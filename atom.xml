<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>ç§‹è¿‡å†¬æ¼«é•¿</title>
  
  <subtitle>æ²¡æœ‰æ¯”è„šæ›´é•¿çš„è·¯ï¼Œèµ°è¿‡å»ï¼Œå‰é¢æ˜¯ä¸ªå¤©ï¼</subtitle>
  <link href="https://alexhuihui.github.io/atom.xml" rel="self"/>
  
  <link href="https://alexhuihui.github.io/"/>
  <updated>2025-04-21T09:07:32.798Z</updated>
  <id>https://alexhuihui.github.io/</id>
  
  <author>
    <name>æ±ªæ°¸æ™–</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>ã€æ•…éšœæ’æŸ¥ã€‘SSH è¿æ¥GitHubå¤±æ•ˆ</title>
    <link href="https://alexhuihui.github.io/article/20250421.html"/>
    <id>https://alexhuihui.github.io/article/20250421.html</id>
    <published>2025-04-21T09:03:59.000Z</published>
    <updated>2025-04-21T09:07:32.798Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Git-SSH-æ— æ³•è¿æ¥-GitHub-çš„æ’æŸ¥ä¸ä»£ç†é…ç½®ï¼ˆClash-ç¯å¢ƒï¼‰"><a href="#Git-SSH-æ— æ³•è¿æ¥-GitHub-çš„æ’æŸ¥ä¸ä»£ç†é…ç½®ï¼ˆClash-ç¯å¢ƒï¼‰" class="headerlink" title="Git SSH æ— æ³•è¿æ¥ GitHub çš„æ’æŸ¥ä¸ä»£ç†é…ç½®ï¼ˆClash ç¯å¢ƒï¼‰"></a>Git SSH æ— æ³•è¿æ¥ GitHub çš„æ’æŸ¥ä¸ä»£ç†é…ç½®ï¼ˆClash ç¯å¢ƒï¼‰</h1><p>åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œä½¿ç”¨ Git SSH è¿æ¥ GitHub æ˜¯å¸¸è§çš„æ“ä½œï¼Œæœ€è¿‘åœ¨æœ¬åœ°å¼€å‘ä¸­å°±é‡åˆ°äº†ç±»ä¼¼çš„é—®é¢˜ï¼Œæ‰§è¡Œ <code>git pull</code> æŠ¥é”™ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh: connect to host ssh.github.com port 443: Connection refused</span><br></pre></td></tr></table></figure><span id="more"></span> <h2 id="æ’æŸ¥æ–¹å‘ï¼ˆå®¢æˆ·ç«¯é…ç½®ã€SSH-ä½¿ç”¨æ–¹å¼ã€æœ¬åœ°ç½‘ç»œã€ä»£ç†ç­‰ç»´åº¦ï¼‰"><a href="#æ’æŸ¥æ–¹å‘ï¼ˆå®¢æˆ·ç«¯é…ç½®ã€SSH-ä½¿ç”¨æ–¹å¼ã€æœ¬åœ°ç½‘ç»œã€ä»£ç†ç­‰ç»´åº¦ï¼‰" class="headerlink" title="æ’æŸ¥æ–¹å‘ï¼ˆå®¢æˆ·ç«¯é…ç½®ã€SSH ä½¿ç”¨æ–¹å¼ã€æœ¬åœ°ç½‘ç»œã€ä»£ç†ç­‰ç»´åº¦ï¼‰"></a>æ’æŸ¥æ–¹å‘ï¼ˆå®¢æˆ·ç«¯é…ç½®ã€SSH ä½¿ç”¨æ–¹å¼ã€æœ¬åœ°ç½‘ç»œã€ä»£ç†ç­‰ç»´åº¦ï¼‰</h2><h3 id="ä¸€ã€å®¢æˆ·ç«¯é…ç½®æ£€æŸ¥"><a href="#ä¸€ã€å®¢æˆ·ç«¯é…ç½®æ£€æŸ¥" class="headerlink" title="ä¸€ã€å®¢æˆ·ç«¯é…ç½®æ£€æŸ¥"></a>ä¸€ã€å®¢æˆ·ç«¯é…ç½®æ£€æŸ¥</h3><ul><li><p>æ˜¯ä½¿ç”¨ SSH åè®®è¿˜æ˜¯ HTTPSï¼Ÿ</p><blockquote><p>é€šè¿‡ <code>git remote -v</code> æŸ¥çœ‹è¿œç¨‹åœ°å€æ˜¯å¦ä¸º <code>git@github.com:xxx</code>ï¼ˆSSHï¼‰</p></blockquote></li><li><p>æœ¬åœ°æ˜¯å¦å­˜åœ¨ SSH Keyï¼ŸGitHub æ˜¯å¦é…ç½®äº†å…¬é’¥ï¼Ÿ</p><blockquote><p>æ£€æŸ¥ <code>~/.ssh/id_rsa.pub</code>ï¼Œå¹¶ç¡®è®¤ GitHub è®¾ç½®ä¸­æ·»åŠ äº†å¯¹åº”çš„ SSH å…¬é’¥</p></blockquote></li><li><p>SSH é…ç½®æ–‡ä»¶ <code>~/.ssh/config</code> æ˜¯å¦æœ‰è¯¯ï¼Ÿ</p></li></ul><hr><h3 id="äºŒã€GitHub-SSH-æœåŠ¡æ˜¯å¦å¯ç”¨"><a href="#äºŒã€GitHub-SSH-æœåŠ¡æ˜¯å¦å¯ç”¨" class="headerlink" title="äºŒã€GitHub SSH æœåŠ¡æ˜¯å¦å¯ç”¨"></a>äºŒã€GitHub SSH æœåŠ¡æ˜¯å¦å¯ç”¨</h3><h4 id="ğŸ“¡-ä½¿ç”¨-telnet-æˆ–-nc-æµ‹è¯•æ˜¯å¦èƒ½è®¿é—®-ssh-github-com-443"><a href="#ğŸ“¡-ä½¿ç”¨-telnet-æˆ–-nc-æµ‹è¯•æ˜¯å¦èƒ½è®¿é—®-ssh-github-com-443" class="headerlink" title="ğŸ“¡ ä½¿ç”¨ telnet æˆ– nc æµ‹è¯•æ˜¯å¦èƒ½è®¿é—® ssh.github.com:443"></a>ğŸ“¡ ä½¿ç”¨ telnet æˆ– nc æµ‹è¯•æ˜¯å¦èƒ½è®¿é—® <code>ssh.github.com:443</code></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -vz ssh.github.com 443</span><br></pre></td></tr></table></figure><p>å¦‚æœæ˜¾ç¤ºè¿æ¥å¤±è´¥ï¼Œæœ‰å¯èƒ½æ˜¯è¢«é˜²ç«å¢™æ‹¦æˆªæˆ–ç½‘ç»œé™åˆ¶ã€‚</p><hr><h3 id="ä¸‰ã€æœ¬åœ°ç½‘ç»œæˆ–ä»£ç†é—®é¢˜"><a href="#ä¸‰ã€æœ¬åœ°ç½‘ç»œæˆ–ä»£ç†é—®é¢˜" class="headerlink" title="ä¸‰ã€æœ¬åœ°ç½‘ç»œæˆ–ä»£ç†é—®é¢˜"></a>ä¸‰ã€æœ¬åœ°ç½‘ç»œæˆ–ä»£ç†é—®é¢˜</h3><h4 id="Clash-æ˜¯å¦å·²å¼€å¯ï¼Ÿ"><a href="#Clash-æ˜¯å¦å·²å¼€å¯ï¼Ÿ" class="headerlink" title="Clash æ˜¯å¦å·²å¼€å¯ï¼Ÿ"></a>Clash æ˜¯å¦å·²å¼€å¯ï¼Ÿ</h4><p>Clash æ˜¯æœ¬åœ°ä»£ç†å·¥å…·ï¼Œé€šå¸¸è¿è¡Œåœ¨ 127.0.0.1:7890ï¼ˆHTTPï¼‰æˆ– 7897ï¼ˆSOCKS5ï¼‰ï¼Œå¯ä»¥ä»£ç†æ‰€æœ‰å‡ºç«™æµé‡ã€‚</p><p>è‹¥æœªå¼€å¯æˆ–æœªå¯ç”¨ç³»ç»Ÿä»£ç†ï¼Œåˆ™ Git SSH ä¸ä¼šè‡ªåŠ¨èµ°ä»£ç†ã€‚</p><hr><h3 id="å››ã€é…ç½®-SSH-ä½¿ç”¨-Clash-çš„-SOCKS5-ä»£ç†"><a href="#å››ã€é…ç½®-SSH-ä½¿ç”¨-Clash-çš„-SOCKS5-ä»£ç†" class="headerlink" title="å››ã€é…ç½® SSH ä½¿ç”¨ Clash çš„ SOCKS5 ä»£ç†"></a>å››ã€é…ç½® SSH ä½¿ç”¨ Clash çš„ SOCKS5 ä»£ç†</h3><p>ä¸ºäº†è§£å†³ SSH è¿æ¥æ— æ³•é€šè¿‡ç½‘ç»œç›´è¿ GitHub çš„é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>ProxyCommand</code> æ–¹å¼ï¼Œé…ç½® Git çš„ SSH ä½¿ç”¨ Clash çš„ä»£ç†ã€‚</p><h4 id="âœ…-æ¨èä½¿ç”¨-connect-exe-ä½œä¸ºä»£ç†å·¥å…·"><a href="#âœ…-æ¨èä½¿ç”¨-connect-exe-ä½œä¸ºä»£ç†å·¥å…·" class="headerlink" title="âœ… æ¨èä½¿ç”¨ connect.exe ä½œä¸ºä»£ç†å·¥å…·"></a>âœ… æ¨èä½¿ç”¨ connect.exe ä½œä¸ºä»£ç†å·¥å…·</h4><ol><li>Git è‡ªå¸¦ï¼š</li><li>ä¿®æ”¹ <code>~/.ssh/config</code> æ–‡ä»¶å¦‚ä¸‹ï¼š</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Host github.com</span><br><span class="line">  HostName ssh.github.com</span><br><span class="line">  Port 443</span><br><span class="line">  User git</span><br><span class="line">  IdentityFile ~/.ssh/id_rsa</span><br><span class="line">  TCPKeepAlive yes</span><br><span class="line">  ProxyCommand &quot;C:\Program Files\Git\mingw64\bin\connect.exe&quot; -S 127.0.0.1:7897 -a none %h %p</span><br><span class="line"></span><br><span class="line">Host ssh.github.com</span><br><span class="line">  HostName ssh.github.com</span><br><span class="line">  Port 443</span><br><span class="line">  User git</span><br><span class="line">  IdentityFile ~/.ssh/id_rsa</span><br><span class="line">  TCPKeepAlive yes</span><br><span class="line">  ProxyCommand &quot;C:\Program Files\Git\mingw64\bin\connect.exe&quot; -S 127.0.0.1:7897 -a none %h %p</span><br></pre></td></tr></table></figure><blockquote><p>è¿™é‡ŒæŒ‡å®šäº†é€šè¿‡ Clash çš„æœ¬åœ° SOCKS5 ä»£ç†ï¼ˆ127.0.0.1:7897ï¼‰è¿æ¥ GitHub çš„ SSH æœåŠ¡å™¨ã€‚</p></blockquote><hr><h3 id="äº”ã€éªŒè¯è¿æ¥æ˜¯å¦æˆåŠŸ"><a href="#äº”ã€éªŒè¯è¿æ¥æ˜¯å¦æˆåŠŸ" class="headerlink" title="äº”ã€éªŒè¯è¿æ¥æ˜¯å¦æˆåŠŸ"></a>äº”ã€éªŒè¯è¿æ¥æ˜¯å¦æˆåŠŸ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -T git@github.com</span><br></pre></td></tr></table></figure><p>å¦‚æœè¾“å‡ºï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hi your-username! You<span class="string">&#x27;ve successfully authenticated...</span></span><br></pre></td></tr></table></figure><h2 id="æ€»ç»“ä¸å»ºè®®"><a href="#æ€»ç»“ä¸å»ºè®®" class="headerlink" title="æ€»ç»“ä¸å»ºè®®"></a>æ€»ç»“ä¸å»ºè®®</h2><ul><li>å¦‚æœä½ ç”¨çš„æ˜¯ SSH åè®®ï¼ˆ<code>git@github.com</code>ï¼‰ï¼Œå°±éœ€è¦é…ç½® SSH çš„ <code>ProxyCommand</code> æ‰èƒ½èµ°ä»£ç†ã€‚</li><li>æ¨èä½¿ç”¨ <code>connect.exe</code> å·¥å…·ï¼Œå…¼å®¹æ€§æ›´å¥½ã€‚</li></ul><p>å¦‚æœä½ ä¹Ÿé‡åˆ° Git SSH æ— æ³•è¿æ¥çš„é—®é¢˜ï¼Œä¸å¦¨å‚è€ƒä»¥ä¸Šæ–¹å¼é…ç½®ä»£ç†ï¼Œå¤§æ¦‚ç‡å°±èƒ½è§£å†³äº†ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;Git-SSH-æ— æ³•è¿æ¥-GitHub-çš„æ’æŸ¥ä¸ä»£ç†é…ç½®ï¼ˆClash-ç¯å¢ƒï¼‰&quot;&gt;&lt;a href=&quot;#Git-SSH-æ— æ³•è¿æ¥-GitHub-çš„æ’æŸ¥ä¸ä»£ç†é…ç½®ï¼ˆClash-ç¯å¢ƒï¼‰&quot; class=&quot;headerlink&quot; title=&quot;Git SSH æ— æ³•è¿æ¥ GitHub çš„æ’æŸ¥ä¸ä»£ç†é…ç½®ï¼ˆClash ç¯å¢ƒï¼‰&quot;&gt;&lt;/a&gt;Git SSH æ— æ³•è¿æ¥ GitHub çš„æ’æŸ¥ä¸ä»£ç†é…ç½®ï¼ˆClash ç¯å¢ƒï¼‰&lt;/h1&gt;&lt;p&gt;åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œä½¿ç”¨ Git SSH è¿æ¥ GitHub æ˜¯å¸¸è§çš„æ“ä½œï¼Œæœ€è¿‘åœ¨æœ¬åœ°å¼€å‘ä¸­å°±é‡åˆ°äº†ç±»ä¼¼çš„é—®é¢˜ï¼Œæ‰§è¡Œ &lt;code&gt;git pull&lt;/code&gt; æŠ¥é”™ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;ssh: connect to host ssh.github.com port 443: Connection refused&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="æ•…éšœæ’æŸ¥" scheme="https://alexhuihui.github.io/categories/%E6%95%85%E9%9A%9C%E6%8E%92%E6%9F%A5/"/>
    
    
    <category term="æ•…éšœæ’æŸ¥" scheme="https://alexhuihui.github.io/tags/%E6%95%85%E9%9A%9C%E6%8E%92%E6%9F%A5/"/>
    
    <category term="ssh" scheme="https://alexhuihui.github.io/tags/ssh/"/>
    
  </entry>
  
  <entry>
    <title>ã€æ•…éšœæ’æŸ¥ã€‘ä¸ƒç‰›äº‘ä¸Šä¼ é—®é¢˜æ’æŸ¥</title>
    <link href="https://alexhuihui.github.io/article/20250416.html"/>
    <id>https://alexhuihui.github.io/article/20250416.html</id>
    <published>2025-04-16T08:54:53.000Z</published>
    <updated>2025-04-16T09:18:52.248Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ä¸ƒç‰›äº‘ä¸Šä¼ é—®é¢˜æ’æŸ¥"><a href="#ä¸ƒç‰›äº‘ä¸Šä¼ é—®é¢˜æ’æŸ¥" class="headerlink" title="ä¸ƒç‰›äº‘ä¸Šä¼ é—®é¢˜æ’æŸ¥"></a>ä¸ƒç‰›äº‘ä¸Šä¼ é—®é¢˜æ’æŸ¥</h1><p>åœ¨ä¸€ä¸ªå•†åŸçš„åº”ç”¨ä¸­é‡åˆ°äº†æ–‡ä»¶ä¸Šä¼ ç¼“æ…¢çš„é—®é¢˜ï¼Œæ¯”å¦‚ä¸Šä¼ ä¸€ä¸ª 3M çš„å›¾ç‰‡ï¼Œå±…ç„¶è€—æ—¶2åˆ†é’Ÿã€‚è¿™æ˜æ˜¾æ˜¯æœ‰é—®é¢˜çš„ï¼Œæ¥ä¸‹æ¥æ˜¯æ’æŸ¥çš„æµç¨‹ã€‚</p><span id="more"></span> <h2 id="æ’æŸ¥æ–¹å‘ï¼ˆåˆ†æœåŠ¡ç«¯ã€æœ¬åœ°å®¢æˆ·ç«¯ã€ç½‘ç»œã€ä¸ƒç‰›é…ç½®ç­‰ç»´åº¦ï¼‰"><a href="#æ’æŸ¥æ–¹å‘ï¼ˆåˆ†æœåŠ¡ç«¯ã€æœ¬åœ°å®¢æˆ·ç«¯ã€ç½‘ç»œã€ä¸ƒç‰›é…ç½®ç­‰ç»´åº¦ï¼‰" class="headerlink" title="æ’æŸ¥æ–¹å‘ï¼ˆåˆ†æœåŠ¡ç«¯ã€æœ¬åœ°å®¢æˆ·ç«¯ã€ç½‘ç»œã€ä¸ƒç‰›é…ç½®ç­‰ç»´åº¦ï¼‰"></a>æ’æŸ¥æ–¹å‘ï¼ˆåˆ†æœåŠ¡ç«¯ã€æœ¬åœ°å®¢æˆ·ç«¯ã€ç½‘ç»œã€ä¸ƒç‰›é…ç½®ç­‰ç»´åº¦ï¼‰</h2><h3 id="ä¸€ã€å®¢æˆ·ç«¯ä»£ç é—®é¢˜"><a href="#ä¸€ã€å®¢æˆ·ç«¯ä»£ç é—®é¢˜" class="headerlink" title="ä¸€ã€å®¢æˆ·ç«¯ä»£ç é—®é¢˜"></a>ä¸€ã€å®¢æˆ·ç«¯ä»£ç é—®é¢˜</h3><ul><li>æœ‰æ²¡æœ‰ä½¿ç”¨ <code>InputStream</code> å¼‚å¸¸è€—æ—¶çš„å†™æ³•ï¼Ÿï¼ˆæ¯”å¦‚è¯»å–æµç‰¹åˆ«æ…¢ã€é˜»å¡ï¼‰</li><li>æ–‡ä»¶æ˜¯ä¸´æ—¶ç”Ÿæˆçš„å—ï¼Ÿï¼ˆä¸´æ—¶æ–‡ä»¶ç”Ÿæˆç¼“æ…¢ï¼‰</li><li>æœ‰æ²¡æœ‰å¯¹ <code>fileBytes</code> åš base64 ç¼–ç ç­‰å¤šä½™å¤„ç†ï¼Ÿ</li></ul><hr><h3 id="äºŒã€ç½‘ç»œé—®é¢˜"><a href="#äºŒã€ç½‘ç»œé—®é¢˜" class="headerlink" title="äºŒã€ç½‘ç»œé—®é¢˜"></a>äºŒã€ç½‘ç»œé—®é¢˜</h3><h4 id="ğŸ“¡-æœåŠ¡ç«¯åˆ°ä¸ƒç‰›çš„ç½‘ç»œå»¶è¿Ÿå¤§æˆ–è€…å¸¦å®½ä¸è¶³ï¼Ÿ"><a href="#ğŸ“¡-æœåŠ¡ç«¯åˆ°ä¸ƒç‰›çš„ç½‘ç»œå»¶è¿Ÿå¤§æˆ–è€…å¸¦å®½ä¸è¶³ï¼Ÿ" class="headerlink" title="ğŸ“¡ æœåŠ¡ç«¯åˆ°ä¸ƒç‰›çš„ç½‘ç»œå»¶è¿Ÿå¤§æˆ–è€…å¸¦å®½ä¸è¶³ï¼Ÿ"></a>ğŸ“¡ æœåŠ¡ç«¯åˆ°ä¸ƒç‰›çš„ç½‘ç»œå»¶è¿Ÿå¤§æˆ–è€…å¸¦å®½ä¸è¶³ï¼Ÿ</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">traceroute upload.qiniup.com</span><br></pre></td></tr></table></figure><hr><h3 id="ä¸‰ã€ä¸ƒç‰›äº‘é…ç½®æ˜¯å¦å¼‚å¸¸ï¼ˆæ¯”å¦‚-bucket-ç»‘å®šäº†è¾ƒè¿œçš„å­˜å‚¨åŒºåŸŸï¼‰"><a href="#ä¸‰ã€ä¸ƒç‰›äº‘é…ç½®æ˜¯å¦å¼‚å¸¸ï¼ˆæ¯”å¦‚-bucket-ç»‘å®šäº†è¾ƒè¿œçš„å­˜å‚¨åŒºåŸŸï¼‰" class="headerlink" title="ä¸‰ã€ä¸ƒç‰›äº‘é…ç½®æ˜¯å¦å¼‚å¸¸ï¼ˆæ¯”å¦‚ bucket ç»‘å®šäº†è¾ƒè¿œçš„å­˜å‚¨åŒºåŸŸï¼‰"></a>ä¸‰ã€ä¸ƒç‰›äº‘é…ç½®æ˜¯å¦å¼‚å¸¸ï¼ˆæ¯”å¦‚ bucket ç»‘å®šäº†è¾ƒè¿œçš„å­˜å‚¨åŒºåŸŸï¼‰</h3><h4 id="Region-è®¾ç½®æ˜¯å¦æ­£ç¡®ï¼Ÿ"><a href="#Region-è®¾ç½®æ˜¯å¦æ­£ç¡®ï¼Ÿ" class="headerlink" title="Region è®¾ç½®æ˜¯å¦æ­£ç¡®ï¼Ÿ"></a>Region è®¾ç½®æ˜¯å¦æ­£ç¡®ï¼Ÿ</h4><p>ä¸ƒç‰›æœ‰å¤šä¸ªåŒºåŸŸï¼Œæ¯”å¦‚åä¸œã€ååŒ—ã€åå—ã€åŒ—ç¾ã€‚åº”è¯¥è®¾ç½®ä¸æœåŠ¡å™¨ç‰©ç†ä½ç½®æœ€æ¥è¿‘çš„ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Configuration cfg = <span class="keyword">new</span> Configuration(Region.huabei()); <span class="comment">// ååŒ—</span></span><br></pre></td></tr></table></figure><hr><h3 id="å››ã€æ’æŸ¥ä¸Šä¼ è¿‡ç¨‹æ—¥å¿—"><a href="#å››ã€æ’æŸ¥ä¸Šä¼ è¿‡ç¨‹æ—¥å¿—" class="headerlink" title="å››ã€æ’æŸ¥ä¸Šä¼ è¿‡ç¨‹æ—¥å¿—"></a>å››ã€æ’æŸ¥ä¸Šä¼ è¿‡ç¨‹æ—¥å¿—</h3><h4 id="æ‰“å¼€è¯¦ç»†æ—¥å¿—ï¼š"><a href="#æ‰“å¼€è¯¦ç»†æ—¥å¿—ï¼š" class="headerlink" title="æ‰“å¼€è¯¦ç»†æ—¥å¿—ï¼š"></a>æ‰“å¼€è¯¦ç»†æ—¥å¿—ï¼š</h4><ul><li>ä¸ƒç‰› SDK æ”¯æŒå¼€å¯ debug æ¨¡å¼ï¼ˆè¾“å‡ºæ—¥å¿—ï¼‰</li><li>åœ¨æœåŠ¡ç«¯è®°å½•ä¸Šä¼ è€—æ—¶ï¼šä»æ¥æ”¶åˆ°æ–‡ä»¶ â†’ ä¸Šä¼ å®Œæˆ çš„æ•´ä½“è€—æ—¶</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">long</span> start = System.currentTimeMillis();</span><br><span class="line"><span class="comment">// ä¸Šä¼ é€»è¾‘</span></span><br><span class="line"><span class="keyword">long</span> end = System.currentTimeMillis();</span><br><span class="line">System.out.println(<span class="string">&quot;ä¸Šä¼ è€—æ—¶: &quot;</span> + (end - start) + <span class="string">&quot;ms&quot;</span>);</span><br></pre></td></tr></table></figure><h2 id="ä¿®å¤ä»£ç "><a href="#ä¿®å¤ä»£ç " class="headerlink" title="ä¿®å¤ä»£ç "></a>ä¿®å¤ä»£ç </h2><ol><li>ä½¿ç”¨ byte[] ä¸Šä¼ </li><li>é…ç½®ç›¸è¿‘çš„ä¸Šä¼ åŒºåŸŸ</li></ol><p>ä»¥ä¸Šæ”¹åŠ¨éƒ½æ²¡æœ‰ä¼˜åŒ–ä¸Šä¼ é€Ÿåº¦ï¼Œæ€€ç–‘æ˜¯ç½‘ç»œå‡ºé—®é¢˜äº†</p><h2 id="æ’æŸ¥ç½‘ç»œé—®é¢˜"><a href="#æ’æŸ¥ç½‘ç»œé—®é¢˜" class="headerlink" title="æ’æŸ¥ç½‘ç»œé—®é¢˜"></a>æ’æŸ¥ç½‘ç»œé—®é¢˜</h2><p>é€šè¿‡ ping ç­‰å·¥å…·å‘ç°å»¶è¿Ÿå’Œä¸¢åŒ…æƒ…å†µæ˜¯éå¸¸å¥åº·çš„ï¼Œç´§æ¥ç€ä½¿ç”¨iperf3æµ‹è¯•å¸¦å®½</p><p>A æœåŠ¡å™¨è¿è¡Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iperf3 -s</span><br></pre></td></tr></table></figure><p>B æœåŠ¡å™¨è¿è¡Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iperf3 -c &lt;server-ip&gt; -R   <span class="comment"># æµ‹è¯•ä¸Šä¼ å¸¦å®½</span></span><br></pre></td></tr></table></figure><p>å‘ç°ä¸Šè¡Œé€Ÿåº¦ç¡®å®å¾ˆæ…¢</p><p>ä¸ºäº†æ›´è¿›ä¸€æ­¥çš„ç¡®è®¤ åˆä½¿ç”¨ <code>nload </code>æŸ¥çœ‹å…·ä½“ç½‘å¡çš„å®æ—¶ä¸Šä¼ é€Ÿç‡</p><p>å‘ç°åœ¨ä¸Šä¼ æ–‡ä»¶çš„æ—¶å€™ å¯¹åº”ç½‘å¡çš„ä¸Šä¼ é€Ÿåº¦åªæœ‰ å‡ å <code>kBit/s</code></p><p>é‚£ä¹ˆå°±ç¡®å®šæ˜¯å¸¦å®½ä¸è¶³çš„é—®é¢˜äº†</p><h2 id="è§£å†³é—®é¢˜"><a href="#è§£å†³é—®é¢˜" class="headerlink" title="è§£å†³é—®é¢˜"></a>è§£å†³é—®é¢˜</h2><ol><li><p>ç¡®è®¤æ˜¯ä¸æ˜¯ docker é™åˆ¶äº†é€Ÿç‡</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker inspect file-prod | grep -i bandwidth</span><br></pre></td></tr></table></figure></li><li><p>ç¡®è®¤æ˜¯ä¸æ˜¯äº‘æœåŠ¡å™¨çš„ä¸Šè¡Œå¸¦å®½æœ‰é™åˆ¶</p></li></ol><p>æœ€ç»ˆæˆ‘ä»¬æ‰¾åˆ°äº†å½±å“ä¸Šä¼ é€Ÿåº¦çš„é—®é¢˜ï¼Œå¹¶æˆåŠŸè§£å†³ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;ä¸ƒç‰›äº‘ä¸Šä¼ é—®é¢˜æ’æŸ¥&quot;&gt;&lt;a href=&quot;#ä¸ƒç‰›äº‘ä¸Šä¼ é—®é¢˜æ’æŸ¥&quot; class=&quot;headerlink&quot; title=&quot;ä¸ƒç‰›äº‘ä¸Šä¼ é—®é¢˜æ’æŸ¥&quot;&gt;&lt;/a&gt;ä¸ƒç‰›äº‘ä¸Šä¼ é—®é¢˜æ’æŸ¥&lt;/h1&gt;&lt;p&gt;åœ¨ä¸€ä¸ªå•†åŸçš„åº”ç”¨ä¸­é‡åˆ°äº†æ–‡ä»¶ä¸Šä¼ ç¼“æ…¢çš„é—®é¢˜ï¼Œæ¯”å¦‚ä¸Šä¼ ä¸€ä¸ª 3M çš„å›¾ç‰‡ï¼Œå±…ç„¶è€—æ—¶2åˆ†é’Ÿã€‚è¿™æ˜æ˜¾æ˜¯æœ‰é—®é¢˜çš„ï¼Œæ¥ä¸‹æ¥æ˜¯æ’æŸ¥çš„æµç¨‹ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="æ•…éšœæ’æŸ¥" scheme="https://alexhuihui.github.io/categories/%E6%95%85%E9%9A%9C%E6%8E%92%E6%9F%A5/"/>
    
    
    <category term="æ•…éšœæ’æŸ¥" scheme="https://alexhuihui.github.io/tags/%E6%95%85%E9%9A%9C%E6%8E%92%E6%9F%A5/"/>
    
  </entry>
  
  <entry>
    <title>ã€DNSã€‘DNSçš„æ¶æ„</title>
    <link href="https://alexhuihui.github.io/article/20250125.html"/>
    <id>https://alexhuihui.github.io/article/20250125.html</id>
    <published>2025-01-25T12:28:38.000Z</published>
    <updated>2025-01-25T12:29:09.828Z</updated>
    
    
    
    
    <category term="DNS" scheme="https://alexhuihui.github.io/categories/DNS/"/>
    
    
    <category term="DNS" scheme="https://alexhuihui.github.io/tags/DNS/"/>
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨ cloudflare tunnel</title>
    <link href="https://alexhuihui.github.io/article/20250113.html"/>
    <id>https://alexhuihui.github.io/article/20250113.html</id>
    <published>2025-01-13T11:54:06.000Z</published>
    <updated>2025-01-25T13:27:36.360Z</updated>
    
    <content type="html"><![CDATA[<p>ä½¿ç”¨ cloudflare tunnel</p><span id="more"></span> <h4 id="1-åˆ›å»ºå¤šä¸ª-Tunnel"><a href="#1-åˆ›å»ºå¤šä¸ª-Tunnel" class="headerlink" title="1. åˆ›å»ºå¤šä¸ª Tunnel"></a>1. <strong>åˆ›å»ºå¤šä¸ª Tunnel</strong></h4><p>æ¯ä¸ª Tunnel éƒ½éœ€è¦ç‹¬ç«‹åˆ›å»ºã€‚ä»¥ SSH å’Œ HTTPS ä¸ºä¾‹ï¼š</p><ol><li><p><strong>åˆ›å»º SSH Tunnel</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cloudflared tunnel create ssh-tunnel</span><br></pre></td></tr></table></figure></li><li><p><strong>åˆ›å»º HTTPS Tunnel</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cloudflared tunnel create https-tunnel</span><br></pre></td></tr></table></figure></li></ol><p>æ¯ä¸ª Tunnel éƒ½ä¼šç”Ÿæˆä¸€ä¸ªå”¯ä¸€çš„ <code>credentials-file</code>ï¼Œé€šå¸¸ä½äº <code>~/.cloudflared/</code> ç›®å½•ä¸‹ã€‚</p><hr><h4 id="2-é…ç½®å¤šä¸ª-Tunnel-çš„æœåŠ¡"><a href="#2-é…ç½®å¤šä¸ª-Tunnel-çš„æœåŠ¡" class="headerlink" title="2. é…ç½®å¤šä¸ª Tunnel çš„æœåŠ¡"></a>2. <strong>é…ç½®å¤šä¸ª Tunnel çš„æœåŠ¡</strong></h4><p>ä¸ºæ¯ä¸ª Tunnel åˆ›å»ºç‹¬ç«‹çš„é…ç½®æ–‡ä»¶ã€‚ä¾‹å¦‚ï¼š</p><h5 id="SSH-Tunnel-é…ç½®"><a href="#SSH-Tunnel-é…ç½®" class="headerlink" title="SSH Tunnel é…ç½®"></a><strong>SSH Tunnel é…ç½®</strong></h5><p>åˆ›å»ºæˆ–ç¼–è¾‘ <code>~/.cloudflared/ssh-config.yml</code>ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">tunnel:</span> <span class="string">ssh-tunnel</span></span><br><span class="line"><span class="attr">credentials-file:</span> <span class="string">/home/your-user/.cloudflared/ssh-tunnel.json</span></span><br><span class="line"></span><br><span class="line"><span class="attr">ingress:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">hostname:</span> <span class="string">ssh.example.com</span></span><br><span class="line">    <span class="attr">service:</span> <span class="string">ssh://localhost:22</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">service:</span> <span class="string">http_status:404</span></span><br></pre></td></tr></table></figure><h5 id="HTTPS-Tunnel-é…ç½®"><a href="#HTTPS-Tunnel-é…ç½®" class="headerlink" title="HTTPS Tunnel é…ç½®"></a><strong>HTTPS Tunnel é…ç½®</strong></h5><p>åˆ›å»ºæˆ–ç¼–è¾‘ <code>~/.cloudflared/https-config.yml</code>ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">tunnel:</span> <span class="string">https-tunnel</span></span><br><span class="line"><span class="attr">credentials-file:</span> <span class="string">/home/your-user/.cloudflared/https-tunnel.json</span></span><br><span class="line"></span><br><span class="line"><span class="attr">ingress:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">hostname:</span> <span class="string">www.example.com</span></span><br><span class="line">    <span class="attr">service:</span> <span class="string">http://localhost:80</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">service:</span> <span class="string">http_status:404</span></span><br></pre></td></tr></table></figure><hr><h4 id="3-åˆ›å»ºDNSè®°å½•"><a href="#3-åˆ›å»ºDNSè®°å½•" class="headerlink" title="3. åˆ›å»ºDNSè®°å½•"></a>3. <strong>åˆ›å»ºDNSè®°å½•</strong></h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo cloudflared tunnel route dns ssh-tunnel ssh.example.com</span><br><span class="line"></span><br><span class="line">sudo cloudflared tunnel route dns https-tunnel www.example.com</span><br></pre></td></tr></table></figure><h4 id="4-å¯åŠ¨å¤šä¸ª-Tunnel"><a href="#4-å¯åŠ¨å¤šä¸ª-Tunnel" class="headerlink" title="4. å¯åŠ¨å¤šä¸ª Tunnel"></a>4. <strong>å¯åŠ¨å¤šä¸ª Tunnel</strong></h4><p>å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åˆ†åˆ«å¯åŠ¨æ¯ä¸ª Tunnelï¼š</p><ul><li><p>å¯åŠ¨ SSH Tunnelï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cloudflared tunnel --config ~/.cloudflared/ssh-config.yml run ssh-tunnel</span><br></pre></td></tr></table></figure></li><li><p>å¯åŠ¨ HTTPS Tunnelï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cloudflared tunnel --config ~/.cloudflared/https-config.yml run https-tunnel</span><br></pre></td></tr></table></figure></li></ul><hr><h4 id="5-ä½¿ç”¨-Systemd-ç®¡ç†å¤šä¸ª-Tunnel"><a href="#5-ä½¿ç”¨-Systemd-ç®¡ç†å¤šä¸ª-Tunnel" class="headerlink" title="5. ä½¿ç”¨ Systemd ç®¡ç†å¤šä¸ª Tunnel"></a>5. <strong>ä½¿ç”¨ Systemd ç®¡ç†å¤šä¸ª Tunnel</strong></h4><p>ä¸ºæ¯ä¸ª Tunnel é…ç½®ä¸€ä¸ª Systemd æœåŠ¡ï¼Œä»¥ä¾¿åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶è‡ªåŠ¨è¿è¡Œã€‚</p><ol><li><p><strong>åˆ›å»º Systemd æœåŠ¡æ–‡ä»¶</strong></p><ul><li><p>ä¸º SSH Tunnel åˆ›å»ºæœåŠ¡æ–‡ä»¶ <code>/etc/systemd/system/ssh-tunnel.service</code>ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[Unit]</span></span><br><span class="line"><span class="attr">Description</span>=Cloudflare Tunnel for SSH</span><br><span class="line"><span class="attr">After</span>=network.target</span><br><span class="line"></span><br><span class="line"><span class="section">[Service]</span></span><br><span class="line"><span class="attr">ExecStart</span>=/usr/local/bin/cloudflared tunnel --config /home/your-user/.cloudflared/ssh-config.yml run ssh-tunnel</span><br><span class="line"><span class="attr">Restart</span>=always</span><br><span class="line"><span class="attr">User</span>=your-user</span><br><span class="line"></span><br><span class="line"><span class="section">[Install]</span></span><br><span class="line"><span class="attr">WantedBy</span>=multi-user.target</span><br></pre></td></tr></table></figure></li><li><p>ä¸º HTTPS Tunnel åˆ›å»ºæœåŠ¡æ–‡ä»¶ <code>/etc/systemd/system/https-tunnel.service</code>ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[Unit]</span></span><br><span class="line"><span class="attr">Description</span>=Cloudflare Tunnel for HTTPS</span><br><span class="line"><span class="attr">After</span>=network.target</span><br><span class="line"></span><br><span class="line"><span class="section">[Service]</span></span><br><span class="line"><span class="attr">ExecStart</span>=/usr/local/bin/cloudflared tunnel --config /home/your-user/.cloudflared/https-config.yml run https-tunnel</span><br><span class="line"><span class="attr">Restart</span>=always</span><br><span class="line"><span class="attr">User</span>=your-user</span><br><span class="line"></span><br><span class="line"><span class="section">[Install]</span></span><br><span class="line"><span class="attr">WantedBy</span>=multi-user.target</span><br></pre></td></tr></table></figure></li></ul></li><li><p><strong>å¯åŠ¨å’Œå¯ç”¨æœåŠ¡</strong></p><ul><li><p>å¯åŠ¨ SSH Tunnel æœåŠ¡ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl start ssh-tunnel</span><br><span class="line">sudo systemctl <span class="built_in">enable</span> ssh-tunnel</span><br></pre></td></tr></table></figure></li><li><p>å¯åŠ¨ HTTPS Tunnel æœåŠ¡ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl start https-tunnel</span><br><span class="line">sudo systemctl <span class="built_in">enable</span> https-tunnel</span><br></pre></td></tr></table></figure></li></ul></li></ol><hr><h4 id="6-é…ç½®æœ¬åœ°çš„-ssh"><a href="#6-é…ç½®æœ¬åœ°çš„-ssh" class="headerlink" title="6. **é…ç½®æœ¬åœ°çš„ ssh **"></a>6. **é…ç½®æœ¬åœ°çš„ ssh **</h4><p>éœ€è¦åœ¨æœ¬åœ°sshé…ç½®ä»£ç†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Host ssh.example.com</span><br><span class="line">ProxyCommand C:\\Users\\29308\\.ssh\\cloudflared-windows-amd64.exe access ssh --hostname %h</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;ä½¿ç”¨ cloudflare tunnel&lt;/p&gt;</summary>
    
    
    
    <category term="cloudflare" scheme="https://alexhuihui.github.io/categories/cloudflare/"/>
    
    
    <category term="tunnel" scheme="https://alexhuihui.github.io/tags/tunnel/"/>
    
    <category term="cloudflare" scheme="https://alexhuihui.github.io/tags/cloudflare/"/>
    
  </entry>
  
  <entry>
    <title>ã€Springã€‘ç¼“å­˜æ³¨è§£@Cacheableã€@CacheEvictã€@CachePutä½¿ç”¨</title>
    <link href="https://alexhuihui.github.io/article/20240525.html"/>
    <id>https://alexhuihui.github.io/article/20240525.html</id>
    <published>2024-05-25T11:54:06.000Z</published>
    <updated>2025-01-25T12:03:12.057Z</updated>
    
    <content type="html"><![CDATA[<p>Spring Cache é€šè¿‡å°è£…ç»Ÿä¸€çš„ç¼“å­˜æŠ½è±¡å±‚ï¼Œæ”¯æŒå¤šç§ç¼“å­˜å®ç°ï¼ˆå¦‚Ehcacheã€Redisã€Caffeineç­‰ï¼‰ã€‚å¯ä»¥ä½¿ç”¨æ³¨è§£@Cacheableã€@CacheEvictã€@CachePutç­‰ä¼˜é›…çš„è¿›è¡Œä½¿ç”¨ï¼Œæ— éœ€ä¿®æ”¹ä¸šåŠ¡ä»£ç ã€‚</p><span id="more"></span> <h3 id="Cacheable"><a href="#Cacheable" class="headerlink" title="@Cacheable"></a>@Cacheable</h3><p><code>@Cacheable</code>æ³¨è§£ç”¨äºåœ¨æ–¹æ³•æ‰§è¡Œå‰æ£€æŸ¥ç¼“å­˜ï¼Œå¦‚æœç¼“å­˜ä¸­æœ‰æ•°æ®åˆ™è¿”å›ç¼“å­˜ä¸­çš„æ•°æ®ï¼Œå¦åˆ™æ‰§è¡Œæ–¹æ³•å¹¶å°†ç»“æœç¼“å­˜ã€‚</p><p><strong>å·¥ä½œåŸç†</strong>ï¼š</p><ol><li><strong>æ–¹æ³•è°ƒç”¨å‰</strong>ï¼š<ul><li>AOPä»£ç†æ‹¦æˆªæ–¹æ³•è°ƒç”¨ã€‚</li><li>ä»æŒ‡å®šçš„ç¼“å­˜åŒºï¼ˆ<code>value</code>å±æ€§æŒ‡å®šï¼‰ä¸­æ ¹æ®ç¼“å­˜é”®ï¼ˆ<code>key</code>å±æ€§æŒ‡å®šï¼‰æŸ¥æ‰¾ç¼“å­˜æ¡ç›®ã€‚</li><li>å¦‚æœæ‰¾åˆ°ç¼“å­˜æ¡ç›®ï¼Œåˆ™è¿”å›ç¼“å­˜çš„å€¼ï¼Œä¸æ‰§è¡Œç›®æ ‡æ–¹æ³•ã€‚</li></ul></li><li><strong>æ–¹æ³•è°ƒç”¨å</strong>ï¼š<ul><li>å¦‚æœç¼“å­˜ä¸­æ²¡æœ‰æ‰¾åˆ°æ¡ç›®ï¼Œåˆ™æ‰§è¡Œç›®æ ‡æ–¹æ³•ã€‚</li><li>å°†æ–¹æ³•è¿”å›å€¼å­˜å‚¨åˆ°ç¼“å­˜ä¸­ï¼Œä½¿ç”¨æŒ‡å®šçš„ç¼“å­˜åŒºå’Œç¼“å­˜é”®ã€‚</li></ul></li></ol><p><strong>ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@Cacheable(value = &quot;users&quot;, key = &quot;#userId&quot;)</span><br><span class="line">public User getUserById(Long userId) &#123;</span><br><span class="line">    return userRepository.findById(userId).orElse(null);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="CacheEvict"><a href="#CacheEvict" class="headerlink" title="@CacheEvict"></a>@CacheEvict</h3><p><code>@CacheEvict</code>æ³¨è§£ç”¨äºä»ç¼“å­˜ä¸­ç§»é™¤ä¸€ä¸ªæˆ–å¤šä¸ªæ¡ç›®ï¼Œé€šå¸¸åœ¨æ•°æ®ä¿®æ”¹æˆ–åˆ é™¤æ“ä½œæ—¶ä½¿ç”¨ã€‚</p><p><strong>å·¥ä½œåŸç†</strong>ï¼š</p><ol><li><p>æ–¹æ³•è°ƒç”¨å</p><p>ï¼š</p><ul><li>AOPä»£ç†æ‹¦æˆªæ–¹æ³•è°ƒç”¨ã€‚</li><li>æ‰§è¡Œç›®æ ‡æ–¹æ³•ã€‚</li><li>ä»æŒ‡å®šçš„ç¼“å­˜åŒºï¼ˆ<code>value</code>å±æ€§æŒ‡å®šï¼‰ä¸­æ ¹æ®ç¼“å­˜é”®ï¼ˆ<code>key</code>å±æ€§æŒ‡å®šï¼‰ç§»é™¤ç¼“å­˜æ¡ç›®ã€‚</li><li>å¦‚æœè®¾ç½®äº†<code>allEntries = true</code>ï¼Œåˆ™æ¸…ç©ºæ•´ä¸ªç¼“å­˜åŒºã€‚</li></ul></li></ol><p><strong>ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@CacheEvict(value = &quot;users&quot;, key = &quot;#userId&quot;)</span><br><span class="line">public void deleteUserById(Long userId) &#123;</span><br><span class="line">    userRepository.deleteById(userId);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="CachePut"><a href="#CachePut" class="headerlink" title="@CachePut"></a>@CachePut</h3><p><code>@CachePut</code>æ³¨è§£ç”¨äºåœ¨æ–¹æ³•æ‰§è¡Œåå°†ç»“æœæ›´æ–°åˆ°ç¼“å­˜ä¸­ã€‚ä¸<code>@Cacheable</code>ä¸åŒï¼Œå®ƒæ€»æ˜¯ä¼šæ‰§è¡Œç›®æ ‡æ–¹æ³•ã€‚</p><p><strong>å·¥ä½œåŸç†</strong>ï¼š</p><ol><li><p>æ–¹æ³•è°ƒç”¨å</p><p>ï¼š</p><ul><li>AOPä»£ç†æ‹¦æˆªæ–¹æ³•è°ƒç”¨ã€‚</li><li>æ‰§è¡Œç›®æ ‡æ–¹æ³•ã€‚</li><li>å°†æ–¹æ³•è¿”å›å€¼å­˜å‚¨åˆ°ç¼“å­˜ä¸­ï¼Œä½¿ç”¨æŒ‡å®šçš„ç¼“å­˜åŒºï¼ˆ<code>value</code>å±æ€§æŒ‡å®šï¼‰å’Œç¼“å­˜é”®ï¼ˆ<code>key</code>å±æ€§æŒ‡å®šï¼‰ã€‚</li></ul></li></ol><p><strong>ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@CachePut(value = &quot;users&quot;, key = &quot;#user.id&quot;)</span><br><span class="line">public User updateUser(User user) &#123;</span><br><span class="line">    return userRepository.save(user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>@CacheConfig</code>æ³¨è§£ç”¨äºåœ¨ç±»çº§åˆ«é…ç½®ç¼“å­˜çš„å…¬å…±è®¾ç½®ï¼Œç®€åŒ–æ–¹æ³•çº§åˆ«çš„ç¼“å­˜é…ç½®ã€‚å¦‚æœç±»ä¸­çš„å¤šä¸ªæ–¹æ³•å…±äº«ç›¸åŒçš„ç¼“å­˜é…ç½®ï¼ˆä¾‹å¦‚ç›¸åŒçš„ç¼“å­˜åç§°ï¼‰ï¼Œä½¿ç”¨<code>@CacheConfig</code>å¯ä»¥é¿å…åœ¨æ¯ä¸ªæ–¹æ³•ä¸Šé‡å¤é…ç½®ã€‚</p><h3 id="CacheConfigçš„ä½œç”¨"><a href="#CacheConfigçš„ä½œç”¨" class="headerlink" title="@CacheConfigçš„ä½œç”¨"></a>@CacheConfigçš„ä½œç”¨</h3><ul><li><strong>ç¼“å­˜åç§°</strong>ï¼šè®¾ç½®é»˜è®¤çš„ç¼“å­˜åç§°ï¼Œåº”ç”¨äºè¯¥ç±»ä¸­çš„æ‰€æœ‰ç¼“å­˜æ“ä½œã€‚</li><li><strong>ç¼“å­˜ç®¡ç†å™¨</strong>ï¼šæŒ‡å®šé»˜è®¤çš„ç¼“å­˜ç®¡ç†å™¨ï¼Œåº”ç”¨äºè¯¥ç±»ä¸­çš„æ‰€æœ‰ç¼“å­˜æ“ä½œã€‚</li></ul><h3 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ª<code>UserService</code>ç±»ï¼Œå…¶ä¸­å¤šä¸ªæ–¹æ³•éœ€è¦ä½¿ç”¨ç›¸åŒçš„ç¼“å­˜é…ç½®ã€‚</p><h4 id="ä¸ä½¿ç”¨-CacheConfig"><a href="#ä¸ä½¿ç”¨-CacheConfig" class="headerlink" title="ä¸ä½¿ç”¨@CacheConfig"></a>ä¸ä½¿ç”¨@CacheConfig</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">import org.springframework.cache.annotation.Cacheable;</span><br><span class="line">import org.springframework.cache.annotation.CacheEvict;</span><br><span class="line">import org.springframework.cache.annotation.CachePut;</span><br><span class="line">import org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line">@Service</span><br><span class="line">public class UserService &#123;</span><br><span class="line"></span><br><span class="line">    @Cacheable(value = &quot;users&quot;, key = &quot;#userId&quot;)</span><br><span class="line">    public User getUserById(Long userId) &#123;</span><br><span class="line">        return userRepository.findById(userId).orElse(null);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @CacheEvict(value = &quot;users&quot;, key = &quot;#userId&quot;)</span><br><span class="line">    public void deleteUserById(Long userId) &#123;</span><br><span class="line">        userRepository.deleteById(userId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @CachePut(value = &quot;users&quot;, key = &quot;#user.id&quot;)</span><br><span class="line">    public User updateUser(User user) &#123;</span><br><span class="line">        return userRepository.save(user);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæ¯ä¸ªç¼“å­˜æ³¨è§£éƒ½éœ€è¦æŒ‡å®š<code>value = &quot;users&quot;</code>ï¼Œå¦‚æœæœ‰å¤šä¸ªæ–¹æ³•å…±äº«ç›¸åŒçš„ç¼“å­˜åç§°ï¼Œè¿™æ ·ä¼šæ˜¾å¾—å†—ä½™ã€‚</p><h4 id="ä½¿ç”¨-CacheConfig"><a href="#ä½¿ç”¨-CacheConfig" class="headerlink" title="ä½¿ç”¨@CacheConfig"></a>ä½¿ç”¨@CacheConfig</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">import org.springframework.cache.annotation.CacheConfig;</span><br><span class="line">import org.springframework.cache.annotation.Cacheable;</span><br><span class="line">import org.springframework.cache.annotation.CacheEvict;</span><br><span class="line">import org.springframework.cache.annotation.CachePut;</span><br><span class="line">import org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line">@Service</span><br><span class="line">@CacheConfig(cacheNames = &quot;users&quot;)</span><br><span class="line">public class UserService &#123;</span><br><span class="line"></span><br><span class="line">    @Cacheable(key = &quot;#userId&quot;)</span><br><span class="line">    public User getUserById(Long userId) &#123;</span><br><span class="line">        return userRepository.findById(userId).orElse(null);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @CacheEvict(key = &quot;#userId&quot;)</span><br><span class="line">    public void deleteUserById(Long userId) &#123;</span><br><span class="line">        userRepository.deleteById(userId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @CachePut(key = &quot;#user.id&quot;)</span><br><span class="line">    public User updateUser(User user) &#123;</span><br><span class="line">        return userRepository.save(user);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼š</p><ul><li><code>@CacheConfig(cacheNames = &quot;users&quot;)</code>ï¼šåœ¨ç±»çº§åˆ«é…ç½®é»˜è®¤çš„ç¼“å­˜åç§°ä¸ºâ€œusersâ€ã€‚</li><li>å„ä¸ªæ–¹æ³•ä¸Šä¸å†éœ€è¦é‡å¤æŒ‡å®šç¼“å­˜åç§°ï¼Œåªéœ€è¦é…ç½®<code>key</code>å±æ€§ã€‚</li></ul><h3 id="CacheConfig-çš„ä½¿ç”¨åœºæ™¯"><a href="#CacheConfig-çš„ä½¿ç”¨åœºæ™¯" class="headerlink" title="@CacheConfig çš„ä½¿ç”¨åœºæ™¯"></a>@CacheConfig çš„ä½¿ç”¨åœºæ™¯</h3><ul><li><strong>ç»Ÿä¸€ç¼“å­˜é…ç½®</strong>ï¼šå½“ä¸€ä¸ªç±»ä¸­å¤šä¸ªæ–¹æ³•ä½¿ç”¨ç›¸åŒçš„ç¼“å­˜åç§°æˆ–ç¼“å­˜ç®¡ç†å™¨æ—¶ï¼Œå¯ä»¥é€šè¿‡<code>@CacheConfig</code>ç»Ÿä¸€é…ç½®ï¼Œå‡å°‘ä»£ç å†—ä½™ã€‚</li><li><strong>ç®€åŒ–é…ç½®</strong>ï¼šé¿å…åœ¨æ¯ä¸ªæ–¹æ³•çš„ç¼“å­˜æ³¨è§£ä¸­é‡å¤æŒ‡å®šç›¸åŒçš„ç¼“å­˜åç§°æˆ–å…¶ä»–é…ç½®ã€‚</li></ul><h3 id="è¿›ä¸€æ­¥ç¤ºä¾‹"><a href="#è¿›ä¸€æ­¥ç¤ºä¾‹" class="headerlink" title="è¿›ä¸€æ­¥ç¤ºä¾‹"></a>è¿›ä¸€æ­¥ç¤ºä¾‹</h3><p>å‡è®¾æˆ‘ä»¬åœ¨åŒä¸€ä¸ªç±»ä¸­ä½¿ç”¨å¤šä¸ªç¼“å­˜åç§°ï¼Œå¯ä»¥é€šè¿‡<code>@CacheConfig</code>é…ç½®é»˜è®¤çš„ç¼“å­˜åç§°ï¼ŒåŒæ—¶åœ¨ç‰¹å®šæ–¹æ³•ä¸Šè¦†ç›–é»˜è®¤é…ç½®ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">import org.springframework.cache.annotation.CacheConfig;</span><br><span class="line">import org.springframework.cache.annotation.Cacheable;</span><br><span class="line">import org.springframework.cache.annotation.CacheEvict;</span><br><span class="line">import org.springframework.cache.annotation.CachePut;</span><br><span class="line">import org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line">@Service</span><br><span class="line">@CacheConfig(cacheNames = &quot;users&quot;)</span><br><span class="line">public class UserService &#123;</span><br><span class="line"></span><br><span class="line">    @Cacheable(key = &quot;#userId&quot;)</span><br><span class="line">    public User getUserById(Long userId) &#123;</span><br><span class="line">        return userRepository.findById(userId).orElse(null);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @CacheEvict(key = &quot;#userId&quot;)</span><br><span class="line">    public void deleteUserById(Long userId) &#123;</span><br><span class="line">        userRepository.deleteById(userId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @CachePut(key = &quot;#user.id&quot;)</span><br><span class="line">    public User updateUser(User user) &#123;</span><br><span class="line">        return userRepository.save(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Cacheable(value = &quot;admins&quot;, key = &quot;#adminId&quot;)</span><br><span class="line">    public Admin getAdminById(Long adminId) &#123;</span><br><span class="line">        return adminRepository.findById(adminId).orElse(null);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼š</p><ul><li><code>@CacheConfig(cacheNames = &quot;users&quot;)</code>ï¼šåœ¨ç±»çº§åˆ«è®¾ç½®é»˜è®¤ç¼“å­˜åç§°ä¸ºâ€œusersâ€ã€‚</li><li><code>getAdminById</code>æ–¹æ³•é€šè¿‡<code>@Cacheable(value = &quot;admins&quot;, key = &quot;#adminId&quot;)</code>è¦†ç›–äº†é»˜è®¤çš„ç¼“å­˜åç§°ï¼Œä½¿ç”¨â€œadminsâ€ç¼“å­˜ã€‚</li></ul><p>é€šè¿‡ä½¿ç”¨<code>@CacheConfig</code>ï¼Œå¯ä»¥ä½¿ä»£ç æ›´æ¸…æ™°ï¼Œé¿å…é‡å¤é…ç½®ï¼Œæé«˜å¯ç»´æŠ¤æ€§ã€‚</p><h3 id="å®ç°ç»†èŠ‚"><a href="#å®ç°ç»†èŠ‚" class="headerlink" title="å®ç°ç»†èŠ‚"></a>å®ç°ç»†èŠ‚</h3><ol><li><strong>Spring AOPä»£ç†</strong>ï¼š<ul><li>Spring AOPé€šè¿‡JDKåŠ¨æ€ä»£ç†æˆ–CGLIBåˆ›å»ºä»£ç†å¯¹è±¡ã€‚</li><li>ä»£ç†å¯¹è±¡æ‹¦æˆªæ–¹æ³•è°ƒç”¨ï¼Œåœ¨è°ƒç”¨ç›®æ ‡æ–¹æ³•ä¹‹å‰æˆ–ä¹‹åæ‰§è¡Œç¼“å­˜é€»è¾‘ã€‚</li></ul></li><li><strong>CacheManagerå’ŒCacheæ¥å£</strong>ï¼š<ul><li><code>CacheManager</code>ï¼šSpringç¼“å­˜æŠ½è±¡ä¸­çš„æ ¸å¿ƒæ¥å£ï¼Œç”¨äºç®¡ç†ä¸åŒçš„ç¼“å­˜å®ç°ã€‚</li><li><code>Cache</code>ï¼šè¡¨ç¤ºå…·ä½“çš„ç¼“å­˜ï¼Œæä¾›åŸºæœ¬çš„ç¼“å­˜æ“ä½œæ–¹æ³•ï¼Œå¦‚<code>get</code>ã€<code>put</code>ã€<code>evict</code>ç­‰ã€‚</li></ul></li><li><strong>ç¼“å­˜é…ç½®</strong>ï¼š<ul><li>åœ¨Spring Booté¡¹ç›®ä¸­ï¼Œé€šè¿‡<code>@EnableCaching</code>æ³¨è§£å¯ç”¨ç¼“å­˜åŠŸèƒ½ã€‚</li><li>åœ¨é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šå…·ä½“çš„ç¼“å­˜å®ç°ï¼ˆå¦‚Ehcacheã€Redisç­‰ï¼‰çš„é…ç½®ã€‚</li></ul></li></ol><h3 id="ç¤ºä¾‹é¡¹ç›®é…ç½®"><a href="#ç¤ºä¾‹é¡¹ç›®é…ç½®" class="headerlink" title="ç¤ºä¾‹é¡¹ç›®é…ç½®"></a>ç¤ºä¾‹é¡¹ç›®é…ç½®</h3><p><strong>å¼•å…¥ä¾èµ–</strong>ï¼š</p><p>åœ¨<code>pom.xml</code>ä¸­æ·»åŠ ä¾èµ–ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">      &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;spring-boot-starter-cache&lt;/artifactId&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">      &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br></pre></td></tr></table></figure><p><strong>é…ç½®æ–‡ä»¶Yaml</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  application:</span><br><span class="line">    name: buzz-chat</span><br><span class="line"></span><br><span class="line">  data:</span><br><span class="line">    redis:</span><br><span class="line">      host: 127.0.0.1</span><br><span class="line">      port: 6379</span><br><span class="line">      database: 0</span><br><span class="line"></span><br><span class="line">  cache:</span><br><span class="line">    type: REDIS</span><br></pre></td></tr></table></figure><p><strong>ä¸»é…ç½®ç±»</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">import org.springframework.boot.SpringApplication;</span><br><span class="line">import org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line">import org.springframework.cache.annotation.EnableCaching;</span><br><span class="line"></span><br><span class="line">@SpringBootApplication</span><br><span class="line">@EnableCaching</span><br><span class="line">public class CacheApplication &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        SpringApplication.run(CacheApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡ä¸Šè¿°é…ç½®å’Œä»£ç ï¼ŒSpring Cacheå’Œç¼“å­˜æ³¨è§£å¯ä»¥åœ¨Springåº”ç”¨ä¸­æ— ç¼å·¥ä½œã€‚AOPå’Œç¼“å­˜æŠ½è±¡æœºåˆ¶ä½¿å¾—è¿™äº›ç¼“å­˜æ“ä½œé€æ˜åœ°é›†æˆåˆ°ä¸šåŠ¡é€»è¾‘ä¸­ï¼Œå¤§å¤§ç®€åŒ–äº†å¼€å‘å’Œç»´æŠ¤å·¥ä½œã€‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;Spring Cache é€šè¿‡å°è£…ç»Ÿä¸€çš„ç¼“å­˜æŠ½è±¡å±‚ï¼Œæ”¯æŒå¤šç§ç¼“å­˜å®ç°ï¼ˆå¦‚Ehcacheã€Redisã€Caffeineç­‰ï¼‰ã€‚å¯ä»¥ä½¿ç”¨æ³¨è§£@Cacheableã€@CacheEvictã€@CachePutç­‰ä¼˜é›…çš„è¿›è¡Œä½¿ç”¨ï¼Œæ— éœ€ä¿®æ”¹ä¸šåŠ¡ä»£ç ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="Spring" scheme="https://alexhuihui.github.io/categories/Spring/"/>
    
    
    <category term="Spring" scheme="https://alexhuihui.github.io/tags/Spring/"/>
    
  </entry>
  
  <entry>
    <title>ã€MySQLã€‘ç´¢å¼•å¤±æ•ˆçš„åœºæ™¯</title>
    <link href="https://alexhuihui.github.io/article/20240522.html"/>
    <id>https://alexhuihui.github.io/article/20240522.html</id>
    <published>2024-05-22T11:54:06.000Z</published>
    <updated>2025-01-25T12:34:39.694Z</updated>
    
    <content type="html"><![CDATA[<p>ä»Šå¤©æˆ‘ä»¬è®¨è®ºä¸€ä¸‹æ•°æ®åº“ç´¢å¼•åœ¨ä»€ä¹ˆæƒ…å†µä¸‹ä¼šå¤±æ•ˆï¼Œæ€»çš„æ¥è¯´æœ‰ä»¥ä¸‹å‡ ç§åœºæ™¯</p><ol><li>åœ¨ç´¢å¼•åˆ—ä¸ŠåŠ å‡½æ•°è¿ç®—</li><li>ç»„åˆç´¢å¼•ä¸­ï¼Œä¸ç¬¦åˆæœ€å·¦åŒ¹é…åŸåˆ™</li><li>å½“ç´¢å¼•åˆ—å­˜åœ¨éšå¼è½¬åŒ–çš„æ—¶å€™</li><li>ä½¿ç”¨likeé€šé…ç¬¦åŒ¹é…åç¼€%xxxçš„æ—¶å€™</li><li>ä½¿ç”¨orè¿æ¥æŸ¥è¯¢çš„æ—¶å€™ï¼Œorè¯­å¥å‰åæ²¡æœ‰åŒæ—¶ä½¿ç”¨ç´¢å¼•</li></ol><span id="more"></span> <h3 id="è®¾è®¡-SQL-è¡¨"><a href="#è®¾è®¡-SQL-è¡¨" class="headerlink" title="è®¾è®¡ SQL è¡¨"></a>è®¾è®¡ SQL è¡¨</h3><p>å‡è®¾æˆ‘ä»¬è®¾è®¡ä¸€ä¸ªå‘˜å·¥è¡¨ <code>employees</code>ï¼ŒåŒ…å«ä»¥ä¸‹å­—æ®µï¼š</p><ul><li><code>employee_id</code>ï¼šå‘˜å·¥IDï¼ˆå­—ç¬¦ä¸²ç±»å‹ï¼Œä½œä¸ºç´¢å¼•åˆ—ï¼‰</li><li><code>name</code>ï¼šå‘˜å·¥å§“å</li><li><code>department_id</code>ï¼šéƒ¨é—¨IDï¼ˆå­—ç¬¦ä¸²ç±»å‹ï¼Œä½œä¸ºç´¢å¼•åˆ—ï¼‰</li><li><code>age</code>ï¼šå‘˜å·¥å¹´é¾„</li></ul><h3 id="åˆ›å»ºè¡¨çš„-SQL-è¯­å¥"><a href="#åˆ›å»ºè¡¨çš„-SQL-è¯­å¥" class="headerlink" title="åˆ›å»ºè¡¨çš„ SQL è¯­å¥"></a>åˆ›å»ºè¡¨çš„ SQL è¯­å¥</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE employees (</span><br><span class="line">    employee_id VARCHAR(20) NOT NULL,</span><br><span class="line">    name VARCHAR(100),</span><br><span class="line">    department_id VARCHAR(20),</span><br><span class="line">    age INT,</span><br><span class="line">    PRIMARY KEY (employee_id),</span><br><span class="line">    KEY idx_department_id (department_id)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><h3 id="æ’å…¥ç¤ºä¾‹æ•°æ®"><a href="#æ’å…¥ç¤ºä¾‹æ•°æ®" class="headerlink" title="æ’å…¥ç¤ºä¾‹æ•°æ®"></a>æ’å…¥ç¤ºä¾‹æ•°æ®</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO employees (employee_id, name, department_id, age) VALUES</span><br><span class="line">(&#x27;E001&#x27;, &#x27;Alice&#x27;, &#x27;D001&#x27;, 30),</span><br><span class="line">(&#x27;E002&#x27;, &#x27;Bob&#x27;, &#x27;D002&#x27;, 25),</span><br><span class="line">(&#x27;E003&#x27;, &#x27;Charlie&#x27;, &#x27;D001&#x27;, 28),</span><br><span class="line">(&#x27;E004&#x27;, &#x27;David&#x27;, &#x27;D003&#x27;, 35),</span><br><span class="line">(&#x27;E005&#x27;, &#x27;Eve&#x27;, &#x27;D002&#x27;, 22);</span><br></pre></td></tr></table></figure><h3 id="æŸ¥è¯¢è¯­å¥åŠå…¶-EXPLAIN-åˆ†æ"><a href="#æŸ¥è¯¢è¯­å¥åŠå…¶-EXPLAIN-åˆ†æ" class="headerlink" title="æŸ¥è¯¢è¯­å¥åŠå…¶ EXPLAIN åˆ†æ"></a>æŸ¥è¯¢è¯­å¥åŠå…¶ EXPLAIN åˆ†æ</h3><h4 id="1-éšå¼ç±»å‹è½¬æ¢å¯¼è‡´ç´¢å¼•å¤±æ•ˆ"><a href="#1-éšå¼ç±»å‹è½¬æ¢å¯¼è‡´ç´¢å¼•å¤±æ•ˆ" class="headerlink" title="1. éšå¼ç±»å‹è½¬æ¢å¯¼è‡´ç´¢å¼•å¤±æ•ˆ"></a>1. éšå¼ç±»å‹è½¬æ¢å¯¼è‡´ç´¢å¼•å¤±æ•ˆ</h4><p>æŸ¥è¯¢å‘˜å·¥IDä¸º123çš„å‘˜å·¥ä¿¡æ¯ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM employees WHERE employee_id = 123;</span><br></pre></td></tr></table></figure><p>åˆ†æï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN SELECT * FROM employees WHERE employee_id = 123;</span><br></pre></td></tr></table></figure><h4 id="2-LIKE-é€šé…ç¬¦åŒ¹é…åç¼€å¯¼è‡´ç´¢å¼•å¤±æ•ˆ"><a href="#2-LIKE-é€šé…ç¬¦åŒ¹é…åç¼€å¯¼è‡´ç´¢å¼•å¤±æ•ˆ" class="headerlink" title="2. LIKE é€šé…ç¬¦åŒ¹é…åç¼€å¯¼è‡´ç´¢å¼•å¤±æ•ˆ"></a>2. LIKE é€šé…ç¬¦åŒ¹é…åç¼€å¯¼è‡´ç´¢å¼•å¤±æ•ˆ</h4><p>æŸ¥è¯¢åå­—ä»¥ â€˜liceâ€™ ç»“å°¾çš„å‘˜å·¥ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM employees WHERE name LIKE &#x27;%lice&#x27;;</span><br></pre></td></tr></table></figure><p>åˆ†æï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN SELECT * FROM employees WHERE name LIKE &#x27;%lice&#x27;;</span><br></pre></td></tr></table></figure><h4 id="3-OR-è¿æ¥æŸ¥è¯¢ç´¢å¼•å¤±æ•ˆ"><a href="#3-OR-è¿æ¥æŸ¥è¯¢ç´¢å¼•å¤±æ•ˆ" class="headerlink" title="3. OR è¿æ¥æŸ¥è¯¢ç´¢å¼•å¤±æ•ˆ"></a>3. OR è¿æ¥æŸ¥è¯¢ç´¢å¼•å¤±æ•ˆ</h4><p>æŸ¥è¯¢å‘˜å·¥IDä¸ºâ€™E001â€™æˆ–éƒ¨é—¨IDä¸ºâ€™D003â€™çš„å‘˜å·¥ä¿¡æ¯ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM employees WHERE employee_id = &#x27;E001&#x27; OR department_id = &#x27;D003&#x27;;</span><br></pre></td></tr></table></figure><p>åˆ†æï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN SELECT * FROM employees WHERE employee_id = &#x27;E001&#x27; OR department_id = &#x27;D003&#x27;;</span><br></pre></td></tr></table></figure><h4 id="4-æ­£ç¡®ä½¿ç”¨ç´¢å¼•çš„æŸ¥è¯¢"><a href="#4-æ­£ç¡®ä½¿ç”¨ç´¢å¼•çš„æŸ¥è¯¢" class="headerlink" title="4. æ­£ç¡®ä½¿ç”¨ç´¢å¼•çš„æŸ¥è¯¢"></a>4. æ­£ç¡®ä½¿ç”¨ç´¢å¼•çš„æŸ¥è¯¢</h4><p>æŸ¥è¯¢åå­—ä»¥ â€˜Aâ€™ å¼€å¤´çš„å‘˜å·¥ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM employees WHERE name LIKE &#x27;A%&#x27;;</span><br></pre></td></tr></table></figure><p>åˆ†æï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN SELECT * FROM employees WHERE name LIKE &#x27;A%&#x27;;</span><br></pre></td></tr></table></figure><h3 id="EXPLAIN-ç»“æœåˆ†æ"><a href="#EXPLAIN-ç»“æœåˆ†æ" class="headerlink" title="EXPLAIN ç»“æœåˆ†æ"></a>EXPLAIN ç»“æœåˆ†æ</h3><p>é€šè¿‡ <code>EXPLAIN</code> è¯­å¥ï¼Œå¯ä»¥åˆ†ææ¯ä¸ªæŸ¥è¯¢çš„æ‰§è¡Œè®¡åˆ’ã€‚ä»¥ä¸‹æ˜¯å¯èƒ½çš„è§£é‡Šï¼š</p><h4 id="1-éšå¼ç±»å‹è½¬æ¢å¯¼è‡´ç´¢å¼•å¤±æ•ˆ-1"><a href="#1-éšå¼ç±»å‹è½¬æ¢å¯¼è‡´ç´¢å¼•å¤±æ•ˆ-1" class="headerlink" title="1. éšå¼ç±»å‹è½¬æ¢å¯¼è‡´ç´¢å¼•å¤±æ•ˆ"></a>1. éšå¼ç±»å‹è½¬æ¢å¯¼è‡´ç´¢å¼•å¤±æ•ˆ</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">+----+-------------+-----------+------+---------------+------+---------+------+------+-------------+</span><br><span class="line">| id | select_type | table     | type | possible_keys | key  | key_len | ref  | rows | Extra       |</span><br><span class="line">+----+-------------+-----------+------+---------------+------+---------+------+------+-------------+</span><br><span class="line">|  1 | SIMPLE      | employees | ALL  | PRIMARY       | NULL | NULL    | NULL |    5 | Using where |</span><br><span class="line">+----+-------------+-----------+------+---------------+------+---------+------+------+-------------+</span><br></pre></td></tr></table></figure><p>è§£é‡Šï¼šç”±äºéšå¼ç±»å‹è½¬æ¢ï¼ŒMySQL è¿›è¡Œäº†å…¨è¡¨æ‰«æï¼ˆ<code>type=ALL</code>ï¼‰ï¼Œæœªèƒ½ä½¿ç”¨ç´¢å¼•ã€‚</p><h4 id="2-LIKE-é€šé…ç¬¦åŒ¹é…åç¼€å¯¼è‡´ç´¢å¼•å¤±æ•ˆ-1"><a href="#2-LIKE-é€šé…ç¬¦åŒ¹é…åç¼€å¯¼è‡´ç´¢å¼•å¤±æ•ˆ-1" class="headerlink" title="2. LIKE é€šé…ç¬¦åŒ¹é…åç¼€å¯¼è‡´ç´¢å¼•å¤±æ•ˆ"></a>2. LIKE é€šé…ç¬¦åŒ¹é…åç¼€å¯¼è‡´ç´¢å¼•å¤±æ•ˆ</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">+----+-------------+-----------+------+---------------+------+---------+------+------+-------------+</span><br><span class="line">| id | select_type | table     | type | possible_keys | key  | key_len | ref  | rows | Extra       |</span><br><span class="line">+----+-------------+-----------+------+---------------+------+---------+------+------+-------------+</span><br><span class="line">|  1 | SIMPLE      | employees | ALL  | NULL          | NULL | NULL    | NULL |    5 | Using where |</span><br><span class="line">+----+-------------+-----------+------+---------------+------+---------+------+------+-------------+</span><br></pre></td></tr></table></figure><p>è§£é‡Šï¼šç”±äºé€šé…ç¬¦åœ¨å‰ï¼ŒMySQL è¿›è¡Œäº†å…¨è¡¨æ‰«æï¼ˆ<code>type=ALL</code>ï¼‰ï¼Œæœªèƒ½ä½¿ç”¨ç´¢å¼•ã€‚</p><h4 id="3-OR-è¿æ¥æŸ¥è¯¢ç´¢å¼•å¤±æ•ˆ-1"><a href="#3-OR-è¿æ¥æŸ¥è¯¢ç´¢å¼•å¤±æ•ˆ-1" class="headerlink" title="3. OR è¿æ¥æŸ¥è¯¢ç´¢å¼•å¤±æ•ˆ"></a>3. OR è¿æ¥æŸ¥è¯¢ç´¢å¼•å¤±æ•ˆ</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">+----+-------------+-----------+------+--------------------+------+---------+------+------+-------------+</span><br><span class="line">| id | select_type | table     | type | possible_keys      | key  | key_len | ref  | rows | Extra       |</span><br><span class="line">+----+-------------+-----------+------+--------------------+------+---------+------+------+-------------+</span><br><span class="line">|  1 | SIMPLE      | employees | ALL  | PRIMARY,idx_department_id | NULL | NULL    | NULL |    5 | Using where |</span><br><span class="line">+----+-------------+-----------+------+--------------------+------+---------+------+------+-------------+</span><br></pre></td></tr></table></figure><p>è§£é‡Šï¼šç”±äº <code>OR</code> è¯­å¥ä½¿å¾—æŸ¥è¯¢éœ€è¦è€ƒè™‘å¤šä¸ªæ¡ä»¶ï¼ŒMySQL è¿›è¡Œäº†å…¨è¡¨æ‰«æï¼ˆ<code>type=ALL</code>ï¼‰ï¼Œæœªèƒ½ä½¿ç”¨ç´¢å¼•ã€‚</p><h4 id="4-æ­£ç¡®ä½¿ç”¨ç´¢å¼•çš„æŸ¥è¯¢-1"><a href="#4-æ­£ç¡®ä½¿ç”¨ç´¢å¼•çš„æŸ¥è¯¢-1" class="headerlink" title="4. æ­£ç¡®ä½¿ç”¨ç´¢å¼•çš„æŸ¥è¯¢"></a>4. æ­£ç¡®ä½¿ç”¨ç´¢å¼•çš„æŸ¥è¯¢</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">+----+-------------+-----------+-------+---------------+---------------+---------+------+------+-------------+</span><br><span class="line">| id | select_type | table     | type  | possible_keys | key           | key_len | ref  | rows | Extra       |</span><br><span class="line">+----+-------------+-----------+-------+---------------+---------------+---------+------+------+-------------+</span><br><span class="line">|  1 | SIMPLE      | employees | range | NULL          | idx_name      | 1024    | NULL |    2 | Using where |</span><br><span class="line">+----+-------------+-----------+-------+---------------+---------------+---------+------+------+-------------+</span><br></pre></td></tr></table></figure><p>è§£é‡Šï¼šç”±äºé€šé…ç¬¦åœ¨åï¼Œç¬¦åˆæœ€å·¦åŒ¹é…åŸåˆ™ï¼ŒMySQL ä½¿ç”¨äº†ç´¢å¼•ï¼ˆ<code>type=range</code>ï¼‰ã€‚</p><p>é€šè¿‡ä»¥ä¸ŠæŸ¥è¯¢å’Œåˆ†æï¼Œå¯ä»¥æ›´å¥½åœ°ç†è§£ B+æ ‘ç´¢å¼•åœ¨ä¸åŒæƒ…å†µä¸‹çš„ä½¿ç”¨å’Œå¤±æ•ˆåŸå› ï¼Œä»è€Œä¼˜åŒ–æ•°æ®åº“æŸ¥è¯¢æ€§èƒ½ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;ä»Šå¤©æˆ‘ä»¬è®¨è®ºä¸€ä¸‹æ•°æ®åº“ç´¢å¼•åœ¨ä»€ä¹ˆæƒ…å†µä¸‹ä¼šå¤±æ•ˆï¼Œæ€»çš„æ¥è¯´æœ‰ä»¥ä¸‹å‡ ç§åœºæ™¯&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;åœ¨ç´¢å¼•åˆ—ä¸ŠåŠ å‡½æ•°è¿ç®—&lt;/li&gt;
&lt;li&gt;ç»„åˆç´¢å¼•ä¸­ï¼Œä¸ç¬¦åˆæœ€å·¦åŒ¹é…åŸåˆ™&lt;/li&gt;
&lt;li&gt;å½“ç´¢å¼•åˆ—å­˜åœ¨éšå¼è½¬åŒ–çš„æ—¶å€™&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨likeé€šé…ç¬¦åŒ¹é…åç¼€%xxxçš„æ—¶å€™&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨orè¿æ¥æŸ¥è¯¢çš„æ—¶å€™ï¼Œorè¯­å¥å‰åæ²¡æœ‰åŒæ—¶ä½¿ç”¨ç´¢å¼•&lt;/li&gt;
&lt;/ol&gt;</summary>
    
    
    
    <category term="MySQL" scheme="https://alexhuihui.github.io/categories/MySQL/"/>
    
    
    <category term="MySQL" scheme="https://alexhuihui.github.io/tags/MySQL/"/>
    
  </entry>
  
  <entry>
    <title>ã€Dockerã€‘å®¹å™¨çš„æœ¬è´¨</title>
    <link href="https://alexhuihui.github.io/article/20240430.html"/>
    <id>https://alexhuihui.github.io/article/20240430.html</id>
    <published>2024-04-30T11:54:06.000Z</published>
    <updated>2025-01-25T12:11:04.378Z</updated>
    
    <content type="html"><![CDATA[<p>ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„ Docker å®¹å™¨ï¼Œå…¶å®å°±æ˜¯ä¸€ä¸ªå¯ç”¨äº†å¤šä¸ª Linux Namespace çš„åº”ç”¨è¿›ç¨‹ï¼Œè€Œè¿™ä¸ªè¿›ç¨‹èƒ½å¤Ÿä½¿ç”¨çš„èµ„æºé‡ï¼Œåˆ™å— Cgroups é…ç½®çš„é™åˆ¶ã€‚</p><p>ä¸‹é¢é€šè¿‡ä¸€ä¸ªå°å®éªŒè¯æ˜è¿™å¥è¯</p><span id="more"></span> <h3 id="éªŒè¯"><a href="#éªŒè¯" class="headerlink" title="éªŒè¯"></a>éªŒè¯</h3><p>åœ¨ Linux ä¸­ï¼ŒCgroups ç»™ç”¨æˆ·æš´éœ²å‡ºæ¥çš„æ“ä½œæ¥å£æ˜¯æ–‡ä»¶ç³»ç»Ÿï¼Œå³å®ƒä»¥æ–‡ä»¶å’Œç›®å½•çš„æ–¹å¼ç»„ç»‡åœ¨æ“ä½œç³»ç»Ÿçš„ /sys/fs/cgroup è·¯å¾„ä¸‹ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mount -t cgroup </span><br></pre></td></tr></table></figure><p>è¿›å…¥åˆ° /sys/fs/cgroup/cpu ç›®å½•ä¸‹ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªç›®å½•ï¼Œæ“ä½œç³»ç»Ÿä¼šåœ¨æ–°åˆ›å»ºçš„ container ç›®å½•ä¸‹ï¼Œè‡ªåŠ¨ç”Ÿæˆè¯¥å­ç³»ç»Ÿå¯¹åº”çš„èµ„æºé™åˆ¶æ–‡ä»¶ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:/sys/fs/cgroup/cpu$ mkdir container</span><br><span class="line">root@ubuntu:/sys/fs/cgroup/cpu$ ls container/</span><br><span class="line">cgroup.clone_children cpu.cfs_period_us cpu.rt_period_us  cpu.shares notify_on_release</span><br><span class="line">cgroup.procs      cpu.cfs_quota_us  cpu.rt_runtime_us cpu.stat  tasks</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œä¸€ä¸ªè„šæœ¬ï¼Œæ‰“æ»¡CPU</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">while : ; do : ; done &amp;</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹containerç›®å½•ä¸­çš„CPUèµ„æºé™åˆ¶å¹¶æŠŠåˆšåˆšåˆ›å»ºçš„è¿›ç¨‹åŠ å…¥åˆ°ä»»åŠ¡ç»„ä¸­</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">echo 20000 &gt; /sys/fs/cgroup/cpu/container/cpu.cfs_quota_us</span><br><span class="line"></span><br><span class="line">echo PID &gt; /sys/fs/cgroup/cpu/container/tasks </span><br></pre></td></tr></table></figure><p>è¿™æ—¶å€™å†é€šè¿‡TOPå»æŸ¥çœ‹CPUä½¿ç”¨å°±ä¼šå‘ç°å®ƒçš„ä½¿ç”¨ç‡ä»100%é™åˆ°äº†20%</p><p><a href="https://raw.githubusercontent.com/Alexhuihui/photo/main/20240430101156.png"><img src="https://raw.githubusercontent.com/Alexhuihui/photo/main/20240430101156.png" alt="img"></a></p><h3 id="ç¼ºç‚¹"><a href="#ç¼ºç‚¹" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h3><p>dockerä½¿ç”¨namespaceè¿›è¡Œéš”ç¦»ä½†æ˜¯éš”ç¦»çš„ä¸å½»åº•ï¼Œå®ƒæœ¬è´¨ä¸Šè¿˜æ˜¯ä¸€ä¸ªè·‘åœ¨å®¿ä¸»æœºä¸Šçš„è¿›ç¨‹ã€‚</p><p>dockerä½¿ç”¨cgroupsè¿›è¡Œä½¿ç”¨èµ„æºçš„é™åˆ¶ï¼Œä½†æ˜¯Cgroups å¯¹èµ„æºçš„é™åˆ¶èƒ½åŠ›ä¹Ÿæœ‰å¾ˆå¤šä¸å®Œå–„çš„åœ°æ–¹ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„ Docker å®¹å™¨ï¼Œå…¶å®å°±æ˜¯ä¸€ä¸ªå¯ç”¨äº†å¤šä¸ª Linux Namespace çš„åº”ç”¨è¿›ç¨‹ï¼Œè€Œè¿™ä¸ªè¿›ç¨‹èƒ½å¤Ÿä½¿ç”¨çš„èµ„æºé‡ï¼Œåˆ™å— Cgroups é…ç½®çš„é™åˆ¶ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢é€šè¿‡ä¸€ä¸ªå°å®éªŒè¯æ˜è¿™å¥è¯&lt;/p&gt;</summary>
    
    
    
    <category term="Docker" scheme="https://alexhuihui.github.io/categories/Docker/"/>
    
    
    <category term="Docker" scheme="https://alexhuihui.github.io/tags/Docker/"/>
    
  </entry>
  
  <entry>
    <title>ã€äº‹åŠ¡å¤„ç†ã€‘åˆ†å¸ƒå¼äº‹åŠ¡</title>
    <link href="https://alexhuihui.github.io/article/20240127.html"/>
    <id>https://alexhuihui.github.io/article/20240127.html</id>
    <published>2024-01-27T11:54:06.000Z</published>
    <updated>2025-01-25T12:15:24.511Z</updated>
    
    <content type="html"><![CDATA[<p>å¯ä»¥æŒ‰ç…§æœåŠ¡çš„æ•°é‡ä»¥åŠå¯¹åº”çš„æ•°æ®æºçš„ä½¿ç”¨æ•°é‡æ¥åˆ’åˆ†åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œä¾‹å¦‚å•ä¸ªæœåŠ¡ä½¿ç”¨å¤šæ•°æ®æºç§°ä½œå…¨å±€äº‹åŠ¡å¯ä»¥ä½¿ç”¨2ã€3æ®µæäº¤ï¼Œå¤šä¸ªæœåŠ¡ä½¿ç”¨å•æ•°æ®æºåˆ™ç§°ä½œå…±äº«äº‹åŠ¡å¯ä»¥ä½¿ç”¨å…±äº«æ•°æ®åº“è¿æ¥ï¼Œè¿˜æœ‰ä¸€ç§å°±æ˜¯å¤šæœåŠ¡å¤šæ•°æ®æºï¼Œè¿™ç§ä¸€èˆ¬ç§°ä½œåœ¨åˆ†å¸ƒå¼æœåŠ¡ç¯å¢ƒä¸‹çš„äº‹åŠ¡å¤„ç†æœºåˆ¶ã€‚</p><span id="more"></span> <h3 id="å…¨å±€äº‹åŠ¡"><a href="#å…¨å±€äº‹åŠ¡" class="headerlink" title="å…¨å±€äº‹åŠ¡"></a>å…¨å±€äº‹åŠ¡</h3><blockquote><p>å‡†å¤‡é˜¶æ®µï¼šåˆå«ä½œæŠ•ç¥¨é˜¶æ®µï¼Œåœ¨è¿™ä¸€é˜¶æ®µï¼Œåè°ƒè€…è¯¢é—®äº‹åŠ¡çš„æ‰€æœ‰å‚ä¸è€…æ˜¯å¦å‡†å¤‡å¥½æäº¤ï¼Œå‚ä¸è€…å¦‚æœå·²ç»å‡†å¤‡å¥½æäº¤åˆ™å›å¤ Preparedï¼Œå¦åˆ™å›å¤ Non-Preparedã€‚è¿™é‡Œæ‰€è¯´çš„å‡†å¤‡æ“ä½œè·Ÿäººç±»è¯­è¨€ä¸­é€šå¸¸ç†è§£çš„å‡†å¤‡å¹¶ä¸ç›¸åŒï¼Œå¯¹äºæ•°æ®åº“æ¥è¯´ï¼Œå‡†å¤‡æ“ä½œæ˜¯åœ¨é‡åšæ—¥å¿—ä¸­è®°å½•å…¨éƒ¨äº‹åŠ¡æäº¤æ“ä½œæ‰€è¦åšçš„å†…å®¹ï¼Œå®ƒä¸æœ¬åœ°äº‹åŠ¡ä¸­çœŸæ­£æäº¤çš„åŒºåˆ«åªæ˜¯æš‚ä¸å†™å…¥æœ€åä¸€æ¡ Commit Record è€Œå·²ï¼Œè¿™æ„å‘³ç€åœ¨åšå®Œæ•°æ®æŒä¹…åŒ–åå¹¶ä¸ç«‹å³é‡Šæ”¾éš”ç¦»æ€§ï¼Œå³ä»ç»§ç»­æŒæœ‰é”ï¼Œç»´æŒæ•°æ®å¯¹å…¶ä»–éäº‹åŠ¡å†…è§‚å¯Ÿè€…çš„éš”ç¦»çŠ¶æ€ã€‚</p><p>æäº¤é˜¶æ®µï¼šåˆå«ä½œæ‰§è¡Œé˜¶æ®µï¼Œåè°ƒè€…å¦‚æœåœ¨ä¸Šä¸€é˜¶æ®µæ”¶åˆ°æ‰€æœ‰äº‹åŠ¡å‚ä¸è€…å›å¤çš„ Prepared æ¶ˆæ¯ï¼Œåˆ™å…ˆè‡ªå·±åœ¨æœ¬åœ°æŒä¹…åŒ–äº‹åŠ¡çŠ¶æ€ä¸º Commitï¼Œåœ¨æ­¤æ“ä½œå®Œæˆåå‘æ‰€æœ‰å‚ä¸è€…å‘é€ Commit æŒ‡ä»¤ï¼Œæ‰€æœ‰å‚ä¸è€…ç«‹å³æ‰§è¡Œæäº¤æ“ä½œï¼›å¦åˆ™ï¼Œä»»æ„ä¸€ä¸ªå‚ä¸è€…å›å¤äº† Non-Prepared æ¶ˆæ¯ï¼Œæˆ–ä»»æ„ä¸€ä¸ªå‚ä¸è€…è¶…æ—¶æœªå›å¤ï¼Œåè°ƒè€…å°†è‡ªå·±çš„äº‹åŠ¡çŠ¶æ€æŒä¹…åŒ–ä¸º Abort ä¹‹åï¼Œå‘æ‰€æœ‰å‚ä¸è€…å‘é€ Abort æŒ‡ä»¤ï¼Œå‚ä¸è€…ç«‹å³æ‰§è¡Œå›æ»šæ“ä½œã€‚å¯¹äºæ•°æ®åº“æ¥è¯´ï¼Œè¿™ä¸ªé˜¶æ®µçš„æäº¤æ“ä½œåº”æ˜¯å¾ˆè½»é‡çš„ï¼Œä»…ä»…æ˜¯æŒä¹…åŒ–ä¸€æ¡ Commit Record è€Œå·²ï¼Œé€šå¸¸èƒ½å¤Ÿå¿«é€Ÿå®Œæˆï¼Œåªæœ‰æ”¶åˆ° Abort æŒ‡ä»¤æ—¶ï¼Œæ‰éœ€è¦æ ¹æ®å›æ»šæ—¥å¿—æ¸…ç†å·²æäº¤çš„æ•°æ®ï¼Œè¿™å¯èƒ½æ˜¯ç›¸å¯¹é‡è´Ÿè½½çš„æ“ä½œã€‚</p></blockquote><p>ç¼ºç‚¹å¾ˆæ˜æ˜¾ï¼Œå®¹æ˜“å•ç‚¹ã€æ€§èƒ½é—®é¢˜ã€ä¸€è‡´æ€§é£é™©</p><h3 id="å…±äº«äº‹åŠ¡"><a href="#å…±äº«äº‹åŠ¡" class="headerlink" title="å…±äº«äº‹åŠ¡"></a>å…±äº«äº‹åŠ¡</h3><blockquote><p>ç†è®ºå¯è¡Œï¼Œå› ä¸ºè¯¥æ–¹æ¡ˆæ˜¯ä¸å®é™…ç”Ÿäº§ç³»ç»Ÿä¸­çš„å‹åŠ›æ–¹å‘ç›¸æ‚–çš„ï¼Œä¸€ä¸ªæœåŠ¡é›†ç¾¤é‡Œæ•°æ®åº“æ‰æ˜¯å‹åŠ›æœ€å¤§è€Œåˆæœ€ä¸å®¹æ˜“ä¼¸ç¼©æ‹“å±•çš„é‡ç¾åŒºã€‚</p></blockquote><h3 id="åˆ†å¸ƒå¼äº‹åŠ¡"><a href="#åˆ†å¸ƒå¼äº‹åŠ¡" class="headerlink" title="åˆ†å¸ƒå¼äº‹åŠ¡"></a>åˆ†å¸ƒå¼äº‹åŠ¡</h3>]]></content>
    
    
    <summary type="html">&lt;p&gt;å¯ä»¥æŒ‰ç…§æœåŠ¡çš„æ•°é‡ä»¥åŠå¯¹åº”çš„æ•°æ®æºçš„ä½¿ç”¨æ•°é‡æ¥åˆ’åˆ†åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œä¾‹å¦‚å•ä¸ªæœåŠ¡ä½¿ç”¨å¤šæ•°æ®æºç§°ä½œå…¨å±€äº‹åŠ¡å¯ä»¥ä½¿ç”¨2ã€3æ®µæäº¤ï¼Œå¤šä¸ªæœåŠ¡ä½¿ç”¨å•æ•°æ®æºåˆ™ç§°ä½œå…±äº«äº‹åŠ¡å¯ä»¥ä½¿ç”¨å…±äº«æ•°æ®åº“è¿æ¥ï¼Œè¿˜æœ‰ä¸€ç§å°±æ˜¯å¤šæœåŠ¡å¤šæ•°æ®æºï¼Œè¿™ç§ä¸€èˆ¬ç§°ä½œåœ¨åˆ†å¸ƒå¼æœåŠ¡ç¯å¢ƒä¸‹çš„äº‹åŠ¡å¤„ç†æœºåˆ¶ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="äº‹åŠ¡å¤„ç†" scheme="https://alexhuihui.github.io/categories/%E4%BA%8B%E5%8A%A1%E5%A4%84%E7%90%86/"/>
    
    
    <category term="äº‹åŠ¡å¤„ç†" scheme="https://alexhuihui.github.io/tags/%E4%BA%8B%E5%8A%A1%E5%A4%84%E7%90%86/"/>
    
  </entry>
  
  <entry>
    <title>ã€æŠ€æœ¯åˆ†äº«ã€‘Springå£°æ˜å¼äº‹åŠ¡çš„æ­£ç¡®ä½¿ç”¨</title>
    <link href="https://alexhuihui.github.io/article/20240118.html"/>
    <id>https://alexhuihui.github.io/article/20240118.html</id>
    <published>2024-01-18T11:54:06.000Z</published>
    <updated>2025-01-25T12:40:04.556Z</updated>
    
    <content type="html"><![CDATA[<p>å¤§å®¶è‚¯å®šå¯¹@Transactionalè¿™ä¸ªæ³¨è§£å¾ˆç†Ÿæ‚‰ï¼Œä¹Ÿå¯¹äº‹åŠ¡æœ‰ç€è¯¦ç»†çš„äº†è§£ï¼Œä¹ŸçŸ¥é“å¤šä¸ªæ•°æ®åº“æ“ä½œéœ€è¦é€šè¿‡äº‹åŠ¡æ¥ä¿è¯ä¸€è‡´æ€§å’ŒåŸå­æ€§ã€‚ä½†æ˜¯å¾ˆå°‘ä¼šå…³æ³¨äº‹åŠ¡æ˜¯å¦ç”Ÿæ•ˆã€æœ‰æ²¡æœ‰å‡ºé”™ã€‚è¿™ç±»é—®é¢˜ä¹Ÿæ¯”è¾ƒéš¾åœ¨æµ‹è¯•é˜¶æ®µå‘ç°ï¼Œå½“å‡ºç°çº¿ä¸Šé—®é¢˜çš„æ—¶å€™ä¸å¯é¿å…çš„ä¼šäº§ç”Ÿå¤§é‡è„æ•°æ®ã€‚æ‰€ä»¥è¿™æ¬¡æˆ‘åˆ†äº«çš„å†…å®¹å°±æ˜¯å¸®åŠ©å¤§å®¶ç†æ¸…æ¥šä½¿ç”¨@Transactionalçš„æ€è·¯ï¼Œé¿å…ä½¿ç”¨ä¸å½“äº§ç”Ÿbugã€‚</p><span id="more"></span> <h3 id="äº‹åŠ¡ä¸ºä»€ä¹ˆä¸ç”Ÿæ•ˆ"><a href="#äº‹åŠ¡ä¸ºä»€ä¹ˆä¸ç”Ÿæ•ˆ" class="headerlink" title="äº‹åŠ¡ä¸ºä»€ä¹ˆä¸ç”Ÿæ•ˆ"></a>äº‹åŠ¡ä¸ºä»€ä¹ˆä¸ç”Ÿæ•ˆ</h3><p>å¾ˆå¤šåŒå­¦ä»¥ä¸ºåªè¦åŠ äº†è¿™ä¸ªæ³¨è§£å°±ä¸éœ€è¦ç®¡å®ƒäº†ï¼Œå…¶å®ä¸å°½ç„¶ã€‚å¯ä»¥çœ‹çœ‹ä¸‹è¿°ä¾‹å­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserRepository userRepository;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ä¸€ä¸ªå…¬å…±æ–¹æ³•ä¾›Controllerè°ƒç”¨ï¼Œå†…éƒ¨è°ƒç”¨äº‹åŠ¡æ€§çš„ç§æœ‰æ–¹æ³•</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">createUserWrong1</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">this</span>.createUserPrivate(<span class="keyword">new</span> UserEntity(name));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;create user failed because &#123;&#125;&quot;</span>, ex.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> userRepository.findByName(name).size();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ ‡è®°äº†@Transactionalçš„privateæ–¹æ³•</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">createUserPrivate</span><span class="params">(UserEntity entity)</span> </span>&#123;</span><br><span class="line">        userRepository.save(entity);</span><br><span class="line">        <span class="keyword">if</span> (entity.getName().contains(<span class="string">&quot;test&quot;</span>)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;invalid username!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ ¹æ®ç”¨æˆ·åæŸ¥è¯¢ç”¨æˆ·æ•°</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getUserCount</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userRepository.findByName(name).size();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>åªæœ‰å®šä¹‰åœ¨publicæ–¹æ³•ä¸Šçš„ @Transactional æ‰èƒ½ç”Ÿæ•ˆ</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">createUserWrong2</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.createUserPublic(<span class="keyword">new</span> UserEntity(name));</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">        log.error(<span class="string">&quot;create user failed because &#123;&#125;&quot;</span>, ex.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> userRepository.findByName(name).size();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ ‡è®°äº†@Transactionalçš„publicæ–¹æ³•</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">createUserPublic</span><span class="params">(UserEntity entity)</span> </span>&#123;</span><br><span class="line">    userRepository.save(entity);</span><br><span class="line">    <span class="keyword">if</span> (entity.getName().contains(<span class="string">&quot;test&quot;</span>)) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;invalid username!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>å¿…é¡»é€šè¿‡ä»£ç†è¿‡çš„ç±»ä»å¤–éƒ¨è°ƒç”¨ç›®æ ‡æ–¹æ³•æ‰èƒ½ç”Ÿæ•ˆ</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;right2&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">right2</span><span class="params">(<span class="meta">@RequestParam(&quot;name&quot;)</span> String name)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        userService.createUserPublic(<span class="keyword">new</span> UserEntity(name));</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">        log.error(<span class="string">&quot;create user failed because &#123;&#125;&quot;</span>, ex.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> userService.getUserCount(name);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"> <span class="comment">// This is an around advice: Invoke the next interceptor in the chain.</span></span><br><span class="line"> <span class="comment">// This will normally result in a target object being invoked.</span></span><br><span class="line"> retVal = invocation.proceedWithInvocation();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">catch</span> (Throwable ex) &#123;</span><br><span class="line"> <span class="comment">// target invocation exception</span></span><br><span class="line"> completeTransactionAfterThrowing(txInfo, ex);</span><br><span class="line"> <span class="keyword">throw</span> ex;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">finally</span> &#123;</span><br><span class="line"> cleanupTransactionInfo(txInfo);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>åªæœ‰å¼‚å¸¸ä¼ æ’­å‡ºäº†æ ‡è®°äº† @Transactional æ³¨è§£çš„æ–¹æ³•ï¼Œäº‹åŠ¡æ‰èƒ½å›æ»š</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The default behavior is as with EJB: rollback on unchecked exception</span></span><br><span class="line"><span class="comment"> * (&#123;<span class="doctag">@link</span> RuntimeException&#125;), assuming an unexpected outcome outside of any</span></span><br><span class="line"><span class="comment"> * business rules. Additionally, we also attempt to rollback on &#123;<span class="doctag">@link</span> Error&#125; which</span></span><br><span class="line"><span class="comment"> * is clearly an unexpected outcome as well. By contrast, a checked exception is</span></span><br><span class="line"><span class="comment"> * considered a business exception and therefore a regular expected outcome of the</span></span><br><span class="line"><span class="comment"> * transactional business method, i.e. a kind of alternative return value which</span></span><br><span class="line"><span class="comment"> * still allows for regular completion of resource operations.</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;This is largely consistent with TransactionTemplate&#x27;s default behavior,</span></span><br><span class="line"><span class="comment"> * except that TransactionTemplate also rolls back on undeclared checked exceptions</span></span><br><span class="line"><span class="comment"> * (a corner case). For declarative transactions, we expect checked exceptions to be</span></span><br><span class="line"><span class="comment"> * intentionally declared as business exceptions, leading to a commit by default.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> org.springframework.transaction.support.TransactionTemplate#execute</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">rollbackOn</span><span class="params">(Throwable ex)</span> </span>&#123;</span><br><span class="line">     <span class="keyword">return</span> (ex <span class="keyword">instanceof</span> RuntimeException || ex <span class="keyword">instanceof</span> Error);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>é»˜è®¤å‡ºç° RuntimeExceptionï¼ˆéå—æ£€å¼‚å¸¸ï¼‰æˆ– Error çš„æ—¶å€™ï¼ŒSpring æ‰ä¼šå›æ»šäº‹åŠ¡ï¼ˆå¯ä»¥æŒ‡å®šå›æ»šå¼‚å¸¸ï¼‰</li></ol><h3 id="äº‹åŠ¡ä¼ æ’­"><a href="#äº‹åŠ¡ä¼ æ’­" class="headerlink" title="äº‹åŠ¡ä¼ æ’­"></a>äº‹åŠ¡ä¼ æ’­</h3><p>æœ‰ç°åœ¨è¿™ä¸ªåœºæ™¯ï¼Œæ³¨å†Œä¸»ä¼šå‘˜å’Œæ³¨å†Œå­ç”¨æˆ·ï¼Œè¦æ±‚æ³¨å†Œå­ç”¨æˆ·å¤±è´¥ä¸å½±å“ä¸»ä¼šå‘˜çš„æ³¨å†Œï¼Œä¸‹è¿°ä¼ªä»£ç ï¼Œå¯ä»¥çŒœä¸€ä¸‹ç»“æœ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> UserRepository userRepository;</span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> SubUserService subUserService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">createUserWrong</span><span class="params">(UserEntity entity)</span> </span>&#123;</span><br><span class="line">    createMainUser(entity);</span><br><span class="line">    subUserService.createSubUserWithExceptionWrong(entity);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">createMainUser</span><span class="params">(UserEntity entity)</span> </span>&#123;</span><br><span class="line">    userRepository.save(entity);</span><br><span class="line">    log.info(<span class="string">&quot;createMainUser finish&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç å¼‚å¸¸è·‘å‡ºäº†@Transactional æ³¨è§£æ ‡è®°çš„ createUserWrong æ–¹æ³•ï¼ŒSpring ä¼šå›æ»šäº‹åŠ¡</p><p>ä¿®æ”¹ä¹‹åå¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">createUserWrong2</span><span class="params">(UserEntity entity)</span> </span>&#123;</span><br><span class="line">    createMainUser(entity);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        subUserService.createSubUserWithExceptionWrong(entity);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">        log.error(<span class="string">&quot;create sub user error:&#123;&#125;&quot;</span>, ex.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è™½ç„¶æ•è·äº†å¼‚å¸¸ï¼Œä½†æ˜¯å› ä¸ºæ²¡æœ‰å¼€å¯æ–°äº‹åŠ¡ï¼Œè€Œå½“å‰äº‹åŠ¡å› ä¸ºå¼‚å¸¸å·²ç»è¢«æ ‡è®°ä¸ºrollbackäº†ï¼Œæ‰€ä»¥æœ€ç»ˆè¿˜æ˜¯ä¼šå›æ»šã€‚</p><p>çœ‹åˆ°è¿™é‡Œå°±æ¸…æ¥šäº†ï¼Œåªèƒ½è®©å¤„ç†å­ç”¨æˆ·çš„é€»è¾‘è¿è¡Œåœ¨å•ç‹¬çš„äº‹åŠ¡ä¸­ï¼Œè¿™å°±ç”¨åˆ°äº†SPRINGçš„äº‹åŠ¡ä¼ æ’­æœºåˆ¶</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional(propagation = Propagation.REQUIRES_NEW)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">createSubUserWithExceptionRight</span><span class="params">(UserEntity entity)</span> </span>&#123;</span><br><span class="line">    log.info(<span class="string">&quot;createSubUserWithExceptionRight start&quot;</span>);</span><br><span class="line">    userRepository.save(entity);</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;invalid status&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">createUserRight</span><span class="params">(UserEntity entity)</span> </span>&#123;</span><br><span class="line">    createMainUser(entity);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        subUserService.createSubUserWithExceptionRight(entity);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">        <span class="comment">// æ•è·å¼‚å¸¸ï¼Œé˜²æ­¢ä¸»æ–¹æ³•å›æ»š</span></span><br><span class="line">        log.error(<span class="string">&quot;create sub user error:&#123;&#125;&quot;</span>, ex.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¸Œæœ›è¿™æ¬¡åˆ†äº«èƒ½å¸®åŠ©å¤§å®¶æ­£ç¡®å¤„ç†ä¸šåŠ¡ä»£ç ä¸­çš„äº‹åŠ¡ã€‚</p><h3 id="å®é™…ä½¿ç”¨è¸©çš„å‘"><a href="#å®é™…ä½¿ç”¨è¸©çš„å‘" class="headerlink" title="å®é™…ä½¿ç”¨è¸©çš„å‘"></a>å®é™…ä½¿ç”¨è¸©çš„å‘</h3><h4 id="å¤šæ•°æ®æºä¸­ä¸èƒ½ä½¿ç”¨äº‹åŠ¡"><a href="#å¤šæ•°æ®æºä¸­ä¸èƒ½ä½¿ç”¨äº‹åŠ¡" class="headerlink" title="å¤šæ•°æ®æºä¸­ä¸èƒ½ä½¿ç”¨äº‹åŠ¡"></a>å¤šæ•°æ®æºä¸­ä¸èƒ½ä½¿ç”¨äº‹åŠ¡</h4><h4 id="äº‹åŠ¡å’Œåˆ†å¸ƒå¼é”ä½¿ç”¨çš„å‘"><a href="#äº‹åŠ¡å’Œåˆ†å¸ƒå¼é”ä½¿ç”¨çš„å‘" class="headerlink" title="äº‹åŠ¡å’Œåˆ†å¸ƒå¼é”ä½¿ç”¨çš„å‘"></a>äº‹åŠ¡å’Œåˆ†å¸ƒå¼é”ä½¿ç”¨çš„å‘</h4><p>ç°è±¡ï¼šä¸šåŠ¡ä¸­åŠ äº†åˆ†å¸ƒå¼é”ï¼Œä¹Ÿåšäº†å¹‚ç­‰å¤„ç†å¦‚æœä¸šåŠ¡IDå­˜åœ¨ç›¸åŒçš„æ•°æ®åˆ™ç›´æ¥è¿”å›ã€‚ä½†è¿˜æ˜¯ä¼šç”Ÿæˆ2æ¡ä¸€æ ·çš„æ•°æ®ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Around(&quot;@annotation(redisLock)&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">around</span><span class="params">(ProceedingJoinPoint joinPoint, RedisLock redisLock)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">    String spel = redisLock.key();</span><br><span class="line">    String lockName = redisLock.lockName();</span><br><span class="line">    String redisLockKey = getRedisKey(joinPoint, lockName, spel);</span><br><span class="line">    log.info(<span class="string">&quot;ç”Ÿæˆçš„ redisKey æ˜¯ -&gt; &#123;&#125;&quot;</span>, redisLockKey);</span><br><span class="line">    RLock rLock = redissonClient.getLock(redisLockKey);</span><br><span class="line">    Object result;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        rLock.lock(redisLock.expire(), redisLock.timeUnit());</span><br><span class="line">        <span class="comment">//æ‰§è¡Œæ–¹æ³•</span></span><br><span class="line">        result = joinPoint.proceed();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InterruptedException interruptedException) &#123;</span><br><span class="line">        log.error(<span class="string">&quot;è·å–åˆ†å¸ƒå¼é”å¤±è´¥, &quot;</span>, interruptedException);</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;è·å–åˆ†å¸ƒå¼é”å¤±è´¥&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (rLock.isLocked()) &#123;</span><br><span class="line">            rLock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Transactional(rollbackFor = RuntimeException.class)</span></span><br><span class="line"><span class="meta">@RedisLock(lockName = &quot;test&quot;, key = &quot;test&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// æ ¹æ®æ‰‹æœºå·æŸ¥è¯¢ç”¨æˆ·</span></span><br><span class="line">    User user = bizService.queryByPhone(<span class="string">&quot;17770848782&quot;</span>);</span><br><span class="line">    log.info(<span class="string">&quot;user===&#123;&#125;&quot;</span>, user);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Transactional(rollbackFor = RuntimeException.class)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// æ ¹æ®æ‰‹æœºå·æŸ¥è¯¢ç”¨æˆ·</span></span><br><span class="line">    User user = bizService.queryByPhone(<span class="string">&quot;17770848782&quot;</span>);</span><br><span class="line">    log.info(<span class="string">&quot;user2===&#123;&#125;&quot;</span>, user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="https://raw.githubusercontent.com/Alexhuihui/photo/main/c87dacaa25d90940960381b89cbcc36.png"><img src="https://raw.githubusercontent.com/Alexhuihui/photo/main/c87dacaa25d90940960381b89cbcc36.png" alt="img"></a></p><p><a href="https://raw.githubusercontent.com/Alexhuihui/photo/main/2c863c0d9bede38ff6d4494ffd1e913.png"><img src="https://raw.githubusercontent.com/Alexhuihui/photo/main/2c863c0d9bede38ff6d4494ffd1e913.png" alt="img"></a></p><p><a href="https://raw.githubusercontent.com/Alexhuihui/photo/main/31a1043cd83c4866d202ba4c86efd5a.png"><img src="https://raw.githubusercontent.com/Alexhuihui/photo/main/31a1043cd83c4866d202ba4c86efd5a.png" alt="img"></a></p><p><a href="https://raw.githubusercontent.com/Alexhuihui/photo/main/152cfd85f8f8c853ed32f308155f461.png"><img src="https://raw.githubusercontent.com/Alexhuihui/photo/main/152cfd85f8f8c853ed32f308155f461.png" alt="img"></a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping</span></span><br><span class="line"><span class="meta">@Operation(summary = &quot;test2&quot;)</span></span><br><span class="line"><span class="meta">@RedisLock(lockName = &quot;test2&quot;, key = &quot;test2&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ObjectResponse&lt;String&gt; <span class="title">test2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    userAppService.test2();</span><br><span class="line">    <span class="keyword">return</span> ObjectResponse.success();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@PostMapping</span></span><br><span class="line"><span class="meta">@Operation(summary = &quot;test&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ObjectResponse&lt;String&gt; <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    userAppService.test();</span><br><span class="line">    <span class="keyword">return</span> ObjectResponse.success();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»“è®ºï¼šå½“ä½¿ç”¨åˆ†å¸ƒå¼é”å’Œäº‹åŠ¡æ—¶ï¼Œå› ä¸ºåˆ‡é¢å¤„ç†æ˜¯ç”¨çš„å…ˆè¿›åå‡ºçš„æ ˆï¼Œåˆå› ä¸ºäº‹åŠ¡å¤„ç†çš„ä¼˜å…ˆçº§æ˜¯é»˜è®¤æœ€ä½çš„ï¼Œæ‰€ä»¥å¦‚æœæ²¡æœ‰çŸ¥é“åˆ†å¸ƒå¼é”çš„ä¼˜å…ˆçº§å°±ä¼šå¯¼è‡´é”å…ˆäºäº‹åŠ¡é‡Šæ”¾ï¼Œå¯¼è‡´å¯èƒ½å‡ºç°äº‹åŠ¡çš„éš”ç¦»æ€§è¢«ç ´åï¼Œäº§ç”Ÿè„æ•°æ®ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;å¤§å®¶è‚¯å®šå¯¹@Transactionalè¿™ä¸ªæ³¨è§£å¾ˆç†Ÿæ‚‰ï¼Œä¹Ÿå¯¹äº‹åŠ¡æœ‰ç€è¯¦ç»†çš„äº†è§£ï¼Œä¹ŸçŸ¥é“å¤šä¸ªæ•°æ®åº“æ“ä½œéœ€è¦é€šè¿‡äº‹åŠ¡æ¥ä¿è¯ä¸€è‡´æ€§å’ŒåŸå­æ€§ã€‚ä½†æ˜¯å¾ˆå°‘ä¼šå…³æ³¨äº‹åŠ¡æ˜¯å¦ç”Ÿæ•ˆã€æœ‰æ²¡æœ‰å‡ºé”™ã€‚è¿™ç±»é—®é¢˜ä¹Ÿæ¯”è¾ƒéš¾åœ¨æµ‹è¯•é˜¶æ®µå‘ç°ï¼Œå½“å‡ºç°çº¿ä¸Šé—®é¢˜çš„æ—¶å€™ä¸å¯é¿å…çš„ä¼šäº§ç”Ÿå¤§é‡è„æ•°æ®ã€‚æ‰€ä»¥è¿™æ¬¡æˆ‘åˆ†äº«çš„å†…å®¹å°±æ˜¯å¸®åŠ©å¤§å®¶ç†æ¸…æ¥šä½¿ç”¨@Transactionalçš„æ€è·¯ï¼Œé¿å…ä½¿ç”¨ä¸å½“äº§ç”Ÿbugã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯åˆ†äº«" scheme="https://alexhuihui.github.io/categories/%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB/"/>
    
    
    <category term="æŠ€æœ¯åˆ†äº«" scheme="https://alexhuihui.github.io/tags/%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB/"/>
    
  </entry>
  
  <entry>
    <title>ã€ELKã€‘springbootç»“åˆelkæ­å»ºæ—¥å¿—å¹³å°</title>
    <link href="https://alexhuihui.github.io/article/20231206.html"/>
    <id>https://alexhuihui.github.io/article/20231206.html</id>
    <published>2023-12-06T11:54:06.000Z</published>
    <updated>2025-01-25T12:23:00.378Z</updated>
    
    <content type="html"><![CDATA[<p>æœ¬æ–‡ä»‹ç»å¦‚æœé€šè¿‡æ­å»ºELKæ”¶é›†springbootçš„æ—¥å¿—ã€‚</p><span id="more"></span> <h3 id="éƒ¨ç½²ELK"><a href="#éƒ¨ç½²ELK" class="headerlink" title="éƒ¨ç½²ELK"></a>éƒ¨ç½²ELK</h3><p>é€šè¿‡docker composeå®‰è£…</p><ol><li><p>å®‰è£…docker compose</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum install -y yum-utils device-mapper-persistent-data lvm2</span><br><span class="line">yum install docker-compose</span><br></pre></td></tr></table></figure></li><li><p>åˆ›å»ºä»¥ä¸‹ç›®å½•ä»¥åŠå¯¹åº”çš„é…ç½®æ–‡ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">â”œâ”€â”€ docker-compose.yml</span><br><span class="line">â”œâ”€â”€ elasticsearch</span><br><span class="line">â”‚   â”œâ”€â”€ config</span><br><span class="line">â”‚   â”‚   â””â”€â”€ elasticsearch.yml</span><br><span class="line">â”‚   â”œâ”€â”€ data</span><br><span class="line">â”‚   â””â”€â”€ logs</span><br><span class="line">â”œâ”€â”€ kibana</span><br><span class="line">â”‚   â””â”€â”€ config</span><br><span class="line">â”‚       â””â”€â”€ kibana.yml</span><br><span class="line">â””â”€â”€ logstash</span><br><span class="line">    â”œâ”€â”€ config</span><br><span class="line">    â”‚   â”œâ”€â”€ logstash.yml</span><br><span class="line">    â”‚   â””â”€â”€ small-tools</span><br><span class="line">    â”‚       â””â”€â”€ dev-enlightrn-hub.config</span><br><span class="line">    â””â”€â”€ data</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># elasticsearch.yml</span><br><span class="line">cluster.name: &quot;docker-cluster&quot;</span><br><span class="line">network.host: 0.0.0.0</span><br><span class="line">http.port: 9200</span><br><span class="line"># å¼€å¯esè·¨åŸŸ</span><br><span class="line">http.cors.enabled: true</span><br><span class="line">http.cors.allow-origin: &quot;*&quot;</span><br><span class="line">http.cors.allow-headers: Authorization</span><br><span class="line"># # å¼€å¯å®‰å…¨æ§åˆ¶</span><br><span class="line">xpack.security.enabled: true</span><br><span class="line">xpack.security.transport.ssl.enabled: true</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># kibana.yml</span><br><span class="line">server.name: kibana</span><br><span class="line">server.host: &quot;0.0.0.0&quot;</span><br><span class="line">server.publicBaseUrl: &quot;http://kibana:5601&quot;</span><br><span class="line">elasticsearch.hosts: [ &quot;http://elasticsearch:9200&quot; ] </span><br><span class="line">xpack.monitoring.ui.container.elasticsearch.enabled: true</span><br><span class="line">elasticsearch.username: &quot;elastic&quot;</span><br><span class="line">elasticsearch.password: &quot;123456&quot;</span><br><span class="line">i18n.locale: zh-CN</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># logstash.yml</span><br><span class="line">http.host: &quot;0.0.0.0&quot;</span><br><span class="line">xpack.monitoring.enabled: true</span><br><span class="line">xpack.monitoring.elasticsearch.hosts: [ &quot;http://elasticsearch:9200&quot; ]</span><br><span class="line">xpack.monitoring.elasticsearch.username: &quot;elastic&quot;</span><br><span class="line">xpack.monitoring.elasticsearch.password: &quot;123456&quot;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"># dev-enlightrn-hub.config</span><br><span class="line">input &#123; #è¾“å…¥</span><br><span class="line"> </span><br><span class="line">    tcp &#123;</span><br><span class="line">        mode =&gt; &quot;server&quot;</span><br><span class="line">        host =&gt; &quot;0.0.0.0&quot;   # å…è®¸ä»»æ„ä¸»æœºå‘é€æ—¥å¿—</span><br><span class="line">        type =&gt; &quot;dev-enlighten-hub&quot;      # è®¾å®štypeä»¥åŒºåˆ†æ¯ä¸ªè¾“å…¥æº</span><br><span class="line">        port =&gt; 9999</span><br><span class="line">        codec =&gt; json_lines # æ•°æ®æ ¼å¼</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">filter &#123;</span><br><span class="line">    mutate &#123;</span><br><span class="line">        # å¯¼å…¥ä¹‹è¿‡æ»¤å­—æ®µ</span><br><span class="line">        remove_field =&gt; [&quot;LOG_MAX_HISTORY_DAY&quot;, &quot;LOG_HOME&quot;, &quot;APP_NAME&quot;]</span><br><span class="line">        remove_field =&gt; [&quot;@version&quot;, &quot;_score&quot;, &quot;port&quot;, &quot;level_value&quot;, &quot;tags&quot;, &quot;_type&quot;, &quot;host&quot;]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">output &#123; #è¾“å‡º-æ§åˆ¶å°</span><br><span class="line">    stdout&#123;</span><br><span class="line">        codec =&gt; rubydebug</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">output &#123; #è¾“å‡º-es</span><br><span class="line"> </span><br><span class="line">    if [type] == &quot;dev-enlighten-hub&quot; &#123;</span><br><span class="line">        elasticsearch &#123;</span><br><span class="line">            action =&gt; &quot;index&quot;                       # è¾“å‡ºæ—¶åˆ›å»ºæ˜ å°„</span><br><span class="line">            hosts  =&gt; &quot;http://elasticsearch:9200&quot;   # ESåœ°å€å’Œç«¯å£</span><br><span class="line">            user =&gt; &quot;elastic&quot;                       # ESç”¨æˆ·å</span><br><span class="line">            password =&gt; &quot;123456&quot;                    # ESå¯†ç </span><br><span class="line">            index  =&gt; &quot;dev-enlighten-hub-%&#123;+YYYY.MM.dd&#125;&quot;         # æŒ‡å®šç´¢å¼•å-æŒ‰å¤©</span><br><span class="line">            codec  =&gt; &quot;json&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>ç¼–å†™docker-compose.yml</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">version: &#x27;3.3&#x27;</span><br><span class="line">networks:</span><br><span class="line">  elk:</span><br><span class="line">    driver: bridge</span><br><span class="line">services:</span><br><span class="line">  elasticsearch:</span><br><span class="line">    image: registry.cn-hangzhou.aliyuncs.com/zhengqing/elasticsearch:7.14.1</span><br><span class="line">    container_name: elk_elasticsearch</span><br><span class="line">    restart: unless-stopped</span><br><span class="line">    volumes:</span><br><span class="line">      - &quot;./elasticsearch/data:/usr/share/elasticsearch/data&quot;</span><br><span class="line">      - &quot;./elasticsearch/logs:/usr/share/elasticsearch/logs&quot;</span><br><span class="line">      - &quot;./elasticsearch/config/elasticsearch.yml:/usr/share/elasticsearch/config/elasticsearch.yml&quot;</span><br><span class="line">    environment:</span><br><span class="line">      TZ: Asia/Shanghai</span><br><span class="line">      LANG: en_US.UTF-8</span><br><span class="line">      TAKE_FILE_OWNERSHIP: &quot;true&quot;  # æƒé™</span><br><span class="line">      discovery.type: single-node</span><br><span class="line">      ES_JAVA_OPTS: &quot;-Xmx1g -Xms1g&quot;</span><br><span class="line">      ELASTIC_PASSWORD: &quot;111111&quot; # elasticè´¦å·å¯†ç </span><br><span class="line">    ports:</span><br><span class="line">      - &quot;9200:9200&quot;</span><br><span class="line">      - &quot;9300:9300&quot;</span><br><span class="line">    networks:</span><br><span class="line">      - elk</span><br><span class="line"> </span><br><span class="line">  kibana:</span><br><span class="line">    image: registry.cn-hangzhou.aliyuncs.com/zhengqing/kibana:7.14.1</span><br><span class="line">    container_name: elk_kibana</span><br><span class="line">    restart: unless-stopped</span><br><span class="line">    volumes:</span><br><span class="line">      - &quot;./kibana/config/kibana.yml:/usr/share/kibana/config/kibana.yml&quot;</span><br><span class="line">    ports:</span><br><span class="line">      - &quot;5601:5601&quot;</span><br><span class="line">    depends_on:</span><br><span class="line">      - elasticsearch</span><br><span class="line">    links:</span><br><span class="line">      - elasticsearch</span><br><span class="line">    networks:</span><br><span class="line">      - elk</span><br><span class="line"> </span><br><span class="line">  logstash:</span><br><span class="line">    image: registry.cn-hangzhou.aliyuncs.com/zhengqing/logstash:7.14.1</span><br><span class="line">    container_name: elk_logstash</span><br><span class="line">    restart: unless-stopped</span><br><span class="line">    environment:</span><br><span class="line">      LS_JAVA_OPTS: &quot;-Xmx1g -Xms1g&quot;</span><br><span class="line">    volumes:</span><br><span class="line">      - &quot;./logstash/data:/usr/share/logstash/data&quot;</span><br><span class="line">      - &quot;./logstash/config/logstash.yml:/usr/share/logstash/config/logstash.yml&quot;</span><br><span class="line">      - &quot;./logstash/config/small-tools:/usr/share/logstash/config/small-tools&quot;</span><br><span class="line">    command: logstash -f /usr/share/logstash/config/small-tools</span><br><span class="line">    ports:</span><br><span class="line">      - &quot;9600:9600&quot;</span><br><span class="line">      - &quot;9999:9999&quot;</span><br><span class="line">    depends_on:</span><br><span class="line">      - elasticsearch</span><br><span class="line">    networks:</span><br><span class="line">      - elk</span><br></pre></td></tr></table></figure></li><li><p>æ‰§è¡Œå¯åŠ¨å‘½ä»¤</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker compose up -d</span><br></pre></td></tr></table></figure></li><li><p>å¦‚æœå¯åŠ¨å¤±è´¥å¯ä»¥é€šè¿‡ä¸‹è¿°å‘½ä»¤è¿›è¡Œæ£€æŸ¥é…ç½®é¡¹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose run --rm logstash logstash -t -f /usr/share/logstash/config/small-tools</span><br></pre></td></tr></table></figure></li></ol><h3 id="ä¿®æ”¹spring-booté¡¹ç›®"><a href="#ä¿®æ”¹spring-booté¡¹ç›®" class="headerlink" title="ä¿®æ”¹spring booté¡¹ç›®"></a>ä¿®æ”¹spring booté¡¹ç›®</h3><ol><li><p>æ·»åŠ mavenä¾èµ–</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">      &lt;groupId&gt;net.logstash.logback&lt;/groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;logstash-logback-encoder&lt;/artifactId&gt;</span><br><span class="line">      &lt;version&gt;7.3&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure></li><li><p>æ·»åŠ logback-spring.xml</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;configuration scan=&quot;true&quot; scanPeriod=&quot;60 seconds&quot; debug=&quot;false&quot;&gt;</span><br><span class="line">  &lt;!-- æ—¥å¿—å­˜æ”¾è·¯å¾„ --&gt;</span><br><span class="line">  &lt;property name=&quot;log.path&quot; value=&quot;$&#123;user.dir&#125;/logs&quot;/&gt;</span><br><span class="line">  &lt;!-- æ—¥å¿—è¾“å‡ºæ ¼å¼ --&gt;</span><br><span class="line">  &lt;property name=&quot;log.pattern&quot; value=&quot;%d&#123;HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;20&#125; - [%method,%line] - %msg%n&quot;/&gt;</span><br><span class="line"></span><br><span class="line">  &lt;!-- æ§åˆ¶å°è¾“å‡º --&gt;</span><br><span class="line">  &lt;appender name=&quot;console&quot; class=&quot;ch.qos.logback.core.ConsoleAppender&quot;&gt;</span><br><span class="line">    &lt;encoder&gt;</span><br><span class="line">      &lt;pattern&gt;$&#123;log.pattern&#125;&lt;/pattern&gt;</span><br><span class="line">    &lt;/encoder&gt;</span><br><span class="line">  &lt;/appender&gt;</span><br><span class="line"></span><br><span class="line">  &lt;!-- ç³»ç»Ÿæ—¥å¿—è¾“å‡º --&gt;</span><br><span class="line">  &lt;appender name=&quot;file_info&quot; class=&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;&gt;</span><br><span class="line">    &lt;file&gt;$&#123;log.path&#125;/info.log&lt;/file&gt;</span><br><span class="line">    &lt;!-- å¾ªç¯æ”¿ç­–ï¼šåŸºäºæ—¶é—´åˆ›å»ºæ—¥å¿—æ–‡ä»¶ --&gt;</span><br><span class="line">    &lt;rollingPolicy class=&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;&gt;</span><br><span class="line">      &lt;!-- æ—¥å¿—æ–‡ä»¶åæ ¼å¼ --&gt;</span><br><span class="line">      &lt;fileNamePattern&gt;$&#123;log.path&#125;/info.%d&#123;yyyy-MM-dd&#125;.log&lt;/fileNamePattern&gt;</span><br><span class="line">      &lt;!-- æ—¥å¿—æœ€å¤§çš„å†å² 7å¤© --&gt;</span><br><span class="line">      &lt;maxHistory&gt;7&lt;/maxHistory&gt;</span><br><span class="line">    &lt;/rollingPolicy&gt;</span><br><span class="line">    &lt;encoder&gt;</span><br><span class="line">      &lt;pattern&gt;$&#123;log.pattern&#125;&lt;/pattern&gt;</span><br><span class="line">    &lt;/encoder&gt;</span><br><span class="line">    &lt;filter class=&quot;ch.qos.logback.classic.filter.LevelFilter&quot;&gt;</span><br><span class="line">      &lt;!-- è¿‡æ»¤çš„çº§åˆ« --&gt;</span><br><span class="line">      &lt;level&gt;INFO&lt;/level&gt;</span><br><span class="line">      &lt;!-- åŒ¹é…æ—¶çš„æ“ä½œï¼šæ¥æ”¶ï¼ˆè®°å½•ï¼‰ --&gt;</span><br><span class="line">      &lt;onMatch&gt;ACCEPT&lt;/onMatch&gt;</span><br><span class="line">      &lt;!-- ä¸åŒ¹é…æ—¶çš„æ“ä½œï¼šæ‹’ç»ï¼ˆä¸è®°å½•ï¼‰ --&gt;</span><br><span class="line">      &lt;onMismatch&gt;DENY&lt;/onMismatch&gt;</span><br><span class="line">    &lt;/filter&gt;</span><br><span class="line">  &lt;/appender&gt;</span><br><span class="line"></span><br><span class="line">  &lt;appender name=&quot;file_error&quot; class=&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;&gt;</span><br><span class="line">    &lt;file&gt;$&#123;log.path&#125;/error.log&lt;/file&gt;</span><br><span class="line">    &lt;!-- å¾ªç¯æ”¿ç­–ï¼šåŸºäºæ—¶é—´åˆ›å»ºæ—¥å¿—æ–‡ä»¶ --&gt;</span><br><span class="line">    &lt;rollingPolicy class=&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;&gt;</span><br><span class="line">      &lt;!-- æ—¥å¿—æ–‡ä»¶åæ ¼å¼ --&gt;</span><br><span class="line">      &lt;fileNamePattern&gt;$&#123;log.path&#125;/error.%d&#123;yyyy-MM-dd&#125;.log&lt;/fileNamePattern&gt;</span><br><span class="line">      &lt;!-- æ—¥å¿—æœ€å¤§çš„å†å² 60å¤© --&gt;</span><br><span class="line">      &lt;maxHistory&gt;60&lt;/maxHistory&gt;</span><br><span class="line">    &lt;/rollingPolicy&gt;</span><br><span class="line">    &lt;encoder&gt;</span><br><span class="line">      &lt;pattern&gt;$&#123;log.pattern&#125;&lt;/pattern&gt;</span><br><span class="line">    &lt;/encoder&gt;</span><br><span class="line">    &lt;filter class=&quot;ch.qos.logback.classic.filter.LevelFilter&quot;&gt;</span><br><span class="line">      &lt;!-- è¿‡æ»¤çš„çº§åˆ« --&gt;</span><br><span class="line">      &lt;level&gt;ERROR&lt;/level&gt;</span><br><span class="line">      &lt;!-- åŒ¹é…æ—¶çš„æ“ä½œï¼šæ¥æ”¶ï¼ˆè®°å½•ï¼‰ --&gt;</span><br><span class="line">      &lt;onMatch&gt;ACCEPT&lt;/onMatch&gt;</span><br><span class="line">      &lt;!-- ä¸åŒ¹é…æ—¶çš„æ“ä½œï¼šæ‹’ç»ï¼ˆä¸è®°å½•ï¼‰ --&gt;</span><br><span class="line">      &lt;onMismatch&gt;DENY&lt;/onMismatch&gt;</span><br><span class="line">    &lt;/filter&gt;</span><br><span class="line">  &lt;/appender&gt;</span><br><span class="line"></span><br><span class="line">  &lt;!-- å°†æ—¥å¿—æ–‡ä»¶è¾“å‡ºåˆ°Logstash --&gt;</span><br><span class="line">  &lt;appender name=&quot;logstash&quot; class=&quot;net.logstash.logback.appender.LogstashTcpSocketAppender&quot;&gt;</span><br><span class="line">    &lt;!-- è·å–logstashåœ°å€ä½œä¸ºè¾“å‡ºçš„ç›®çš„åœ° --&gt;</span><br><span class="line">    &lt;destination&gt;172.22.0.4:9999&lt;/destination&gt;</span><br><span class="line">    &lt;encoder chatset=&quot;UTF-8&quot; class=&quot;net.logstash.logback.encoder.LogstashEncoder&quot;/&gt;</span><br><span class="line">  &lt;/appender&gt;</span><br><span class="line"></span><br><span class="line">  &lt;!-- ç³»ç»Ÿæ¨¡å—æ—¥å¿—çº§åˆ«æ§åˆ¶  --&gt;</span><br><span class="line">  &lt;logger name=&quot;com.gyhappylife&quot; level=&quot;info&quot;/&gt;</span><br><span class="line">  &lt;!-- Springæ—¥å¿—çº§åˆ«æ§åˆ¶  --&gt;</span><br><span class="line">  &lt;logger name=&quot;org.springframework&quot; level=&quot;warn&quot;/&gt;</span><br><span class="line"></span><br><span class="line">  &lt;root level=&quot;info&quot;&gt;</span><br><span class="line">    &lt;appender-ref ref=&quot;console&quot;/&gt;</span><br><span class="line">  &lt;/root&gt;</span><br><span class="line"></span><br><span class="line">  &lt;!--ç³»ç»Ÿæ“ä½œæ—¥å¿—--&gt;</span><br><span class="line">  &lt;root level=&quot;info&quot;&gt;</span><br><span class="line">    &lt;appender-ref ref=&quot;file_info&quot;/&gt;</span><br><span class="line">    &lt;appender-ref ref=&quot;file_error&quot;/&gt;</span><br><span class="line">    &lt;appender-ref ref=&quot;logstash&quot;/&gt;</span><br><span class="line">  &lt;/root&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br></pre></td></tr></table></figure></li></ol><h3 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h3><p>å¦‚æœspringåº”ç”¨ä¹Ÿæ˜¯è·‘åœ¨dockerä¸­çš„è¯ é‚£ä¹ˆå®ƒçš„ç½‘æ®µå¯èƒ½ä¼šå’ŒELKä¸ä¸€æ · ã€‚è¿™æ ·å°±å¿…é¡»åœ¨iptablesä¸­æ·»åŠ è·¯ç”±è§„åˆ™ä¾‹å¦‚:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ iptables -I DOCKER-USER -i br-3bed419583c5 -o br-787e52a81bb4 -j ACCEPT</span><br><span class="line">$ iptables -I DOCKER-USER -i br-787e52a81bb4 -o br-3bed419583c5 -j ACCEPT</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;æœ¬æ–‡ä»‹ç»å¦‚æœé€šè¿‡æ­å»ºELKæ”¶é›†springbootçš„æ—¥å¿—ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="ELK" scheme="https://alexhuihui.github.io/categories/ELK/"/>
    
    
    <category term="ELK" scheme="https://alexhuihui.github.io/tags/ELK/"/>
    
  </entry>
  
  <entry>
    <title>ã€æŠ€æœ¯åˆ†äº«ã€‘ä¼˜åŒ–å»¶è¿Ÿé˜Ÿåˆ—ä»»åŠ¡æ¶ˆè´¹æ—¶é—´çš„æŠ€æœ¯åˆ†äº«</title>
    <link href="https://alexhuihui.github.io/article/20231019.html"/>
    <id>https://alexhuihui.github.io/article/20231019.html</id>
    <published>2023-10-19T11:54:06.000Z</published>
    <updated>2025-01-25T12:25:43.387Z</updated>
    
    <content type="html"><![CDATA[<p>å»¶è¿Ÿé˜Ÿåˆ—åœ¨å®é™…åº”ç”¨ä¸­æ˜¯ä¸€é¡¹é‡è¦çš„æŠ€æœ¯ï¼Œå¯ä»¥ç”¨äºä»»åŠ¡è°ƒåº¦ã€å®šæ—¶æé†’ã€æ¶ˆæ¯é‡è¯•ç­‰å¤šç§åœºæ™¯ã€‚ç„¶è€Œï¼Œå»¶è¿Ÿé˜Ÿåˆ—çš„ä»»åŠ¡æœ‰æ—¶ä¼šåœ¨è¿‡æœŸæ—¶é—´ä¹‹åæ‰å¾—ä»¥æ‰§è¡Œï¼Œè¿™å¯èƒ½å¯¼è‡´åº”ç”¨ç¨‹åºçš„æ€§èƒ½é—®é¢˜å’Œä¸ç¡®å®šæ€§ã€‚åœ¨æœ¬æŠ€æœ¯åˆ†äº«ä¸­ï¼Œæˆ‘å°†ä»‹ç»ä¸€ä¸ªä¼˜åŒ–å»¶è¿Ÿé˜Ÿåˆ—ä»»åŠ¡æ¶ˆè´¹æ—¶é—´çš„è§£å†³æ–¹æ¡ˆï¼Œä»¥åŠå¦‚ä½•å®ç°è¿™ä¸€è§£å†³æ–¹æ¡ˆã€‚</p><span id="more"></span> <p><strong>å»¶è¿Ÿé˜Ÿåˆ—å®ç°åŸç†</strong></p><p>åœ¨æˆ‘ä»¬å¼€å§‹è®¨è®ºå¦‚ä½•ä¼˜åŒ–å»¶è¿Ÿé˜Ÿåˆ—çš„ä»»åŠ¡æ¶ˆè´¹æ—¶é—´ä¹‹å‰ï¼Œè®©æˆ‘ä»¬é¦–å…ˆäº†è§£ä¸€ä¸‹å»¶è¿Ÿé˜Ÿåˆ—çš„å®ç°åŸç†ã€‚è¿™ä¸ªå»¶è¿Ÿé˜Ÿåˆ—åŸºäºRediså’ŒRedissonåº“å®ç°ï¼Œå®ƒåˆ†ä¸ºä¸‰ä¸ªä¸»è¦é˜¶æ®µï¼šå¯åŠ¨ã€ä»»åŠ¡æ·»åŠ å’Œä»»åŠ¡æ¶ˆè´¹ã€‚</p><p><strong>ç¬¬ä¸€é˜¶æ®µï¼šå¯åŠ¨</strong></p><ol><li>è®¢é˜…é˜Ÿåˆ—ï¼šåœ¨è¿™ä¸ªé˜¶æ®µï¼Œæˆ‘ä»¬è®¢é˜…äº†ä¸€ä¸ªåä¸ºâ€redisson_delay_queue_channel:{dest_queue1}â€çš„å›ºå®šé˜Ÿåˆ—ï¼Œç”¨äºæ¥æ”¶ä»»åŠ¡åˆ°æœŸçš„é€šçŸ¥ã€‚</li><li>è·å–è¿‡æœŸä»»åŠ¡ï¼šä½¿ç”¨<code>zrangebyscore</code>å‘½ä»¤ï¼Œæˆ‘ä»¬è·å–äº†è¿‡äº†å½“å‰æ—¶é—´çš„100æ¡ä»»åŠ¡æ•°æ®ï¼Œä»¥ç¡®ä¿æ²¡æœ‰æ¼æ‰ä¸Šæ¬¡å®•æœºåæœªæ‰§è¡Œçš„ä»»åŠ¡ã€‚</li><li>åˆ¤æ–­ä¸‹ä¸€é¡µï¼šé€šè¿‡<code>zrange</code>å‘½ä»¤ï¼Œæˆ‘ä»¬æ£€æŸ¥æ˜¯å¦è¿˜æœ‰ä¸‹ä¸€é¡µçš„ä»»åŠ¡éœ€è¦å¤„ç†ã€‚</li><li>ç§»é™¤ä»»åŠ¡ï¼šä½¿ç”¨<code>BLPOP</code>å‘½ä»¤ï¼Œæˆ‘ä»¬ç§»é™¤å¹¶è·å–äº†é˜Ÿåˆ—â€dest_queue1â€ä¸­çš„ç¬¬ä¸€ä¸ªä»»åŠ¡ï¼Œå¦‚æœé˜Ÿåˆ—ä¸ºç©ºï¼Œè¯¥æ“ä½œä¼šä¸€ç›´é˜»å¡ã€‚</li></ol><p><strong>ç¬¬äºŒé˜¶æ®µï¼šæ·»åŠ å»¶æ—¶ä»»åŠ¡</strong></p><ol><li>æ·»åŠ ä»»åŠ¡ï¼šä½¿ç”¨<code>zadd</code>å‘½ä»¤ï¼Œæˆ‘ä»¬å°†ä»»åŠ¡æ·»åŠ åˆ°â€redisson_delay_queue_timeout:{dest_queue1}â€ã€‚</li><li>åŒæ­¥æ•°æ®ï¼šå°†ä»»åŠ¡æ•°æ®åŒæ­¥åˆ°â€redisson_delay_queue:{dest_queue1}â€ã€‚</li><li>è·å–å³å°†è§¦å‘çš„ä»»åŠ¡ï¼šé€šè¿‡<code>zrange</code>å‘½ä»¤ï¼Œæˆ‘ä»¬è·å–äº†å³å°†è§¦å‘çš„ä»»åŠ¡ã€‚</li><li>å‘å¸ƒé€šçŸ¥ï¼šä½¿ç”¨<code>publish</code>å‘½ä»¤ï¼Œæˆ‘ä»¬å‘â€redisson_delay_queue_channel:{dest_queue1}â€å‘å¸ƒäº†ä»»åŠ¡åˆ°æœŸçš„æ¶ˆæ¯ï¼Œå®¢æˆ·ç«¯æ”¶åˆ°é€šçŸ¥åä¼šåœ¨è‡ªå·±çš„è¿›ç¨‹ä¸­æ‰§è¡Œå»¶æ—¶ä»»åŠ¡ã€‚</li></ol><p><strong>ç¬¬ä¸‰é˜¶æ®µï¼šä»»åŠ¡æ¶ˆè´¹</strong></p><ol><li>è·å–åˆ°æœŸä»»åŠ¡ï¼šä½¿ç”¨<code>zrangebyscore</code>å‘½ä»¤ï¼Œæˆ‘ä»¬è·å–äº†â€redisson_delay_queue_timeout:{dest_queue1}â€ä¸­å·²åˆ°æœŸçš„ä»»åŠ¡ã€‚</li><li>å°†ä»»åŠ¡æ”¾å…¥é˜Ÿåˆ—ï¼šé€šè¿‡<code>rpush</code>å‘½ä»¤ï¼Œæˆ‘ä»¬å°†è¿™äº›ä»»åŠ¡æ”¾å…¥ç¬¬ä¸€é˜¶æ®µç›‘å¬çš„é˜»å¡é˜Ÿåˆ—â€dest_queue1â€ã€‚</li><li>å®¢æˆ·ç«¯æ¶ˆè´¹ä»»åŠ¡ï¼šå®¢æˆ·ç«¯è·å–è¿™äº›æ•°æ®å¹¶è¿›è¡Œå¤„ç†ã€‚</li><li>åˆ é™¤ä»»åŠ¡ï¼šä½¿ç”¨<code>lrem</code>å’Œ<code>zrem</code>å‘½ä»¤ï¼Œæˆ‘ä»¬åˆ é™¤å·²ç»å¤„ç†è¿‡çš„ä»»åŠ¡ã€‚</li><li>æ£€æŸ¥ä¸‹ä¸€ä¸ªä»»åŠ¡ï¼šé€šè¿‡<code>zrange</code>å‘½ä»¤ï¼Œæˆ‘ä»¬æ£€æŸ¥æ˜¯å¦æœ‰ä¸‹ä¸€ä¸ªä»»åŠ¡éœ€è¦å¤„ç†ã€‚</li><li>ç»§ç»­ç›‘å¬ï¼šä½¿ç”¨<code>BLPOP</code>å‘½ä»¤ï¼Œæˆ‘ä»¬ç»§ç»­ç›‘å¬â€dest_queue1â€è¿™ä¸ªé˜»å¡é˜Ÿåˆ—ã€‚</li></ol><p><strong>é—®é¢˜åˆ†æ</strong></p><p>ä¸Šè¿°å®ç°ä¸­ï¼Œå®¢æˆ·ç«¯è®¢é˜…äº†ä¸€ä¸ªå…³é”®å­—ï¼ˆkeyï¼‰ï¼Œå¹¶ä¸”ä¼šåœ¨ç±»åˆå§‹åŒ–ä¸­æ‰§è¡Œè¯¥è®¢é˜…æ“ä½œã€‚ç„¶è€Œï¼Œåœ¨æµ‹è¯•ç¯å¢ƒä¸­ï¼ŒæœåŠ¡é¢‘ç¹å‡çº§å’Œé‡å¯ï¼Œåªæœ‰åœ¨è°ƒç”¨å»¶è¿Ÿé˜Ÿåˆ—å®¢æˆ·ç«¯çš„é™æ€æ–¹æ³•æ—¶æ‰ä¼šæ‰§è¡Œç±»åˆå§‹åŒ–ã€‚å› æ­¤ï¼Œå½“æœåŠ¡é‡å¯åæœªå†æ¬¡è®¢é˜…ç›¸åº”çš„keyï¼Œå¯¼è‡´æ— æ³•ä»Redisè·å–ä»»åŠ¡æ•°æ®ï¼Œå»¶è¿Ÿé˜Ÿåˆ—çš„ä»»åŠ¡æ¶ˆè´¹æ—¶é—´è¢«æ¨è¿Ÿã€‚</p><p><strong>ä¼˜åŒ–å»¶è¿Ÿé˜Ÿåˆ—ä»»åŠ¡æ¶ˆè´¹æ—¶é—´çš„è§£å†³æ–¹æ¡ˆ</strong></p><p>ä¸ºäº†ä¼˜åŒ–å»¶è¿Ÿé˜Ÿåˆ—ä»»åŠ¡çš„æ¶ˆè´¹æ—¶é—´ï¼Œæˆ‘ä»¬é‡‡ç”¨äº†Redissonåº“æ¥å®ç°å»¶è¿Ÿé˜Ÿåˆ—ã€‚ä¸‹é¢æ˜¯è§£å†³æ–¹æ¡ˆçš„ä¸»è¦æ­¥éª¤ï¼š</p><p><strong>1. å®šä¹‰æ¥å£</strong></p><p>é¦–å…ˆï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªåä¸ºQueueçš„æ¥å£ï¼Œç”¨äºè¡¨ç¤ºå»¶è¿Ÿé˜Ÿåˆ—ã€‚</p><p><strong>2. å®ç°æŠ½è±¡ç±»</strong></p><p>æˆ‘ä»¬å®ç°äº†ä¸€ä¸ªåä¸ºAbstractQueueçš„æŠ½è±¡ç±»ï¼Œè¯¥ç±»åŒ…å«äº†å®ç°å»¶è¿Ÿé˜Ÿåˆ—æ‰€éœ€çš„æ ¸å¿ƒé€»è¾‘ã€‚ä»¥ä¸‹æ˜¯è¯¥æŠ½è±¡ç±»çš„å…³é”®éƒ¨åˆ†ï¼š</p><ul><li>ä½¿ç”¨Redissonå®¢æˆ·ç«¯ï¼šé€šè¿‡Springé…ç½®ï¼Œæˆ‘ä»¬åˆå§‹åŒ–äº†Redissonå®¢æˆ·ç«¯ï¼Œä»¥ä¾¿ä¸RedisæœåŠ¡å™¨é€šä¿¡ã€‚</li><li>å®šä¹‰ç›‘å¬å™¨å®¹å™¨ï¼šæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªåä¸ºlistenerMapçš„å®¹å™¨ï¼Œç”¨äºå­˜å‚¨ä¸topicç›¸å…³çš„é˜Ÿåˆ—ç›‘å¬å™¨ã€‚</li><li>å¯åŠ¨ç›‘å¬çº¿ç¨‹ï¼šåœ¨æ„é€ å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬å¼€å¯äº†ä¸€ä¸ªç‹¬ç«‹çš„çº¿ç¨‹æ¥ç›‘å¬é˜Ÿåˆ—çš„æ¶ˆæ¯ã€‚è¿™ç¡®ä¿äº†ä»»åŠ¡èƒ½å¤ŸåŠæ—¶è¢«å¤„ç†ã€‚</li><li>å®ç°æ¶ˆè´¹é€»è¾‘ï¼šæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªconsumeræ–¹æ³•ï¼Œç”¨äºåœ¨ç›‘å¬åˆ°æ¶ˆæ¯æ—¶å¤„ç†é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ã€‚è¯¥æ–¹æ³•é¦–å…ˆè·å–ä¸æ¶ˆæ¯å¯¹åº”çš„é˜Ÿåˆ—ç›‘å¬å™¨ï¼Œç„¶åæ‰§è¡Œä»»åŠ¡çš„æ¶ˆè´¹é€»è¾‘ã€‚</li></ul><p><strong>3. å­ç±»å®ç°</strong></p><p>æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªåä¸ºDelayQueueçš„å­ç±»ï¼Œå®ƒç»§æ‰¿äº†AbstractQueueå¹¶å®ç°äº†å…¶ä¸­çš„æŠ½è±¡æ–¹æ³•ã€‚ä»¥ä¸‹æ˜¯è¯¥å­ç±»çš„å…³é”®éƒ¨åˆ†ï¼š</p><ul><li>åˆ›å»ºå»¶è¿Ÿé˜Ÿåˆ—ï¼šæˆ‘ä»¬ä½¿ç”¨Redissonå®¢æˆ·ç«¯åˆ›å»ºäº†RBlockingDequeå’ŒRDelayedQueueï¼Œè¿™æ˜¯å»¶è¿Ÿé˜Ÿåˆ—çš„åŸºæœ¬æ•°æ®ç»“æ„ã€‚</li><li>æ·»åŠ ä»»åŠ¡ï¼šé€šè¿‡offeræ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥å‘RDelayedQueueä¸­æ·»åŠ å»¶æ—¶ä»»åŠ¡ã€‚</li><li>æ¶ˆè´¹ä»»åŠ¡ï¼šåœ¨takeæ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬ä»RBlockingDequeä¸­è·å–ä»»åŠ¡æ•°æ®ï¼Œç„¶åå¼€å¯çº¿ç¨‹æ‰§è¡Œæ¶ˆè´¹é€»è¾‘ã€‚</li></ul><p><strong>ä½¿ç”¨ç¤ºä¾‹</strong></p><p>æœ€åï¼Œæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªDelayClientç±»ï¼Œå®ƒç”¨äºå‘å»¶è¿Ÿé˜Ÿåˆ—ä¸­æ·»åŠ ä»»åŠ¡ã€‚é€šè¿‡è°ƒç”¨offeræ–¹æ³•ï¼Œç”¨æˆ·å¯ä»¥æ–¹ä¾¿åœ°å°†ä»»åŠ¡åŠ å…¥å»¶è¿Ÿé˜Ÿåˆ—ï¼Œæ— éœ€æ‹…å¿ƒç±»åˆå§‹åŒ–é—®é¢˜ã€‚</p><p>å®ç°å»¶è¿Ÿé˜Ÿåˆ—çš„è®¾è®¡å…·æœ‰ä»¥ä¸‹ä¼˜ç‚¹ï¼š</p><ol><li>å®æ—¶æ€§ï¼šé‡‡ç”¨Rediså’ŒRedissonåº“å®ç°çš„å»¶è¿Ÿé˜Ÿåˆ—æ— éœ€è½®è¯¢ï¼Œä»»åŠ¡å¯ä»¥åœ¨åˆ°æœŸæ—¶ç«‹å³è¢«å¤„ç†ï¼Œæä¾›äº†æ›´å¥½çš„å®æ—¶æ€§ã€‚</li><li>å¯æ‰©å±•æ€§ï¼šå»¶è¿Ÿé˜Ÿåˆ—çš„è®¾è®¡æ”¯æŒåº”ç”¨ç¨‹åºçš„æ°´å¹³æ‰©å±•ã€‚å¯ä»¥è½»æ¾åœ°æ·»åŠ æ›´å¤šçš„æ¶ˆè´¹è€…æ¥å¤„ç†å¤§é‡çš„å»¶è¿Ÿä»»åŠ¡ï¼Œè€Œæ— éœ€æ‹…å¿ƒæ€§èƒ½é—®é¢˜ã€‚</li><li>å®¹é”™æ€§ï¼šå³ä½¿åœ¨æœåŠ¡å‡çº§æˆ–é‡å¯æ—¶ï¼Œå»¶è¿Ÿé˜Ÿåˆ—ä»èƒ½å¤Ÿæ­£å¸¸å·¥ä½œï¼Œä¸ä¼šä¸¢å¤±ä»»ä½•ä»»åŠ¡ã€‚</li><li>çµæ´»æ€§ï¼šä½¿ç”¨æŠ½è±¡ç±»å’Œæ¥å£çš„è®¾è®¡ï¼Œå¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚æ‰©å±•å’Œå®šåˆ¶å»¶è¿Ÿé˜Ÿåˆ—çš„åŠŸèƒ½ã€‚å¯ä»¥æ·»åŠ ä¸åŒç±»å‹çš„é˜Ÿåˆ—ç›‘å¬å™¨ï¼Œå®ç°å„ç§ä»»åŠ¡æ¶ˆè´¹é€»è¾‘ã€‚</li></ol><p><strong>ç»“è¯­</strong></p><p>é€šè¿‡ä½¿ç”¨Redissonå’Œåˆç†çš„è®¾è®¡ï¼Œæˆ‘ä»¬æˆåŠŸä¼˜åŒ–äº†å»¶è¿Ÿé˜Ÿåˆ—çš„ä»»åŠ¡æ¶ˆè´¹æ—¶é—´ï¼Œæé«˜äº†ç³»ç»Ÿçš„æ€§èƒ½å’Œç¨³å®šæ€§ã€‚è¿™ç§æŠ€æœ¯å¯¹äºéœ€è¦å¤„ç†å»¶è¿Ÿä»»åŠ¡çš„åº”ç”¨ç¨‹åºéå¸¸æœ‰ç”¨ï¼Œå¦‚å®šæ—¶ä»»åŠ¡ã€æ¶ˆæ¯é€šçŸ¥å’Œæ¶ˆæ¯é‡è¯•ç­‰åœºæ™¯ã€‚</p><p>åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œå¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚è¿›ä¸€æ­¥æ‰©å±•å’Œä¼˜åŒ–è¿™ä¸€è§£å†³æ–¹æ¡ˆï¼Œä»¥é€‚åº”ä¸åŒçš„åº”ç”¨åœºæ™¯ã€‚åŒæ—¶ï¼Œè¿˜å¯ä»¥è€ƒè™‘æ·»åŠ ç›‘æ§å’Œæ—¥å¿—è®°å½•ï¼Œä»¥ä¾¿æ›´å¥½åœ°è·Ÿè¸ªå’Œè°ƒè¯•å»¶è¿Ÿé˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ã€‚é€šè¿‡åˆé€‚çš„å·¥å…·å’Œè®¾è®¡ï¼Œå»¶è¿Ÿé˜Ÿåˆ—å¯ä»¥æˆä¸ºæé«˜åº”ç”¨ç¨‹åºæ•ˆç‡å’Œå¯é æ€§çš„é‡è¦ç»„æˆéƒ¨åˆ†ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;å»¶è¿Ÿé˜Ÿåˆ—åœ¨å®é™…åº”ç”¨ä¸­æ˜¯ä¸€é¡¹é‡è¦çš„æŠ€æœ¯ï¼Œå¯ä»¥ç”¨äºä»»åŠ¡è°ƒåº¦ã€å®šæ—¶æé†’ã€æ¶ˆæ¯é‡è¯•ç­‰å¤šç§åœºæ™¯ã€‚ç„¶è€Œï¼Œå»¶è¿Ÿé˜Ÿåˆ—çš„ä»»åŠ¡æœ‰æ—¶ä¼šåœ¨è¿‡æœŸæ—¶é—´ä¹‹åæ‰å¾—ä»¥æ‰§è¡Œï¼Œè¿™å¯èƒ½å¯¼è‡´åº”ç”¨ç¨‹åºçš„æ€§èƒ½é—®é¢˜å’Œä¸ç¡®å®šæ€§ã€‚åœ¨æœ¬æŠ€æœ¯åˆ†äº«ä¸­ï¼Œæˆ‘å°†ä»‹ç»ä¸€ä¸ªä¼˜åŒ–å»¶è¿Ÿé˜Ÿåˆ—ä»»åŠ¡æ¶ˆè´¹æ—¶é—´çš„è§£å†³æ–¹æ¡ˆï¼Œä»¥åŠå¦‚ä½•å®ç°è¿™ä¸€è§£å†³æ–¹æ¡ˆã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯åˆ†äº«" scheme="https://alexhuihui.github.io/categories/%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB/"/>
    
    
    <category term="æŠ€æœ¯åˆ†äº«" scheme="https://alexhuihui.github.io/tags/%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB/"/>
    
  </entry>
  
  <entry>
    <title>ã€Kafkaã€‘Kafkaçš„åŸºæœ¬ä½¿ç”¨</title>
    <link href="https://alexhuihui.github.io/article/20230915.html"/>
    <id>https://alexhuihui.github.io/article/20230915.html</id>
    <published>2023-09-15T11:54:06.000Z</published>
    <updated>2025-01-25T12:28:42.133Z</updated>
    
    <content type="html"><![CDATA[<h3 id="æ¶ˆæ¯å¼•æ“ç³»ç»Ÿä»‹ç»"><a href="#æ¶ˆæ¯å¼•æ“ç³»ç»Ÿä»‹ç»" class="headerlink" title="æ¶ˆæ¯å¼•æ“ç³»ç»Ÿä»‹ç»"></a>æ¶ˆæ¯å¼•æ“ç³»ç»Ÿä»‹ç»</h3><ol><li><p>Apache Kafkaæ˜¯ä¸€æ¬¾å¼€æºçš„æ¶ˆæ¯å¼•æ“ç³»ç»Ÿã€‚æ ¹æ®ç»´åŸºç™¾ç§‘çš„å®šä¹‰ï¼Œæ¶ˆæ¯å¼•æ“ç³»ç»Ÿæ˜¯ä¸€ç»„è§„èŒƒã€‚ä¼ä¸šåˆ©ç”¨è¿™ç»„è§„èŒƒåœ¨ä¸åŒç³»ç»Ÿä¹‹é—´ä¼ é€’è¯­ä¹‰å‡†ç¡®çš„æ¶ˆæ¯ï¼Œå®ç°æ¾è€¦åˆçš„å¼‚æ­¥å¼æ•°æ®ä¼ é€’ã€‚é€šä¿—æ¥è®²ï¼Œå°±æ˜¯ç³»ç»ŸAå‘é€æ¶ˆæ¯åˆ°æ¶ˆæ¯å¼•æ“ç³»ç»Ÿï¼Œç³»ç»ŸBä»æ¶ˆæ¯å¼•æ“ç³»ç»Ÿä¸­è¯»å–Aå‘é€çš„æ¶ˆæ¯ã€‚</p></li><li><p>æ¶ˆæ¯å¼•æ“ç³»ç»Ÿè¦è®¾å®šå…·ä½“çš„ä¼ è¾“åè®®ï¼Œå¸¸è§çš„æœ‰2ç§ï¼šç‚¹å¯¹ç‚¹æ¨¡å‹ï¼›å‘å¸ƒè®¢é˜…æ¨¡å‹ã€‚KafkaåŒäº‹æ”¯æŒè¿™ä¸¤ç§ã€‚</p></li><li><p>ä¸»è¦ä½œç”¨æ˜¯å‰Šå³°å¡«è°·ï¼Œé¿å…ä¸‹æ¸¸ç³»ç»Ÿå› çªå‘æµé‡è€Œå´©æºƒã€‚</p></li></ol><span id="more"></span> <h3 id="æœ¯è¯­ç®€ä»‹"><a href="#æœ¯è¯­ç®€ä»‹" class="headerlink" title="æœ¯è¯­ç®€ä»‹"></a>æœ¯è¯­ç®€ä»‹</h3><ul><li>æ¶ˆæ¯ï¼šRecordã€‚Kafka æ˜¯æ¶ˆæ¯å¼•æ“å˜›ï¼Œè¿™é‡Œçš„æ¶ˆæ¯å°±æ˜¯æŒ‡ Kafka å¤„ç†çš„ä¸»è¦å¯¹è±¡ã€‚</li><li>ä¸»é¢˜ï¼šTopicã€‚ä¸»é¢˜æ˜¯æ‰¿è½½æ¶ˆæ¯çš„é€»è¾‘å®¹å™¨ï¼Œåœ¨å®é™…ä½¿ç”¨ä¸­å¤šç”¨æ¥åŒºåˆ†å…·ä½“çš„ä¸šåŠ¡ã€‚</li><li>åˆ†åŒºï¼šPartitionã€‚ä¸€ä¸ªæœ‰åºä¸å˜çš„æ¶ˆæ¯åºåˆ—ã€‚æ¯ä¸ªä¸»é¢˜ä¸‹å¯ä»¥æœ‰å¤šä¸ªåˆ†åŒºã€‚</li><li>æ¶ˆæ¯ä½ç§»ï¼šOffsetã€‚è¡¨ç¤ºåˆ†åŒºä¸­æ¯æ¡æ¶ˆæ¯çš„ä½ç½®ä¿¡æ¯ï¼Œæ˜¯ä¸€ä¸ªå•è°ƒé€’å¢ä¸”ä¸å˜çš„å€¼ã€‚</li><li>å‰¯æœ¬ï¼šReplicaã€‚Kafka ä¸­åŒä¸€æ¡æ¶ˆæ¯èƒ½å¤Ÿè¢«æ‹·è´åˆ°å¤šä¸ªåœ°æ–¹ä»¥æä¾›æ•°æ®å†—ä½™ï¼Œè¿™äº›åœ°æ–¹å°±æ˜¯æ‰€è°“çš„å‰¯æœ¬ã€‚å‰¯æœ¬è¿˜åˆ†ä¸ºé¢†å¯¼è€…å‰¯æœ¬å’Œè¿½éšè€…å‰¯æœ¬ï¼Œå„è‡ªæœ‰ä¸åŒçš„è§’è‰²åˆ’åˆ†ã€‚å‰¯æœ¬æ˜¯åœ¨åˆ†åŒºå±‚çº§ä¸‹çš„ï¼Œå³æ¯ä¸ªåˆ†åŒºå¯é…ç½®å¤šä¸ªå‰¯æœ¬å®ç°é«˜å¯ç”¨ã€‚</li><li>ç”Ÿäº§è€…ï¼šProducerã€‚å‘ä¸»é¢˜å‘å¸ƒæ–°æ¶ˆæ¯çš„åº”ç”¨ç¨‹åºã€‚</li><li>æ¶ˆè´¹è€…ï¼šConsumerã€‚ä»ä¸»é¢˜è®¢é˜…æ–°æ¶ˆæ¯çš„åº”ç”¨ç¨‹åºã€‚</li><li>æ¶ˆè´¹è€…ä½ç§»ï¼šConsumer Offsetã€‚è¡¨å¾æ¶ˆè´¹è€…æ¶ˆè´¹è¿›åº¦ï¼Œæ¯ä¸ªæ¶ˆè´¹è€…éƒ½æœ‰è‡ªå·±çš„æ¶ˆè´¹è€…ä½ç§»ã€‚</li><li>æ¶ˆè´¹è€…ç»„ï¼šConsumer Groupã€‚å¤šä¸ªæ¶ˆè´¹è€…å®ä¾‹å…±åŒç»„æˆçš„ä¸€ä¸ªç»„ï¼ŒåŒæ—¶æ¶ˆè´¹å¤šä¸ªåˆ†åŒºä»¥å®ç°é«˜ååã€‚</li><li>é‡å¹³è¡¡ï¼šRebalanceã€‚æ¶ˆè´¹è€…ç»„å†…æŸä¸ªæ¶ˆè´¹è€…å®ä¾‹æŒ‚æ‰åï¼Œå…¶ä»–æ¶ˆè´¹è€…å®ä¾‹è‡ªåŠ¨é‡æ–°åˆ†é…è®¢é˜…ä¸»é¢˜åˆ†åŒºçš„è¿‡ç¨‹ã€‚Rebalance æ˜¯ Kafka æ¶ˆè´¹è€…ç«¯å®ç°é«˜å¯ç”¨çš„é‡è¦æ‰‹æ®µã€‚</li></ul>]]></content>
    
    
    <summary type="html">&lt;h3 id=&quot;æ¶ˆæ¯å¼•æ“ç³»ç»Ÿä»‹ç»&quot;&gt;&lt;a href=&quot;#æ¶ˆæ¯å¼•æ“ç³»ç»Ÿä»‹ç»&quot; class=&quot;headerlink&quot; title=&quot;æ¶ˆæ¯å¼•æ“ç³»ç»Ÿä»‹ç»&quot;&gt;&lt;/a&gt;æ¶ˆæ¯å¼•æ“ç³»ç»Ÿä»‹ç»&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;p&gt;Apache Kafkaæ˜¯ä¸€æ¬¾å¼€æºçš„æ¶ˆæ¯å¼•æ“ç³»ç»Ÿã€‚æ ¹æ®ç»´åŸºç™¾ç§‘çš„å®šä¹‰ï¼Œæ¶ˆæ¯å¼•æ“ç³»ç»Ÿæ˜¯ä¸€ç»„è§„èŒƒã€‚ä¼ä¸šåˆ©ç”¨è¿™ç»„è§„èŒƒåœ¨ä¸åŒç³»ç»Ÿä¹‹é—´ä¼ é€’è¯­ä¹‰å‡†ç¡®çš„æ¶ˆæ¯ï¼Œå®ç°æ¾è€¦åˆçš„å¼‚æ­¥å¼æ•°æ®ä¼ é€’ã€‚é€šä¿—æ¥è®²ï¼Œå°±æ˜¯ç³»ç»ŸAå‘é€æ¶ˆæ¯åˆ°æ¶ˆæ¯å¼•æ“ç³»ç»Ÿï¼Œç³»ç»ŸBä»æ¶ˆæ¯å¼•æ“ç³»ç»Ÿä¸­è¯»å–Aå‘é€çš„æ¶ˆæ¯ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;æ¶ˆæ¯å¼•æ“ç³»ç»Ÿè¦è®¾å®šå…·ä½“çš„ä¼ è¾“åè®®ï¼Œå¸¸è§çš„æœ‰2ç§ï¼šç‚¹å¯¹ç‚¹æ¨¡å‹ï¼›å‘å¸ƒè®¢é˜…æ¨¡å‹ã€‚KafkaåŒäº‹æ”¯æŒè¿™ä¸¤ç§ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;ä¸»è¦ä½œç”¨æ˜¯å‰Šå³°å¡«è°·ï¼Œé¿å…ä¸‹æ¸¸ç³»ç»Ÿå› çªå‘æµé‡è€Œå´©æºƒã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;</summary>
    
    
    
    <category term="Kafka" scheme="https://alexhuihui.github.io/categories/Kafka/"/>
    
    
    <category term="Kafka" scheme="https://alexhuihui.github.io/tags/Kafka/"/>
    
  </entry>
  
  <entry>
    <title>ã€å¹¶å‘ã€‘Javaå’ŒGoçš„å¹¶å‘ç¼–ç¨‹å¯¹æ¯”</title>
    <link href="https://alexhuihui.github.io/article/20230616.html"/>
    <id>https://alexhuihui.github.io/article/20230616.html</id>
    <published>2023-06-16T11:54:06.000Z</published>
    <updated>2025-01-25T12:31:22.423Z</updated>
    
    <content type="html"><![CDATA[<p>Goä½¿ç”¨çš„æ˜¯<code>CSP</code>å¹¶å‘æ¨¡å‹ï¼Œè€ŒJAVAä½¿ç”¨çš„æ˜¯åŸºäºä¼ ç»Ÿçš„å†…å­˜è®¿é—®æ§åˆ¶çš„å¹¶å‘æ¨¡å‹ã€‚ä»–ä»¬æœ‰ä»¥ä¸‹åŒºåˆ«ã€‚æˆ‘ä»¬é€šè¿‡ç¤ºä¾‹ä»£ç æ¥æ¯”å¯¹ä¸€ä¸‹Goå’Œ Javaçš„å¹¶å‘ç¼–ç¨‹</p><span id="more"></span> <p>â€œCommunicating Sequential Processesâ€ (CSP) æ˜¯ä¸€ç§å¹¶å‘è®¡ç®—çš„æ•°å­¦æ¨¡å‹ï¼Œæœ€æ—©ç”±è®¡ç®—æœºç§‘å­¦å®¶Tony Hoareäº1978å¹´æå‡ºã€‚CSP çš„ä¸»è¦ç›®æ ‡æ˜¯æè¿°å¹¶å‘ç³»ç»Ÿä¸­è¿›ç¨‹ä¹‹é—´çš„äº¤äº’å’Œé€šä¿¡æ–¹å¼ï¼Œè€Œä¸æ¶‰åŠå…±äº«å†…å­˜çš„æ¦‚å¿µã€‚ä¸ä¼ ç»Ÿçš„å†…å­˜è®¿é—®æ§åˆ¶æœ‰å¾ˆå¤§çš„åŒºåˆ«ï¼Œä¸‹é¢æ˜¯ä¸€äº›ä¸»è¦çš„åŒºåˆ«ï¼š</p><ol><li><strong>é€šä¿¡æ–¹å¼ï¼š</strong><ul><li><strong>CSPï¼š</strong> ä½¿ç”¨è¿›ç¨‹ä¹‹é—´çš„æ˜ç¡®é€šä¿¡æ¥å®ç°ååŒå·¥ä½œã€‚è¿›ç¨‹é€šè¿‡å‘é€å’Œæ¥æ”¶æ¶ˆæ¯è¿›è¡Œé€šä¿¡ï¼Œä½†å®ƒä»¬å¹¶ä¸å…±äº«å†…å­˜ç©ºé—´ã€‚</li><li><strong>ä¼ ç»Ÿå†…å­˜è®¿é—®æ§åˆ¶ï¼š</strong> å¤šä¸ªè¿›ç¨‹å¯èƒ½åœ¨åŒä¸€å—å†…å­˜ä¸­è¿›è¡Œè¯»å†™æ“ä½œï¼Œé€šè¿‡å…±äº«å†…å­˜æ¥å®ç°é€šä¿¡ã€‚è¿™å¯èƒ½å¯¼è‡´è¯¸å¦‚ç«æ€æ¡ä»¶å’Œæ­»é”ç­‰é—®é¢˜ã€‚</li></ul></li><li><strong>å¹¶å‘æ¨¡å‹ï¼š</strong><ul><li><strong>CSPï¼š</strong> é‡‡ç”¨äº‹ä»¶é©±åŠ¨çš„æ–¹å¼ï¼Œè¿›ç¨‹ä¹‹é—´é€šè¿‡æ¶ˆæ¯ä¼ é€’è¿›è¡Œé€šä¿¡ï¼Œä»¥å®ç°å¹¶å‘ã€‚å¹¶å‘åœ¨è¿™é‡Œæ˜¯é€šè¿‡åä½œå’Œé€šä¿¡è€Œéå…±äº«çŠ¶æ€æ¥å®ç°çš„ã€‚</li><li><strong>ä¼ ç»Ÿå†…å­˜è®¿é—®æ§åˆ¶ï¼š</strong> å¹¶å‘é€šå¸¸æ˜¯é€šè¿‡å¤šä¸ªè¿›ç¨‹æˆ–çº¿ç¨‹å…±äº«åŒä¸€å—å†…å­˜æ¥å®ç°çš„ã€‚è¿™å¯èƒ½å¼•å…¥ä¸€ç³»åˆ—å¹¶å‘æ§åˆ¶é—®é¢˜ï¼Œå¦‚é”å’ŒåŒæ­¥ã€‚</li></ul></li><li><strong>æ•°æ®å…±äº«ï¼š</strong><ul><li><strong>CSPï¼š</strong> é¼“åŠ±é¿å…å…±äº«æ•°æ®ï¼Œè€Œæ˜¯é€šè¿‡æ¶ˆæ¯ä¼ é€’æ¥ä¼ é€’å¿…è¦çš„ä¿¡æ¯ã€‚è¿™æ ·è®¾è®¡æœ‰åŠ©äºå‡å°‘ç«æ€æ¡ä»¶å’Œæé«˜ç³»ç»Ÿçš„å¯é æ€§ã€‚</li><li><strong>ä¼ ç»Ÿå†…å­˜è®¿é—®æ§åˆ¶ï¼š</strong> é€šå¸¸æ¶‰åŠå¤šä¸ªè¿›ç¨‹æˆ–çº¿ç¨‹å…±äº«ç›¸åŒçš„å†…å­˜åŒºåŸŸï¼Œéœ€è¦ä½¿ç”¨é”æˆ–å…¶ä»–åŒæ­¥æœºåˆ¶æ¥ç¡®ä¿æ•°æ®ä¸€è‡´æ€§ã€‚</li></ul></li><li><strong>åŒæ­¥å’Œäº’æ–¥ï¼š</strong><ul><li><strong>CSPï¼š</strong> ä½¿ç”¨é€šä¿¡æœºåˆ¶æ¥è¿›è¡ŒåŒæ­¥ï¼Œè¿›ç¨‹ä¹‹é—´é€šè¿‡æ¶ˆæ¯ä¼ é€’åè°ƒå„è‡ªçš„åŠ¨ä½œã€‚</li><li><strong>ä¼ ç»Ÿå†…å­˜è®¿é—®æ§åˆ¶ï¼š</strong> å¸¸å¸¸éœ€è¦ä½¿ç”¨é”æˆ–ä¿¡å·é‡ç­‰æœºåˆ¶æ¥è¿›è¡ŒåŒæ­¥å’Œäº’æ–¥ï¼Œä»¥é˜²æ­¢å¤šä¸ªè¿›ç¨‹åŒæ—¶è®¿é—®å…±äº«çš„å†…å­˜åŒºåŸŸã€‚</li></ul></li></ol><p>æ€»çš„æ¥è¯´ï¼ŒCSP æä¾›äº†ä¸€ç§ä¸åŒäºä¼ ç»Ÿå…±äº«å†…å­˜çš„å¹¶å‘æ¨¡å‹ï¼Œå¼ºè°ƒé€šè¿‡æ˜ç¡®çš„é€šä¿¡æ¥å®ç°è¿›ç¨‹ä¹‹é—´çš„ååŒå·¥ä½œï¼Œä»¥å‡å°‘å¹¶å‘é—®é¢˜çš„å‡ºç°ã€‚è¿™ç§æ–¹å¼æ›´å®¹æ˜“æ¨ç†å’Œè°ƒè¯•ï¼Œå¹¶ä¸”æœ‰åŠ©äºæ„å»ºå¯é çš„å¹¶å‘ç³»ç»Ÿã€‚</p><h3 id="Go"><a href="#Go" class="headerlink" title="Go"></a>Go</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">&quot;fmt&quot;</span><br><span class="line">&quot;sync&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">func main() &#123;</span><br><span class="line">type Button struct &#123;</span><br><span class="line">Clicked *sync.Cond</span><br><span class="line">&#125;</span><br><span class="line">button := Button&#123;Clicked: sync.NewCond(&amp;sync.Mutex&#123;&#125;)&#125;</span><br><span class="line">subscribe := func(c *sync.Cond, fn func()) &#123;</span><br><span class="line">var goroutineRunning sync.WaitGroup</span><br><span class="line">goroutineRunning.Add(1)</span><br><span class="line">go func() &#123;</span><br><span class="line">defer c.L.Unlock()</span><br><span class="line">goroutineRunning.Done()</span><br><span class="line">c.L.Lock()</span><br><span class="line">c.Wait()</span><br><span class="line">fn()</span><br><span class="line">&#125;()</span><br><span class="line">goroutineRunning.Wait()</span><br><span class="line">&#125;</span><br><span class="line">var clickRegistered sync.WaitGroup</span><br><span class="line">clickRegistered.Add(3)</span><br><span class="line">subscribe(button.Clicked, func() &#123;</span><br><span class="line">fmt.Println(&quot;Maximizing window.&quot;)</span><br><span class="line">clickRegistered.Done()</span><br><span class="line">&#125;)</span><br><span class="line">subscribe(button.Clicked, func() &#123;</span><br><span class="line">fmt.Println(&quot;Displaying annoying dialog box!&quot;)</span><br><span class="line">clickRegistered.Done()</span><br><span class="line">&#125;)</span><br><span class="line">subscribe(button.Clicked, func() &#123;</span><br><span class="line">fmt.Println(&quot;Mouse clicked.&quot;)</span><br><span class="line">clickRegistered.Done()</span><br><span class="line">&#125;)</span><br><span class="line">button.Clicked.Broadcast()</span><br><span class="line">clickRegistered.Wait()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç æ¼”ç¤ºäº†ä½¿ç”¨æ¡ä»¶å˜é‡ï¼ˆ<code>sync.Cond</code>ï¼‰å®ç°è®¢é˜…å’Œå‘å¸ƒæ¨¡å¼çš„ç¤ºä¾‹ã€‚</p><p>é¦–å…ˆï¼Œä»£ç å®šä¹‰äº†ä¸€ä¸ªåä¸º<code>Button</code>çš„ç»“æ„ä½“ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªæŒ‡å‘æ¡ä»¶å˜é‡çš„æŒ‡é’ˆ<code>Clicked</code>ã€‚é€šè¿‡<code>sync.NewCond</code>å‡½æ•°ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªä¸äº’æ–¥é”å…³è”çš„æ¡ä»¶å˜é‡ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œä»£ç å®šä¹‰äº†ä¸€ä¸ª<code>subscribe</code>å‡½æ•°ï¼Œç”¨äºè®¢é˜…äº‹ä»¶ã€‚è¯¥å‡½æ•°æ¥æ”¶ä¸€ä¸ªæ¡ä»¶å˜é‡<code>c</code>å’Œä¸€ä¸ªå›è°ƒå‡½æ•°<code>fn</code>ä½œä¸ºå‚æ•°ã€‚åœ¨å‡½æ•°å†…éƒ¨ï¼Œå®ƒåˆ›å»ºäº†ä¸€ä¸ª<code>sync.WaitGroup</code>ç±»å‹çš„å˜é‡<code>goroutineRunning</code>ï¼Œç”¨äºç­‰å¾…goroutineçš„å¯åŠ¨ã€‚ç„¶åï¼Œå®ƒå¯åŠ¨ä¸€ä¸ªæ–°çš„goroutineï¼Œåœ¨å…¶ä¸­ç­‰å¾…æ¡ä»¶å˜é‡çš„ä¿¡å·ã€‚ä¸€æ—¦æ¥æ”¶åˆ°ä¿¡å·ï¼Œå®ƒä¼šæ‰§è¡Œå›è°ƒå‡½æ•°<code>fn</code>ã€‚åœ¨ç­‰å¾…å’Œæ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå®ƒä½¿ç”¨äº’æ–¥é”æ¥ä¿æŠ¤å…±äº«èµ„æºã€‚æœ€åï¼Œé€šè¿‡<code>goroutineRunning.Wait()</code>ç¡®ä¿goroutineå·²ç»å¯åŠ¨ã€‚è¿™æ ·åšæ˜¯ä¸ºäº†é¿å…å‡ºç°ç«äº‰æ¡ä»¶ï¼Œç¡®ä¿å›è°ƒå‡½æ•°åœ¨è®¢é˜…å®Œæˆä¹‹åæ‰ä¼šæ‰§è¡Œã€‚</p><p>åœ¨<code>main</code>å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª<code>Button</code>å®ä¾‹<code>button</code>ï¼Œå¹¶è°ƒç”¨<code>subscribe</code>å‡½æ•°ä¸‰æ¬¡ï¼Œæ¯æ¬¡ä¼ é€’ä¸åŒçš„å›è°ƒå‡½æ•°ã€‚è¿™äº›å›è°ƒå‡½æ•°åˆ†åˆ«æ‰“å°ä¸åŒçš„æ¶ˆæ¯ã€‚</p><p>éšåï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª<code>sync.WaitGroup</code>ç±»å‹çš„å˜é‡<code>clickRegistered</code>ï¼Œç”¨äºç­‰å¾…æ‰€æœ‰è®¢é˜…çš„å›è°ƒå‡½æ•°æ‰§è¡Œå®Œæˆã€‚é€šè¿‡<code>clickRegistered.Add(3)</code>å°†ç­‰å¾…è®¡æ•°è®¾ç½®ä¸º3ï¼Œå› ä¸ºæˆ‘ä»¬æœ‰ä¸‰ä¸ªè®¢é˜…çš„å›è°ƒå‡½æ•°ã€‚</p><p>æœ€åï¼Œæˆ‘ä»¬è°ƒç”¨<code>button.Clicked.Broadcast()</code>å‘é€å¹¿æ’­ä¿¡å·ï¼Œé€šçŸ¥æ‰€æœ‰è®¢é˜…è€…äº‹ä»¶å·²å‘ç”Ÿã€‚è¿™å°†è§¦å‘æ‰€æœ‰ç­‰å¾…ä¸­çš„<code>subscribe</code>å‡½æ•°ä¸­çš„æ¡ä»¶å˜é‡çš„ä¿¡å·ï¼Œå¹¶æ‰§è¡Œå¯¹åº”çš„å›è°ƒå‡½æ•°ã€‚</p><p>é€šè¿‡ä½¿ç”¨æ¡ä»¶å˜é‡å’Œäº’æ–¥é”ï¼Œä»£ç å®ç°äº†ä¸€ä¸ªç®€å•çš„è®¢é˜…å’Œå‘å¸ƒæ¨¡å¼ã€‚å½“äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œè®¢é˜…è€…æ”¶åˆ°ä¿¡å·å¹¶æ‰§è¡Œç›¸åº”çš„å›è°ƒå‡½æ•°ã€‚è¿™ç§æ¨¡å¼å¯ä»¥åœ¨å¹¶å‘ç¯å¢ƒä¸­å®ç°è§£è€¦å’Œäº‹ä»¶é©±åŠ¨çš„ç¼–ç¨‹</p><h3 id="Java"><a href="#Java" class="headerlink" title="Java"></a>Java</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">import java.util.concurrent.locks.Condition;</span><br><span class="line">import java.util.concurrent.locks.Lock;</span><br><span class="line">import java.util.concurrent.locks.ReentrantLock;</span><br><span class="line"></span><br><span class="line">public class Main &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        Button button = new Button();</span><br><span class="line"></span><br><span class="line">        Thread thread1 = new Thread(() -&gt; &#123;</span><br><span class="line">            button.subscribe(() -&gt; &#123;</span><br><span class="line">                System.out.println(&quot;Maximizing window.&quot;);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        Thread thread2 = new Thread(() -&gt; &#123;</span><br><span class="line">            button.subscribe(() -&gt; &#123;</span><br><span class="line">                System.out.println(&quot;Displaying annoying dialog box!&quot;);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        Thread thread3 = new Thread(() -&gt; &#123;</span><br><span class="line">            button.subscribe(() -&gt; &#123;</span><br><span class="line">                System.out.println(&quot;Mouse clicked.&quot;);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        thread1.start();</span><br><span class="line">        thread2.start();</span><br><span class="line">        thread3.start();</span><br><span class="line"></span><br><span class="line">        // æ¨¡æ‹ŸæŒ‰é’®ç‚¹å‡»äº‹ä»¶</span><br><span class="line">        button.click();</span><br><span class="line"></span><br><span class="line">        try &#123;</span><br><span class="line">            thread1.join();</span><br><span class="line">            thread2.join();</span><br><span class="line">            thread3.join();</span><br><span class="line">        &#125; catch (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Button &#123;</span><br><span class="line">    private Lock lock;</span><br><span class="line">    private Condition condition;</span><br><span class="line"></span><br><span class="line">    public Button() &#123;</span><br><span class="line">        lock = new ReentrantLock();</span><br><span class="line">        condition = lock.newCondition();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void click() &#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        try &#123;</span><br><span class="line">            condition.signalAll();</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void subscribe(Runnable callback) &#123;</span><br><span class="line">        Thread thread = new Thread(() -&gt; &#123;</span><br><span class="line">            lock.lock();</span><br><span class="line">            try &#123;</span><br><span class="line">                condition.await();</span><br><span class="line">                callback.run();</span><br><span class="line">            &#125; catch (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125; finally &#123;</span><br><span class="line">                lock.unlock();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        thread.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œä½¿ç”¨äº†<code>Condition</code>ã€<code>Lock</code>å’Œ<code>ReentrantLock</code>æ¥å®ç°çº¿ç¨‹é—´çš„åŒæ­¥å’Œé€šä¿¡ã€‚</p><ol><li><code>Lock</code>æ¥å£æ˜¯Javaæä¾›çš„ç”¨äºå¤šçº¿ç¨‹åŒæ­¥çš„æœºåˆ¶ä¹‹ä¸€ã€‚<code>ReentrantLock</code>æ˜¯<code>Lock</code>æ¥å£çš„ä¸€ä¸ªå…·ä½“å®ç°ç±»ï¼Œå®ƒæä¾›äº†ç‹¬å é”çš„åŠŸèƒ½ã€‚åœ¨ç¤ºä¾‹ä»£ç ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª<code>ReentrantLock</code>å®ä¾‹ï¼Œç”¨äºä¿æŠ¤å…±äº«èµ„æºçš„è®¿é—®ã€‚</li><li><code>Condition</code>æ¥å£æ˜¯ä¸é”å…³è”çš„æ¡ä»¶ï¼Œå¯ä»¥ç”¨äºå®ç°çº¿ç¨‹é—´çš„ç­‰å¾…å’Œé€šçŸ¥æœºåˆ¶ã€‚åœ¨ç¤ºä¾‹ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨<code>lock.newCondition()</code>åˆ›å»ºäº†ä¸€ä¸ª<code>Condition</code>å®ä¾‹ï¼Œç”¨äºå®ç°è®¢é˜…è€…çº¿ç¨‹çš„ç­‰å¾…å’Œä¸»çº¿ç¨‹çš„é€šçŸ¥ã€‚</li><li><code>lock.lock()</code>å’Œ<code>lock.unlock()</code>ç”¨äºè·å–å’Œé‡Šæ”¾é”ã€‚é€šè¿‡ä½¿ç”¨<code>lock.lock()</code>è·å–é”ï¼Œå¯ä»¥ç¡®ä¿åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥æ‰§è¡Œè¢«ä¿æŠ¤çš„ä»£ç å—ï¼Œå…¶ä»–çº¿ç¨‹å°†è¢«é˜»å¡ã€‚ä¸€æ—¦çº¿ç¨‹å®Œæˆäº†å¯¹å…±äº«èµ„æºçš„æ“ä½œï¼Œä½¿ç”¨<code>lock.unlock()</code>é‡Šæ”¾é”ï¼Œä»¥ä¾¿å…¶ä»–çº¿ç¨‹å¯ä»¥è·å–é”å¹¶æ‰§è¡Œã€‚</li><li><code>condition.await()</code>ç”¨äºä½¿å½“å‰çº¿ç¨‹è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œç›´åˆ°å…¶ä»–çº¿ç¨‹é€šè¿‡è°ƒç”¨<code>condition.signal()</code>æˆ–<code>condition.signalAll()</code>å‘å‡ºä¿¡å·ã€‚åœ¨ç¤ºä¾‹ä»£ç ä¸­ï¼Œè®¢é˜…è€…çº¿ç¨‹åœ¨æ”¶åˆ°ä¿¡å·å‰ä¼šè°ƒç”¨<code>condition.await()</code>è¿›å…¥ç­‰å¾…çŠ¶æ€ã€‚</li><li><code>condition.signalAll()</code>ç”¨äºå”¤é†’æ‰€æœ‰ç­‰å¾…åœ¨è¯¥æ¡ä»¶ä¸Šçš„çº¿ç¨‹ã€‚åœ¨ç¤ºä¾‹ä»£ç ä¸­ï¼Œä¸»çº¿ç¨‹è°ƒç”¨<code>button.click()</code>åä¼šè°ƒç”¨<code>condition.signalAll()</code>ï¼Œä»¥é€šçŸ¥æ‰€æœ‰ç­‰å¾…çš„è®¢é˜…è€…çº¿ç¨‹ã€‚</li></ol><p>é€šè¿‡ä½¿ç”¨<code>Condition</code>ã€<code>Lock</code>å’Œ<code>ReentrantLock</code>ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°æ›´ç²¾ç»†çš„çº¿ç¨‹åŒæ­¥å’Œé€šä¿¡ã€‚å®ƒä»¬æä¾›äº†æ›´çµæ´»çš„æ§åˆ¶æœºåˆ¶ï¼Œä½¿å¾—çº¿ç¨‹ä¹‹é—´çš„äº¤äº’æ›´åŠ å¯æ§å’Œé«˜æ•ˆã€‚</p><p>å¯ä»¥ä½¿ç”¨<code>Object</code>ç±»ä¸­çš„<code>wait()</code>å’Œ<code>notifyAll()</code>æ–¹æ³•æ¥å®ç°çº¿ç¨‹é—´çš„ç­‰å¾…å’Œé€šçŸ¥æœºåˆ¶ï¼Œç”¨äºæ›¿ä»£<code>Condition</code>æ¥å£å’Œ<code>Lock</code>æœºåˆ¶ã€‚</p><p>åœ¨ä½¿ç”¨<code>wait()</code>å’Œ<code>notifyAll()</code>æ—¶ï¼Œéœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š</p><ol><li><code>wait()</code>æ–¹æ³•ç”¨äºä½¿å½“å‰çº¿ç¨‹è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œç›´åˆ°å…¶ä»–çº¿ç¨‹è°ƒç”¨ç›¸åŒå¯¹è±¡çš„<code>notify()</code>æˆ–<code>notifyAll()</code>æ–¹æ³•ã€‚åœ¨ç­‰å¾…æœŸé—´ï¼Œå½“å‰çº¿ç¨‹ä¼šé‡Šæ”¾å¯¹è±¡çš„é”ã€‚</li><li><code>notifyAll()</code>æ–¹æ³•ç”¨äºå”¤é†’æ‰€æœ‰ç­‰å¾…åœ¨ç›¸åŒå¯¹è±¡ä¸Šçš„çº¿ç¨‹ã€‚å®ƒä¼šé€šçŸ¥æ‰€æœ‰ç­‰å¾…çš„çº¿ç¨‹ç»§ç»­æ‰§è¡Œï¼Œä½†åªæœ‰åœ¨è·å–åˆ°å¯¹è±¡çš„é”ä¹‹åæ‰èƒ½çœŸæ­£æ‰§è¡Œã€‚</li><li>åœ¨ä½¿ç”¨<code>wait()</code>å’Œ<code>notifyAll()</code>æ—¶ï¼Œå¿…é¡»åœ¨åŒæ­¥ä»£ç å—æˆ–åŒæ­¥æ–¹æ³•ä¸­è°ƒç”¨ï¼Œä»¥ç¡®ä¿å¯¹å¯¹è±¡çš„é”çš„æ­£ç¡®ä½¿ç”¨ã€‚</li><li>é€šå¸¸ï¼Œä½ éœ€è¦ä½¿ç”¨ä¸€ä¸ªå…±äº«çš„å¯¹è±¡ä½œä¸ºé€šä¿¡çš„é”ï¼Œç±»ä¼¼äºç¤ºä¾‹ä»£ç ä¸­çš„<code>button</code>å¯¹è±¡ã€‚</li></ol><p>ä¸‹é¢æ˜¯ä¿®æ”¹åçš„ç¤ºä¾‹ä»£ç ï¼Œä½¿ç”¨<code>wait()</code>å’Œ<code>notifyAll()</code>å®ç°çº¿ç¨‹é—´çš„ç­‰å¾…å’Œé€šçŸ¥ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">class Button &#123;</span><br><span class="line">    private final Object lock = new Object();</span><br><span class="line">  </span><br><span class="line">    public void click() &#123;</span><br><span class="line">        synchronized (lock) &#123;</span><br><span class="line">            lock.notifyAll();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    public void subscribe(Runnable task) &#123;</span><br><span class="line">        synchronized (lock) &#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                lock.wait();</span><br><span class="line">                task.run();</span><br><span class="line">            &#125; catch (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class Main &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        Button button = new Button();</span><br><span class="line">        Thread subscriber1 = new Thread(() -&gt; &#123;</span><br><span class="line">            button.subscribe(() -&gt; &#123;</span><br><span class="line">                System.out.println(&quot;Maximizing window.&quot;);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">        Thread subscriber2 = new Thread(() -&gt; &#123;</span><br><span class="line">            button.subscribe(() -&gt; &#123;</span><br><span class="line">                System.out.println(&quot;Displaying annoying dialog box!&quot;);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">        Thread subscriber3 = new Thread(() -&gt; &#123;</span><br><span class="line">            button.subscribe(() -&gt; &#123;</span><br><span class="line">                System.out.println(&quot;Mouse clicked.&quot;);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">        subscriber1.start();</span><br><span class="line">        subscriber2.start();</span><br><span class="line">        subscriber3.start();</span><br><span class="line">      </span><br><span class="line">        // ä¸»çº¿ç¨‹ç­‰å¾…è®¢é˜…è€…çº¿ç¨‹å®Œæˆ</span><br><span class="line">        try &#123;</span><br><span class="line">            subscriber1.join();</span><br><span class="line">            subscriber2.join();</span><br><span class="line">            subscriber3.join();</span><br><span class="line">        &#125; catch (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">      </span><br><span class="line">        button.click();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œ<code>Button</code>ç±»ä½¿ç”¨äº†ä¸€ä¸ªå…±äº«çš„é”å¯¹è±¡<code>lock</code>ã€‚åœ¨è®¢é˜…è€…çº¿ç¨‹ä¸­ï¼Œè°ƒç”¨<code>lock.wait()</code>ä½¿çº¿ç¨‹è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œåœ¨ä¸»çº¿ç¨‹ä¸­è°ƒç”¨<code>lock.notifyAll()</code>å”¤é†’æ‰€æœ‰ç­‰å¾…çš„çº¿ç¨‹ã€‚ä¸»çº¿ç¨‹ä½¿ç”¨<code>join()</code>æ–¹æ³•ç­‰å¾…è®¢é˜…è€…çº¿ç¨‹å®Œæˆåå†è°ƒç”¨<code>button.click()</code>ã€‚</p><p>ä½¿ç”¨<code>wait()</code>å’Œ<code>notifyAll()</code>å¯ä»¥å®ç°åŸºæœ¬çš„çº¿ç¨‹é—´ç­‰å¾…å’Œé€šçŸ¥æœºåˆ¶ï¼Œä½†ç›¸æ¯”<code>Condition</code>å’Œ<code>Lock</code>ï¼Œå®ƒä»¬çš„ä½¿ç”¨æ›´åŠ åŸºç¡€å’Œä½çº§ï¼Œéœ€è¦æ‰‹åŠ¨å¤„ç†é”çš„è·å–å’Œé‡Šæ”¾ï¼Œå¹¶ä¸”å¯èƒ½å­˜åœ¨æ›´å¤šçš„é£é™©ï¼Œå¦‚æ­»é”å’Œç«æ€æ¡ä»¶ã€‚å› æ­¤ï¼Œåœ¨å®é™…å¼€å‘ä¸­ï¼Œå»ºè®®ä½¿ç”¨<code>Condition</code>å’Œ<code>Lock</code>æœºåˆ¶ï¼Œå› ä¸ºå®ƒä»¬æä¾›äº†æ›´çµæ´»ã€æ›´å¯é çš„çº¿ç¨‹åŒæ­¥å’Œé€šä¿¡æ–¹å¼ã€‚ç›¸æ¯”äºä½¿ç”¨<code>wait()</code>å’Œ<code>notifyAll()</code>ï¼Œ<code>Condition</code>å’Œ<code>Lock</code>å…·æœ‰ä»¥ä¸‹ä¼˜åŠ¿ï¼š</p><ol><li>ç²¾ç¡®çš„é€šçŸ¥æœºåˆ¶ï¼š<code>Condition</code>æ¥å£æä¾›äº†æ›´ç»†ç²’åº¦çš„é€šçŸ¥æœºåˆ¶ï¼Œå¯ä»¥é€‰æ‹©æ€§åœ°é€šçŸ¥ç­‰å¾…çº¿ç¨‹ã€‚ä½ å¯ä»¥åˆ›å»ºå¤šä¸ª<code>Condition</code>å®ä¾‹æ¥æ§åˆ¶ä¸åŒçš„ç­‰å¾…æ¡ä»¶ï¼Œå¹¶ä½¿ç”¨<code>signal()</code>æˆ–<code>signalAll()</code>æ–¹æ³•é€šçŸ¥ç‰¹å®šçš„ç­‰å¾…çº¿ç¨‹ã€‚</li><li>æ›´çµæ´»çš„é”æ§åˆ¶ï¼š<code>Lock</code>æ¥å£æä¾›äº†æ›´çµæ´»çš„é”æ§åˆ¶æœºåˆ¶ã€‚å®ƒæ”¯æŒå¯é‡å…¥é”ï¼ˆReentrantLockï¼‰å’Œè¯»å†™é”ï¼ˆReentrantReadWriteLockï¼‰ï¼Œä»¥åŠå„ç§é”çš„é«˜çº§åŠŸèƒ½ï¼Œå¦‚å…¬å¹³æ€§ã€è¶…æ—¶ç­‰å¾…å’Œä¸­æ–­å“åº”ã€‚</li><li>æ›´å®‰å…¨çš„å¹¶å‘æ§åˆ¶ï¼š<code>Condition</code>å’Œ<code>Lock</code>æä¾›äº†æ›´å®‰å…¨çš„å¹¶å‘æ§åˆ¶æœºåˆ¶ï¼Œé¿å…äº†å¯èƒ½å¯¼è‡´æ­»é”ã€ç«æ€æ¡ä»¶å’Œçº¿ç¨‹é¥¥é¥¿ç­‰é—®é¢˜ã€‚å®ƒä»¬é€šè¿‡æ˜¾ç¤ºåœ°è·å–å’Œé‡Šæ”¾é”æ¥ç¡®ä¿çº¿ç¨‹çš„æ­£ç¡®åŒæ­¥å’Œåè°ƒã€‚</li><li>å¯æ‰©å±•æ€§å’Œæ€§èƒ½ä¼˜åŒ–ï¼š<code>Condition</code>å’Œ<code>Lock</code>æœºåˆ¶æä¾›äº†æ›´é«˜çº§çš„çº¿ç¨‹åŒæ­¥åŠŸèƒ½ï¼Œå¯ä»¥æ›´å¥½åœ°æ»¡è¶³å¤æ‚çš„å¹¶å‘éœ€æ±‚ã€‚å®ƒä»¬æ”¯æŒæ›´å¤šçš„é«˜çº§æ“ä½œï¼Œå¦‚æ¡ä»¶ç­‰å¾…ã€å¤šä¸ªç­‰å¾…é˜Ÿåˆ—ã€å¯ä¸­æ–­çš„ç­‰å¾…ç­‰ï¼Œå¹¶æä¾›äº†æ›´å¥½çš„æ€§èƒ½ä¼˜åŒ–é€‰é¡¹ã€‚</li></ol><p>ç»¼ä¸Šæ‰€è¿°ï¼Œå°½ç®¡å¯ä»¥ä½¿ç”¨<code>wait()</code>å’Œ<code>notifyAll()</code>æ¥å®ç°ç®€å•çš„çº¿ç¨‹åŒæ­¥å’Œé€šä¿¡ï¼Œä½†åœ¨æ›´å¤æ‚çš„å¹¶å‘åœºæ™¯ä¸‹ï¼Œä½¿ç”¨<code>Condition</code>å’Œ<code>Lock</code>ä¼šæ›´åŠ å¯é å’Œçµæ´»ã€‚å®ƒä»¬æä¾›äº†æ›´å¤šçš„åŠŸèƒ½å’Œæ€§èƒ½ä¼˜åŒ–é€‰é¡¹ï¼Œå¯ä»¥æ›´å¥½åœ°ç®¡ç†çº¿ç¨‹çš„çŠ¶æ€ã€ç­‰å¾…å’Œå”¤é†’ï¼Œç¡®ä¿çº¿ç¨‹é—´çš„æ­£ç¡®åŒæ­¥å’Œåä½œã€‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;Goä½¿ç”¨çš„æ˜¯&lt;code&gt;CSP&lt;/code&gt;å¹¶å‘æ¨¡å‹ï¼Œè€ŒJAVAä½¿ç”¨çš„æ˜¯åŸºäºä¼ ç»Ÿçš„å†…å­˜è®¿é—®æ§åˆ¶çš„å¹¶å‘æ¨¡å‹ã€‚ä»–ä»¬æœ‰ä»¥ä¸‹åŒºåˆ«ã€‚æˆ‘ä»¬é€šè¿‡ç¤ºä¾‹ä»£ç æ¥æ¯”å¯¹ä¸€ä¸‹Goå’Œ Javaçš„å¹¶å‘ç¼–ç¨‹&lt;/p&gt;</summary>
    
    
    
    <category term="å¹¶å‘" scheme="https://alexhuihui.github.io/categories/%E5%B9%B6%E5%8F%91/"/>
    
    
    <category term="å¹¶å‘" scheme="https://alexhuihui.github.io/tags/%E5%B9%B6%E5%8F%91/"/>
    
  </entry>
  
  <entry>
    <title>ã€é‡æ„ã€‘æ”¹å–„æ—¢æœ‰ä»£ç è®¾è®¡çš„é˜…è¯»ç¬”è®°</title>
    <link href="https://alexhuihui.github.io/article/20230613.html"/>
    <id>https://alexhuihui.github.io/article/20230613.html</id>
    <published>2023-06-13T11:54:06.000Z</published>
    <updated>2025-01-25T12:32:58.463Z</updated>
    
    <content type="html"><![CDATA[<p>æ‰€è°“é‡æ„ï¼ˆrefactoringï¼‰æ˜¯è¿™æ ·ä¸€ä¸ªè¿‡ç¨‹ï¼šåœ¨ä¸æ”¹å˜ä»£ç å¤–åœ¨è¡Œä¸ºçš„å‰æä¸‹ï¼Œå¯¹ä»£ç åšå‡ºä¿®æ”¹ï¼Œä»¥æ”¹è¿›ç¨‹åºçš„å†…éƒ¨ç»“æ„ã€‚é‡æ„æ˜¯ä¸€ç§ç»åƒé”¤ç™¾ç‚¼å½¢æˆçš„æœ‰æ¡ä¸ç´Šçš„ç¨‹åºæ•´ç†æ–¹æ³•ï¼Œå¯ä»¥æœ€å¤§é™åº¦åœ°å‡å°‘æ•´ç†è¿‡ç¨‹ä¸­å¼•å…¥é”™è¯¯çš„å‡ ç‡ã€‚è¿™æœ¬ä¹¦å‘Šè¯‰ä½ å¦‚ä½•ä»¥ä¸€ç§å¯æ§åˆ¶ä¸”é«˜æ•ˆç‡çš„æ–¹å¼è¿›è¡Œé‡æ„ï¼Œå¦‚ä½•æœ‰æ¡ä¸ç´Šåœ°æ”¹è¿›ç¨‹åºç»“æ„ï¼Œè€Œä¸”ä¸ä¼šå¼•å…¥é”™è¯¯ã€‚</p><span id="more"></span> <h3 id="é‡æ„ç¬¬ä¸€ä¸ªæ¡ˆä¾‹"><a href="#é‡æ„ç¬¬ä¸€ä¸ªæ¡ˆä¾‹" class="headerlink" title="é‡æ„ç¬¬ä¸€ä¸ªæ¡ˆä¾‹"></a>é‡æ„ç¬¬ä¸€ä¸ªæ¡ˆä¾‹</h3><p>å¦‚æœä½ å‘ç°è‡ªå·±éœ€è¦ä¸ºç¨‹åºæ·»åŠ ä¸€ä¸ªç‰¹æ€§ï¼Œè€Œä»£ç ç»“æ„ä½¿ä½ æ— æ³•å¾ˆæ–¹ä¾¿åœ°è¾¾æˆç›®çš„ï¼Œé‚£å°±å…ˆé‡æ„é‚£ä¸ªç¨‹åºï¼Œä½¿ç‰¹æ€§çš„æ·»åŠ æ¯”è¾ƒå®¹æ˜“è¿›è¡Œï¼Œç„¶åå†æ·»åŠ ç‰¹æ€§ã€‚</p><h4 id="ç¬¬ä¸€æ­¥"><a href="#ç¬¬ä¸€æ­¥" class="headerlink" title="ç¬¬ä¸€æ­¥"></a>ç¬¬ä¸€æ­¥</h4><p>æ„å»ºå®Œæ•´çš„æµ‹è¯•ç”¨ä¾‹ï¼Œä¿è¯é‡æ„ä¹‹åçš„ä»£ç è¡Œä¸ºè¡¨ç°ä¸ä¹‹å‰æ— å¼‚ã€‚</p><p>Extract Method</p><p>ä¿®æ”¹å˜é‡å‘½å</p><p>Move Method</p><p>Replace Temp with Query</p><p>Replace Conditional with Polymorphism ç”¨å¤šæ€å–ä»£æ¡ä»¶è¡¨è¾¾å¼</p><p>Self Encapsulate Field è‡ªå°è£…å­—æ®µï¼ˆå­—æ®µè®¿é—®ä¿æŠ¤ï¼‰</p><p>Replace Type Code with State/Strategy</p><p>ç”¨äºæ”¹å–„åŸºäºç±»å‹ç ï¼ˆType Codeï¼‰çš„æ¡ä»¶é€»è¾‘ï¼Œå¹¶é€šè¿‡å¼•å…¥çŠ¶æ€æ¨¡å¼ï¼ˆState Patternï¼‰æˆ–ç­–ç•¥æ¨¡å¼ï¼ˆStrategy Patternï¼‰æ¥å®ç°æ›´æ¸…æ™°å’Œå¯æ‰©å±•çš„ä»£ç ç»“æ„</p><h3 id="é‡æ„åŸåˆ™"><a href="#é‡æ„åŸåˆ™" class="headerlink" title="é‡æ„åŸåˆ™"></a>é‡æ„åŸåˆ™</h3><h4 id="ä»€ä¹ˆæ˜¯é‡æ„"><a href="#ä»€ä¹ˆæ˜¯é‡æ„" class="headerlink" title="ä»€ä¹ˆæ˜¯é‡æ„"></a>ä»€ä¹ˆæ˜¯é‡æ„</h4><p>å¯¹è½¯ä»¶å†…éƒ¨ç»“æ„çš„ä¸€ç§è°ƒæ•´ï¼Œç›®çš„æ˜¯åœ¨ä¸æ”¹å˜è½¯ä»¶å¯è§‚å¯Ÿè¡Œä¸ºçš„å‰æä¸‹ï¼Œæé«˜å…¶å¯ç†è§£æ€§ï¼Œé™ä½å…¶ä¿®æ”¹æˆæœ¬</p><p>ä¸¤é¡¶å¸½å­ï¼Œå½“ä½ ä½¿ç”¨é‡æ„æŠ€æœ¯è¿›è¡Œå¼€å‘æ—¶ï¼ŒæŠŠæ—¶é—´åˆ†é…åˆ°ä¸¤ç§ä¸åŒçš„è¡Œä¸ºï¼šæ·»åŠ æ–°åŠŸèƒ½ä»¥åŠé‡æ„ã€‚æ·»åŠ æ–°åŠŸèƒ½æ—¶ï¼Œä½ ä¸åº”è¯¥ä¿®æ”¹æ—¢æœ‰ä»£ç ï¼Œåªç®¡æ·»åŠ æ–°åŠŸèƒ½ã€‚</p><p>é‡æ„æ—¶ä½ å°±ä¸åº”è¯¥æ·»åŠ æ–°åŠŸèƒ½è€Œæ˜¯åªç®¡æ”¹å˜ç¨‹åºç»“æ„ã€‚ä¸¤é¡¶å¸½å­è¦éšæ—¶åˆ‡æ¢ï¼Œåº”è¯¥æ¸…é™¤æ„è¯†åˆ°ä½ æˆ´çš„æ˜¯ä»€ä¹ˆå¸½å­ã€‚</p><h4 id="ä¸ºä½•é‡æ„"><a href="#ä¸ºä½•é‡æ„" class="headerlink" title="ä¸ºä½•é‡æ„"></a>ä¸ºä½•é‡æ„</h4><p>é‡æ„æ”¹è¿›è½¯ä»¶è®¾è®¡</p><p>é‡æ„ä½¿è½¯ä»¶æ›´å®¹æ˜“ç†è§£</p><h4 id="ä½•æ—¶é‡æ„"><a href="#ä½•æ—¶é‡æ„" class="headerlink" title="ä½•æ—¶é‡æ„"></a>ä½•æ—¶é‡æ„</h4><p>äº‹ä¸è¿‡ä¸‰ï¼Œä¸‰åˆ™é‡æ„</p><h3 id="ä»£ç çš„åå‘³é“"><a href="#ä»£ç çš„åå‘³é“" class="headerlink" title="ä»£ç çš„åå‘³é“"></a>ä»£ç çš„åå‘³é“</h3><p>Duplicated Code</p><p>Long Methodï¼ˆè¿‡é•¿å‡½æ•°ï¼‰</p><p>Large Classï¼ˆè¿‡å¤§çš„ç±»ï¼‰</p><p>Long Parameter Listï¼ˆè¿‡é•¿å‚æ•°åˆ—ï¼‰</p><p>Divergent Changeï¼ˆå‘æ•£å¼å˜åŒ–ï¼‰</p><p>Shotgun Surgeryï¼ˆéœ°å¼¹å¼ä¿®æ”¹ï¼‰</p><p>Feature Envyï¼ˆä¾æ‹æƒ…ç»“ï¼‰</p><h3 id="é‡æ„åˆ—è¡¨"><a href="#é‡æ„åˆ—è¡¨" class="headerlink" title="é‡æ„åˆ—è¡¨"></a>é‡æ„åˆ—è¡¨</h3>]]></content>
    
    
    <summary type="html">&lt;p&gt;æ‰€è°“é‡æ„ï¼ˆrefactoringï¼‰æ˜¯è¿™æ ·ä¸€ä¸ªè¿‡ç¨‹ï¼šåœ¨ä¸æ”¹å˜ä»£ç å¤–åœ¨è¡Œä¸ºçš„å‰æä¸‹ï¼Œå¯¹ä»£ç åšå‡ºä¿®æ”¹ï¼Œä»¥æ”¹è¿›ç¨‹åºçš„å†…éƒ¨ç»“æ„ã€‚é‡æ„æ˜¯ä¸€ç§ç»åƒé”¤ç™¾ç‚¼å½¢æˆçš„æœ‰æ¡ä¸ç´Šçš„ç¨‹åºæ•´ç†æ–¹æ³•ï¼Œå¯ä»¥æœ€å¤§é™åº¦åœ°å‡å°‘æ•´ç†è¿‡ç¨‹ä¸­å¼•å…¥é”™è¯¯çš„å‡ ç‡ã€‚è¿™æœ¬ä¹¦å‘Šè¯‰ä½ å¦‚ä½•ä»¥ä¸€ç§å¯æ§åˆ¶ä¸”é«˜æ•ˆç‡çš„æ–¹å¼è¿›è¡Œé‡æ„ï¼Œå¦‚ä½•æœ‰æ¡ä¸ç´Šåœ°æ”¹è¿›ç¨‹åºç»“æ„ï¼Œè€Œä¸”ä¸ä¼šå¼•å…¥é”™è¯¯ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="é‡æ„" scheme="https://alexhuihui.github.io/categories/%E9%87%8D%E6%9E%84/"/>
    
    
    <category term="é‡æ„" scheme="https://alexhuihui.github.io/tags/%E9%87%8D%E6%9E%84/"/>
    
  </entry>
  
  <entry>
    <title>ã€Mybatisã€‘Mybatisæºç è§£æâ€”åŸºç¡€åŠŸèƒ½åŒ…</title>
    <link href="https://alexhuihui.github.io/article/20230608.html"/>
    <id>https://alexhuihui.github.io/article/20230608.html</id>
    <published>2023-06-08T11:54:06.000Z</published>
    <updated>2025-01-25T12:35:47.544Z</updated>
    
    <content type="html"><![CDATA[<p>é˜…è¯»<code>mybatis</code>æºç å¯ä»¥å…ˆä»å¤–å›´çš„åŸºç¡€åŠŸèƒ½åŒ…å¼€å§‹ï¼Œå‰¥æ´‹è‘±ä¸€æ ·ä¸€å±‚ä¸€å±‚æ·±å…¥</p><span id="more"></span> <h3 id="type-åŒ…"><a href="#type-åŒ…" class="headerlink" title="type åŒ…"></a>type åŒ…</h3><h4 id="å½’ç±»æ€»ç»“"><a href="#å½’ç±»æ€»ç»“" class="headerlink" title="å½’ç±»æ€»ç»“"></a>å½’ç±»æ€»ç»“</h4><ul><li>ç±»å‹å¤„ç†å™¨</li><li>ç±»å‹æ³¨å†Œå™¨</li><li>æ³¨è§£ç±»</li></ul><h4 id="è®¾è®¡æ¨¡å¼"><a href="#è®¾è®¡æ¨¡å¼" class="headerlink" title="è®¾è®¡æ¨¡å¼"></a>è®¾è®¡æ¨¡å¼</h4><ol><li>æ¨¡æ¿æ¨¡å¼</li></ol><p> æ¨¡æ¿ä¸­å®šä¹‰äº†å¤§ä½“çš„å¤„ç†æ¡†æ¶ï¼Œç•™ä¸‹ä¸€äº›ç»†èŠ‚ä¾›ä½¿ç”¨è€…æ¥å®Œå–„ã€‚åœ¨è®¾è®¡æ¨¡å¼ä¸­ï¼Œä½¿ç”¨ä¸€ä¸ªæŠ½è±¡ç±»å®šä¹‰ä¸€æ•´å¥—çš„æ“ä½œæµç¨‹ï¼Œè€ŒæŠ½è±¡ç±»çš„å­ç±»åˆ™å®Œæˆæ¯ä¸ªæ“ä½œæ­¥éª¤çš„å®ç°ã€‚</p><h4 id="ç±»å‹å¤„ç†å™¨"><a href="#ç±»å‹å¤„ç†å™¨" class="headerlink" title="ç±»å‹å¤„ç†å™¨"></a>ç±»å‹å¤„ç†å™¨</h4><p>ç”¨äºORMæ¡†æ¶ä¸­å¤„ç†Javaç±»å‹å’Œæ•°æ®åº“ç±»å‹ï¼Œä½¿ç”¨æ¨¡æ¿æ–¹å¼å®šä¹‰äº†ä¸€ä¸ª<code>BaseTypeHandler</code>ï¼Œ<code>getResult</code>æ–¹æ³•å®Œæˆäº†å¼‚å¸¸å¤„ç†ç­‰ç»Ÿä¸€çš„å·¥ä½œï¼Œè€Œä¸å…·ä½“ç±»å‹çš„æ“ä½œåˆ™é€šè¿‡æŠ½è±¡æ–¹æ³•ç”±å…·ä½“çš„å­ç±»ç±»å‹å¤„ç†å™¨å®ç°ã€‚</p><h4 id="ç±»å‹æ³¨å†Œè¡¨"><a href="#ç±»å‹æ³¨å†Œè¡¨" class="headerlink" title="ç±»å‹æ³¨å†Œè¡¨"></a>ç±»å‹æ³¨å†Œè¡¨</h4><p>å…‰æœ‰ç±»å‹å¤„ç†å™¨è¿˜ä¸å¤Ÿï¼Œè¿˜éœ€è¦å¿«é€ŸæŸ¥æ‰¾æ•°æ®ç±»å‹å¯¹åº”çš„ç±»å‹å¤„ç†å™¨</p><p>æ ¹æ®ä¸€ä¸ªJavaç±»å‹å’ŒJDBCç±»å‹å°±èƒ½ç¡®å®šä¸€ä¸ªç±»å‹å¤„ç†å™¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">// TypeHandlerRegistry.class</span><br><span class="line">private &lt;T&gt; TypeHandler&lt;T&gt; getTypeHandler(Type type, JdbcType jdbcType) &#123;</span><br><span class="line">    if (ParamMap.class.equals(type)) &#123;</span><br><span class="line">      return null;</span><br><span class="line">    &#125;</span><br><span class="line">    Map&lt;JdbcType, TypeHandler&lt;?&gt;&gt; jdbcHandlerMap = getJdbcHandlerMap(type);</span><br><span class="line">    TypeHandler&lt;?&gt; handler = null;</span><br><span class="line">    if (jdbcHandlerMap != null) &#123;</span><br><span class="line">      handler = jdbcHandlerMap.get(jdbcType);</span><br><span class="line">      if (handler == null) &#123;</span><br><span class="line">        handler = jdbcHandlerMap.get(null);</span><br><span class="line">      &#125;</span><br><span class="line">      if (handler == null) &#123;</span><br><span class="line">        // #591</span><br><span class="line">        handler = pickSoleHandler(jdbcHandlerMap);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    // type drives generics here</span><br><span class="line">    return (TypeHandler&lt;T&gt;) handler;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h3 id="io-åŒ…"><a href="#io-åŒ…" class="headerlink" title="io åŒ…"></a>io åŒ…</h3><p>ioåŒ…å³è¾“å…¥/è¾“å‡ºåŒ…ï¼Œè´Ÿè´£å®Œæˆ MyBatisä¸­ä¸è¾“å…¥/è¾“å‡ºç›¸å…³çš„æ“ä½œ</p><h4 id="è®¾è®¡æ¨¡å¼-1"><a href="#è®¾è®¡æ¨¡å¼-1" class="headerlink" title="è®¾è®¡æ¨¡å¼"></a>è®¾è®¡æ¨¡å¼</h4><h5 id="å•ä¾‹æ¨¡å¼"><a href="#å•ä¾‹æ¨¡å¼" class="headerlink" title="å•ä¾‹æ¨¡å¼"></a>å•ä¾‹æ¨¡å¼</h5><p>å•ä¾‹æ¨¡å¼ï¼ˆSingleton Patternï¼‰æ˜¯ä¸€ç§éå¸¸ç®€å•çš„è®¾è®¡æ¨¡å¼ã€‚ä½¿ ç”¨äº†å•ä¾‹æ¨¡å¼çš„ç±»æä¾›ä¸€ä¸ªæ–¹æ³•å¾—åˆ°è¯¥ç±»çš„å¯¹è±¡ï¼Œå¹¶ä¸”æ€»ä¿è¯è¿™ä¸ªå¯¹ è±¡æ˜¯å”¯ä¸€çš„ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">public class Singleton &#123;</span><br><span class="line">    private static final Singleton INSTANCE = new Singleton();</span><br><span class="line">    </span><br><span class="line">    private Singleton() &#123;&#125;;</span><br><span class="line">    </span><br><span class="line">    public static Singleton getInstance() &#123;</span><br><span class="line">        return INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="ä»£ç†æ¨¡å¼"><a href="#ä»£ç†æ¨¡å¼" class="headerlink" title="ä»£ç†æ¨¡å¼"></a>ä»£ç†æ¨¡å¼</h5><p>ä»£ç†æ¨¡å¼ï¼ˆProxy Patternï¼‰æ˜¯æŒ‡å»ºç«‹æŸä¸€ä¸ªå¯¹è±¡çš„ä»£ç†å¯¹è±¡ï¼Œå¹¶ä¸”ç”±ä»£ç†å¯¹è±¡æ§åˆ¶å¯¹åŸå¯¹è±¡çš„å¼•ç”¨ã€‚</p><h3 id="logging-åŒ…"><a href="#logging-åŒ…" class="headerlink" title="logging åŒ…"></a>logging åŒ…</h3><p>loggingåŒ…è´Ÿè´£å®Œæˆ MyBatisæ“ä½œä¸­çš„æ—¥å¿—è®°å½•å·¥ä½œã€‚</p><h4 id="è®¾è®¡æ¨¡å¼-2"><a href="#è®¾è®¡æ¨¡å¼-2" class="headerlink" title="è®¾è®¡æ¨¡å¼"></a>è®¾è®¡æ¨¡å¼</h4><h5 id="é€‚é…å™¨æ¨¡å¼"><a href="#é€‚é…å™¨æ¨¡å¼" class="headerlink" title="é€‚é…å™¨æ¨¡å¼"></a>é€‚é…å™¨æ¨¡å¼</h5><p>é€‚é…å™¨æ¨¡å¼ï¼ˆAdapter Patternï¼‰æ˜¯ä¸€ç§ç»“æ„å‹æ¨¡å¼ï¼ŒåŸºäºè¯¥æ¨¡å¼ è®¾è®¡çš„ç±»èƒ½å¤Ÿåœ¨ä¸¤ä¸ªæˆ–è€…å¤šä¸ªä¸å…¼å®¹çš„ç±»ä¹‹é—´èµ·åˆ°æ²Ÿé€šæ¡¥æ¢çš„ä½œç”¨ã€‚ è½¬æ¢æ’å¤´å°±æ˜¯ä¸€ä¸ªé€‚é…å™¨çš„å…¸å‹ä¾‹å­ã€‚ä¸åŒçš„è½¬æ¢æ’å¤´èƒ½å¤Ÿé€‚é… ä¸åŒå›½å®¶çš„æ’åº§æ ‡å‡†ï¼Œä»è€Œä½¿å¾—ä¸€ä¸ªç”µå™¨èƒ½åœ¨å„ä¸ªå›½å®¶ä½¿ç”¨ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;é˜…è¯»&lt;code&gt;mybatis&lt;/code&gt;æºç å¯ä»¥å…ˆä»å¤–å›´çš„åŸºç¡€åŠŸèƒ½åŒ…å¼€å§‹ï¼Œå‰¥æ´‹è‘±ä¸€æ ·ä¸€å±‚ä¸€å±‚æ·±å…¥&lt;/p&gt;</summary>
    
    
    
    <category term="Mybatis" scheme="https://alexhuihui.github.io/categories/Mybatis/"/>
    
    
    <category term="Mybatis" scheme="https://alexhuihui.github.io/tags/Mybatis/"/>
    
  </entry>
  
  <entry>
    <title>ã€Mybatisã€‘Mybatisè¿è¡Œæµç¨‹</title>
    <link href="https://alexhuihui.github.io/article/20230607.html"/>
    <id>https://alexhuihui.github.io/article/20230607.html</id>
    <published>2023-06-07T11:54:06.000Z</published>
    <updated>2025-01-25T12:39:02.885Z</updated>
    
    <content type="html"><![CDATA[<p>ä»Šå¤©è®©æˆ‘ä»¬æ¥æ¢å¯»ä¸€ä¸‹<code>Mybatis</code>çš„è¿è¡Œæµç¨‹ï¼Œæˆ‘ä»¬å°†å®ƒçš„è¿è¡Œæµç¨‹åˆ†ä¸º2ä¸ªé˜¶æ®µã€‚</p><ul><li>ç¬¬ä¸€é˜¶æ®µï¼š<code>MyBatis</code>åˆå§‹åŒ–é˜¶æ®µã€‚è¯¥é˜¶æ®µç”¨æ¥å®Œæˆ <code>MyBatis</code>è¿è¡Œç¯å¢ƒçš„å‡†å¤‡å·¥ä½œï¼Œåªåœ¨ <code>MyBatis</code>å¯åŠ¨æ—¶è¿è¡Œä¸€æ¬¡ã€‚</li><li>ç¬¬äºŒé˜¶æ®µï¼šæ•°æ®è¯»å†™é˜¶æ®µã€‚è¯¥é˜¶æ®µç”±æ•°æ®è¯»å†™æ“ä½œè§¦å‘ï¼Œå°†æ ¹æ®è¦æ±‚å®Œæˆå…·ä½“çš„å¢ã€åˆ ã€æ”¹ã€æŸ¥ç­‰æ•°æ®åº“æ“ä½œã€‚</li></ul><span id="more"></span> <h3 id="åˆå§‹åŒ–é˜¶æ®µ"><a href="#åˆå§‹åŒ–é˜¶æ®µ" class="headerlink" title="åˆå§‹åŒ–é˜¶æ®µ"></a>åˆå§‹åŒ–é˜¶æ®µ</h3><ul><li>æ ¹æ®é…ç½®æ–‡ä»¶çš„ä½ç½®ï¼Œè·å–å®ƒçš„è¾“å…¥æµ <code>InputStream</code></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">InputStream <span class="title">getResourceAsStream</span><span class="params">(String resource, ClassLoader[] classLoader)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (ClassLoader cl : classLoader) &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">null</span> != cl) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// try to find the resource as passed</span></span><br><span class="line">        InputStream returnValue = cl.getResourceAsStream(resource);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// now, some class loaders want this leading &quot;/&quot;, so we&#x27;ll add it and try again if we didn&#x27;t find the resource</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> == returnValue) &#123;</span><br><span class="line">          returnValue = cl.getResourceAsStream(<span class="string">&quot;/&quot;</span> + resource);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> != returnValue) &#123;</span><br><span class="line">          <span class="keyword">return</span> returnValue;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><ul><li>ä»é…ç½®æ–‡ä»¶çš„æ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œé€å±‚è§£æé…ç½®æ–‡ä»¶ï¼Œä¹ŸåŒ…æ‹¬ç›¸å…³çš„æ˜ å°„æ–‡ä»¶ã€‚è§£æè¿‡ç¨‹ä¸­ä¸æ–­å°†è§£æç»“æœæ”¾å…¥ <code>Configuration</code>å¯¹è±¡ã€‚</li><li>ä»¥é…ç½®å¥½çš„ <code>Configuration</code>å¯¹è±¡ä¸ºå‚æ•°ï¼Œè·å–ä¸€ä¸ª<code> SqlSessionFactory</code>å¯¹è±¡ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> SqlSessionFactory <span class="title">build</span><span class="params">(Reader reader, String environment, Properties properties)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      XMLConfigBuilder parser = <span class="keyword">new</span> XMLConfigBuilder(reader, environment, properties);</span><br><span class="line">      <span class="keyword">return</span> build(parser.parse());</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">      <span class="keyword">throw</span> ExceptionFactory.wrapException(<span class="string">&quot;Error building SqlSession.&quot;</span>, e);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      ErrorContext.instance().reset();</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (reader != <span class="keyword">null</span>) &#123;</span><br><span class="line">          reader.close();</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        <span class="comment">// Intentionally ignore. Prefer previous error.</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p> é‡è¦ä»£ç æ³¨é‡Š:</p><blockquote><ol><li>ç”Ÿæˆäº†ä¸€ä¸ª <code>XMLConfigBuilder </code>å¯¹è±¡ï¼Œå¹¶è°ƒç”¨äº†å…¶ <code>parse </code>æ–¹æ³•ï¼Œå¾—åˆ°ä¸€ä¸ª<code>Configuration</code>å¯¹è±¡ï¼ˆå› ä¸º parseæ–¹æ³•çš„è¾“å‡ºç»“æœä¸º<code> Configuration</code>å¯¹è±¡ï¼‰ã€‚</li></ol></blockquote><blockquote><ol start="2"><li>è°ƒç”¨äº† <code>SqlSessionFactoryBuilder</code> è‡ªèº«çš„ <code>build</code>æ–¹æ³•ï¼Œ ä¼ å…¥å‚æ•°ä¸ºä¸Šä¸€æ­¥å¾—åˆ°çš„<code>Configuration</code>å¯¹è±¡ã€‚</li></ol></blockquote><h3 id="æ•°æ®è¯»å†™é˜¶æ®µè¿½è¸ª"><a href="#æ•°æ®è¯»å†™é˜¶æ®µè¿½è¸ª" class="headerlink" title="æ•°æ®è¯»å†™é˜¶æ®µè¿½è¸ª"></a>æ•°æ®è¯»å†™é˜¶æ®µè¿½è¸ª</h3><p>è¿›è¡Œä¸€æ¬¡æ•°æ®åº“çš„è¯»æˆ–å†™æ“ä½œæ—¶ï¼Œ<code>MyBatis</code>å†…éƒ¨éƒ½è¦ç»è¿‡å“ªäº›æ­¥éª¤</p><h4 id="è·å¾—SqlSession"><a href="#è·å¾—SqlSession" class="headerlink" title="è·å¾—SqlSession"></a>è·å¾—<code>SqlSession</code></h4><p>é€šè¿‡åˆå§‹åŒ–é˜¶æ®µè·å–çš„<code>SqlSessionFactory</code>ç”Ÿæˆæ•°æ®åº“æ“ä½œä¸­æ‰€éœ€è¦çš„<code>SqlSession</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SqlSession sqlSession = sqlSessionFactory.openSession();</span><br></pre></td></tr></table></figure><h4 id="æ˜ å°„æ¥å£æ–‡ä»¶ä¸æ˜ å°„æ–‡ä»¶çš„ç»‘å®š"><a href="#æ˜ å°„æ¥å£æ–‡ä»¶ä¸æ˜ å°„æ–‡ä»¶çš„ç»‘å®š" class="headerlink" title="æ˜ å°„æ¥å£æ–‡ä»¶ä¸æ˜ å°„æ–‡ä»¶çš„ç»‘å®š"></a>æ˜ å°„æ¥å£æ–‡ä»¶ä¸æ˜ å°„æ–‡ä»¶çš„ç»‘å®š</h4><p>æ˜ å°„æ¥å£æ–‡ä»¶æ˜¯æŒ‡å­˜æœ‰Javaæ¥å£çš„æ–‡ä»¶ï¼Œè€Œæ˜ å°„æ–‡ä»¶æ˜¯æŒ‡å­˜æœ‰<code>sql</code>æ“ä½œçš„<code>xml</code>æ–‡ä»¶</p><p>åœ¨è¿›è¡Œæ•°æ®æŸ¥è¯¢ä¹‹å‰ï¼Œå…ˆé€šè¿‡<code>SqlSession</code>çš„<code>getMapper()</code>è·å–æ˜ å°„æ¥å£çš„å®ç°, è¯¥æ“ä½œé€šè¿‡ Configurationç±»çš„ <code>getMapper</code>æ–¹æ³•è½¬æ¥ï¼Œæœ€ç»ˆè¿›å…¥<code> MapperRegistry</code>ç±»ä¸­çš„<code>getMapper</code>æ–¹æ³•ã€‚<code>MapperRegistry</code>ç±»ä¸­çš„ <code>getMapper()</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// DefaultSqlSession.class</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> &lt;T&gt; <span class="function">T <span class="title">getMapper</span><span class="params">(Class&lt;T&gt; type)</span> </span>&#123;</span><br><span class="line">   <span class="keyword">return</span> configuration.getMapper(type, <span class="keyword">this</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Configuration.class</span></span><br><span class="line"><span class="keyword">public</span> &lt;T&gt; <span class="function">T <span class="title">getMapper</span><span class="params">(Class&lt;T&gt; type, SqlSession sqlSession)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> mapperRegistry.getMapper(type, sqlSession);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// MapperRegistry.class</span></span><br><span class="line"><span class="keyword">public</span> &lt;T&gt; <span class="function">T <span class="title">getMapper</span><span class="params">(Class&lt;T&gt; type, SqlSession sqlSession)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> MapperProxyFactory&lt;T&gt; mapperProxyFactory = (MapperProxyFactory&lt;T&gt;) knownMappers.get(type);</span><br><span class="line">    <span class="keyword">if</span> (mapperProxyFactory == <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> BindingException(<span class="string">&quot;Type &quot;</span> + type + <span class="string">&quot; is not known to the MapperRegistry.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> mapperProxyFactory.newInstance(sqlSession);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> BindingException(<span class="string">&quot;Error getting mapper instance. Cause: &quot;</span> + e, e);</span><br><span class="line">    &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><h4 id="æ˜ å°„æ¥å£çš„ä»£ç†"><a href="#æ˜ å°„æ¥å£çš„ä»£ç†" class="headerlink" title="æ˜ å°„æ¥å£çš„ä»£ç†"></a>æ˜ å°„æ¥å£çš„ä»£ç†</h4><p><code>session.getMapper()</code> å¾—åˆ°çš„æ˜¯ä¸€ä¸ª<code>mapperProxyFactory.newInstance(sqlSession)</code>è¿”å›çš„å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡æ˜¯ä¸€ä¸ªåŸºäºåå°„çš„åŠ¨æ€ä»£ç†å¯¹è±¡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> T <span class="title">newInstance</span><span class="params">(MapperProxy&lt;T&gt; mapperProxy)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (T) Proxy.newProxyInstance(mapperInterface.getClassLoader(), <span class="keyword">new</span> Class[] &#123; mapperInterface &#125;, mapperProxy);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> T <span class="title">newInstance</span><span class="params">(SqlSession sqlSession)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> MapperProxy&lt;T&gt; mapperProxy = <span class="keyword">new</span> MapperProxy&lt;&gt;(sqlSession, mapperInterface, methodCache);</span><br><span class="line">  <span class="keyword">return</span> newInstance(mapperProxy);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€ç»ˆæ•°æ®æŸ¥è¯¢ä¼šè¿›å…¥<code>MapperProxy</code>çš„<code>invoke()</code>ï¼Œè¿™æ˜¯å› ä¸ºè¢«ä»£ç†å¯¹è±¡çš„æ–¹æ³•ä¼šè¢«ä»£ç†å¯¹è±¡çš„<code>invoke()</code>æ‹¦æˆª</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (Object.class.equals(method.getDeclaringClass())) &#123;</span><br><span class="line">      <span class="keyword">return</span> method.invoke(<span class="keyword">this</span>, args);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> cachedInvoker(method).invoke(proxy, method, args, sqlSession);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (Throwable t) &#123;</span><br><span class="line">    <span class="keyword">throw</span> ExceptionUtil.unwrapThrowable(t);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åä¼šè§¦å‘<code>MapperMethod</code>å¯¹è±¡çš„<code>execute()</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">execute</span><span class="params">(SqlSession sqlSession, Object[] args)</span> </span>&#123;</span><br><span class="line">    Object result;</span><br><span class="line">    <span class="keyword">switch</span> (command.getType()) &#123;</span><br><span class="line">      <span class="keyword">case</span> INSERT: &#123;</span><br><span class="line">        Object param = method.convertArgsToSqlCommandParam(args);</span><br><span class="line">        result = rowCountResult(sqlSession.insert(command.getName(), param));</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">case</span> UPDATE: &#123;</span><br><span class="line">        Object param = method.convertArgsToSqlCommandParam(args);</span><br><span class="line">        result = rowCountResult(sqlSession.update(command.getName(), param));</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">case</span> DELETE: &#123;</span><br><span class="line">        Object param = method.convertArgsToSqlCommandParam(args);</span><br><span class="line">        result = rowCountResult(sqlSession.delete(command.getName(), param));</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">case</span> SELECT:</span><br><span class="line">        <span class="keyword">if</span> (method.returnsVoid() &amp;&amp; method.hasResultHandler()) &#123;</span><br><span class="line">          executeWithResultHandler(sqlSession, args);</span><br><span class="line">          result = <span class="keyword">null</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (method.returnsMany()) &#123;</span><br><span class="line">          result = executeForMany(sqlSession, args);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (method.returnsMap()) &#123;</span><br><span class="line">          result = executeForMap(sqlSession, args);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (method.returnsCursor()) &#123;</span><br><span class="line">          result = executeForCursor(sqlSession, args);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          Object param = method.convertArgsToSqlCommandParam(args);</span><br><span class="line">          result = sqlSession.selectOne(command.getName(), param);</span><br><span class="line">          <span class="keyword">if</span> (method.returnsOptional() &amp;&amp; (result == <span class="keyword">null</span> || !method.getReturnType().equals(result.getClass()))) &#123;</span><br><span class="line">            result = Optional.ofNullable(result);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> FLUSH:</span><br><span class="line">        result = sqlSession.flushStatements();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> BindingException(<span class="string">&quot;Unknown execution method for: &quot;</span> + command.getName());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (result == <span class="keyword">null</span> &amp;&amp; method.getReturnType().isPrimitive() &amp;&amp; !method.returnsVoid()) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> BindingException(<span class="string">&quot;Mapper method &#x27;&quot;</span> + command.getName()</span><br><span class="line">          + <span class="string">&quot;&#x27; attempted to return null from a method with a primitive return type (&quot;</span> + method.getReturnType() + <span class="string">&quot;).&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p><code>MyBatis</code>æ ¹æ®ä¸åŒæ•°æ®åº“æ“ä½œç±»å‹è°ƒç”¨äº†ä¸åŒçš„å¤„ç†æ–¹æ³•</p><p><code>executeForMany</code> æ–¹æ³•ä¸­ï¼Œ<code>MyBatis </code>å¼€å§‹é€šè¿‡ <code>SqlSession</code> å¯¹è±¡çš„<code>selectList</code>æ–¹æ³•å¼€å±•åç»­çš„æŸ¥è¯¢å·¥ä½œã€‚ è¿½è¸ªåˆ°è¿™é‡Œï¼Œ<code>MyBatis </code>å·²ç»å®Œæˆäº†ä¸ºæ˜ å°„æ¥å£æ³¨å…¥å®ç°çš„è¿‡ç¨‹ã€‚ äºæ˜¯ï¼Œå¯¹æ˜ å°„æ¥å£ä¸­æŠ½è±¡æ–¹æ³•çš„è°ƒç”¨è½¬å˜ä¸ºäº†æ•°æ®æŸ¥è¯¢æ“ä½œã€‚</p><h4 id="SQLè¯­å¥çš„æŸ¥æ‰¾"><a href="#SQLè¯­å¥çš„æŸ¥æ‰¾" class="headerlink" title="SQLè¯­å¥çš„æŸ¥æ‰¾"></a><code>SQL</code>è¯­å¥çš„æŸ¥æ‰¾</h4><p>æ¯ä¸ª<code> MappedStatement</code> å¯¹è±¡å¯¹åº”äº†æˆ‘ä»¬è®¾ç½®çš„ä¸€ä¸ªæ•°æ®åº“æ“ä½œèŠ‚ ç‚¹ï¼Œå®ƒä¸»è¦å®šä¹‰äº†æ•°æ®åº“æ“ä½œè¯­å¥ã€è¾“å…¥/è¾“å‡ºå‚æ•°ç­‰ä¿¡æ¯ã€‚configuration.getMappedStatementï¼ˆstatementï¼‰<code>è¯­å¥å°†è¦æ‰§è¡Œçš„</code>MappedStatement<code>å¯¹è±¡ä» </code>Configuration`å¯¹è±¡å­˜å‚¨çš„æ˜ å°„æ–‡ä»¶ä¿¡æ¯ä¸­æ‰¾äº†å‡ºæ¥ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> &lt;E&gt; <span class="function">List&lt;E&gt; <span class="title">selectList</span><span class="params">(String statement, Object parameter, RowBounds rowBounds, ResultHandler handler)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      MappedStatement ms = configuration.getMappedStatement(statement);</span><br><span class="line">      dirty |= ms.isDirtySelect();</span><br><span class="line">      <span class="keyword">return</span> executor.query(ms, wrapCollection(parameter), rowBounds, handler);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">      <span class="keyword">throw</span> ExceptionFactory.wrapException(<span class="string">&quot;Error querying database.  Cause: &quot;</span> + e, e);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      ErrorContext.instance().reset();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h4 id="æŸ¥è¯¢ç»“æœç¼“å­˜"><a href="#æŸ¥è¯¢ç»“æœç¼“å­˜" class="headerlink" title="æŸ¥è¯¢ç»“æœç¼“å­˜"></a>æŸ¥è¯¢ç»“æœç¼“å­˜</h4><p>queryæ–¹æ³•æ˜¯ä¸€ä¸ª Executoræ¥å£ä¸­çš„æŠ½è±¡æ–¹æ³•ï¼Œå®é™…æ‰§è¡Œçš„æ˜¯<code> CachingExecutor</code>ç±»ä¸­çš„æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// CachingExecutor.class</span></span><br><span class="line"><span class="keyword">public</span> &lt;E&gt; <span class="function">List&lt;E&gt; <span class="title">query</span><span class="params">(MappedStatement ms, Object parameterObject, RowBounds rowBounds, ResultHandler resultHandler)</span></span></span><br><span class="line"><span class="function">      <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">    BoundSql boundSql = ms.getBoundSql(parameterObject);</span><br><span class="line">    CacheKey key = createCacheKey(ms, parameterObject, rowBounds, boundSql);</span><br><span class="line">    <span class="keyword">return</span> query(ms, parameterObject, rowBounds, resultHandler, key, boundSql);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p><code>BoundSql</code>æ˜¯ç»è¿‡å±‚å±‚è½¬åŒ–åå»é™¤æ‰ ifã€whereç­‰æ ‡ç­¾çš„ <code>SQL</code>è¯­ å¥ï¼Œè€Œ<code> CacheKey</code>æ˜¯ä¸ºè¯¥æ¬¡æŸ¥è¯¢æ“ä½œè®¡ç®—å‡ºæ¥çš„ç¼“å­˜é”®</p><h4 id="æ•°æ®åº“æŸ¥è¯¢"><a href="#æ•°æ®åº“æŸ¥è¯¢" class="headerlink" title="æ•°æ®åº“æŸ¥è¯¢"></a>æ•°æ®åº“æŸ¥è¯¢</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// CachingExecutor.class</span></span><br><span class="line"><span class="keyword">public</span> &lt;E&gt; <span class="function">List&lt;E&gt; <span class="title">query</span><span class="params">(MappedStatement ms, Object parameterObject, RowBounds rowBounds, ResultHandler resultHandler,</span></span></span><br><span class="line"><span class="params"><span class="function">      CacheKey key, BoundSql boundSql)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">    Cache cache = ms.getCache();</span><br><span class="line">    <span class="keyword">if</span> (cache != <span class="keyword">null</span>) &#123;</span><br><span class="line">      flushCacheIfRequired(ms);</span><br><span class="line">      <span class="keyword">if</span> (ms.isUseCache() &amp;&amp; resultHandler == <span class="keyword">null</span>) &#123;</span><br><span class="line">        ensureNoOutParams(ms, boundSql);</span><br><span class="line">        <span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line">        List&lt;E&gt; list = (List&lt;E&gt;) tcm.getObject(cache, key);</span><br><span class="line">        <span class="keyword">if</span> (list == <span class="keyword">null</span>) &#123;</span><br><span class="line">          list = delegate.query(ms, parameterObject, rowBounds, resultHandler, key, boundSql);</span><br><span class="line">          tcm.putObject(cache, key, list); <span class="comment">// issue #578 and #116</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> delegate.query(ms, parameterObject, rowBounds, resultHandler, key, boundSql);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p><code>MyBatis</code>æŸ¥çœ‹å½“å‰çš„æŸ¥è¯¢æ“ä½œæ˜¯å¦å‘½ä¸­ç¼“å­˜ã€‚å¦‚æœ æ˜¯ï¼Œåˆ™ä»ç¼“å­˜ä¸­è·å–æ•°æ®ç»“æœï¼›å¦åˆ™ï¼Œä¾¿é€šè¿‡ delegateè°ƒç”¨ queryæ–¹ æ³•ã€‚</p><p>delegateè°ƒç”¨çš„ queryæ–¹æ³•å®é™…ä¸Šæ˜¯<code>BaseExecutor</code>ç±»ä¸­çš„ queryæ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// BaseExecutor.class</span></span><br><span class="line"><span class="keyword">public</span> &lt;E&gt; <span class="function">List&lt;E&gt; <span class="title">query</span><span class="params">(MappedStatement ms, Object parameter, RowBounds rowBounds, ResultHandler resultHandler,</span></span></span><br><span class="line"><span class="params"><span class="function">      CacheKey key, BoundSql boundSql)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">    ErrorContext.instance().resource(ms.getResource()).activity(<span class="string">&quot;executing a query&quot;</span>).object(ms.getId());</span><br><span class="line">    <span class="keyword">if</span> (closed) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> ExecutorException(<span class="string">&quot;Executor was closed.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (queryStack == <span class="number">0</span> &amp;&amp; ms.isFlushCacheRequired()) &#123;</span><br><span class="line">      clearLocalCache();</span><br><span class="line">    &#125;</span><br><span class="line">    List&lt;E&gt; list;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      queryStack++;</span><br><span class="line">      list = resultHandler == <span class="keyword">null</span> ? (List&lt;E&gt;) localCache.getObject(key) : <span class="keyword">null</span>;</span><br><span class="line">      <span class="keyword">if</span> (list != <span class="keyword">null</span>) &#123;</span><br><span class="line">        handleLocallyCachedOutputParameters(ms, key, parameter, boundSql);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        list = queryFromDatabase(ms, parameter, rowBounds, resultHandler, key, boundSql);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      queryStack--;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (queryStack == <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">for</span> (DeferredLoad deferredLoad : deferredLoads) &#123;</span><br><span class="line">        deferredLoad.load();</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// issue #601</span></span><br><span class="line">      deferredLoads.clear();</span><br><span class="line">      <span class="keyword">if</span> (configuration.getLocalCacheScope() == LocalCacheScope.STATEMENT) &#123;</span><br><span class="line">        <span class="comment">// issue #482</span></span><br><span class="line">        clearLocalCache();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> list;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p><code>MyBatis</code>å¼€å§‹è°ƒç”¨æ•°æ®åº“å±•å¼€æŸ¥è¯¢æ“ ä½œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// BaseExecutor.class</span></span><br><span class="line"><span class="keyword">private</span> &lt;E&gt; <span class="function">List&lt;E&gt; <span class="title">queryFromDatabase</span><span class="params">(MappedStatement ms, Object parameter, RowBounds rowBounds,</span></span></span><br><span class="line"><span class="params"><span class="function">      ResultHandler resultHandler, CacheKey key, BoundSql boundSql)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">    List&lt;E&gt; list;</span><br><span class="line">    localCache.putObject(key, EXECUTION_PLACEHOLDER);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      list = doQuery(ms, parameter, rowBounds, resultHandler, boundSql);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      localCache.removeObject(key);</span><br><span class="line">    &#125;</span><br><span class="line">    localCache.putObject(key, list);</span><br><span class="line">    <span class="keyword">if</span> (ms.getStatementType() == StatementType.CALLABLE) &#123;</span><br><span class="line">      localOutputParameterCache.putObject(key, parameter);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> list;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p><code>MyBatis</code>å…ˆåœ¨ç¼“å­˜ä¸­æ”¾ç½®ä¸€ä¸ªå ä½ç¬¦ï¼Œç„¶ åè°ƒç”¨ <code>doQuery</code>æ–¹æ³•å®é™…æ‰§è¡ŒæŸ¥è¯¢æ“ä½œã€‚æœ€åï¼ŒåˆæŠŠç¼“å­˜ä¸­çš„å ä½ç¬¦ æ›¿æ¢æˆçœŸæ­£çš„æŸ¥è¯¢ç»“æœ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SimpleExecutor.class</span></span><br><span class="line"><span class="keyword">public</span> &lt;E&gt; <span class="function">List&lt;E&gt; <span class="title">doQuery</span><span class="params">(MappedStatement ms, Object parameter, RowBounds rowBounds, ResultHandler resultHandler,</span></span></span><br><span class="line"><span class="params"><span class="function">      BoundSql boundSql)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">    Statement stmt = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      Configuration configuration = ms.getConfiguration();</span><br><span class="line">      StatementHandler handler = configuration.newStatementHandler(wrapper, ms, parameter, rowBounds, resultHandler,</span><br><span class="line">          boundSql);</span><br><span class="line">      stmt = prepareStatement(handler, ms.getStatementLog());</span><br><span class="line">      <span class="keyword">return</span> handler.query(stmt, resultHandler);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      closeStatement(stmt);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°æ–¹æ³•ç”Ÿæˆäº†Statementå¯¹è±¡stmtã€‚Statementç±»å¹¶ä¸æ˜¯MyBatis ä¸­çš„ç±»ï¼Œè€Œæ˜¯java.sqlåŒ…ä¸­çš„ç±»ã€‚Statementç±»èƒ½å¤Ÿæ‰§è¡Œé™æ€ SQLè¯­å¥ å¹¶è¿”å›ç»“æœã€‚</p><p>ç¨‹åºè¿˜é€šè¿‡ Configurationçš„ newStatementHandleræ–¹æ³•è·å¾—äº† ä¸€ä¸ª StatementHandlerå¯¹è±¡ handlerï¼Œç„¶åå°†æŸ¥è¯¢æ“ä½œäº¤ç»™ StatementHandlerå¯¹è±¡è¿›è¡Œã€‚StatementHandleræ˜¯ä¸€ä¸ªè¯­å¥å¤„ç†å™¨ç±»ï¼Œå…¶ä¸­å° è£…äº†å¾ˆå¤šè¯­å¥æ“ä½œæ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// PreparedStatementHandler.class</span></span><br><span class="line"><span class="keyword">public</span> &lt;E&gt; <span class="function">List&lt;E&gt; <span class="title">query</span><span class="params">(Statement statement, ResultHandler resultHandler)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">    PreparedStatement ps = (PreparedStatement) statement;</span><br><span class="line">    ps.execute();</span><br><span class="line">    <span class="keyword">return</span> resultSetHandler.handleResultSets(ps);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œ ps.executeï¼ˆï¼‰çœŸæ­£æ‰§è¡Œäº† SQL è¯­å¥ï¼Œç„¶åæŠŠæ‰§è¡Œç»“æœäº¤ ç»™ ResultHandler å¯¹è±¡å¤„ç†ã€‚è€ŒPreparedStatementç±»å¹¶ä¸æ˜¯MyBatis ä¸­çš„ç±»ï¼Œå› è€Œps.executeï¼ˆï¼‰çš„æ‰§è¡Œä¸å†ç”±MyBatisè´Ÿè´£ï¼Œè€Œæ˜¯ç”± com.mysql.cj.jdbcåŒ…ä¸­çš„ç±»è´Ÿè´£ï¼Œè¿™é‡Œä¸å†ç»§ç»­è¿½è¸ªã€‚</p><p>æ€»ç»“ï¼š</p><ol><li>åœ¨è¿›è¡Œæ•°æ®åº“æŸ¥è¯¢å‰ï¼Œå…ˆæŸ¥è¯¢ç¼“å­˜ï¼›å¦‚æœç¡®å®éœ€è¦æŸ¥è¯¢æ•°æ® åº“ï¼Œåˆ™æ•°æ®åº“æŸ¥è¯¢ä¹‹åçš„ç»“æœä¹Ÿæ”¾å…¥ç¼“å­˜ä¸­ã€‚ Â·</li><li>SQL è¯­å¥çš„æ‰§è¡Œç»è¿‡äº†å±‚å±‚è½¬åŒ–ï¼Œä¾æ¬¡ç»è¿‡äº† MappedStatement å¯¹è±¡ã€Statementå¯¹è±¡å’Œ PreparedStatementå¯¹è±¡ï¼Œæœ€åæ‰å¾—ä»¥æ‰§ è¡Œã€‚ Â·</li><li>æœ€ç»ˆæ•°æ®åº“æŸ¥è¯¢å¾—åˆ°çš„ç»“æœäº¤ç»™ ResultHandlerå¯¹è±¡å¤„ç†ã€‚</li></ol><h4 id="å¤„ç†ç»“æœé›†"><a href="#å¤„ç†ç»“æœé›†" class="headerlink" title="å¤„ç†ç»“æœé›†"></a>å¤„ç†ç»“æœé›†</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// DefaultResultSetHandler.class</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;Object&gt; <span class="title">handleResultSets</span><span class="params">(Statement stmt)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">    ErrorContext.instance().activity(<span class="string">&quot;handling results&quot;</span>).object(mappedStatement.getId());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> List&lt;Object&gt; multipleResults = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> resultSetCount = <span class="number">0</span>;</span><br><span class="line">    ResultSetWrapper rsw = getFirstResultSet(stmt);</span><br><span class="line"></span><br><span class="line">    List&lt;ResultMap&gt; resultMaps = mappedStatement.getResultMaps();</span><br><span class="line">    <span class="keyword">int</span> resultMapCount = resultMaps.size();</span><br><span class="line">    validateResultMapsCount(rsw, resultMapCount);</span><br><span class="line">    <span class="keyword">while</span> (rsw != <span class="keyword">null</span> &amp;&amp; resultMapCount &gt; resultSetCount) &#123;</span><br><span class="line">      ResultMap resultMap = resultMaps.get(resultSetCount);</span><br><span class="line">      handleResultSet(rsw, resultMap, multipleResults, <span class="keyword">null</span>);</span><br><span class="line">      rsw = getNextResultSet(stmt);</span><br><span class="line">      cleanUpAfterHandlingResultSet();</span><br><span class="line">      resultSetCount++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    String[] resultSets = mappedStatement.getResultSets();</span><br><span class="line">    <span class="keyword">if</span> (resultSets != <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="keyword">while</span> (rsw != <span class="keyword">null</span> &amp;&amp; resultSetCount &lt; resultSets.length) &#123;</span><br><span class="line">        ResultMapping parentMapping = nextResultMaps.get(resultSets[resultSetCount]);</span><br><span class="line">        <span class="keyword">if</span> (parentMapping != <span class="keyword">null</span>) &#123;</span><br><span class="line">          String nestedResultMapId = parentMapping.getNestedResultMapId();</span><br><span class="line">          ResultMap resultMap = configuration.getResultMap(nestedResultMapId);</span><br><span class="line">          handleResultSet(rsw, resultMap, <span class="keyword">null</span>, parentMapping);</span><br><span class="line">        &#125;</span><br><span class="line">        rsw = getNextResultSet(stmt);</span><br><span class="line">        cleanUpAfterHandlingResultSet();</span><br><span class="line">        resultSetCount++;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> collapseSingleResultList(multipleResults);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;ä»Šå¤©è®©æˆ‘ä»¬æ¥æ¢å¯»ä¸€ä¸‹&lt;code&gt;Mybatis&lt;/code&gt;çš„è¿è¡Œæµç¨‹ï¼Œæˆ‘ä»¬å°†å®ƒçš„è¿è¡Œæµç¨‹åˆ†ä¸º2ä¸ªé˜¶æ®µã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç¬¬ä¸€é˜¶æ®µï¼š&lt;code&gt;MyBatis&lt;/code&gt;åˆå§‹åŒ–é˜¶æ®µã€‚è¯¥é˜¶æ®µç”¨æ¥å®Œæˆ &lt;code&gt;MyBatis&lt;/code&gt;è¿è¡Œç¯å¢ƒçš„å‡†å¤‡å·¥ä½œï¼Œåªåœ¨ &lt;code&gt;MyBatis&lt;/code&gt;å¯åŠ¨æ—¶è¿è¡Œä¸€æ¬¡ã€‚&lt;/li&gt;
&lt;li&gt;ç¬¬äºŒé˜¶æ®µï¼šæ•°æ®è¯»å†™é˜¶æ®µã€‚è¯¥é˜¶æ®µç”±æ•°æ®è¯»å†™æ“ä½œè§¦å‘ï¼Œå°†æ ¹æ®è¦æ±‚å®Œæˆå…·ä½“çš„å¢ã€åˆ ã€æ”¹ã€æŸ¥ç­‰æ•°æ®åº“æ“ä½œã€‚&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="Mybatis" scheme="https://alexhuihui.github.io/categories/Mybatis/"/>
    
    
    <category term="Mybatis" scheme="https://alexhuihui.github.io/tags/Mybatis/"/>
    
  </entry>
  
  <entry>
    <title>ã€äº‹åŠ¡å¤„ç†ã€‘æœ¬åœ°äº‹åŠ¡</title>
    <link href="https://alexhuihui.github.io/article/20230517.html"/>
    <id>https://alexhuihui.github.io/article/20230517.html</id>
    <published>2023-05-17T11:54:06.000Z</published>
    <updated>2025-01-25T12:43:12.845Z</updated>
    
    <content type="html"><![CDATA[<p>å¤§å®¶éƒ½çŸ¥é“æ•°æ®åº“äº‹åŠ¡ä¸­æœ‰ç€<code>AICD</code>çš„è¯´æ³•ï¼Œå®é™…ä¸ŠC(ä¸€è‡´æ€§)æ˜¯ç›®çš„ï¼Œè€Œå¯¹åº”çš„A(åŸå­æ€§)ã€I(éš”ç¦»æ€§)ã€D(æŒä¹…æ€§)æ˜¯æ‰‹æ®µï¼ŒAID -&gt; Cã€‚</p><span id="more"></span> <h3 id="æ¦‚å¿µä»‹ç»"><a href="#æ¦‚å¿µä»‹ç»" class="headerlink" title="æ¦‚å¿µä»‹ç»"></a>æ¦‚å¿µä»‹ç»</h3><h4 id="åŸå­æ€§"><a href="#åŸå­æ€§" class="headerlink" title="åŸå­æ€§"></a>åŸå­æ€§</h4><p>åŸå­æ€§ä¿è¯äº†äº‹åŠ¡çš„å¤šä¸ªæ“ä½œè¦ä¹ˆéƒ½ç”Ÿæ•ˆè¦ä¹ˆéƒ½ä¸ç”Ÿæ•ˆï¼Œä¸ä¼šå­˜åœ¨ä¸­é—´çŠ¶æ€</p><h4 id="éš”ç¦»æ€§"><a href="#éš”ç¦»æ€§" class="headerlink" title="éš”ç¦»æ€§"></a>éš”ç¦»æ€§</h4><p>åœ¨ä¸åŒçš„ä¸šåŠ¡å¤„ç†è¿‡ç¨‹ä¸­ï¼Œäº’ä¸å½±å“å„è‡ªè¯»å†™æ•°æ®</p><h3 id="æŒä¹…æ€§"><a href="#æŒä¹…æ€§" class="headerlink" title="æŒä¹…æ€§"></a>æŒä¹…æ€§</h3><p>æ‰€æœ‰æäº¤æˆåŠŸçš„æ•°æ®ä¿®æ”¹éƒ½åº”è¯¥è¢«æŒä¹…åŒ–ä¿å­˜</p><h3 id="å®ç°åŸå­æ€§å’ŒæŒä¹…æ€§"><a href="#å®ç°åŸå­æ€§å’ŒæŒä¹…æ€§" class="headerlink" title="å®ç°åŸå­æ€§å’ŒæŒä¹…æ€§"></a>å®ç°åŸå­æ€§å’ŒæŒä¹…æ€§</h3>]]></content>
    
    
    <summary type="html">&lt;p&gt;å¤§å®¶éƒ½çŸ¥é“æ•°æ®åº“äº‹åŠ¡ä¸­æœ‰ç€&lt;code&gt;AICD&lt;/code&gt;çš„è¯´æ³•ï¼Œå®é™…ä¸ŠC(ä¸€è‡´æ€§)æ˜¯ç›®çš„ï¼Œè€Œå¯¹åº”çš„A(åŸå­æ€§)ã€I(éš”ç¦»æ€§)ã€D(æŒä¹…æ€§)æ˜¯æ‰‹æ®µï¼ŒAID -&amp;gt; Cã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="äº‹åŠ¡" scheme="https://alexhuihui.github.io/categories/%E4%BA%8B%E5%8A%A1/"/>
    
    
    <category term="äº‹åŠ¡" scheme="https://alexhuihui.github.io/tags/%E4%BA%8B%E5%8A%A1/"/>
    
  </entry>
  
  <entry>
    <title>ã€é¡¹ç›®ã€‘åˆ†è¯ŠçŸ¥è¯†åº“ç³»ç»Ÿè®¾è®¡</title>
    <link href="https://alexhuihui.github.io/article/20230512.html"/>
    <id>https://alexhuihui.github.io/article/20230512.html</id>
    <published>2023-05-12T11:45:55.000Z</published>
    <updated>2025-01-25T12:45:32.042Z</updated>
    
    <content type="html"><![CDATA[<p>åˆ†è¯ŠçŸ¥è¯†åº“çš„ç³»ç»Ÿè®¾è®¡</p><span id="more"></span> <p>è®¾è®¡æ–¹æ¡ˆï¼š</p><h3 id="æ•°æ®åº“è®¾è®¡"><a href="#æ•°æ®åº“è®¾è®¡" class="headerlink" title="æ•°æ®åº“è®¾è®¡"></a>æ•°æ®åº“è®¾è®¡</h3><p>é’ˆå¯¹ç–¾ç—…ã€è¯å“ã€æ€¥æ•‘å’Œå¼‚å¸¸åˆ†è¯Šæ¡ˆä¾‹ï¼Œåˆ†åˆ«è®¾è®¡å¯¹åº”çš„æ•°æ®è¡¨ä»¥åŠå…³è”çš„æ•°æ®è¡¨ã€‚</p><p><a href="https://raw.githubusercontent.com/Alexhuihui/photo/main/20230515153441.png"><img src="https://raw.githubusercontent.com/Alexhuihui/photo/main/20230515153441.png" alt="img"></a></p><p><a href="https://raw.githubusercontent.com/Alexhuihui/photo/main/20230515153214.png"><img src="https://raw.githubusercontent.com/Alexhuihui/photo/main/20230515153214.png" alt="img"></a></p><h3 id="Elasticsearchç´¢å¼•è®¾è®¡"><a href="#Elasticsearchç´¢å¼•è®¾è®¡" class="headerlink" title="Elasticsearchç´¢å¼•è®¾è®¡"></a><code>Elasticsearch</code>ç´¢å¼•è®¾è®¡</h3><p>åœ¨<code>Elasticsearch</code>ä¸­ï¼Œä¸ºç–¾ç—…ã€è¯å“å’Œæ€¥æ•‘å»ºç«‹ä¸€ä¸ªç»Ÿä¸€çš„ç´¢å¼•ï¼Œæ–¹ä¾¿è¿›è¡Œæœç´¢ã€‚</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;index_patterns&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;local-knowledge-*&quot;</span>,</span><br><span class="line">    <span class="string">&quot;dev-knowledge-*&quot;</span>,</span><br><span class="line">    <span class="string">&quot;sit-knowledge-*&quot;</span>,</span><br><span class="line">    <span class="string">&quot;uat-knowledge-*&quot;</span>,</span><br><span class="line">    <span class="string">&quot;prod-knowledge-*&quot;</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">&quot;settings&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;number_of_shards&quot;</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">&quot;number_of_replicas&quot;</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">&quot;analysis&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;filter&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;len&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;length&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;min&quot;</span>: <span class="number">2</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;analyzer&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;custom_ik_max&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;tokenizer&quot;</span>: <span class="string">&quot;ik_max_word&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;filter&quot;</span>: [</span><br><span class="line">            <span class="string">&quot;len&quot;</span></span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;properties&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;name&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;analyzer&quot;</span>: <span class="string">&quot;custom_ik_max&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;search_analyzer&quot;</span>: <span class="string">&quot;ik_smart&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;commonName&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;analyzer&quot;</span>: <span class="string">&quot;custom_ik_max&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;search_analyzer&quot;</span>: <span class="string">&quot;ik_smart&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;infoType&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;integer&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;introduction&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;analyzer&quot;</span>: <span class="string">&quot;custom_ik_max&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;search_analyzer&quot;</span>: <span class="string">&quot;ik_smart&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;typeId&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;long&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;typeName&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;keyword&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;relatedDepartments&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;nested&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;properties&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;departmentId&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;long&quot;</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="attr">&quot;departmentName&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;keyword&quot;</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;relatedPositions&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;nested&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;properties&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;positionId&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;long&quot;</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="attr">&quot;positionName&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;keyword&quot;</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;fdaId&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;long&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;fdaName&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;keyword&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;morbidityId&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;long&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;morbidityName&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;keyword&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;symptomDescription&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;analyzer&quot;</span>: <span class="string">&quot;custom_ik_max&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;search_analyzer&quot;</span>: <span class="string">&quot;ik_smart&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;checkDescription&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;analyzer&quot;</span>: <span class="string">&quot;custom_ik_max&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;search_analyzer&quot;</span>: <span class="string">&quot;ik_smart&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;treatment&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;analyzer&quot;</span>: <span class="string">&quot;ik_max_word&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;search_analyzer&quot;</span>: <span class="string">&quot;ik_smart&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;prevention&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;analyzer&quot;</span>: <span class="string">&quot;custom_ik_max&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;search_analyzer&quot;</span>: <span class="string">&quot;ik_smart&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;concurrent&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;analyzer&quot;</span>: <span class="string">&quot;custom_ik_max&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;search_analyzer&quot;</span>: <span class="string">&quot;ik_smart&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;diagnosis&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;analyzer&quot;</span>: <span class="string">&quot;ik_max_word&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;search_analyzer&quot;</span>: <span class="string">&quot;ik_smart&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;adverseReaction&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;analyzer&quot;</span>: <span class="string">&quot;custom_ik_max&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;search_analyzer&quot;</span>: <span class="string">&quot;ik_smart&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;component&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;analyzer&quot;</span>: <span class="string">&quot;custom_ik_max&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;search_analyzer&quot;</span>: <span class="string">&quot;ik_smart&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;contraindication&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;analyzer&quot;</span>: <span class="string">&quot;custom_ik_max&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;search_analyzer&quot;</span>: <span class="string">&quot;ik_smart&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;dosage&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;analyzer&quot;</span>: <span class="string">&quot;custom_ik_max&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;search_analyzer&quot;</span>: <span class="string">&quot;ik_smart&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;indication&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;analyzer&quot;</span>: <span class="string">&quot;custom_ik_max&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;search_analyzer&quot;</span>: <span class="string">&quot;ik_smart&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;content&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;analyzer&quot;</span>: <span class="string">&quot;custom_ik_max&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;search_analyzer&quot;</span>: <span class="string">&quot;ik_smart&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;note&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;analyzer&quot;</span>: <span class="string">&quot;custom_ik_max&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;search_analyzer&quot;</span>: <span class="string">&quot;ik_smart&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;crtId&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;long&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;crtName&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;crtTime&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;date&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;format&quot;</span>: <span class="string">&quot;yyyy-MM-dd HH:mm:ss||yyyy-MM-dd||epoch_millis&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;updId&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;long&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;updName&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;updTime&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;date&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;format&quot;</span>: <span class="string">&quot;yyyy-MM-dd HH:mm:ss||yyyy-MM-dd||epoch_millis&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åº”ç”¨ç¨‹åºè®¾è®¡"><a href="#åº”ç”¨ç¨‹åºè®¾è®¡" class="headerlink" title="åº”ç”¨ç¨‹åºè®¾è®¡"></a>åº”ç”¨ç¨‹åºè®¾è®¡</h3><p>ä¸ºç–¾ç—…ã€è¯å“ã€æ€¥æ•‘å’Œå¼‚å¸¸åˆ†è¯Šæ¡ˆä¾‹æä¾›åŸºç¡€æ•°æ®ç®¡ç†èƒ½åŠ›ï¼Œ<code>API</code>å¦‚ä¸‹</p><ol><li>ç–¾ç—…æ¨¡å—APIæ¥å£</li></ol><table><thead><tr><th align="left">APIåç§°</th><th align="left">è¯·æ±‚æ–¹å¼</th><th align="left">æ¥å£è·¯å¾„</th><th align="left">è¯·æ±‚å‚æ•°</th><th align="left">è¿”å›ç»“æœ</th><th align="left">å¤‡æ³¨</th></tr></thead><tbody><tr><td align="left">è·å–ç–¾ç—…åˆ—è¡¨</td><td align="left">GET</td><td align="left">/diseases</td><td align="left">-</td><td align="left">ç–¾ç—…åˆ—è¡¨</td><td align="left">åˆ†é¡µè·å–æ‰€æœ‰ç–¾ç—…ä¿¡æ¯</td></tr><tr><td align="left">è·å–ç–¾ç—…è¯¦æƒ…</td><td align="left">GET</td><td align="left">/diseases/{id}</td><td align="left">id (ç–¾ç—…ID)</td><td align="left">ç–¾ç—…è¯¦æƒ…</td><td align="left">æ ¹æ®ç–¾ç—…IDè·å–ç–¾ç—…è¯¦ç»†ä¿¡æ¯</td></tr><tr><td align="left">åˆ›å»ºç–¾ç—…</td><td align="left">POST</td><td align="left">/diseases</td><td align="left">ç–¾ç—…ä¿¡æ¯</td><td align="left">åˆ›å»ºæˆåŠŸçš„ç–¾ç—…</td><td align="left">åˆ›å»ºæ–°çš„ç–¾ç—…</td></tr><tr><td align="left">æ›´æ–°ç–¾ç—…</td><td align="left">PUT</td><td align="left">/diseases/{id}</td><td align="left">id (ç–¾ç—…ID)</td><td align="left">æ›´æ–°æˆåŠŸçš„ç–¾ç—…</td><td align="left">æ ¹æ®ç–¾ç—…IDæ›´æ–°ç–¾ç—…ä¿¡æ¯</td></tr><tr><td align="left">åˆ é™¤ç–¾ç—…</td><td align="left">DELETE</td><td align="left">/diseases/{id}</td><td align="left">id (ç–¾ç—…ID)</td><td align="left">åˆ é™¤æˆåŠŸçš„ç–¾ç—…</td><td align="left">æ ¹æ®ç–¾ç—…IDåˆ é™¤ç–¾ç—…</td></tr></tbody></table><ol><li>è¯å“æ¨¡å—APIæ¥å£</li></ol><table><thead><tr><th align="left">APIåç§°</th><th align="left">è¯·æ±‚æ–¹å¼</th><th align="left">æ¥å£è·¯å¾„</th><th align="left">è¯·æ±‚å‚æ•°</th><th align="left">è¿”å›ç»“æœ</th><th align="left">å¤‡æ³¨</th></tr></thead><tbody><tr><td align="left">è·å–è¯å“åˆ—è¡¨</td><td align="left">GET</td><td align="left">/drugs</td><td align="left">-</td><td align="left">è¯å“åˆ—è¡¨</td><td align="left">åˆ†é¡µè·å–æ‰€æœ‰è¯å“ä¿¡æ¯</td></tr><tr><td align="left">è·å–è¯å“è¯¦æƒ…</td><td align="left">GET</td><td align="left">/drugs/{id}</td><td align="left">id (è¯å“ID)</td><td align="left">è¯å“è¯¦æƒ…</td><td align="left">æ ¹æ®è¯å“IDè·å–è¯å“è¯¦ç»†ä¿¡æ¯</td></tr><tr><td align="left">åˆ›å»ºè¯å“</td><td align="left">POST</td><td align="left">/drugs</td><td align="left">è¯å“ä¿¡æ¯</td><td align="left">åˆ›å»ºæˆåŠŸçš„è¯å“</td><td align="left">åˆ›å»ºæ–°çš„è¯å“</td></tr><tr><td align="left">æ›´æ–°è¯å“</td><td align="left">PUT</td><td align="left">/drugs/{id}</td><td align="left">id (è¯å“ID)</td><td align="left">æ›´æ–°æˆåŠŸçš„è¯å“</td><td align="left">æ ¹æ®è¯å“IDæ›´æ–°è¯å“ä¿¡æ¯</td></tr><tr><td align="left">åˆ é™¤è¯å“</td><td align="left">DELETE</td><td align="left">/drugs/{id}</td><td align="left">id (è¯å“ID)</td><td align="left">åˆ é™¤æˆåŠŸçš„è¯å“</td><td align="left">æ ¹æ®è¯å“IDåˆ é™¤è¯å“</td></tr></tbody></table><ol><li>æ€¥æ•‘æ¨¡å—APIæ¥å£</li></ol><table><thead><tr><th align="left">APIåç§°</th><th align="left">è¯·æ±‚æ–¹å¼</th><th align="left">æ¥å£è·¯å¾„</th><th align="left">è¯·æ±‚å‚æ•°</th><th align="left">è¿”å›ç»“æœ</th><th align="left">å¤‡æ³¨</th></tr></thead><tbody><tr><td align="left">è·å–æ€¥æ•‘ä¿¡æ¯åˆ—è¡¨</td><td align="left">GET</td><td align="left">/emergencies</td><td align="left">-</td><td align="left">æ€¥æ•‘ä¿¡æ¯åˆ—è¡¨</td><td align="left">åˆ†é¡µè·å–æ‰€æœ‰æ€¥æ•‘ä¿¡æ¯</td></tr><tr><td align="left">è·å–æ€¥æ•‘ä¿¡æ¯è¯¦æƒ…</td><td align="left">GET</td><td align="left">/emergencies/{id}</td><td align="left">id (æ€¥æ•‘ä¿¡æ¯ID)</td><td align="left">æ€¥æ•‘ä¿¡æ¯è¯¦æƒ…</td><td align="left">æ ¹æ®æ€¥æ•‘ä¿¡æ¯IDè·å–æ€¥æ•‘ä¿¡æ¯è¯¦ç»†ä¿¡æ¯</td></tr><tr><td align="left">åˆ›å»ºæ€¥æ•‘ä¿¡æ¯</td><td align="left">POST</td><td align="left">/emergencies</td><td align="left">æ€¥æ•‘ä¿¡æ¯</td><td align="left">åˆ›å»ºæˆåŠŸçš„æ€¥æ•‘ä¿¡æ¯</td><td align="left">åˆ›å»ºæ–°çš„æ€¥æ•‘ä¿¡æ¯</td></tr><tr><td align="left">æ›´æ–°æ€¥æ•‘ä¿¡æ¯</td><td align="left">PUT</td><td align="left">/emergencies/{id}</td><td align="left">id (æ€¥æ•‘ä¿¡æ¯ID)</td><td align="left">æ›´æ–°æˆåŠŸçš„æ€¥æ•‘ä¿¡æ¯</td><td align="left">æ ¹æ®æ€¥æ•‘ä¿¡æ¯IDæ›´æ–°æ€¥æ•‘ä¿¡æ¯</td></tr><tr><td align="left">åˆ é™¤æ€¥æ•‘ä¿¡æ¯</td><td align="left">DELETE</td><td align="left">/emergencies/{id}</td><td align="left">id (æ€¥æ•‘ä¿¡æ¯ID)</td><td align="left">åˆ é™¤æˆåŠŸçš„æ€¥æ•‘ä¿¡æ¯</td><td align="left">æ ¹æ®æ€¥æ•‘ä¿¡æ¯IDåˆ é™¤æ€¥æ•‘ä¿¡æ¯</td></tr></tbody></table><ol><li>å¼‚å¸¸åˆ†è¯Šæ¡ˆä¾‹æ¨¡å—APIæ¥å£</li></ol><table><thead><tr><th align="left">APIåç§°</th><th align="left">è¯·æ±‚æ–¹å¼</th><th align="left">æ¥å£è·¯å¾„</th><th align="left">è¯·æ±‚å‚æ•°</th><th align="left">è¿”å›ç»“æœ</th><th align="left">å¤‡æ³¨</th></tr></thead><tbody><tr><td align="left">è·å–å¼‚å¸¸åˆ†è¯Šæ¡ˆä¾‹åˆ—è¡¨</td><td align="left">GET</td><td align="left">/case</td><td align="left">-</td><td align="left">å¼‚å¸¸åˆ†è¯Šæ¡ˆä¾‹åˆ—è¡¨</td><td align="left">åˆ†é¡µè·å–æ‰€æœ‰å¼‚å¸¸åˆ†è¯Šæ¡ˆä¾‹ä¿¡æ¯</td></tr><tr><td align="left">è·å–å¼‚å¸¸åˆ†è¯Šæ¡ˆä¾‹è¯¦æƒ…</td><td align="left">GET</td><td align="left">/case/{id}</td><td align="left">id (æ¡ˆä¾‹ID)</td><td align="left">å¼‚å¸¸åˆ†è¯Šæ¡ˆä¾‹è¯¦æƒ…</td><td align="left">æ ¹æ®æ¡ˆä¾‹IDè·å–å¼‚å¸¸åˆ†è¯Šæ¡ˆä¾‹è¯¦ç»†ä¿¡æ¯</td></tr><tr><td align="left">åˆ›å»ºå¼‚å¸¸åˆ†è¯Šæ¡ˆä¾‹</td><td align="left">POST</td><td align="left">/case</td><td align="left">å¼‚å¸¸åˆ†è¯Šæ¡ˆä¾‹ä¿¡æ¯</td><td align="left">åˆ›å»ºæˆåŠŸçš„å¼‚å¸¸åˆ†è¯Šæ¡ˆä¾‹</td><td align="left">åˆ›å»ºæ–°çš„å¼‚å¸¸åˆ†è¯Šæ¡ˆä¾‹</td></tr><tr><td align="left">æ›´æ–°å¼‚å¸¸åˆ†è¯Šæ¡ˆä¾‹</td><td align="left">PUT</td><td align="left">/case/{id}</td><td align="left">id (æ¡ˆä¾‹ID)</td><td align="left">æ›´æ–°æˆåŠŸçš„å¼‚å¸¸åˆ†è¯Šæ¡ˆä¾‹</td><td align="left">æ ¹æ®æ¡ˆä¾‹IDæ›´æ–°å¼‚å¸¸åˆ†è¯Šæ¡ˆä¾‹ä¿¡æ¯</td></tr><tr><td align="left">åˆ é™¤å¼‚å¸¸åˆ†è¯Šæ¡ˆä¾‹</td><td align="left">DELETE</td><td align="left">/case/{id}</td><td align="left">id (æ¡ˆä¾‹ID)</td><td align="left">åˆ é™¤æˆåŠŸçš„å¼‚å¸¸åˆ†è¯Šæ¡ˆä¾‹</td><td align="left">æ ¹æ®æ¡ˆä¾‹IDåˆ é™¤å¼‚å¸¸åˆ†è¯Šæ¡ˆä¾‹</td></tr><tr><td align="left">è·å–æ¡ˆä¾‹å…³è”ç–¾ç—…åˆ—è¡¨</td><td align="left">GET</td><td align="left">/case/{id}/diseases</td><td align="left">id (æ¡ˆä¾‹ID)</td><td align="left">å…³è”ç–¾ç—…åˆ—è¡¨</td><td align="left">æ ¹æ®æ¡ˆä¾‹IDè·å–å…³è”çš„ç–¾ç—…åˆ—è¡¨</td></tr><tr><td align="left">è·å–æ¡ˆä¾‹å…³è”ç§‘å®¤åˆ—è¡¨</td><td align="left">GET</td><td align="left">/case/{id}/departments</td><td align="left">id (æ¡ˆä¾‹ID)</td><td align="left">å…³è”ç§‘å®¤åˆ—è¡¨</td><td align="left"></td></tr></tbody></table><h3 id="å®‰å…¨æ€§è®¾è®¡"><a href="#å®‰å…¨æ€§è®¾è®¡" class="headerlink" title="å®‰å…¨æ€§è®¾è®¡"></a>å®‰å…¨æ€§è®¾è®¡</h3><p>é’ˆå¯¹æ•æ„Ÿæ•°æ®ï¼Œä¾‹å¦‚è¯å“åç§°ã€ç–¾ç—…åç§°å’Œç—…äººéšç§ä¿¡æ¯ç­‰ï¼Œéœ€è¦å®ç°è®¿é—®æ§åˆ¶å’Œå®‰å…¨ä¿æŠ¤æªæ–½ã€‚åŸºäºè§’è‰²å’Œæƒé™çš„è®¿é—®æ§åˆ¶ï¼Œä»¥åŠå¯¹æ•°æ®çš„åŠ å¯†å’Œè§£å¯†ä¿æŠ¤ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;åˆ†è¯ŠçŸ¥è¯†åº“çš„ç³»ç»Ÿè®¾è®¡&lt;/p&gt;</summary>
    
    
    
    <category term="ä¸ªäººé¡¹ç›®" scheme="https://alexhuihui.github.io/categories/%E4%B8%AA%E4%BA%BA%E9%A1%B9%E7%9B%AE/"/>
    
    
    <category term="è®¾è®¡" scheme="https://alexhuihui.github.io/tags/%E8%AE%BE%E8%AE%A1/"/>
    
  </entry>
  
  <entry>
    <title>ã€LLMã€‘LLMå…¥é—¨</title>
    <link href="https://alexhuihui.github.io/article/20230414.html"/>
    <id>https://alexhuihui.github.io/article/20230414.html</id>
    <published>2023-04-14T11:54:06.000Z</published>
    <updated>2025-01-25T12:47:02.715Z</updated>
    
    <content type="html"><![CDATA[<h3 id="LLMä»‹ç»"><a href="#LLMä»‹ç»" class="headerlink" title="LLMä»‹ç»"></a><code>LLM</code>ä»‹ç»</h3><p>è¯­è¨€æ¨¡å‹åœ¨æœ€è¿‘å‡ å¹´å†…è¿…é€Ÿæé«˜ï¼Œå¤§å‹è¯­è¨€æ¨¡å‹ï¼ˆLLMsï¼‰å¦‚GPT-3å’ŒGPT-4æˆä¸ºä¸­å¿ƒã€‚è¿™äº›æ¨¡å‹å› å…¶èƒ½å¤Ÿä»¥æƒŠäººçš„æŠ€å·§æ‰§è¡Œå„ç§ä»»åŠ¡è€Œå˜å¾—æµè¡Œã€‚æ­¤å¤–ï¼Œéšç€è¿™äº›æ¨¡å‹çš„å‚æ•°æ•°é‡ï¼ˆæ•°åäº¿ï¼ï¼‰å¢åŠ ï¼Œå®ƒä»¬ä¸å¯é¢„æµ‹åœ°è·å¾—äº†æ–°çš„èƒ½åŠ›ã€‚</p><p>åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†æ¢è®¨LLMsã€å®ƒä»¬å¯ä»¥æ‰§è¡Œçš„ä»»åŠ¡ã€å®ƒä»¬çš„ç¼ºç‚¹ä»¥åŠå„ç§æç¤ºå·¥ç¨‹ç­–ç•¥ã€‚</p><span id="more"></span> <h4 id="ä»€ä¹ˆæ˜¯LLMsï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯LLMsï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯LLMsï¼Ÿ"></a>ä»€ä¹ˆæ˜¯LLMsï¼Ÿ</h4><p>LLMsæ˜¯ç¥ç»ç½‘ç»œï¼Œåœ¨å¤§é‡æ–‡æœ¬æ•°æ®ä¸Šè¿›è¡Œäº†è®­ç»ƒã€‚è®­ç»ƒè¿‡ç¨‹ä½¿æ¨¡å‹å­¦ä¹ æ–‡æœ¬ä¸­çš„æ¨¡å¼ï¼ŒåŒ…æ‹¬è¯­æ³•ã€å¥æ³•å’Œè¯æ±‡å…³è”ã€‚è¿™äº›å­¦ä¹ åˆ°çš„æ¨¡å¼è¢«ç”¨äºç”Ÿæˆç±»ä¼¼äººç±»æ–‡å­—ï¼Œä½¿å…¶éå¸¸é€‚åˆè‡ªç„¶è¯­è¨€å¤„ç†ï¼ˆNLPï¼‰ä»»åŠ¡ã€‚</p><h4 id="å“ªäº›LLMå¯ç”¨ï¼Ÿ"><a href="#å“ªäº›LLMå¯ç”¨ï¼Ÿ" class="headerlink" title="å“ªäº›LLMå¯ç”¨ï¼Ÿ"></a>å“ªäº›LLMå¯ç”¨ï¼Ÿ</h4><p>æœ‰å‡ ä¸ªLLMå¯ç”¨ï¼Œå…¶ä¸­GPT-4æœ€å—æ¬¢è¿ã€‚å…¶ä»–æ¨¡å‹åŒ…æ‹¬ LLaMAã€PaLMã€BERT å’Œ T5 ç­‰ç­‰ã€‚æ¯ä¸ªæ¨¡å‹éƒ½æœ‰å…¶ä¼˜ç‚¹å’Œç¼ºç‚¹ï¼Œå¹¶ä¸”ä¸€äº›æ˜¯å¼€æ”¾æ€§ä½¿ç”¨è€Œå…¶ä»–åˆ™åªèƒ½é€šè¿‡APIä½¿ç”¨ã€‚</p><h4 id="LLM-çš„å±€é™æ€§"><a href="#LLM-çš„å±€é™æ€§" class="headerlink" title="LLM çš„å±€é™æ€§"></a>LLM çš„å±€é™æ€§</h4><p>å°½ç®¡è¡¨ç°å‡ºè‰², ä½† LLMS ä¹Ÿå­˜åœ¨ä¸€äº›é™åˆ¶. å…¶ä¸­ä¸€ä¸ªé‡è¦ç¼ºé™·æ˜¯æ— æ³•è¶…è¶Šæç¤ºä¸­æä¾›çš„ä¿¡æ¯è¿›è¡Œæ¨ç†ã€‚æ­¤å¤–ï¼ŒLLMs å¯ä»¥æ ¹æ®å®ƒä»¬æ‰€è®­ç»ƒçš„æ•°æ®ç”Ÿæˆæœ‰åè§çš„æ–‡æœ¬ã€‚æ§åˆ¶ LLMs çš„è¾“å‡ºä¹Ÿå¾ˆå…·æŒ‘æˆ˜æ€§ï¼Œå› æ­¤éœ€è¦ä½¿ç”¨æç¤ºå·¥ç¨‹ç­–ç•¥æ¥å®ç°æ‰€éœ€çš„è¾“å‡ºã€‚ã€‚</p><h3 id="ä½ èƒ½æ‰§è¡Œå“ªäº›ä»»åŠ¡ï¼Ÿ"><a href="#ä½ èƒ½æ‰§è¡Œå“ªäº›ä»»åŠ¡ï¼Ÿ" class="headerlink" title="ä½ èƒ½æ‰§è¡Œå“ªäº›ä»»åŠ¡ï¼Ÿ"></a>ä½ èƒ½æ‰§è¡Œå“ªäº›ä»»åŠ¡ï¼Ÿ</h3><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸ºæ¯ä¸ªæ¡ˆä¾‹æ ¼å¼åŒ–æç¤ºæ¥æŒ‡å¯¼LLMsæ‰§è¡Œç‰¹å®šçš„ä»»åŠ¡ã€‚ä»¥ä¸‹æ˜¯è¿™äº›ä»»åŠ¡å’Œæç¤ºæ¨¡æ¿ä»¥åŠæ¯ä¸ªç¤ºä¾‹çš„åˆ—è¡¨ã€‚</p><h4 id="æ–‡æœ¬æ‘˜è¦"><a href="#æ–‡æœ¬æ‘˜è¦" class="headerlink" title="æ–‡æœ¬æ‘˜è¦"></a>æ–‡æœ¬æ‘˜è¦</h4><p>LLMså¯ä»¥ç”Ÿæˆé•¿æ–‡æœ¬çš„æ‘˜è¦ï¼Œä½¿å†…å®¹æ›´æ˜“äºç†è§£å’Œæ¶ˆåŒ–ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æç¤ºæ¨¡æ¿è¯·æ±‚å¯¹ä¸€æ®µæ–‡å­—è¿›è¡Œæ‘˜è¦ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;Full text&gt;</span><br><span class="line">Summarize the text above: / Explain the text above in &lt;N&gt; sentences:</span><br></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥è¦æ±‚æŒ‰ç…§ä»¥ä¸‹æç¤ºå¯¹è¿™æ®µæ–‡æœ¬è¿›è¡Œæ€»ç»“ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">In a mechanical watch the watch&#x27;s gears are turned by a spiral spring called a mainspring. In a manual watch energy is stored in the mainspring by turning a knob, the crown on the side of the watch. Then the energy from the mainspring powers the watch movement until it runs down, requiring the spring to be wound again.</span><br><span class="line">A self-winding watch movement has a mechanism which winds the mainspring using the natural motions of the wearer&#x27;s body. The watch contains an oscillating weight that turns on a pivot. The normal movements of the watch in the user&#x27;s pocket (for a pocketwatch) or on the user&#x27;s arm (for a wristwatch) cause the rotor to pivot on its staff, which is attached to a ratcheted winding mechanism. The motion of the watch is thereby translated into circular motion of the weight which, through a series of reverser and reducing gears, eventually winds the mainspring. There are many different designs for modern self-winding mechanisms. Some designs allow winding of the watch to take place while the weight swings in only one direction while other, more advanced, mechanisms have two ratchets and wind the mainspring during both clockwise and anti-clockwise weight motions.</span><br><span class="line">Explain the text above in 2 sentences:</span><br></pre></td></tr></table></figure><p>è¿™å°†äº§ç”Ÿä»¥ä¸‹è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">A mechanical watch uses a mainspring to power the movement of the watch&#x27;s gears. In a manual watch, the mainspring is wound by turning a knob, while a self-winding watch uses the natural motion of the wearer&#x27;s body to wind the mainspring through an oscillating weight and ratcheted winding mechanism.</span><br></pre></td></tr></table></figure><h4 id="ä¿¡æ¯æå–"><a href="#ä¿¡æ¯æå–" class="headerlink" title="ä¿¡æ¯æå–"></a>ä¿¡æ¯æå–</h4><p>LLMså¯ä»¥ä»å¤§é‡æ–‡æœ¬ä¸­è¯†åˆ«å’Œæå–ç‰¹å®šä¿¡æ¯ã€‚è¿™åœ¨æ–°é—»å’Œå•†ä¸šæƒ…æŠ¥ç­‰é¢†åŸŸéå¸¸æœ‰ç”¨ã€‚ä»¥ä¸‹æ¨¡æ¿æŒ‡å¯¼æ¨¡å‹æå–ä¿¡æ¯ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;Full text&gt;</span><br><span class="line">Mention X in the text above: / List X in the text above:</span><br></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥è¦æ±‚ä»ä»¥ä¸‹æ–‡æœ¬ä¸­æå–åœ°ç‚¹åç§°ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">The earliest credible evidence for a successful design is the watch made by the Swiss watchmaker Abraham-Louis Perrelet, who lived in Le Locle. In late 1776 or early 1777, he invented a self-winding mechanism for pocket watches using an oscillating weight inside the watch that moved up and down. The Geneva Society of Arts, reporting on this watch in 1777, stated that 15 minutes walking was necessary to fully wind the watch.</span><br><span class="line">List the names of places in the text above:</span><br></pre></td></tr></table></figure><p>è¿™å°†äº§ç”Ÿä»¥ä¸‹è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Le Locle, Geneva.</span><br></pre></td></tr></table></figure><h3 id="é—®ç­”"><a href="#é—®ç­”" class="headerlink" title="é—®ç­”"></a>é—®ç­”</h3><p>LLMsè¿˜å¯ä»¥æ ¹æ®æç¤ºæä¾›çš„ä¿¡æ¯å›ç­”é—®é¢˜ã€‚ä»¥ä¸‹æ¨¡æ¿å¯ç”¨äºæŒ‡å¯¼LLMå›ç­”é—®é¢˜ï¼š</p><p>æ¨¡æ¿</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">åŸºäºä¸‹é¢çš„ä¸Šä¸‹æ–‡å›ç­”é—®é¢˜ã€‚&lt;å…¶ä»–è¯´æ˜&gt;ã€‚å¦‚æœä¸ç¡®å®šï¼Œè¯·å›å¤â€œä¸ç¡®å®šâ€ã€‚</span><br><span class="line">ä¸Šä¸‹æ–‡ï¼š&lt;Context&gt;</span><br><span class="line">Qï¼š&lt;Question&gt;</span><br><span class="line">Aï¼š</span><br></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼Œä½¿ç”¨ä»¥ä¸‹æç¤ºï¼š</p><p>æç¤º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">åŸºäºä¸‹é¢çš„ä¸Šä¸‹æ–‡å›ç­”é—®é¢˜ã€‚ç”¨ä¸€å¥è¯å›ç­”ã€‚å¦‚æœä¸ç¡®å®šï¼Œè¯·å›å¤â€œä¸ç¡®å®šâ€ã€‚</span><br><span class="line">ä¸Šä¸‹æ–‡ï¼šè‡ªåŠ¨è¡¨ä¹Ÿç§°ä¸ºè‡ªåŠ¨ç»•çº¿è¡¨æˆ–ç®€å•åœ°ç§°ä¸ºè‡ªåŠ¨è¡¨ï¼Œæ˜¯ä¸€ç§æœºæ¢°è¡¨ï¼Œåœ¨ä½©æˆ´è€…çš„è‡ªç„¶è¿åŠ¨ä¸­æä¾›èƒ½é‡æ¥ç»•åˆ¶ä¸»å‘æ¡ï¼Œä½¿æ‰‹å·¥ç»•çº¿å˜å¾—ä¸å¿…è¦ã€‚å®ƒä¸æ‰‹åŠ¨è¡¨æœ‰æ‰€åŒºåˆ«ï¼Œå› ä¸ºæ‰‹åŠ¨è¡¨å¿…é¡»å®šæœŸæ‰‹æ‘‡å…¶ä¸»å‘æ¡ã€‚</span><br><span class="line">Qï¼šè‡ªåŠ¨è…•è¡¨éœ€è¦æ‰‹åŠ¨ç»•å—ï¼Ÿ</span><br><span class="line">Aï¼š</span><br></pre></td></tr></table></figure><p>ChatGPT å›åº”é“ï¼š</p><p>è¾“å‡º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">å¦ï¼Œå¦‚æœè¶³å¤Ÿä½©æˆ´ï¼Œåˆ™æ— éœ€æ‰‹åŠ¨ç¼ ç»•è‡ªåŠ¨è…•è¡¨ï¼Œå› ä¸ºä½©æˆ´è€…çš„è‡ªç„¶è¿åŠ¨ä¼šæä¾›èƒ½é‡æ¥ç»´æŒå…¶æ­£å¸¸è¿è½¬ã€‚</span><br></pre></td></tr></table></figure><h4 id="æ–‡æœ¬åˆ†ç±»"><a href="#æ–‡æœ¬åˆ†ç±»" class="headerlink" title="æ–‡æœ¬åˆ†ç±»"></a>æ–‡æœ¬åˆ†ç±»</h4><p>LLMså¯ä»¥å°†æ–‡æœ¬åˆ†ç±»ä¸ºé¢„å®šä¹‰çš„ç±»åˆ«ï¼Œä¾‹å¦‚æƒ…æ„Ÿåˆ†ææˆ–åƒåœ¾é‚®ä»¶æ£€æµ‹ã€‚æ‚¨å¯ä»¥æŒ‰ä»¥ä¸‹æ–¹å¼æ ¼å¼åŒ–æ–‡æœ¬åˆ†ç±»æŒ‡ä»¤ï¼š</p><p>æ¨¡æ¿</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">å°†æ–‡æœ¬åˆ†ç±»ä¸º&lt;é€‰æ‹©åˆ—è¡¨&gt;ï¼š</span><br><span class="line">æ–‡æœ¬ï¼š&lt;å®Œæ•´æ–‡æœ¬&gt;</span><br><span class="line">åˆ†ç±»ï¼š</span><br></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•å¯¹ä¸€æ®µæ–‡å­—è¿›è¡Œæƒ…æ„Ÿåˆ†æï¼Œåˆ¤æ–­å…¶æƒ…ç»ªæ˜¯ç§¯æçš„ã€ä¸­æ€§çš„è¿˜æ˜¯æ¶ˆæçš„ï¼š</p><p>æç¤º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">å°†è¯¥æ®µæ–‡å­—å½’ç±»ä¸ºç§¯æã€ä¸­æ€§æˆ–æ¶ˆæï¼š</span><br><span class="line">æ–‡æœ¬ï¼šé‚£ä¸ªæŠ•ç¯®é€‰æ‹©å¤ªç³Ÿç³•äº†ã€‚</span><br><span class="line">åˆ†ç±»ï¼š</span><br></pre></td></tr></table></figure><p>è¾“å‡º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">æ¶ˆæ</span><br></pre></td></tr></table></figure><h4 id="å¯¹è¯"><a href="#å¯¹è¯" class="headerlink" title="å¯¹è¯"></a>å¯¹è¯</h4><p>LLMå¯ä»¥ç”Ÿæˆç±»ä¼¼äººç±»çš„å¯¹è¯ï¼Œä½¿å®ƒä»¬åœ¨èŠå¤©æœºå™¨äººå’Œå®¢æˆ·æœåŠ¡åº”ç”¨ç¨‹åºä¸­éå¸¸æœ‰ç”¨ã€‚æˆ‘ä»¬å¯ä»¥æŒ‡ç¤ºLLMæŒ‰ç…§ç‰¹å®šæ–¹å¼è·Ÿéšå¯¹è¯è¡ŒåŠ¨ã€‚</p><p>æ¨¡æ¿</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ä»¥ä¸‹æ˜¯ä¸&lt;Actor&gt;çš„å¯¹è¯ã€‚ &lt;Actor&gt;åº”è¯¥å›ç­”&lt;Further instructions&gt;ã€‚</span><br><span class="line">ä¸ªäººï¼š&lt;Conversation&gt;</span><br><span class="line">&lt;Actor&gt;ï¼š&lt;Response&gt;</span><br><span class="line">ä¸ªäººï¼š&lt;Conversation&gt;</span><br><span class="line">&lt;Actor&gt;ï¼š</span><br></pre></td></tr></table></figure><p>LLMå°†å¡«å†™æˆ‘ä»¬æŒ‡ç¤ºå…¶ç±»å‹æ¼”å‘˜çš„å“åº”ï¼Œå¹¶ä¸”æˆ‘ä»¬å¯ä»¥é€šè¿‡å†æ¬¡å°†æ•´ä¸ªä¼šè¯åŠæ–°å“åº”ä¼ é€’ç»™å®ƒæ¥ç»§ç»­ä¼šè¯ã€‚ä¾‹å¦‚ï¼š</p><p>æç¤º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ä»¥ä¸‹æ˜¯ä¸å¾‹å¸ˆçš„å¯¹è¯ã€‚ å¾‹å¸ˆåº”ç®€å•æ˜äº†åœ°å›ç­”ã€‚</span><br><span class="line">ä¸ªäººï¼šæ‚¨å¥½ï¼Œæˆ‘æƒ³çŸ¥é“å¦‚ä½•äº‰è®®åœè½¦ç½šå•</span><br><span class="line">å¾‹å¸ˆï¼š</span><br></pre></td></tr></table></figure><p>è¾“å‡º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">å½“ç„¶ï¼Œæˆ‘èƒ½å¤Ÿæä¾›å¸®åŠ©ã€‚ç¬¬ä¸€æ­¥æ˜¯æ£€æŸ¥ç½šå•æ˜¯å¦å­˜åœ¨ä»»ä½•é”™è¯¯æˆ–å¤±è¯¯ã€‚å¦‚æœå‘ç°ä»»ä½•é—®é¢˜ï¼Œåˆ™å¯ä»¥ä½¿ç”¨è¿™äº›ä½œä¸ºäº‰è®®ç½šæ¬¾çš„ç†ç”±ã€‚å¦‚æœæ²¡æœ‰é”™è¯¯ï¼Œåˆ™ä»ç„¶å¯ä»¥é€šè¿‡æä¾›è¯æ®æ”¯æŒæ‚¨çš„æ¡ˆä»¶ï¼ˆä¾‹å¦‚ç…§ç‰‡æˆ–è¯è¨€ï¼‰æ¥äº‰è®®ç½šæ¬¾ã€‚æ‚¨è¿˜å¯ä»¥è¯·æ±‚å¬è¯ä¼šä»¥äº²è‡ªé™ˆè¿°æ‚¨çš„æ¡ˆä»¶ã€‚</span><br></pre></td></tr></table></figure><p>æç¤º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ä»¥ä¸‹æ˜¯ä¸å¾‹å¸ˆçš„å¯¹è¯ã€‚ å¾‹å¸ˆåº”ç®€å•æ˜äº†åœ°å›ç­”ã€‚</span><br><span class="line">ä¸ªäººï¼šæ‚¨å¥½ï¼Œæˆ‘æƒ³çŸ¥é“å¦‚ä½•äº‰è®®åœè½¦ç½šå•</span><br><span class="line">å¾‹å¸ˆï¼šå½“ç„¶ï¼Œæˆ‘èƒ½å¤Ÿæä¾›å¸®åŠ©ã€‚ç¬¬ä¸€æ­¥æ˜¯æ£€æŸ¥ç½šå•æ˜¯å¦å­˜åœ¨ä»»ä½•é”™è¯¯æˆ–å¤±è¯¯ã€‚å¦‚æœå‘ç°ä»»ä½•é—®é¢˜ï¼Œåˆ™å¯ä»¥ä½¿ç”¨è¿™äº›ä½œä¸ºäº‰è®®ç½šæ¬¾çš„ç†ç”±ã€‚å¦‚æœæ²¡æœ‰é”™è¯¯ï¼Œåˆ™ä»ç„¶å¯ä»¥é€šè¿‡æä¾›è¯æ®æ”¯æŒæ‚¨çš„æ¡ˆä»¶ï¼ˆä¾‹å¦‚ç…§ç‰‡æˆ–è¯è¨€ï¼‰æ¥äº‰è®®ç½šæ¬¾ã€‚æ‚¨è¿˜å¯ä»¥è¯·æ±‚å¬è¯ä¼šä»¥äº²è‡ªé™ˆè¿°æ‚¨çš„æ¡ˆä»¶ã€‚</span><br><span class="line">ä¸ªäººï¼šæˆ‘å¦‚ä½•è¯·æ±‚å¬è¯ä¼šï¼Ÿ</span><br><span class="line">å¾‹å¸ˆï¼š</span><br></pre></td></tr></table></figure><p>è¾“å‡º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">è¦è¯·æ±‚å¬è¯ä¼šï¼Œæ‚¨éœ€è¦æŒ‰ç…§ç¥¨æ®èƒŒé¢æˆ–ç½‘ç«™ä¸Šçš„è¯´æ˜è¿›è¡Œæ“ä½œ</span><br></pre></td></tr></table></figure><h4 id="ä»£ç ç”Ÿæˆ"><a href="#ä»£ç ç”Ÿæˆ" class="headerlink" title="ä»£ç ç”Ÿæˆ"></a>ä»£ç ç”Ÿæˆ</h4><p>LLMså¯ä»¥ç”Ÿæˆä»£ç ï¼Œä½¿å¼€å‘äººå‘˜æ›´å®¹æ˜“åˆ›å»ºå¤æ‚çš„è½¯ä»¶ç¨‹åºã€‚æˆ‘ä»¬å¯ä»¥ç¼–å†™ä¸€ä¸ªä»£ç æ³¨é‡Šæ¥æè¿°æˆ‘ä»¬å¸Œæœ›ä»£ç æ‰§è¡Œçš„æ“ä½œï¼ŒLLMå°†èƒ½å¤Ÿå°½åŠ›å®Œæˆå®ƒã€‚æˆ‘ä»¬å¸Œæœ›ä»£ç æ‰§è¡Œçš„æ“ä½œè¶Šå¤æ‚ï¼Œæˆ‘ä»¬åœ¨æç¤ºæ³¨é‡Šä¸­éœ€è¦æä¾›çš„ä¿¡æ¯å°±è¶Šå…·ä½“å’Œè¯¦ç»†ã€‚</p><p>æ¨¡æ¿å¯èƒ½å› æ‰€éœ€ç”Ÿæˆçš„ç¼–ç¨‹è¯­è¨€è€Œå¼‚ï¼Œä½†æˆ‘å»ºè®®å¤§è‡´éµå¾ªä»¥ä¸‹æ¨¡æ¿ï¼š</p><p>æ¨¡æ¿</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;æ‚¨é€‰æ‹©çš„è¯­è¨€çš„æ³¨é‡Šç¬¦å·ï¼ˆ/*æˆ–&#x27;&#x27;&#x27;æˆ–#ï¼‰&gt;</span><br><span class="line">æ–¹æ³•ï¼š&lt;æ–¹æ³•åç§°&gt;</span><br><span class="line">è¯­è¨€ï¼š&lt;ç¼–ç¨‹è¯­è¨€&gt;</span><br><span class="line">è¯´æ˜ï¼š&lt;æ–¹æ³•å¿…é¡»æ‰§è¡Œä»€ä¹ˆæ“ä½œ&gt;</span><br><span class="line">å‚æ•°ï¼š&lt;æ–¹æ³•å°†æ¥æ”¶å“ªäº›å‚æ•°&gt;</span><br><span class="line">ä¸Šä¸‹æ–‡ï¼š&lt;å®ç°è¯¥æ–¹æ³•æ‰€éœ€è¿›ä¸€æ­¥ä¿¡æ¯ï¼ˆURLã€æ•°æ®åº“ç­‰ï¼‰&gt;</span><br><span class="line">è¾“å‡ºï¼š&lt;è¯¥æ–¹æ³•è¾“å‡ºå†…å®¹&gt;</span><br><span class="line">&lt;æ‚¨é€‰æ‹©çš„è¯­è¨€çš„æ³¨é‡Šç¬¦å·ï¼ˆ/*æˆ–&#x27;&#x27;&#x27;æˆ–#ï¼‰&gt;</span><br></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦è·å–åˆ†é¡µAPIï¼Œåˆ™å¯ä»¥ç¼–å†™ä»¥ä¸‹è¯„è®ºï¼š</p><p>æç¤º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">/* Method: fetchFirst5Pages</span><br><span class="line"> * Language: Javascript</span><br><span class="line"> * Description: Fetch the first 5 pages from this paginated API: http://example.com/pages/?n=x</span><br><span class="line"> * Context: This API accepts the following URL parameters:</span><br><span class="line"> *   n: the number of the page to fetch</span><br><span class="line"> * Output: the content of the first 5 pages</span><br><span class="line"> */</span><br></pre></td></tr></table></figure><p>è¾“å‡º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">è¿™æ˜¯JavaScriptä¸­fetchFirst5Pageså‡½æ•°å®ç°ç¤ºä¾‹ï¼Œå‡è®¾ä½¿ç”¨äº†fetchå‡½æ•°ï¼š</span><br><span class="line"></span><br><span class="line">async function fetchFirst5Pages() &#123;</span><br><span class="line">  const baseUrl = &#x27;http://example.com/pages/?n=&#x27;;</span><br><span class="line">  const pages = [];</span><br><span class="line"></span><br><span class="line">  for (let i = 1; i &lt;= 5; i++) &#123;</span><br><span class="line">    const url = baseUrl + i;</span><br><span class="line">    const response = await fetch(url);</span><br><span class="line"></span><br><span class="line">    if (!response.ok) &#123;</span><br><span class="line">      throw new Error(`Error fetching page $&#123;i&#125;`);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    const pageData = await response.json();</span><br><span class="line">    pages.push(pageData);</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  return pages;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">è¯¥å‡½æ•°ä½¿ç”¨å¾ªç¯é€šè¿‡å°†é¡µç é™„åŠ åˆ°åŸºæœ¬URLæ¥è·å–APIçš„å‰5ä¸ªé¡µé¢ã€‚å®ƒæ£€æŸ¥æœåŠ¡å™¨çš„å“åº”æ˜¯å¦æ­£å¸¸ï¼Œå¦‚æœä¸æ­£å¸¸åˆ™æŠ›å‡ºé”™è¯¯ã€‚ç„¶åï¼Œå®ƒä»å“åº”ä¸­è§£æJSONæ•°æ®å¹¶å°†å…¶æ·»åŠ åˆ°é¡µé¢æ•°ç»„ä¸­ã€‚æœ€åï¼Œå®ƒè¿”å›é¡µé¢æ•°ç»„ã€‚</span><br></pre></td></tr></table></figure><h4 id="æ¨ç†"><a href="#æ¨ç†" class="headerlink" title="æ¨ç†"></a>æ¨ç†</h4><p>æ³•å­¦ç¡•å£«å¯èƒ½ä¼šåœ¨ä¸€äº›åŸºæœ¬ä»»åŠ¡ä¸Šé‡åˆ°å›°éš¾ï¼Œæ¯”å¦‚ç®—æœ¯é—®é¢˜ã€‚ç„¶è€Œï¼Œå¦‚æœæˆ‘ä»¬è¦æ±‚LLMå¯¹å…¶å›ç­”è¿›è¡Œæ¨ç†ï¼Œæˆ‘ä»¬å¯ä»¥å¸®åŠ©å®ƒå¾—å‡ºæ­£ç¡®çš„ç­”æ¡ˆã€‚è¿™æ˜¯æˆ‘æ¨èçš„æ¨¡æ¿ï¼š</p><p>æ¨¡æ¿</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">é—®ï¼š &lt;é—®é¢˜&gt;</span><br><span class="line">ç­”ï¼š è®©æˆ‘ä»¬é€æ­¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œç¡®ä¿æˆ‘ä»¬æœ‰æ­£ç¡®çš„ç­”æ¡ˆã€‚é¦–å…ˆï¼Œ&lt;è¯´æ˜&gt;ã€‚</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå¦‚æœæ²¡æœ‰æ¨ç†å°±æå‡ºä¸€ä¸ªç®€å•çš„ç®—æœ¯é—®é¢˜ï¼Œåˆ™æ— æ³•æˆåŠŸï¼š</p><p>æç¤º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">å›ç­”ä»¥ä¸‹é—®é¢˜ã€‚ å¦‚æœä¸ç¡®å®šç­”æ¡ˆï¼Œè¯·å›å¤â€œä¸ç¡®å®šâ€ã€‚</span><br><span class="line">é—®ï¼šä»¥ä¸‹åˆ—è¡¨ä¸­è´¨æ•°ä¹‹å’Œæ˜¯3çš„å€æ•°ï¼š[2, 4, 6, 7, 9, 14]</span><br><span class="line">A: [æ˜¯æˆ–å¦]</span><br></pre></td></tr></table></figure><p>è¾“å‡º</p><p>ä¸æ˜¯ã€‚ åˆ—è¡¨[2ã€4ã€6ã€7ã€9ã€14]ä¸­è´¨æ•°ä¹‹å’Œä¸æ˜¯3çš„å€æ•°ã€‚ å› æ­¤ï¼Œç­”æ¡ˆä¸ºâ€œå¦â€ã€‚</p><p>ä½†æ˜¯ï¼Œå¦‚æœæŒ‡ç¤ºLLMå¯¹å…¶å›ç­”è¿›è¡Œæ¨ç†ï¼Œåˆ™ä¼šå¾—åˆ°éå¸¸ä¸åŒçš„ç»“æœï¼š</p><p>æç¤º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">é—®ï¼šä»¥ä¸‹åˆ—è¡¨ä¸­è´¨æ•°ä¹‹å’Œæ˜¯å¦ä¸º3çš„å€æ•°ï¼Ÿ [2ã€4ã€6ã€7ã€9ã€14]</span><br><span class="line">A: è®©æˆ‘ä»¬é€æ­¥è§£å†³è¿™ä¸ªé—®é¢˜ä»¥ç¡®ä¿æˆ‘ä»¬æœ‰æ­£ç¡®çš„ç­”æ¡ˆã€‚ é¦–å…ˆæ‰¾åˆ°åˆ—è¡¨ä¸­æ‰€æœ‰è´¨æ•°å¹¶å°†å®ƒä»¬åŠ èµ·æ¥ã€‚ ç„¶åæ£€æŸ¥æ‰€å¾—æ•°å­—æ˜¯å¦å¯ä»¥è¢«3æ•´é™¤ã€‚</span><br></pre></td></tr></table></figure><p>è¾“å‡º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">å¥½å§ï¼Œè¯·è®©æˆ‘ä»¬é€æ­¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</span><br><span class="line"></span><br><span class="line">åˆ—è¡¨ä¸­çš„è´¨æ•°æ˜¯2å’Œ7ã€‚ æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°†å®ƒä»¬åŠ åœ¨ä¸€èµ·ï¼š</span><br><span class="line"></span><br><span class="line">2 + 7 = 9</span><br><span class="line"></span><br><span class="line">ç»“æœä¸º9ã€‚ ç°åœ¨æˆ‘ä»¬éœ€è¦æ£€æŸ¥å®ƒæ˜¯å¦æ˜¯3çš„å€æ•°ã€‚ æˆ‘ä»¬å¯ä»¥é€šè¿‡æ£€æŸ¥9é™¤ä»¥3çš„ä½™æ•°æ˜¯å¦ç­‰äº0æ¥åšåˆ°è¿™ä¸€ç‚¹ï¼š</span><br><span class="line"></span><br><span class="line">9ï¼…3 = 0</span><br><span class="line"></span><br><span class="line">ç”±äºä½™æ•°ä¸º0ï¼Œå› æ­¤æˆ‘ä»¬çŸ¥é“9ç¡®å®æ˜¯3çš„å€æ•°ã€‚</span><br><span class="line"></span><br><span class="line">å› æ­¤ï¼Œç­”æ¡ˆæ˜¯â€œæ˜¯â€ï¼Œåˆ—è¡¨[2ã€4ã€6ã€7ã€9ã€14]ä¸­è´¨æ•°ä¹‹å’Œæ˜¯3çš„å€æ•°ã€‚</span><br></pre></td></tr></table></figure><h4 id="ç­–ç•¥"><a href="#ç­–ç•¥" class="headerlink" title="ç­–ç•¥"></a>ç­–ç•¥</h4><p>è™½ç„¶è¿™äº›æ¨¡æ¿å¯ä»¥å¸®åŠ©æ‚¨æŒ¤å‡ºLLMsçš„æ½œåŠ›ä»¥æ»¡è¶³æ‚¨çš„éœ€æ±‚ï¼Œä½†æœ‰æ—¶å®ƒä»¬ä»ç„¶å¯èƒ½åœ¨æŸäº›å¤æ‚ä»»åŠ¡ä¸Šé‡åˆ°å›°éš¾ã€‚å·²ç»å¼€å‘äº†ä¸€äº›æŠ€æœ¯æ¥å¸®åŠ©LLMså¾—å‡ºä»¤äººæ»¡æ„çš„ç­”æ¡ˆã€‚åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬åªä½¿ç”¨äº†é›¶-shotæç¤ºï¼Œç°åœ¨æˆ‘ä»¬å°†å¯¹å…¶è¿›è¡Œå®šä¹‰ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ›´å¤æ‚çš„æŠ€æœ¯ã€‚</p><h5 id="é›¶-shotæç¤º"><a href="#é›¶-shotæç¤º" class="headerlink" title="é›¶-shotæç¤º"></a>é›¶-shotæç¤º</h5><p>åœ¨æœ¬æ–‡ä¸­çš„æ‰€æœ‰ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬éƒ½ä½¿ç”¨äº†é›¶-shotæç¤ºã€‚é›¶-shotæç¤ºæ„å‘³ç€å‘LLMä¼ é€’ä¸€ä¸ªæç¤ºï¼Œå…¶ä¸­åªåŒ…å«æˆ‘ä»¬æƒ³è¦å®ƒå›ç­”çš„é—®é¢˜ï¼Œå¹¶æ²¡æœ‰ä»»ä½•å…¶ä»–æƒ…å†µä¸‹åº”è¯¥å¦‚ä½•å“åº”çš„ç¤ºä¾‹ã€‚ä¾‹å¦‚ï¼Œåœ¨æ—©æœŸç¤ºä¾‹ä¸­ï¼š</p><p>Prompt</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">å°†æ–‡æœ¬åˆ†ç±»ä¸ºç§¯æã€ä¸­æ€§æˆ–æ¶ˆæï¼š</span><br><span class="line">Text: That shot selection was awful</span><br><span class="line">Classification:</span><br></pre></td></tr></table></figure><p>Output</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Negative</span><br></pre></td></tr></table></figure><p>è¿™å¯èƒ½ä¸è¶³ä»¥è®©æ¨¡å‹å‡†ç¡®åœ°å›ç­”æˆ‘ä»¬æƒ³è¦å®ƒå›ç­”çš„é—®é¢˜ã€‚è®©æˆ‘ä»¬çœ‹çœ‹è¿˜æœ‰å“ªäº›æ›¿ä»£æ–¹æ¡ˆã€‚</p><h5 id="å°‘é‡æ ·æœ¬æç¤º"><a href="#å°‘é‡æ ·æœ¬æç¤º" class="headerlink" title="å°‘é‡æ ·æœ¬æç¤º"></a>å°‘é‡æ ·æœ¬æç¤º</h5><p>ä¸é›¶-shotæç¤ºç›¸åï¼Œåœ¨å°‘é‡æ ·æœ¬æç¤ºä¸­ï¼Œåœ¨æé—®ä¹‹å‰ç»™LLMæä¾›ä¸€äº›å¦‚ä½•å“åº”çš„ç¤ºä¾‹ã€‚ä¾‹å¦‚ï¼Œå‡è®¾æˆ‘ä»¬æƒ³åƒå…ˆå‰ç¤ºä¾‹é‚£æ ·å¯¹æ–‡æœ¬è¿›è¡Œæƒ…æ„Ÿåˆ†ç±»ã€‚ä½†æ˜¯æ¯æ¬¡éƒ½å¸Œæœ›ä»¥éå¸¸ç‰¹å®šæ ¼å¼è·å¾—ç­”æ¡ˆã€‚æˆ‘ä»¬å¯ä»¥äº‹å…ˆç»™å®ƒä¸€äº›ç¤ºä¾‹ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><p>Prompt</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">å°†æ–‡æœ¬åˆ†ç±»ä¸ºç§¯æã€ä¸­æ€§æˆ–æ¶ˆæï¼š</span><br><span class="line">Text: Today the weather is fantastic</span><br><span class="line">Classification: Pos</span><br><span class="line">Text: The furniture is small.</span><br><span class="line">Classification: Neu</span><br><span class="line">Text: I don&#x27;t like your attitude</span><br><span class="line">Classification: Neg</span><br><span class="line">Text: That shot selection was awful</span><br><span class="line">Classification:</span><br></pre></td></tr></table></figure><p>Output</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Neg</span><br></pre></td></tr></table></figure><h5 id="æ€ç»´é“¾æç¤º"><a href="#æ€ç»´é“¾æç¤º" class="headerlink" title="æ€ç»´é“¾æç¤º"></a>æ€ç»´é“¾æç¤º</h5><p>å¯¹äºæ›´å¤æ‚çš„ä»»åŠ¡ï¼Œæˆ‘ä»¬å¯ä»¥å°†å°‘é‡ç¤ºä¾‹æç¤ºä¸ä½¿æ¨¡å‹æ¨ç†å…¶ç­”æ¡ˆç›¸ç»“åˆã€‚ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¹‹å‰çš„ç›¸åŒç¤ºä¾‹æ¥æŸ¥çœ‹æ¨ç†å’Œå°‘é‡æç¤ºå¦‚ä½•å½±å“ç»“æœï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Q: The sum of prime numbers in the following list are a multiple of 3: [2, 4, 6, 7, 9, 14]</span><br><span class="line">A: The prime numbers in the list are 2 and 7. Their sum is 9. 9 % 3 = 0. The answer is yes.</span><br><span class="line">Q: The sum of prime numbers in the following list are a multiple of 3: [1, 2, 4, 7, 8, 10]</span><br><span class="line">A: The prime numbers in the list are 1, 2 and 7. Their sum is 10. 10 % 3 = 1. The answer is no.</span><br><span class="line">Q: The sum of prime numbers in the following list are a multiple of 3: [1, 2, 3, 4]</span><br><span class="line">A: The prime numbers in the list are 1, 2 and 3. Their sum is 6. 6 % 3 = 0. The answer is yes.</span><br><span class="line">Q: The sum of prime numbers in the following list are a multiple of 3: [5, 6, 7, 8]</span><br><span class="line">A:</span><br><span class="line">The prime numbers in the list are 5 and 7. Their sum is 12. 12 % 3 = 0. The answer is yes.</span><br></pre></td></tr></table></figure><h3 id="æœ€åçš„æ³¨é‡Š"><a href="#æœ€åçš„æ³¨é‡Š" class="headerlink" title="æœ€åçš„æ³¨é‡Š"></a>æœ€åçš„æ³¨é‡Š</h3><p>LLMå·²ç»å½»åº•æ”¹å˜äº†è‡ªç„¶è¯­è¨€å¤„ç†é¢†åŸŸï¼Œä½†ä¸ºäº†æœ€å¤§åŒ–å…¶æ½œåŠ›ï¼Œæç¤ºå·¥ç¨‹è‡³å…³é‡è¦ã€‚é€šè¿‡ç†è§£LLMå¯ä»¥æ‰§è¡Œçš„ä»»åŠ¡ã€å®ƒä»¬çš„ç¼ºç‚¹ä»¥åŠå„ç§æç¤ºå·¥ç¨‹ç­–ç•¥ï¼Œå¼€å‘äººå‘˜å¯ä»¥åˆ©ç”¨LLMçš„èƒ½åŠ›æ¥åˆ›å»ºåˆ›æ–°å’Œæœ‰æ•ˆçš„è§£å†³æ–¹æ¡ˆã€‚æœªæ¥å¯èƒ½ä¼šå¼€å‘æ›´å¤šçš„ç­–ç•¥å’ŒæŠ€æœ¯ï¼Œå› æ­¤è¯·ç»§ç»­å…³æ³¨è¿™ä¸ªé¢†åŸŸçš„è¿›å±•ï¼Œä»¥è¿›ä¸€æ­¥æœ€å¤§åŒ–LLMæ½œåŠ›ã€‚æ­¤å¤–ï¼Œéšç€LLMså‚æ•°æ•°é‡ä¸æ–­å¢åŠ åˆ°æ•°åäº¿çº§åˆ«ï¼Œæˆ‘ä»¬ç°åœ¨ç”šè‡³æ— æ³•æƒ³è±¡æ›´å¤šä»»åŠ¡å°†æœ‰å¯èƒ½è¢«å®ç°ã€‚æƒ³åˆ°ä½¿ç”¨è¿™äº›æ–°å·¥å…·æ‰€èƒ½å®ç°ä»€ä¹ˆæ ·å­ä»¥åŠå®ƒä»¬å°†ä¸ºæˆ‘ä»¬æœåŠ¡äºå“ªäº›ç”¨ä¾‹æ˜¯éå¸¸ä»¤äººå…´å¥‹çš„äº‹æƒ…ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;h3 id=&quot;LLMä»‹ç»&quot;&gt;&lt;a href=&quot;#LLMä»‹ç»&quot; class=&quot;headerlink&quot; title=&quot;LLMä»‹ç»&quot;&gt;&lt;/a&gt;&lt;code&gt;LLM&lt;/code&gt;ä»‹ç»&lt;/h3&gt;&lt;p&gt;è¯­è¨€æ¨¡å‹åœ¨æœ€è¿‘å‡ å¹´å†…è¿…é€Ÿæé«˜ï¼Œå¤§å‹è¯­è¨€æ¨¡å‹ï¼ˆLLMsï¼‰å¦‚GPT-3å’ŒGPT-4æˆä¸ºä¸­å¿ƒã€‚è¿™äº›æ¨¡å‹å› å…¶èƒ½å¤Ÿä»¥æƒŠäººçš„æŠ€å·§æ‰§è¡Œå„ç§ä»»åŠ¡è€Œå˜å¾—æµè¡Œã€‚æ­¤å¤–ï¼Œéšç€è¿™äº›æ¨¡å‹çš„å‚æ•°æ•°é‡ï¼ˆæ•°åäº¿ï¼ï¼‰å¢åŠ ï¼Œå®ƒä»¬ä¸å¯é¢„æµ‹åœ°è·å¾—äº†æ–°çš„èƒ½åŠ›ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†æ¢è®¨LLMsã€å®ƒä»¬å¯ä»¥æ‰§è¡Œçš„ä»»åŠ¡ã€å®ƒä»¬çš„ç¼ºç‚¹ä»¥åŠå„ç§æç¤ºå·¥ç¨‹ç­–ç•¥ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="LLM" scheme="https://alexhuihui.github.io/categories/LLM/"/>
    
    
    <category term="LLM" scheme="https://alexhuihui.github.io/tags/LLM/"/>
    
  </entry>
  
  <entry>
    <title>ã€é¡¹ç›®ã€‘å‡çº§ç°æœ‰çš„æˆæƒç³»ç»Ÿ</title>
    <link href="https://alexhuihui.github.io/article/20230411.html"/>
    <id>https://alexhuihui.github.io/article/20230411.html</id>
    <published>2023-04-11T11:45:55.000Z</published>
    <updated>2025-01-25T12:51:42.459Z</updated>
    
    <content type="html"><![CDATA[<p>ç°æœ‰çš„æˆæƒç³»ç»Ÿå·²æ— æ³•æ»¡è¶³å¯¹ä¸šåŠ¡çš„æ”¯æŒï¼Œæ‰€ä»¥æœ‰å¿…è¦é’ˆå¯¹æˆæƒç³»ç»Ÿè¿›è¡Œä¸€æ¬¡å‡çº§ã€‚åœ¨å‡çº§ä¹‹å‰å…ˆè¯¦ç»†æ‹†è§£ä¸€ä¸‹ä¹‹å‰çš„æˆæƒç³»ç»Ÿã€‚</p><span id="more"></span> <h3 id="æ—§çš„æˆæƒç³»ç»Ÿ"><a href="#æ—§çš„æˆæƒç³»ç»Ÿ" class="headerlink" title="æ—§çš„æˆæƒç³»ç»Ÿ"></a>æ—§çš„æˆæƒç³»ç»Ÿ</h3><h4 id="è¯¦æƒ…"><a href="#è¯¦æƒ…" class="headerlink" title="è¯¦æƒ…"></a>è¯¦æƒ…</h4><p>è®¤è¯ç³»ç»Ÿè´Ÿè´£é¢å‘ä»¤ç‰Œï¼Œç³»ç»Ÿä¸€å…±æ‹¥æœ‰3ç§ç±»å‹çš„ç”¨æˆ·ï¼Œåˆ†åˆ«æ˜¯æ™®é€šç”¨æˆ·ã€ç³»ç»Ÿç”¨æˆ·å’Œå¾®æœåŠ¡ã€‚å…¶ä¸­æ™®é€šç”¨æˆ·å’Œç³»ç»Ÿç”¨æˆ·éƒ½æ˜¯å…±ç”¨çš„åŒä¸€ç§ç±»å‹çš„<code>token</code>ï¼Œå«åš<code>UserToken</code>ï¼Œå¾®æœåŠ¡ä½¿ç”¨çš„æ˜¯<code>ClientToken</code>ã€‚è¿™ä¸¤ç§ä¸åŒç±»å‹çš„<code>token</code>åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­ä½¿ç”¨ä¸åŒçš„è¯·æ±‚å¤´è¿›è¡Œå­˜å‚¨ï¼Œå½“å¾®æœåŠ¡ä¹‹é—´äº’ç›¸è°ƒç”¨çš„æ—¶å€™ï¼Œä¼šæœ‰ä¸€ä¸ª<code>feign</code>æ‹¦æˆªå™¨è´Ÿè´£æŠŠå½“å‰çº¿ç¨‹ä¸­çš„ç”¨æˆ·<code>token</code>å’Œæœ¬èº«çš„å¾®æœåŠ¡<code>token</code>ï¼Œå­˜å…¥åˆ°å¯¹åº”çš„è¯·æ±‚å¤´ä¸­ã€‚å‘é€<code>mq</code>æ—¶ï¼Œä¹Ÿæ˜¯é‡‡ç”¨äº†ç±»ä¼¼çš„æœºåˆ¶è¿›è¡Œä¼ é€’<code>token</code>ã€‚å°¤å…¶è¦æ³¨æ„çš„æ˜¯åœ¨åªæœ‰å¾®æœåŠ¡<code>token</code>æ—¶å¹¶ä¸”<code>CheckUserToken</code>æ³¨è§£ä¸ä¸ºç©ºæ—¶ï¼Œæ‹¦æˆªå™¨ä¼šæŠŠå¾®æœåŠ¡çš„ä¿¡æ¯è½¬æ¢æˆç”¨æˆ·ä¿¡æ¯å­˜å‚¨åˆ°å®‰å…¨ä¸Šä¸‹æ–‡ä¸­ï¼Œä½†ä¸ä¼šè®¾ç½®ç”¨æˆ·<code>token</code>ã€‚</p><h4 id="æµç¨‹å›¾"><a href="#æµç¨‹å›¾" class="headerlink" title="æµç¨‹å›¾"></a>æµç¨‹å›¾</h4><p><a href="https://raw.githubusercontent.com/Alexhuihui/photo/main/20230411141752.png"><img src="https://raw.githubusercontent.com/Alexhuihui/photo/main/20230411141752.png" alt="img"></a></p><h4 id="æ—§ç³»ç»Ÿçš„ç—›ç‚¹"><a href="#æ—§ç³»ç»Ÿçš„ç—›ç‚¹" class="headerlink" title="æ—§ç³»ç»Ÿçš„ç—›ç‚¹"></a>æ—§ç³»ç»Ÿçš„ç—›ç‚¹</h4><ul><li>æ— æ³•åšåˆ°é’ˆå¯¹æ¯ä¸ªæ¥å£è¿›è¡Œè®¿é—®æ§åˆ¶</li><li>æ²¡æœ‰<code>token</code>ç»­æœŸåŠŸèƒ½ï¼Œç”¨æˆ·ä½“éªŒä¸å¥½</li><li>æ²¡æœ‰èƒ½åŠ›æä¾›ç»™å¤–éƒ¨ç³»ç»Ÿä¸æˆ‘ä»¬è¿›è¡Œå¯¹æ¥</li></ul><h3 id="æ–°çš„æˆæƒç³»ç»Ÿ"><a href="#æ–°çš„æˆæƒç³»ç»Ÿ" class="headerlink" title="æ–°çš„æˆæƒç³»ç»Ÿ"></a>æ–°çš„æˆæƒç³»ç»Ÿ</h3><h4 id="å¯¹æ¯ä¸ªæ¥å£è¿›è¡Œè®¿é—®æ§åˆ¶"><a href="#å¯¹æ¯ä¸ªæ¥å£è¿›è¡Œè®¿é—®æ§åˆ¶" class="headerlink" title="å¯¹æ¯ä¸ªæ¥å£è¿›è¡Œè®¿é—®æ§åˆ¶"></a>å¯¹æ¯ä¸ªæ¥å£è¿›è¡Œè®¿é—®æ§åˆ¶</h4><h5 id="æˆæƒè¿‡ç¨‹"><a href="#æˆæƒè¿‡ç¨‹" class="headerlink" title="æˆæƒè¿‡ç¨‹"></a>æˆæƒè¿‡ç¨‹</h5><p>åœ¨å®é™…çš„æˆæƒè¿‡ç¨‹ä¸­ï¼Œå¯ä»¥åœ¨è¯·æ±‚åˆ°è¾¾æ¥å£ä¹‹å‰ï¼Œä½¿ç”¨æ‹¦æˆªå™¨æ¥è¿›è¡Œèº«ä»½éªŒè¯å’Œæˆæƒå¤„ç†ã€‚åœ¨æ‹¦æˆªå™¨ä¸­ï¼Œé¦–å…ˆä»è¯·æ±‚å¤´ä¸­è·å–<code>Token</code>ï¼Œå¦‚æœ<code>Token</code>ä¸å­˜åœ¨ï¼Œåˆ™è¿”å›â€œæœªæˆæƒâ€çš„é”™è¯¯ä¿¡æ¯ã€‚</p><p>å¦‚æœ<code>Token</code>å­˜åœ¨ï¼Œåˆ™ä½¿ç”¨<code>JWT</code>å¯¹<code>Token</code>è¿›è¡Œè§£å¯†å’ŒéªŒè¯ï¼Œå¦‚æœè§£å¯†å’ŒéªŒè¯æˆåŠŸï¼Œåˆ™ä»<code>Token</code>ä¸­è·å–ç”¨æˆ·ä¿¡æ¯å’Œè®¿é—®æƒé™ä¿¡æ¯ï¼Œå¹¶å°†å®ƒä»¬å­˜å‚¨åœ¨<code>ThreadLocal</code>ä¸­ï¼Œä»¥ä¾¿åœ¨æ•´ä¸ªè¯·æ±‚å¤„ç†è¿‡ç¨‹ä¸­å¯ä»¥æ–¹ä¾¿åœ°è®¿é—®å®ƒä»¬ã€‚</p><p>æœ€åï¼Œåœ¨è¯·æ±‚å¤„ç†å®Œæˆåï¼Œæ¸…é™¤<code>ThreadLocal</code>ä¸­å­˜å‚¨çš„ä¿¡æ¯ï¼Œä»¥é¿å…å¯¹ä¸‹ä¸€ä¸ªè¯·æ±‚äº§ç”Ÿå¹²æ‰°ã€‚</p><h5 id="æµç¨‹å›¾-1"><a href="#æµç¨‹å›¾-1" class="headerlink" title="æµç¨‹å›¾"></a>æµç¨‹å›¾</h5><p><a href="https://raw.githubusercontent.com/Alexhuihui/photo/main/20230414105016.png"><img src="https://raw.githubusercontent.com/Alexhuihui/photo/main/20230414105016.png" alt="img"></a></p><h4 id="Tokenç»­æœŸ"><a href="#Tokenç»­æœŸ" class="headerlink" title="Tokenç»­æœŸ"></a><code>Token</code>ç»­æœŸ</h4><h5 id="Tokenåˆ·æ–°æœºåˆ¶"><a href="#Tokenåˆ·æ–°æœºåˆ¶" class="headerlink" title="Tokenåˆ·æ–°æœºåˆ¶"></a><code>Token</code>åˆ·æ–°æœºåˆ¶</h5><p><code>JWT Token</code>è‡ªåŠ¨åˆ·æ–°æœºåˆ¶éœ€è¦åœ¨å‰ç«¯å’Œåç«¯åŒæ—¶å®ç°ã€‚</p><p>åœ¨æ¯æ¬¡è¯·æ±‚çš„è¿”å›ä¸­éƒ½æ£€æŸ¥ token æ˜¯å¦å¿«è¿‡æœŸï¼Œå¦‚æœä¸´è¿‘è¿‡æœŸå°±åˆ·æ–° tokenï¼Œå¹¶ä¸”åœ¨ response çš„ header ä¸­è¿”å›ç»™å‰ç«¯ã€‚å‰ç«¯å¯ä»¥é€šè¿‡è¯»å–å“åº” header ä¸­çš„ token æ¥æ›´æ–°æœ¬åœ°çš„ tokenã€‚</p><p>å…·ä½“å®ç°å¯ä»¥åœ¨åç«¯çš„æ‹¦æˆªå™¨ä¸­æ·»åŠ ä¸€ä¸ªé€»è¾‘ï¼Œåœ¨æ¯æ¬¡è¯·æ±‚è¿”å›æ—¶æ£€æŸ¥ token æ˜¯å¦å¿«è¿‡æœŸï¼Œå¦‚æœæ˜¯ï¼Œåˆ™è¿›è¡Œ token çš„åˆ·æ–°ã€‚åŒæ—¶ï¼Œå°†æ–°çš„ token æ”¾å…¥ response çš„ header ä¸­è¿”å›ç»™å‰ç«¯ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¼ªä»£ç </span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TokenRefreshInterceptor</span> <span class="keyword">implements</span> <span class="title">HandlerInterceptor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> TokenProvider tokenProvider;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">TokenRefreshInterceptor</span><span class="params">(TokenProvider tokenProvider)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.tokenProvider = tokenProvider;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// æ£€æŸ¥ token æ˜¯å¦éœ€è¦åˆ·æ–°</span></span><br><span class="line">        String token = tokenProvider.resolveToken(request);</span><br><span class="line">        <span class="keyword">if</span> (token != <span class="keyword">null</span> &amp;&amp; tokenProvider.isTokenNeedRefresh(token)) &#123;</span><br><span class="line">            <span class="comment">// åˆ·æ–° token</span></span><br><span class="line">            String newToken = tokenProvider.refreshToken(token);</span><br><span class="line">            <span class="comment">// å°†æ–°çš„ token æ”¾å…¥å“åº” header ä¸­</span></span><br><span class="line">            response.setHeader(<span class="string">&quot;Authorization&quot;</span>, <span class="string">&quot;Bearer &quot;</span> + newToken);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="æµç¨‹å›¾-2"><a href="#æµç¨‹å›¾-2" class="headerlink" title="æµç¨‹å›¾"></a>æµç¨‹å›¾</h5><p><a href="https://raw.githubusercontent.com/Alexhuihui/photo/main/20230414134806.png"><img src="https://raw.githubusercontent.com/Alexhuihui/photo/main/20230414134806.png" alt="img"></a>c</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;ç°æœ‰çš„æˆæƒç³»ç»Ÿå·²æ— æ³•æ»¡è¶³å¯¹ä¸šåŠ¡çš„æ”¯æŒï¼Œæ‰€ä»¥æœ‰å¿…è¦é’ˆå¯¹æˆæƒç³»ç»Ÿè¿›è¡Œä¸€æ¬¡å‡çº§ã€‚åœ¨å‡çº§ä¹‹å‰å…ˆè¯¦ç»†æ‹†è§£ä¸€ä¸‹ä¹‹å‰çš„æˆæƒç³»ç»Ÿã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="ä¸ªäººé¡¹ç›®" scheme="https://alexhuihui.github.io/categories/%E4%B8%AA%E4%BA%BA%E9%A1%B9%E7%9B%AE/"/>
    
    
    <category term="æˆæƒ" scheme="https://alexhuihui.github.io/tags/%E6%8E%88%E6%9D%83/"/>
    
  </entry>
  
</feed>
