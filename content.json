[{"title":"ã€æ•…éšœæ’æŸ¥ã€‘SSH è¿æ¥GitHubå¤±æ•ˆ","date":"2025-04-21T09:03:59.000Z","path":"article/20250421.html","text":"Git SSH æ— æ³•è¿æ¥ GitHub çš„æ’æŸ¥ä¸ä»£ç†é…ç½®ï¼ˆClash ç¯å¢ƒï¼‰åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œä½¿ç”¨ Git SSH è¿æ¥ GitHub æ˜¯å¸¸è§çš„æ“ä½œï¼Œæœ€è¿‘åœ¨æœ¬åœ°å¼€å‘ä¸­å°±é‡åˆ°äº†ç±»ä¼¼çš„é—®é¢˜ï¼Œæ‰§è¡Œ git pull æŠ¥é”™ï¼š 1ssh: connect to host ssh.github.com port 443: Connection refused æ’æŸ¥æ–¹å‘ï¼ˆå®¢æˆ·ç«¯é…ç½®ã€SSH ä½¿ç”¨æ–¹å¼ã€æœ¬åœ°ç½‘ç»œã€ä»£ç†ç­‰ç»´åº¦ï¼‰ä¸€ã€å®¢æˆ·ç«¯é…ç½®æ£€æŸ¥ æ˜¯ä½¿ç”¨ SSH åè®®è¿˜æ˜¯ HTTPSï¼Ÿ é€šè¿‡ git remote -v æŸ¥çœ‹è¿œç¨‹åœ°å€æ˜¯å¦ä¸º git@github.com:xxxï¼ˆSSHï¼‰ æœ¬åœ°æ˜¯å¦å­˜åœ¨ SSH Keyï¼ŸGitHub æ˜¯å¦é…ç½®äº†å…¬é’¥ï¼Ÿ æ£€æŸ¥ ~/.ssh/id_rsa.pubï¼Œå¹¶ç¡®è®¤ GitHub è®¾ç½®ä¸­æ·»åŠ äº†å¯¹åº”çš„ SSH å…¬é’¥ SSH é…ç½®æ–‡ä»¶ ~/.ssh/config æ˜¯å¦æœ‰è¯¯ï¼Ÿ äºŒã€GitHub SSH æœåŠ¡æ˜¯å¦å¯ç”¨ğŸ“¡ ä½¿ç”¨ telnet æˆ– nc æµ‹è¯•æ˜¯å¦èƒ½è®¿é—® ssh.github.com:4431nc -vz ssh.github.com 443 å¦‚æœæ˜¾ç¤ºè¿æ¥å¤±è´¥ï¼Œæœ‰å¯èƒ½æ˜¯è¢«é˜²ç«å¢™æ‹¦æˆªæˆ–ç½‘ç»œé™åˆ¶ã€‚ ä¸‰ã€æœ¬åœ°ç½‘ç»œæˆ–ä»£ç†é—®é¢˜Clash æ˜¯å¦å·²å¼€å¯ï¼ŸClash æ˜¯æœ¬åœ°ä»£ç†å·¥å…·ï¼Œé€šå¸¸è¿è¡Œåœ¨ 127.0.0.1:7890ï¼ˆHTTPï¼‰æˆ– 7897ï¼ˆSOCKS5ï¼‰ï¼Œå¯ä»¥ä»£ç†æ‰€æœ‰å‡ºç«™æµé‡ã€‚ è‹¥æœªå¼€å¯æˆ–æœªå¯ç”¨ç³»ç»Ÿä»£ç†ï¼Œåˆ™ Git SSH ä¸ä¼šè‡ªåŠ¨èµ°ä»£ç†ã€‚ å››ã€é…ç½® SSH ä½¿ç”¨ Clash çš„ SOCKS5 ä»£ç†ä¸ºäº†è§£å†³ SSH è¿æ¥æ— æ³•é€šè¿‡ç½‘ç»œç›´è¿ GitHub çš„é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ ProxyCommand æ–¹å¼ï¼Œé…ç½® Git çš„ SSH ä½¿ç”¨ Clash çš„ä»£ç†ã€‚ âœ… æ¨èä½¿ç”¨ connect.exe ä½œä¸ºä»£ç†å·¥å…· Git è‡ªå¸¦ï¼š ä¿®æ”¹ ~/.ssh/config æ–‡ä»¶å¦‚ä¸‹ï¼š 123456789101112131415Host github.com HostName ssh.github.com Port 443 User git IdentityFile ~/.ssh/id_rsa TCPKeepAlive yes ProxyCommand &quot;C:\\Program Files\\Git\\mingw64\\bin\\connect.exe&quot; -S 127.0.0.1:7897 -a none %h %pHost ssh.github.com HostName ssh.github.com Port 443 User git IdentityFile ~/.ssh/id_rsa TCPKeepAlive yes ProxyCommand &quot;C:\\Program Files\\Git\\mingw64\\bin\\connect.exe&quot; -S 127.0.0.1:7897 -a none %h %p è¿™é‡ŒæŒ‡å®šäº†é€šè¿‡ Clash çš„æœ¬åœ° SOCKS5 ä»£ç†ï¼ˆ127.0.0.1:7897ï¼‰è¿æ¥ GitHub çš„ SSH æœåŠ¡å™¨ã€‚ äº”ã€éªŒè¯è¿æ¥æ˜¯å¦æˆåŠŸ1ssh -T git@github.com å¦‚æœè¾“å‡ºï¼š 1Hi your-username! You&#x27;ve successfully authenticated... æ€»ç»“ä¸å»ºè®® å¦‚æœä½ ç”¨çš„æ˜¯ SSH åè®®ï¼ˆgit@github.comï¼‰ï¼Œå°±éœ€è¦é…ç½® SSH çš„ ProxyCommand æ‰èƒ½èµ°ä»£ç†ã€‚ æ¨èä½¿ç”¨ connect.exe å·¥å…·ï¼Œå…¼å®¹æ€§æ›´å¥½ã€‚ å¦‚æœä½ ä¹Ÿé‡åˆ° Git SSH æ— æ³•è¿æ¥çš„é—®é¢˜ï¼Œä¸å¦¨å‚è€ƒä»¥ä¸Šæ–¹å¼é…ç½®ä»£ç†ï¼Œå¤§æ¦‚ç‡å°±èƒ½è§£å†³äº†ã€‚","tags":[{"name":"æ•…éšœæ’æŸ¥","slug":"æ•…éšœæ’æŸ¥","permalink":"https://alexhuihui.github.io/tags/%E6%95%85%E9%9A%9C%E6%8E%92%E6%9F%A5/"},{"name":"ssh","slug":"ssh","permalink":"https://alexhuihui.github.io/tags/ssh/"}]},{"title":"ã€æ•…éšœæ’æŸ¥ã€‘ä¸ƒç‰›äº‘ä¸Šä¼ é—®é¢˜æ’æŸ¥","date":"2025-04-16T08:54:53.000Z","path":"article/20250416.html","text":"ä¸ƒç‰›äº‘ä¸Šä¼ é—®é¢˜æ’æŸ¥åœ¨ä¸€ä¸ªå•†åŸçš„åº”ç”¨ä¸­é‡åˆ°äº†æ–‡ä»¶ä¸Šä¼ ç¼“æ…¢çš„é—®é¢˜ï¼Œæ¯”å¦‚ä¸Šä¼ ä¸€ä¸ª 3M çš„å›¾ç‰‡ï¼Œå±…ç„¶è€—æ—¶2åˆ†é’Ÿã€‚è¿™æ˜æ˜¾æ˜¯æœ‰é—®é¢˜çš„ï¼Œæ¥ä¸‹æ¥æ˜¯æ’æŸ¥çš„æµç¨‹ã€‚ æ’æŸ¥æ–¹å‘ï¼ˆåˆ†æœåŠ¡ç«¯ã€æœ¬åœ°å®¢æˆ·ç«¯ã€ç½‘ç»œã€ä¸ƒç‰›é…ç½®ç­‰ç»´åº¦ï¼‰ä¸€ã€å®¢æˆ·ç«¯ä»£ç é—®é¢˜ æœ‰æ²¡æœ‰ä½¿ç”¨ InputStream å¼‚å¸¸è€—æ—¶çš„å†™æ³•ï¼Ÿï¼ˆæ¯”å¦‚è¯»å–æµç‰¹åˆ«æ…¢ã€é˜»å¡ï¼‰ æ–‡ä»¶æ˜¯ä¸´æ—¶ç”Ÿæˆçš„å—ï¼Ÿï¼ˆä¸´æ—¶æ–‡ä»¶ç”Ÿæˆç¼“æ…¢ï¼‰ æœ‰æ²¡æœ‰å¯¹ fileBytes åš base64 ç¼–ç ç­‰å¤šä½™å¤„ç†ï¼Ÿ äºŒã€ç½‘ç»œé—®é¢˜ğŸ“¡ æœåŠ¡ç«¯åˆ°ä¸ƒç‰›çš„ç½‘ç»œå»¶è¿Ÿå¤§æˆ–è€…å¸¦å®½ä¸è¶³ï¼Ÿ1traceroute upload.qiniup.com ä¸‰ã€ä¸ƒç‰›äº‘é…ç½®æ˜¯å¦å¼‚å¸¸ï¼ˆæ¯”å¦‚ bucket ç»‘å®šäº†è¾ƒè¿œçš„å­˜å‚¨åŒºåŸŸï¼‰Region è®¾ç½®æ˜¯å¦æ­£ç¡®ï¼Ÿä¸ƒç‰›æœ‰å¤šä¸ªåŒºåŸŸï¼Œæ¯”å¦‚åä¸œã€ååŒ—ã€åå—ã€åŒ—ç¾ã€‚åº”è¯¥è®¾ç½®ä¸æœåŠ¡å™¨ç‰©ç†ä½ç½®æœ€æ¥è¿‘çš„ï¼š 1Configuration cfg = new Configuration(Region.huabei()); // ååŒ— å››ã€æ’æŸ¥ä¸Šä¼ è¿‡ç¨‹æ—¥å¿—æ‰“å¼€è¯¦ç»†æ—¥å¿—ï¼š ä¸ƒç‰› SDK æ”¯æŒå¼€å¯ debug æ¨¡å¼ï¼ˆè¾“å‡ºæ—¥å¿—ï¼‰ åœ¨æœåŠ¡ç«¯è®°å½•ä¸Šä¼ è€—æ—¶ï¼šä»æ¥æ”¶åˆ°æ–‡ä»¶ â†’ ä¸Šä¼ å®Œæˆ çš„æ•´ä½“è€—æ—¶ 1234long start = System.currentTimeMillis();// ä¸Šä¼ é€»è¾‘long end = System.currentTimeMillis();System.out.println(&quot;ä¸Šä¼ è€—æ—¶: &quot; + (end - start) + &quot;ms&quot;); ä¿®å¤ä»£ç  ä½¿ç”¨ byte[] ä¸Šä¼  é…ç½®ç›¸è¿‘çš„ä¸Šä¼ åŒºåŸŸ ä»¥ä¸Šæ”¹åŠ¨éƒ½æ²¡æœ‰ä¼˜åŒ–ä¸Šä¼ é€Ÿåº¦ï¼Œæ€€ç–‘æ˜¯ç½‘ç»œå‡ºé—®é¢˜äº† æ’æŸ¥ç½‘ç»œé—®é¢˜é€šè¿‡ ping ç­‰å·¥å…·å‘ç°å»¶è¿Ÿå’Œä¸¢åŒ…æƒ…å†µæ˜¯éå¸¸å¥åº·çš„ï¼Œç´§æ¥ç€ä½¿ç”¨iperf3æµ‹è¯•å¸¦å®½ A æœåŠ¡å™¨è¿è¡Œ 1iperf3 -s B æœåŠ¡å™¨è¿è¡Œ 1iperf3 -c &lt;server-ip&gt; -R # æµ‹è¯•ä¸Šä¼ å¸¦å®½ å‘ç°ä¸Šè¡Œé€Ÿåº¦ç¡®å®å¾ˆæ…¢ ä¸ºäº†æ›´è¿›ä¸€æ­¥çš„ç¡®è®¤ åˆä½¿ç”¨ nload æŸ¥çœ‹å…·ä½“ç½‘å¡çš„å®æ—¶ä¸Šä¼ é€Ÿç‡ å‘ç°åœ¨ä¸Šä¼ æ–‡ä»¶çš„æ—¶å€™ å¯¹åº”ç½‘å¡çš„ä¸Šä¼ é€Ÿåº¦åªæœ‰ å‡ å kBit/s é‚£ä¹ˆå°±ç¡®å®šæ˜¯å¸¦å®½ä¸è¶³çš„é—®é¢˜äº† è§£å†³é—®é¢˜ ç¡®è®¤æ˜¯ä¸æ˜¯ docker é™åˆ¶äº†é€Ÿç‡ 1docker inspect file-prod | grep -i bandwidth ç¡®è®¤æ˜¯ä¸æ˜¯äº‘æœåŠ¡å™¨çš„ä¸Šè¡Œå¸¦å®½æœ‰é™åˆ¶ æœ€ç»ˆæˆ‘ä»¬æ‰¾åˆ°äº†å½±å“ä¸Šä¼ é€Ÿåº¦çš„é—®é¢˜ï¼Œå¹¶æˆåŠŸè§£å†³ã€‚","tags":[{"name":"æ•…éšœæ’æŸ¥","slug":"æ•…éšœæ’æŸ¥","permalink":"https://alexhuihui.github.io/tags/%E6%95%85%E9%9A%9C%E6%8E%92%E6%9F%A5/"}]},{"title":"ã€DNSã€‘DNSçš„æ¶æ„","date":"2025-01-25T12:28:38.000Z","path":"article/20250125.html","text":"","tags":[{"name":"DNS","slug":"DNS","permalink":"https://alexhuihui.github.io/tags/DNS/"}]},{"title":"ä½¿ç”¨ cloudflare tunnel","date":"2025-01-13T11:54:06.000Z","path":"article/20250113.html","text":"ä½¿ç”¨ cloudflare tunnel 1. åˆ›å»ºå¤šä¸ª Tunnelæ¯ä¸ª Tunnel éƒ½éœ€è¦ç‹¬ç«‹åˆ›å»ºã€‚ä»¥ SSH å’Œ HTTPS ä¸ºä¾‹ï¼š åˆ›å»º SSH Tunnel 1cloudflared tunnel create ssh-tunnel åˆ›å»º HTTPS Tunnel 1cloudflared tunnel create https-tunnel æ¯ä¸ª Tunnel éƒ½ä¼šç”Ÿæˆä¸€ä¸ªå”¯ä¸€çš„ credentials-fileï¼Œé€šå¸¸ä½äº ~/.cloudflared/ ç›®å½•ä¸‹ã€‚ 2. é…ç½®å¤šä¸ª Tunnel çš„æœåŠ¡ä¸ºæ¯ä¸ª Tunnel åˆ›å»ºç‹¬ç«‹çš„é…ç½®æ–‡ä»¶ã€‚ä¾‹å¦‚ï¼š SSH Tunnel é…ç½®åˆ›å»ºæˆ–ç¼–è¾‘ ~/.cloudflared/ssh-config.ymlï¼š 1234567tunnel: ssh-tunnelcredentials-file: /home/your-user/.cloudflared/ssh-tunnel.jsoningress: - hostname: ssh.example.com service: ssh://localhost:22 - service: http_status:404 HTTPS Tunnel é…ç½®åˆ›å»ºæˆ–ç¼–è¾‘ ~/.cloudflared/https-config.ymlï¼š 1234567tunnel: https-tunnelcredentials-file: /home/your-user/.cloudflared/https-tunnel.jsoningress: - hostname: www.example.com service: http://localhost:80 - service: http_status:404 3. åˆ›å»ºDNSè®°å½•123sudo cloudflared tunnel route dns ssh-tunnel ssh.example.comsudo cloudflared tunnel route dns https-tunnel www.example.com 4. å¯åŠ¨å¤šä¸ª Tunnelå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åˆ†åˆ«å¯åŠ¨æ¯ä¸ª Tunnelï¼š å¯åŠ¨ SSH Tunnelï¼š 1cloudflared tunnel --config ~/.cloudflared/ssh-config.yml run ssh-tunnel å¯åŠ¨ HTTPS Tunnelï¼š 1cloudflared tunnel --config ~/.cloudflared/https-config.yml run https-tunnel 5. ä½¿ç”¨ Systemd ç®¡ç†å¤šä¸ª Tunnelä¸ºæ¯ä¸ª Tunnel é…ç½®ä¸€ä¸ª Systemd æœåŠ¡ï¼Œä»¥ä¾¿åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶è‡ªåŠ¨è¿è¡Œã€‚ åˆ›å»º Systemd æœåŠ¡æ–‡ä»¶ ä¸º SSH Tunnel åˆ›å»ºæœåŠ¡æ–‡ä»¶ /etc/systemd/system/ssh-tunnel.serviceï¼š 1234567891011[Unit]Description=Cloudflare Tunnel for SSHAfter=network.target[Service]ExecStart=/usr/local/bin/cloudflared tunnel --config /home/your-user/.cloudflared/ssh-config.yml run ssh-tunnelRestart=alwaysUser=your-user[Install]WantedBy=multi-user.target ä¸º HTTPS Tunnel åˆ›å»ºæœåŠ¡æ–‡ä»¶ /etc/systemd/system/https-tunnel.serviceï¼š 1234567891011[Unit]Description=Cloudflare Tunnel for HTTPSAfter=network.target[Service]ExecStart=/usr/local/bin/cloudflared tunnel --config /home/your-user/.cloudflared/https-config.yml run https-tunnelRestart=alwaysUser=your-user[Install]WantedBy=multi-user.target å¯åŠ¨å’Œå¯ç”¨æœåŠ¡ å¯åŠ¨ SSH Tunnel æœåŠ¡ï¼š 12sudo systemctl start ssh-tunnelsudo systemctl enable ssh-tunnel å¯åŠ¨ HTTPS Tunnel æœåŠ¡ï¼š 12sudo systemctl start https-tunnelsudo systemctl enable https-tunnel 6. **é…ç½®æœ¬åœ°çš„ ssh **éœ€è¦åœ¨æœ¬åœ°sshé…ç½®ä»£ç† 12Host ssh.example.comProxyCommand C:\\\\Users\\\\29308\\\\.ssh\\\\cloudflared-windows-amd64.exe access ssh --hostname %h","tags":[{"name":"tunnel","slug":"tunnel","permalink":"https://alexhuihui.github.io/tags/tunnel/"},{"name":"cloudflare","slug":"cloudflare","permalink":"https://alexhuihui.github.io/tags/cloudflare/"}]},{"title":"ã€Springã€‘ç¼“å­˜æ³¨è§£@Cacheableã€@CacheEvictã€@CachePutä½¿ç”¨","date":"2024-05-25T11:54:06.000Z","path":"article/20240525.html","text":"Spring Cache é€šè¿‡å°è£…ç»Ÿä¸€çš„ç¼“å­˜æŠ½è±¡å±‚ï¼Œæ”¯æŒå¤šç§ç¼“å­˜å®ç°ï¼ˆå¦‚Ehcacheã€Redisã€Caffeineç­‰ï¼‰ã€‚å¯ä»¥ä½¿ç”¨æ³¨è§£@Cacheableã€@CacheEvictã€@CachePutç­‰ä¼˜é›…çš„è¿›è¡Œä½¿ç”¨ï¼Œæ— éœ€ä¿®æ”¹ä¸šåŠ¡ä»£ç ã€‚ @Cacheable@Cacheableæ³¨è§£ç”¨äºåœ¨æ–¹æ³•æ‰§è¡Œå‰æ£€æŸ¥ç¼“å­˜ï¼Œå¦‚æœç¼“å­˜ä¸­æœ‰æ•°æ®åˆ™è¿”å›ç¼“å­˜ä¸­çš„æ•°æ®ï¼Œå¦åˆ™æ‰§è¡Œæ–¹æ³•å¹¶å°†ç»“æœç¼“å­˜ã€‚ å·¥ä½œåŸç†ï¼š æ–¹æ³•è°ƒç”¨å‰ï¼š AOPä»£ç†æ‹¦æˆªæ–¹æ³•è°ƒç”¨ã€‚ ä»æŒ‡å®šçš„ç¼“å­˜åŒºï¼ˆvalueå±æ€§æŒ‡å®šï¼‰ä¸­æ ¹æ®ç¼“å­˜é”®ï¼ˆkeyå±æ€§æŒ‡å®šï¼‰æŸ¥æ‰¾ç¼“å­˜æ¡ç›®ã€‚ å¦‚æœæ‰¾åˆ°ç¼“å­˜æ¡ç›®ï¼Œåˆ™è¿”å›ç¼“å­˜çš„å€¼ï¼Œä¸æ‰§è¡Œç›®æ ‡æ–¹æ³•ã€‚ æ–¹æ³•è°ƒç”¨åï¼š å¦‚æœç¼“å­˜ä¸­æ²¡æœ‰æ‰¾åˆ°æ¡ç›®ï¼Œåˆ™æ‰§è¡Œç›®æ ‡æ–¹æ³•ã€‚ å°†æ–¹æ³•è¿”å›å€¼å­˜å‚¨åˆ°ç¼“å­˜ä¸­ï¼Œä½¿ç”¨æŒ‡å®šçš„ç¼“å­˜åŒºå’Œç¼“å­˜é”®ã€‚ ç¤ºä¾‹ï¼š 1234@Cacheable(value = &quot;users&quot;, key = &quot;#userId&quot;)public User getUserById(Long userId) &#123; return userRepository.findById(userId).orElse(null);&#125; @CacheEvict@CacheEvictæ³¨è§£ç”¨äºä»ç¼“å­˜ä¸­ç§»é™¤ä¸€ä¸ªæˆ–å¤šä¸ªæ¡ç›®ï¼Œé€šå¸¸åœ¨æ•°æ®ä¿®æ”¹æˆ–åˆ é™¤æ“ä½œæ—¶ä½¿ç”¨ã€‚ å·¥ä½œåŸç†ï¼š æ–¹æ³•è°ƒç”¨å ï¼š AOPä»£ç†æ‹¦æˆªæ–¹æ³•è°ƒç”¨ã€‚ æ‰§è¡Œç›®æ ‡æ–¹æ³•ã€‚ ä»æŒ‡å®šçš„ç¼“å­˜åŒºï¼ˆvalueå±æ€§æŒ‡å®šï¼‰ä¸­æ ¹æ®ç¼“å­˜é”®ï¼ˆkeyå±æ€§æŒ‡å®šï¼‰ç§»é™¤ç¼“å­˜æ¡ç›®ã€‚ å¦‚æœè®¾ç½®äº†allEntries = trueï¼Œåˆ™æ¸…ç©ºæ•´ä¸ªç¼“å­˜åŒºã€‚ ç¤ºä¾‹ï¼š 1234@CacheEvict(value = &quot;users&quot;, key = &quot;#userId&quot;)public void deleteUserById(Long userId) &#123; userRepository.deleteById(userId);&#125; @CachePut@CachePutæ³¨è§£ç”¨äºåœ¨æ–¹æ³•æ‰§è¡Œåå°†ç»“æœæ›´æ–°åˆ°ç¼“å­˜ä¸­ã€‚ä¸@Cacheableä¸åŒï¼Œå®ƒæ€»æ˜¯ä¼šæ‰§è¡Œç›®æ ‡æ–¹æ³•ã€‚ å·¥ä½œåŸç†ï¼š æ–¹æ³•è°ƒç”¨å ï¼š AOPä»£ç†æ‹¦æˆªæ–¹æ³•è°ƒç”¨ã€‚ æ‰§è¡Œç›®æ ‡æ–¹æ³•ã€‚ å°†æ–¹æ³•è¿”å›å€¼å­˜å‚¨åˆ°ç¼“å­˜ä¸­ï¼Œä½¿ç”¨æŒ‡å®šçš„ç¼“å­˜åŒºï¼ˆvalueå±æ€§æŒ‡å®šï¼‰å’Œç¼“å­˜é”®ï¼ˆkeyå±æ€§æŒ‡å®šï¼‰ã€‚ ç¤ºä¾‹ï¼š 1234@CachePut(value = &quot;users&quot;, key = &quot;#user.id&quot;)public User updateUser(User user) &#123; return userRepository.save(user);&#125; @CacheConfigæ³¨è§£ç”¨äºåœ¨ç±»çº§åˆ«é…ç½®ç¼“å­˜çš„å…¬å…±è®¾ç½®ï¼Œç®€åŒ–æ–¹æ³•çº§åˆ«çš„ç¼“å­˜é…ç½®ã€‚å¦‚æœç±»ä¸­çš„å¤šä¸ªæ–¹æ³•å…±äº«ç›¸åŒçš„ç¼“å­˜é…ç½®ï¼ˆä¾‹å¦‚ç›¸åŒçš„ç¼“å­˜åç§°ï¼‰ï¼Œä½¿ç”¨@CacheConfigå¯ä»¥é¿å…åœ¨æ¯ä¸ªæ–¹æ³•ä¸Šé‡å¤é…ç½®ã€‚ @CacheConfigçš„ä½œç”¨ ç¼“å­˜åç§°ï¼šè®¾ç½®é»˜è®¤çš„ç¼“å­˜åç§°ï¼Œåº”ç”¨äºè¯¥ç±»ä¸­çš„æ‰€æœ‰ç¼“å­˜æ“ä½œã€‚ ç¼“å­˜ç®¡ç†å™¨ï¼šæŒ‡å®šé»˜è®¤çš„ç¼“å­˜ç®¡ç†å™¨ï¼Œåº”ç”¨äºè¯¥ç±»ä¸­çš„æ‰€æœ‰ç¼“å­˜æ“ä½œã€‚ ç¤ºä¾‹å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªUserServiceç±»ï¼Œå…¶ä¸­å¤šä¸ªæ–¹æ³•éœ€è¦ä½¿ç”¨ç›¸åŒçš„ç¼“å­˜é…ç½®ã€‚ ä¸ä½¿ç”¨@CacheConfig1234567891011121314151617181920212223import org.springframework.cache.annotation.Cacheable;import org.springframework.cache.annotation.CacheEvict;import org.springframework.cache.annotation.CachePut;import org.springframework.stereotype.Service;@Servicepublic class UserService &#123; @Cacheable(value = &quot;users&quot;, key = &quot;#userId&quot;) public User getUserById(Long userId) &#123; return userRepository.findById(userId).orElse(null); &#125; @CacheEvict(value = &quot;users&quot;, key = &quot;#userId&quot;) public void deleteUserById(Long userId) &#123; userRepository.deleteById(userId); &#125; @CachePut(value = &quot;users&quot;, key = &quot;#user.id&quot;) public User updateUser(User user) &#123; return userRepository.save(user); &#125;&#125; åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæ¯ä¸ªç¼“å­˜æ³¨è§£éƒ½éœ€è¦æŒ‡å®švalue = &quot;users&quot;ï¼Œå¦‚æœæœ‰å¤šä¸ªæ–¹æ³•å…±äº«ç›¸åŒçš„ç¼“å­˜åç§°ï¼Œè¿™æ ·ä¼šæ˜¾å¾—å†—ä½™ã€‚ ä½¿ç”¨@CacheConfig12345678910111213141516171819202122232425import org.springframework.cache.annotation.CacheConfig;import org.springframework.cache.annotation.Cacheable;import org.springframework.cache.annotation.CacheEvict;import org.springframework.cache.annotation.CachePut;import org.springframework.stereotype.Service;@Service@CacheConfig(cacheNames = &quot;users&quot;)public class UserService &#123; @Cacheable(key = &quot;#userId&quot;) public User getUserById(Long userId) &#123; return userRepository.findById(userId).orElse(null); &#125; @CacheEvict(key = &quot;#userId&quot;) public void deleteUserById(Long userId) &#123; userRepository.deleteById(userId); &#125; @CachePut(key = &quot;#user.id&quot;) public User updateUser(User user) &#123; return userRepository.save(user); &#125;&#125; åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼š @CacheConfig(cacheNames = &quot;users&quot;)ï¼šåœ¨ç±»çº§åˆ«é…ç½®é»˜è®¤çš„ç¼“å­˜åç§°ä¸ºâ€œusersâ€ã€‚ å„ä¸ªæ–¹æ³•ä¸Šä¸å†éœ€è¦é‡å¤æŒ‡å®šç¼“å­˜åç§°ï¼Œåªéœ€è¦é…ç½®keyå±æ€§ã€‚ @CacheConfig çš„ä½¿ç”¨åœºæ™¯ ç»Ÿä¸€ç¼“å­˜é…ç½®ï¼šå½“ä¸€ä¸ªç±»ä¸­å¤šä¸ªæ–¹æ³•ä½¿ç”¨ç›¸åŒçš„ç¼“å­˜åç§°æˆ–ç¼“å­˜ç®¡ç†å™¨æ—¶ï¼Œå¯ä»¥é€šè¿‡@CacheConfigç»Ÿä¸€é…ç½®ï¼Œå‡å°‘ä»£ç å†—ä½™ã€‚ ç®€åŒ–é…ç½®ï¼šé¿å…åœ¨æ¯ä¸ªæ–¹æ³•çš„ç¼“å­˜æ³¨è§£ä¸­é‡å¤æŒ‡å®šç›¸åŒçš„ç¼“å­˜åç§°æˆ–å…¶ä»–é…ç½®ã€‚ è¿›ä¸€æ­¥ç¤ºä¾‹å‡è®¾æˆ‘ä»¬åœ¨åŒä¸€ä¸ªç±»ä¸­ä½¿ç”¨å¤šä¸ªç¼“å­˜åç§°ï¼Œå¯ä»¥é€šè¿‡@CacheConfigé…ç½®é»˜è®¤çš„ç¼“å­˜åç§°ï¼ŒåŒæ—¶åœ¨ç‰¹å®šæ–¹æ³•ä¸Šè¦†ç›–é»˜è®¤é…ç½®ã€‚ 123456789101112131415161718192021222324252627282930import org.springframework.cache.annotation.CacheConfig;import org.springframework.cache.annotation.Cacheable;import org.springframework.cache.annotation.CacheEvict;import org.springframework.cache.annotation.CachePut;import org.springframework.stereotype.Service;@Service@CacheConfig(cacheNames = &quot;users&quot;)public class UserService &#123; @Cacheable(key = &quot;#userId&quot;) public User getUserById(Long userId) &#123; return userRepository.findById(userId).orElse(null); &#125; @CacheEvict(key = &quot;#userId&quot;) public void deleteUserById(Long userId) &#123; userRepository.deleteById(userId); &#125; @CachePut(key = &quot;#user.id&quot;) public User updateUser(User user) &#123; return userRepository.save(user); &#125; @Cacheable(value = &quot;admins&quot;, key = &quot;#adminId&quot;) public Admin getAdminById(Long adminId) &#123; return adminRepository.findById(adminId).orElse(null); &#125;&#125; åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼š @CacheConfig(cacheNames = &quot;users&quot;)ï¼šåœ¨ç±»çº§åˆ«è®¾ç½®é»˜è®¤ç¼“å­˜åç§°ä¸ºâ€œusersâ€ã€‚ getAdminByIdæ–¹æ³•é€šè¿‡@Cacheable(value = &quot;admins&quot;, key = &quot;#adminId&quot;)è¦†ç›–äº†é»˜è®¤çš„ç¼“å­˜åç§°ï¼Œä½¿ç”¨â€œadminsâ€ç¼“å­˜ã€‚ é€šè¿‡ä½¿ç”¨@CacheConfigï¼Œå¯ä»¥ä½¿ä»£ç æ›´æ¸…æ™°ï¼Œé¿å…é‡å¤é…ç½®ï¼Œæé«˜å¯ç»´æŠ¤æ€§ã€‚ å®ç°ç»†èŠ‚ Spring AOPä»£ç†ï¼š Spring AOPé€šè¿‡JDKåŠ¨æ€ä»£ç†æˆ–CGLIBåˆ›å»ºä»£ç†å¯¹è±¡ã€‚ ä»£ç†å¯¹è±¡æ‹¦æˆªæ–¹æ³•è°ƒç”¨ï¼Œåœ¨è°ƒç”¨ç›®æ ‡æ–¹æ³•ä¹‹å‰æˆ–ä¹‹åæ‰§è¡Œç¼“å­˜é€»è¾‘ã€‚ CacheManagerå’ŒCacheæ¥å£ï¼š CacheManagerï¼šSpringç¼“å­˜æŠ½è±¡ä¸­çš„æ ¸å¿ƒæ¥å£ï¼Œç”¨äºç®¡ç†ä¸åŒçš„ç¼“å­˜å®ç°ã€‚ Cacheï¼šè¡¨ç¤ºå…·ä½“çš„ç¼“å­˜ï¼Œæä¾›åŸºæœ¬çš„ç¼“å­˜æ“ä½œæ–¹æ³•ï¼Œå¦‚getã€putã€evictç­‰ã€‚ ç¼“å­˜é…ç½®ï¼š åœ¨Spring Booté¡¹ç›®ä¸­ï¼Œé€šè¿‡@EnableCachingæ³¨è§£å¯ç”¨ç¼“å­˜åŠŸèƒ½ã€‚ åœ¨é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šå…·ä½“çš„ç¼“å­˜å®ç°ï¼ˆå¦‚Ehcacheã€Redisç­‰ï¼‰çš„é…ç½®ã€‚ ç¤ºä¾‹é¡¹ç›®é…ç½®å¼•å…¥ä¾èµ–ï¼š åœ¨pom.xmlä¸­æ·»åŠ ä¾èµ–ï¼š 123456789&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-cache&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt; &lt;/dependency&gt; é…ç½®æ–‡ä»¶Yamlï¼š 123456789101112spring: application: name: buzz-chat data: redis: host: 127.0.0.1 port: 6379 database: 0 cache: type: REDIS ä¸»é…ç½®ç±»ï¼š 1234567891011import org.springframework.boot.SpringApplication;import org.springframework.boot.autoconfigure.SpringBootApplication;import org.springframework.cache.annotation.EnableCaching;@SpringBootApplication@EnableCachingpublic class CacheApplication &#123; public static void main(String[] args) &#123; SpringApplication.run(CacheApplication.class, args); &#125;&#125; é€šè¿‡ä¸Šè¿°é…ç½®å’Œä»£ç ï¼ŒSpring Cacheå’Œç¼“å­˜æ³¨è§£å¯ä»¥åœ¨Springåº”ç”¨ä¸­æ— ç¼å·¥ä½œã€‚AOPå’Œç¼“å­˜æŠ½è±¡æœºåˆ¶ä½¿å¾—è¿™äº›ç¼“å­˜æ“ä½œé€æ˜åœ°é›†æˆåˆ°ä¸šåŠ¡é€»è¾‘ä¸­ï¼Œå¤§å¤§ç®€åŒ–äº†å¼€å‘å’Œç»´æŠ¤å·¥ä½œã€‚","tags":[{"name":"Spring","slug":"Spring","permalink":"https://alexhuihui.github.io/tags/Spring/"}]},{"title":"ã€MySQLã€‘ç´¢å¼•å¤±æ•ˆçš„åœºæ™¯","date":"2024-05-22T11:54:06.000Z","path":"article/20240522.html","text":"ä»Šå¤©æˆ‘ä»¬è®¨è®ºä¸€ä¸‹æ•°æ®åº“ç´¢å¼•åœ¨ä»€ä¹ˆæƒ…å†µä¸‹ä¼šå¤±æ•ˆï¼Œæ€»çš„æ¥è¯´æœ‰ä»¥ä¸‹å‡ ç§åœºæ™¯ åœ¨ç´¢å¼•åˆ—ä¸ŠåŠ å‡½æ•°è¿ç®— ç»„åˆç´¢å¼•ä¸­ï¼Œä¸ç¬¦åˆæœ€å·¦åŒ¹é…åŸåˆ™ å½“ç´¢å¼•åˆ—å­˜åœ¨éšå¼è½¬åŒ–çš„æ—¶å€™ ä½¿ç”¨likeé€šé…ç¬¦åŒ¹é…åç¼€%xxxçš„æ—¶å€™ ä½¿ç”¨orè¿æ¥æŸ¥è¯¢çš„æ—¶å€™ï¼Œorè¯­å¥å‰åæ²¡æœ‰åŒæ—¶ä½¿ç”¨ç´¢å¼• è®¾è®¡ SQL è¡¨å‡è®¾æˆ‘ä»¬è®¾è®¡ä¸€ä¸ªå‘˜å·¥è¡¨ employeesï¼ŒåŒ…å«ä»¥ä¸‹å­—æ®µï¼š employee_idï¼šå‘˜å·¥IDï¼ˆå­—ç¬¦ä¸²ç±»å‹ï¼Œä½œä¸ºç´¢å¼•åˆ—ï¼‰ nameï¼šå‘˜å·¥å§“å department_idï¼šéƒ¨é—¨IDï¼ˆå­—ç¬¦ä¸²ç±»å‹ï¼Œä½œä¸ºç´¢å¼•åˆ—ï¼‰ ageï¼šå‘˜å·¥å¹´é¾„ åˆ›å»ºè¡¨çš„ SQL è¯­å¥12345678CREATE TABLE employees ( employee_id VARCHAR(20) NOT NULL, name VARCHAR(100), department_id VARCHAR(20), age INT, PRIMARY KEY (employee_id), KEY idx_department_id (department_id)); æ’å…¥ç¤ºä¾‹æ•°æ®123456INSERT INTO employees (employee_id, name, department_id, age) VALUES(&#x27;E001&#x27;, &#x27;Alice&#x27;, &#x27;D001&#x27;, 30),(&#x27;E002&#x27;, &#x27;Bob&#x27;, &#x27;D002&#x27;, 25),(&#x27;E003&#x27;, &#x27;Charlie&#x27;, &#x27;D001&#x27;, 28),(&#x27;E004&#x27;, &#x27;David&#x27;, &#x27;D003&#x27;, 35),(&#x27;E005&#x27;, &#x27;Eve&#x27;, &#x27;D002&#x27;, 22); æŸ¥è¯¢è¯­å¥åŠå…¶ EXPLAIN åˆ†æ1. éšå¼ç±»å‹è½¬æ¢å¯¼è‡´ç´¢å¼•å¤±æ•ˆæŸ¥è¯¢å‘˜å·¥IDä¸º123çš„å‘˜å·¥ä¿¡æ¯ï¼š 1SELECT * FROM employees WHERE employee_id = 123; åˆ†æï¼š 1EXPLAIN SELECT * FROM employees WHERE employee_id = 123; 2. LIKE é€šé…ç¬¦åŒ¹é…åç¼€å¯¼è‡´ç´¢å¼•å¤±æ•ˆæŸ¥è¯¢åå­—ä»¥ â€˜liceâ€™ ç»“å°¾çš„å‘˜å·¥ï¼š 1SELECT * FROM employees WHERE name LIKE &#x27;%lice&#x27;; åˆ†æï¼š 1EXPLAIN SELECT * FROM employees WHERE name LIKE &#x27;%lice&#x27;; 3. OR è¿æ¥æŸ¥è¯¢ç´¢å¼•å¤±æ•ˆæŸ¥è¯¢å‘˜å·¥IDä¸ºâ€™E001â€™æˆ–éƒ¨é—¨IDä¸ºâ€™D003â€™çš„å‘˜å·¥ä¿¡æ¯ï¼š 1SELECT * FROM employees WHERE employee_id = &#x27;E001&#x27; OR department_id = &#x27;D003&#x27;; åˆ†æï¼š 1EXPLAIN SELECT * FROM employees WHERE employee_id = &#x27;E001&#x27; OR department_id = &#x27;D003&#x27;; 4. æ­£ç¡®ä½¿ç”¨ç´¢å¼•çš„æŸ¥è¯¢æŸ¥è¯¢åå­—ä»¥ â€˜Aâ€™ å¼€å¤´çš„å‘˜å·¥ï¼š 1SELECT * FROM employees WHERE name LIKE &#x27;A%&#x27;; åˆ†æï¼š 1EXPLAIN SELECT * FROM employees WHERE name LIKE &#x27;A%&#x27;; EXPLAIN ç»“æœåˆ†æé€šè¿‡ EXPLAIN è¯­å¥ï¼Œå¯ä»¥åˆ†ææ¯ä¸ªæŸ¥è¯¢çš„æ‰§è¡Œè®¡åˆ’ã€‚ä»¥ä¸‹æ˜¯å¯èƒ½çš„è§£é‡Šï¼š 1. éšå¼ç±»å‹è½¬æ¢å¯¼è‡´ç´¢å¼•å¤±æ•ˆ12345+----+-------------+-----------+------+---------------+------+---------+------+------+-------------+| id | select_type | table | type | possible_keys | key | key_len | ref | rows | Extra |+----+-------------+-----------+------+---------------+------+---------+------+------+-------------+| 1 | SIMPLE | employees | ALL | PRIMARY | NULL | NULL | NULL | 5 | Using where |+----+-------------+-----------+------+---------------+------+---------+------+------+-------------+ è§£é‡Šï¼šç”±äºéšå¼ç±»å‹è½¬æ¢ï¼ŒMySQL è¿›è¡Œäº†å…¨è¡¨æ‰«æï¼ˆtype=ALLï¼‰ï¼Œæœªèƒ½ä½¿ç”¨ç´¢å¼•ã€‚ 2. LIKE é€šé…ç¬¦åŒ¹é…åç¼€å¯¼è‡´ç´¢å¼•å¤±æ•ˆ12345+----+-------------+-----------+------+---------------+------+---------+------+------+-------------+| id | select_type | table | type | possible_keys | key | key_len | ref | rows | Extra |+----+-------------+-----------+------+---------------+------+---------+------+------+-------------+| 1 | SIMPLE | employees | ALL | NULL | NULL | NULL | NULL | 5 | Using where |+----+-------------+-----------+------+---------------+------+---------+------+------+-------------+ è§£é‡Šï¼šç”±äºé€šé…ç¬¦åœ¨å‰ï¼ŒMySQL è¿›è¡Œäº†å…¨è¡¨æ‰«æï¼ˆtype=ALLï¼‰ï¼Œæœªèƒ½ä½¿ç”¨ç´¢å¼•ã€‚ 3. OR è¿æ¥æŸ¥è¯¢ç´¢å¼•å¤±æ•ˆ12345+----+-------------+-----------+------+--------------------+------+---------+------+------+-------------+| id | select_type | table | type | possible_keys | key | key_len | ref | rows | Extra |+----+-------------+-----------+------+--------------------+------+---------+------+------+-------------+| 1 | SIMPLE | employees | ALL | PRIMARY,idx_department_id | NULL | NULL | NULL | 5 | Using where |+----+-------------+-----------+------+--------------------+------+---------+------+------+-------------+ è§£é‡Šï¼šç”±äº OR è¯­å¥ä½¿å¾—æŸ¥è¯¢éœ€è¦è€ƒè™‘å¤šä¸ªæ¡ä»¶ï¼ŒMySQL è¿›è¡Œäº†å…¨è¡¨æ‰«æï¼ˆtype=ALLï¼‰ï¼Œæœªèƒ½ä½¿ç”¨ç´¢å¼•ã€‚ 4. æ­£ç¡®ä½¿ç”¨ç´¢å¼•çš„æŸ¥è¯¢12345+----+-------------+-----------+-------+---------------+---------------+---------+------+------+-------------+| id | select_type | table | type | possible_keys | key | key_len | ref | rows | Extra |+----+-------------+-----------+-------+---------------+---------------+---------+------+------+-------------+| 1 | SIMPLE | employees | range | NULL | idx_name | 1024 | NULL | 2 | Using where |+----+-------------+-----------+-------+---------------+---------------+---------+------+------+-------------+ è§£é‡Šï¼šç”±äºé€šé…ç¬¦åœ¨åï¼Œç¬¦åˆæœ€å·¦åŒ¹é…åŸåˆ™ï¼ŒMySQL ä½¿ç”¨äº†ç´¢å¼•ï¼ˆtype=rangeï¼‰ã€‚ é€šè¿‡ä»¥ä¸ŠæŸ¥è¯¢å’Œåˆ†æï¼Œå¯ä»¥æ›´å¥½åœ°ç†è§£ B+æ ‘ç´¢å¼•åœ¨ä¸åŒæƒ…å†µä¸‹çš„ä½¿ç”¨å’Œå¤±æ•ˆåŸå› ï¼Œä»è€Œä¼˜åŒ–æ•°æ®åº“æŸ¥è¯¢æ€§èƒ½ã€‚","tags":[{"name":"MySQL","slug":"MySQL","permalink":"https://alexhuihui.github.io/tags/MySQL/"}]},{"title":"ã€Dockerã€‘å®¹å™¨çš„æœ¬è´¨","date":"2024-04-30T11:54:06.000Z","path":"article/20240430.html","text":"ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„ Docker å®¹å™¨ï¼Œå…¶å®å°±æ˜¯ä¸€ä¸ªå¯ç”¨äº†å¤šä¸ª Linux Namespace çš„åº”ç”¨è¿›ç¨‹ï¼Œè€Œè¿™ä¸ªè¿›ç¨‹èƒ½å¤Ÿä½¿ç”¨çš„èµ„æºé‡ï¼Œåˆ™å— Cgroups é…ç½®çš„é™åˆ¶ã€‚ ä¸‹é¢é€šè¿‡ä¸€ä¸ªå°å®éªŒè¯æ˜è¿™å¥è¯ éªŒè¯åœ¨ Linux ä¸­ï¼ŒCgroups ç»™ç”¨æˆ·æš´éœ²å‡ºæ¥çš„æ“ä½œæ¥å£æ˜¯æ–‡ä»¶ç³»ç»Ÿï¼Œå³å®ƒä»¥æ–‡ä»¶å’Œç›®å½•çš„æ–¹å¼ç»„ç»‡åœ¨æ“ä½œç³»ç»Ÿçš„ /sys/fs/cgroup è·¯å¾„ä¸‹ã€‚ 1mount -t cgroup è¿›å…¥åˆ° /sys/fs/cgroup/cpu ç›®å½•ä¸‹ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªç›®å½•ï¼Œæ“ä½œç³»ç»Ÿä¼šåœ¨æ–°åˆ›å»ºçš„ container ç›®å½•ä¸‹ï¼Œè‡ªåŠ¨ç”Ÿæˆè¯¥å­ç³»ç»Ÿå¯¹åº”çš„èµ„æºé™åˆ¶æ–‡ä»¶ã€‚ 1234root@ubuntu:/sys/fs/cgroup/cpu$ mkdir containerroot@ubuntu:/sys/fs/cgroup/cpu$ ls container/cgroup.clone_children cpu.cfs_period_us cpu.rt_period_us cpu.shares notify_on_releasecgroup.procs cpu.cfs_quota_us cpu.rt_runtime_us cpu.stat tasks æ‰§è¡Œä¸€ä¸ªè„šæœ¬ï¼Œæ‰“æ»¡CPU 1while : ; do : ; done &amp; ä¿®æ”¹containerç›®å½•ä¸­çš„CPUèµ„æºé™åˆ¶å¹¶æŠŠåˆšåˆšåˆ›å»ºçš„è¿›ç¨‹åŠ å…¥åˆ°ä»»åŠ¡ç»„ä¸­ 123echo 20000 &gt; /sys/fs/cgroup/cpu/container/cpu.cfs_quota_usecho PID &gt; /sys/fs/cgroup/cpu/container/tasks è¿™æ—¶å€™å†é€šè¿‡TOPå»æŸ¥çœ‹CPUä½¿ç”¨å°±ä¼šå‘ç°å®ƒçš„ä½¿ç”¨ç‡ä»100%é™åˆ°äº†20% ç¼ºç‚¹dockerä½¿ç”¨namespaceè¿›è¡Œéš”ç¦»ä½†æ˜¯éš”ç¦»çš„ä¸å½»åº•ï¼Œå®ƒæœ¬è´¨ä¸Šè¿˜æ˜¯ä¸€ä¸ªè·‘åœ¨å®¿ä¸»æœºä¸Šçš„è¿›ç¨‹ã€‚ dockerä½¿ç”¨cgroupsè¿›è¡Œä½¿ç”¨èµ„æºçš„é™åˆ¶ï¼Œä½†æ˜¯Cgroups å¯¹èµ„æºçš„é™åˆ¶èƒ½åŠ›ä¹Ÿæœ‰å¾ˆå¤šä¸å®Œå–„çš„åœ°æ–¹ã€‚","tags":[{"name":"Docker","slug":"Docker","permalink":"https://alexhuihui.github.io/tags/Docker/"}]},{"title":"ã€äº‹åŠ¡å¤„ç†ã€‘åˆ†å¸ƒå¼äº‹åŠ¡","date":"2024-01-27T11:54:06.000Z","path":"article/20240127.html","text":"å¯ä»¥æŒ‰ç…§æœåŠ¡çš„æ•°é‡ä»¥åŠå¯¹åº”çš„æ•°æ®æºçš„ä½¿ç”¨æ•°é‡æ¥åˆ’åˆ†åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œä¾‹å¦‚å•ä¸ªæœåŠ¡ä½¿ç”¨å¤šæ•°æ®æºç§°ä½œå…¨å±€äº‹åŠ¡å¯ä»¥ä½¿ç”¨2ã€3æ®µæäº¤ï¼Œå¤šä¸ªæœåŠ¡ä½¿ç”¨å•æ•°æ®æºåˆ™ç§°ä½œå…±äº«äº‹åŠ¡å¯ä»¥ä½¿ç”¨å…±äº«æ•°æ®åº“è¿æ¥ï¼Œè¿˜æœ‰ä¸€ç§å°±æ˜¯å¤šæœåŠ¡å¤šæ•°æ®æºï¼Œè¿™ç§ä¸€èˆ¬ç§°ä½œåœ¨åˆ†å¸ƒå¼æœåŠ¡ç¯å¢ƒä¸‹çš„äº‹åŠ¡å¤„ç†æœºåˆ¶ã€‚ å…¨å±€äº‹åŠ¡ å‡†å¤‡é˜¶æ®µï¼šåˆå«ä½œæŠ•ç¥¨é˜¶æ®µï¼Œåœ¨è¿™ä¸€é˜¶æ®µï¼Œåè°ƒè€…è¯¢é—®äº‹åŠ¡çš„æ‰€æœ‰å‚ä¸è€…æ˜¯å¦å‡†å¤‡å¥½æäº¤ï¼Œå‚ä¸è€…å¦‚æœå·²ç»å‡†å¤‡å¥½æäº¤åˆ™å›å¤ Preparedï¼Œå¦åˆ™å›å¤ Non-Preparedã€‚è¿™é‡Œæ‰€è¯´çš„å‡†å¤‡æ“ä½œè·Ÿäººç±»è¯­è¨€ä¸­é€šå¸¸ç†è§£çš„å‡†å¤‡å¹¶ä¸ç›¸åŒï¼Œå¯¹äºæ•°æ®åº“æ¥è¯´ï¼Œå‡†å¤‡æ“ä½œæ˜¯åœ¨é‡åšæ—¥å¿—ä¸­è®°å½•å…¨éƒ¨äº‹åŠ¡æäº¤æ“ä½œæ‰€è¦åšçš„å†…å®¹ï¼Œå®ƒä¸æœ¬åœ°äº‹åŠ¡ä¸­çœŸæ­£æäº¤çš„åŒºåˆ«åªæ˜¯æš‚ä¸å†™å…¥æœ€åä¸€æ¡ Commit Record è€Œå·²ï¼Œè¿™æ„å‘³ç€åœ¨åšå®Œæ•°æ®æŒä¹…åŒ–åå¹¶ä¸ç«‹å³é‡Šæ”¾éš”ç¦»æ€§ï¼Œå³ä»ç»§ç»­æŒæœ‰é”ï¼Œç»´æŒæ•°æ®å¯¹å…¶ä»–éäº‹åŠ¡å†…è§‚å¯Ÿè€…çš„éš”ç¦»çŠ¶æ€ã€‚ æäº¤é˜¶æ®µï¼šåˆå«ä½œæ‰§è¡Œé˜¶æ®µï¼Œåè°ƒè€…å¦‚æœåœ¨ä¸Šä¸€é˜¶æ®µæ”¶åˆ°æ‰€æœ‰äº‹åŠ¡å‚ä¸è€…å›å¤çš„ Prepared æ¶ˆæ¯ï¼Œåˆ™å…ˆè‡ªå·±åœ¨æœ¬åœ°æŒä¹…åŒ–äº‹åŠ¡çŠ¶æ€ä¸º Commitï¼Œåœ¨æ­¤æ“ä½œå®Œæˆåå‘æ‰€æœ‰å‚ä¸è€…å‘é€ Commit æŒ‡ä»¤ï¼Œæ‰€æœ‰å‚ä¸è€…ç«‹å³æ‰§è¡Œæäº¤æ“ä½œï¼›å¦åˆ™ï¼Œä»»æ„ä¸€ä¸ªå‚ä¸è€…å›å¤äº† Non-Prepared æ¶ˆæ¯ï¼Œæˆ–ä»»æ„ä¸€ä¸ªå‚ä¸è€…è¶…æ—¶æœªå›å¤ï¼Œåè°ƒè€…å°†è‡ªå·±çš„äº‹åŠ¡çŠ¶æ€æŒä¹…åŒ–ä¸º Abort ä¹‹åï¼Œå‘æ‰€æœ‰å‚ä¸è€…å‘é€ Abort æŒ‡ä»¤ï¼Œå‚ä¸è€…ç«‹å³æ‰§è¡Œå›æ»šæ“ä½œã€‚å¯¹äºæ•°æ®åº“æ¥è¯´ï¼Œè¿™ä¸ªé˜¶æ®µçš„æäº¤æ“ä½œåº”æ˜¯å¾ˆè½»é‡çš„ï¼Œä»…ä»…æ˜¯æŒä¹…åŒ–ä¸€æ¡ Commit Record è€Œå·²ï¼Œé€šå¸¸èƒ½å¤Ÿå¿«é€Ÿå®Œæˆï¼Œåªæœ‰æ”¶åˆ° Abort æŒ‡ä»¤æ—¶ï¼Œæ‰éœ€è¦æ ¹æ®å›æ»šæ—¥å¿—æ¸…ç†å·²æäº¤çš„æ•°æ®ï¼Œè¿™å¯èƒ½æ˜¯ç›¸å¯¹é‡è´Ÿè½½çš„æ“ä½œã€‚ ç¼ºç‚¹å¾ˆæ˜æ˜¾ï¼Œå®¹æ˜“å•ç‚¹ã€æ€§èƒ½é—®é¢˜ã€ä¸€è‡´æ€§é£é™© å…±äº«äº‹åŠ¡ ç†è®ºå¯è¡Œï¼Œå› ä¸ºè¯¥æ–¹æ¡ˆæ˜¯ä¸å®é™…ç”Ÿäº§ç³»ç»Ÿä¸­çš„å‹åŠ›æ–¹å‘ç›¸æ‚–çš„ï¼Œä¸€ä¸ªæœåŠ¡é›†ç¾¤é‡Œæ•°æ®åº“æ‰æ˜¯å‹åŠ›æœ€å¤§è€Œåˆæœ€ä¸å®¹æ˜“ä¼¸ç¼©æ‹“å±•çš„é‡ç¾åŒºã€‚ åˆ†å¸ƒå¼äº‹åŠ¡","tags":[{"name":"äº‹åŠ¡å¤„ç†","slug":"äº‹åŠ¡å¤„ç†","permalink":"https://alexhuihui.github.io/tags/%E4%BA%8B%E5%8A%A1%E5%A4%84%E7%90%86/"}]},{"title":"ã€æŠ€æœ¯åˆ†äº«ã€‘Springå£°æ˜å¼äº‹åŠ¡çš„æ­£ç¡®ä½¿ç”¨","date":"2024-01-18T11:54:06.000Z","path":"article/20240118.html","text":"å¤§å®¶è‚¯å®šå¯¹@Transactionalè¿™ä¸ªæ³¨è§£å¾ˆç†Ÿæ‚‰ï¼Œä¹Ÿå¯¹äº‹åŠ¡æœ‰ç€è¯¦ç»†çš„äº†è§£ï¼Œä¹ŸçŸ¥é“å¤šä¸ªæ•°æ®åº“æ“ä½œéœ€è¦é€šè¿‡äº‹åŠ¡æ¥ä¿è¯ä¸€è‡´æ€§å’ŒåŸå­æ€§ã€‚ä½†æ˜¯å¾ˆå°‘ä¼šå…³æ³¨äº‹åŠ¡æ˜¯å¦ç”Ÿæ•ˆã€æœ‰æ²¡æœ‰å‡ºé”™ã€‚è¿™ç±»é—®é¢˜ä¹Ÿæ¯”è¾ƒéš¾åœ¨æµ‹è¯•é˜¶æ®µå‘ç°ï¼Œå½“å‡ºç°çº¿ä¸Šé—®é¢˜çš„æ—¶å€™ä¸å¯é¿å…çš„ä¼šäº§ç”Ÿå¤§é‡è„æ•°æ®ã€‚æ‰€ä»¥è¿™æ¬¡æˆ‘åˆ†äº«çš„å†…å®¹å°±æ˜¯å¸®åŠ©å¤§å®¶ç†æ¸…æ¥šä½¿ç”¨@Transactionalçš„æ€è·¯ï¼Œé¿å…ä½¿ç”¨ä¸å½“äº§ç”Ÿbugã€‚ äº‹åŠ¡ä¸ºä»€ä¹ˆä¸ç”Ÿæ•ˆå¾ˆå¤šåŒå­¦ä»¥ä¸ºåªè¦åŠ äº†è¿™ä¸ªæ³¨è§£å°±ä¸éœ€è¦ç®¡å®ƒäº†ï¼Œå…¶å®ä¸å°½ç„¶ã€‚å¯ä»¥çœ‹çœ‹ä¸‹è¿°ä¾‹å­ï¼š 12345678910111213141516171819202122232425262728293031@Service@Slf4jpublic class UserService &#123; @Autowired private UserRepository userRepository; //ä¸€ä¸ªå…¬å…±æ–¹æ³•ä¾›Controllerè°ƒç”¨ï¼Œå†…éƒ¨è°ƒç”¨äº‹åŠ¡æ€§çš„ç§æœ‰æ–¹æ³• public int createUserWrong1(String name) &#123; try &#123; this.createUserPrivate(new UserEntity(name)); &#125; catch (Exception ex) &#123; log.error(&quot;create user failed because &#123;&#125;&quot;, ex.getMessage()); &#125; return userRepository.findByName(name).size(); &#125; //æ ‡è®°äº†@Transactionalçš„privateæ–¹æ³• @Transactional private void createUserPrivate(UserEntity entity) &#123; userRepository.save(entity); if (entity.getName().contains(&quot;test&quot;)) &#123; throw new RuntimeException(&quot;invalid username!&quot;); &#125; &#125; //æ ¹æ®ç”¨æˆ·åæŸ¥è¯¢ç”¨æˆ·æ•° public int getUserCount(String name) &#123; return userRepository.findByName(name).size(); &#125;&#125; åªæœ‰å®šä¹‰åœ¨publicæ–¹æ³•ä¸Šçš„ @Transactional æ‰èƒ½ç”Ÿæ•ˆ 1234567891011121314151617public int createUserWrong2(String name) &#123; try &#123; this.createUserPublic(new UserEntity(name)); &#125; catch (Exception ex) &#123; log.error(&quot;create user failed because &#123;&#125;&quot;, ex.getMessage()); &#125; return userRepository.findByName(name).size();&#125;//æ ‡è®°äº†@Transactionalçš„publicæ–¹æ³•@Transactionalpublic void createUserPublic(UserEntity entity) &#123; userRepository.save(entity); if (entity.getName().contains(&quot;test&quot;)) &#123; throw new RuntimeException(&quot;invalid username!&quot;); &#125;&#125; å¿…é¡»é€šè¿‡ä»£ç†è¿‡çš„ç±»ä»å¤–éƒ¨è°ƒç”¨ç›®æ ‡æ–¹æ³•æ‰èƒ½ç”Ÿæ•ˆ 12345678910111213141516171819202122232425@GetMapping(&quot;right2&quot;)public int right2(@RequestParam(&quot;name&quot;) String name) &#123; try &#123; userService.createUserPublic(new UserEntity(name)); &#125; catch (Exception ex) &#123; log.error(&quot;create user failed because &#123;&#125;&quot;, ex.getMessage()); &#125; return userService.getUserCount(name);&#125;try &#123; // This is an around advice: Invoke the next interceptor in the chain. // This will normally result in a target object being invoked. retVal = invocation.proceedWithInvocation();&#125;catch (Throwable ex) &#123; // target invocation exception completeTransactionAfterThrowing(txInfo, ex); throw ex;&#125;finally &#123; cleanupTransactionInfo(txInfo);&#125; åªæœ‰å¼‚å¸¸ä¼ æ’­å‡ºäº†æ ‡è®°äº† @Transactional æ³¨è§£çš„æ–¹æ³•ï¼Œäº‹åŠ¡æ‰èƒ½å›æ»š 123456789101112131415161718/** * The default behavior is as with EJB: rollback on unchecked exception * (&#123;@link RuntimeException&#125;), assuming an unexpected outcome outside of any * business rules. Additionally, we also attempt to rollback on &#123;@link Error&#125; which * is clearly an unexpected outcome as well. By contrast, a checked exception is * considered a business exception and therefore a regular expected outcome of the * transactional business method, i.e. a kind of alternative return value which * still allows for regular completion of resource operations. * &lt;p&gt;This is largely consistent with TransactionTemplate&#x27;s default behavior, * except that TransactionTemplate also rolls back on undeclared checked exceptions * (a corner case). For declarative transactions, we expect checked exceptions to be * intentionally declared as business exceptions, leading to a commit by default. * @see org.springframework.transaction.support.TransactionTemplate#execute */@Overridepublic boolean rollbackOn(Throwable ex) &#123; return (ex instanceof RuntimeException || ex instanceof Error);&#125; é»˜è®¤å‡ºç° RuntimeExceptionï¼ˆéå—æ£€å¼‚å¸¸ï¼‰æˆ– Error çš„æ—¶å€™ï¼ŒSpring æ‰ä¼šå›æ»šäº‹åŠ¡ï¼ˆå¯ä»¥æŒ‡å®šå›æ»šå¼‚å¸¸ï¼‰ äº‹åŠ¡ä¼ æ’­æœ‰ç°åœ¨è¿™ä¸ªåœºæ™¯ï¼Œæ³¨å†Œä¸»ä¼šå‘˜å’Œæ³¨å†Œå­ç”¨æˆ·ï¼Œè¦æ±‚æ³¨å†Œå­ç”¨æˆ·å¤±è´¥ä¸å½±å“ä¸»ä¼šå‘˜çš„æ³¨å†Œï¼Œä¸‹è¿°ä¼ªä»£ç ï¼Œå¯ä»¥çŒœä¸€ä¸‹ç»“æœ 123456789101112131415@Autowiredprivate UserRepository userRepository;@Autowiredprivate SubUserService subUserService;@Transactionalpublic void createUserWrong(UserEntity entity) &#123; createMainUser(entity); subUserService.createSubUserWithExceptionWrong(entity);&#125;private void createMainUser(UserEntity entity) &#123; userRepository.save(entity); log.info(&quot;createMainUser finish&quot;);&#125; ä¸Šè¿°ä»£ç å¼‚å¸¸è·‘å‡ºäº†@Transactional æ³¨è§£æ ‡è®°çš„ createUserWrong æ–¹æ³•ï¼ŒSpring ä¼šå›æ»šäº‹åŠ¡ ä¿®æ”¹ä¹‹åå¦‚ä¸‹ï¼š 123456789@Transactionalpublic void createUserWrong2(UserEntity entity) &#123; createMainUser(entity); try &#123; subUserService.createSubUserWithExceptionWrong(entity); &#125; catch (Exception ex) &#123; log.error(&quot;create sub user error:&#123;&#125;&quot;, ex.getMessage()); &#125;&#125; è™½ç„¶æ•è·äº†å¼‚å¸¸ï¼Œä½†æ˜¯å› ä¸ºæ²¡æœ‰å¼€å¯æ–°äº‹åŠ¡ï¼Œè€Œå½“å‰äº‹åŠ¡å› ä¸ºå¼‚å¸¸å·²ç»è¢«æ ‡è®°ä¸ºrollbackäº†ï¼Œæ‰€ä»¥æœ€ç»ˆè¿˜æ˜¯ä¼šå›æ»šã€‚ çœ‹åˆ°è¿™é‡Œå°±æ¸…æ¥šäº†ï¼Œåªèƒ½è®©å¤„ç†å­ç”¨æˆ·çš„é€»è¾‘è¿è¡Œåœ¨å•ç‹¬çš„äº‹åŠ¡ä¸­ï¼Œè¿™å°±ç”¨åˆ°äº†SPRINGçš„äº‹åŠ¡ä¼ æ’­æœºåˆ¶ 1234567891011121314151617@Transactional(propagation = Propagation.REQUIRES_NEW)public void createSubUserWithExceptionRight(UserEntity entity) &#123; log.info(&quot;createSubUserWithExceptionRight start&quot;); userRepository.save(entity); throw new RuntimeException(&quot;invalid status&quot;);&#125;@Transactionalpublic void createUserRight(UserEntity entity) &#123; createMainUser(entity); try &#123; subUserService.createSubUserWithExceptionRight(entity); &#125; catch (Exception ex) &#123; // æ•è·å¼‚å¸¸ï¼Œé˜²æ­¢ä¸»æ–¹æ³•å›æ»š log.error(&quot;create sub user error:&#123;&#125;&quot;, ex.getMessage()); &#125;&#125; å¸Œæœ›è¿™æ¬¡åˆ†äº«èƒ½å¸®åŠ©å¤§å®¶æ­£ç¡®å¤„ç†ä¸šåŠ¡ä»£ç ä¸­çš„äº‹åŠ¡ã€‚ å®é™…ä½¿ç”¨è¸©çš„å‘å¤šæ•°æ®æºä¸­ä¸èƒ½ä½¿ç”¨äº‹åŠ¡äº‹åŠ¡å’Œåˆ†å¸ƒå¼é”ä½¿ç”¨çš„å‘ç°è±¡ï¼šä¸šåŠ¡ä¸­åŠ äº†åˆ†å¸ƒå¼é”ï¼Œä¹Ÿåšäº†å¹‚ç­‰å¤„ç†å¦‚æœä¸šåŠ¡IDå­˜åœ¨ç›¸åŒçš„æ•°æ®åˆ™ç›´æ¥è¿”å›ã€‚ä½†è¿˜æ˜¯ä¼šç”Ÿæˆ2æ¡ä¸€æ ·çš„æ•°æ®ã€‚ 123456789101112131415161718192021222324252627282930313233343536@Around(&quot;@annotation(redisLock)&quot;)public Object around(ProceedingJoinPoint joinPoint, RedisLock redisLock) throws Throwable &#123; String spel = redisLock.key(); String lockName = redisLock.lockName(); String redisLockKey = getRedisKey(joinPoint, lockName, spel); log.info(&quot;ç”Ÿæˆçš„ redisKey æ˜¯ -&gt; &#123;&#125;&quot;, redisLockKey); RLock rLock = redissonClient.getLock(redisLockKey); Object result; try &#123; rLock.lock(redisLock.expire(), redisLock.timeUnit()); //æ‰§è¡Œæ–¹æ³• result = joinPoint.proceed(); &#125; catch (InterruptedException interruptedException) &#123; log.error(&quot;è·å–åˆ†å¸ƒå¼é”å¤±è´¥, &quot;, interruptedException); throw new RuntimeException(&quot;è·å–åˆ†å¸ƒå¼é”å¤±è´¥&quot;); &#125; finally &#123; if (rLock.isLocked()) &#123; rLock.unlock(); &#125; &#125; return result;&#125;@Transactional(rollbackFor = RuntimeException.class)@RedisLock(lockName = &quot;test&quot;, key = &quot;test&quot;)public void test() &#123; // æ ¹æ®æ‰‹æœºå·æŸ¥è¯¢ç”¨æˆ· User user = bizService.queryByPhone(&quot;17770848782&quot;); log.info(&quot;user===&#123;&#125;&quot;, user);&#125;@Transactional(rollbackFor = RuntimeException.class)public void test2() &#123; // æ ¹æ®æ‰‹æœºå·æŸ¥è¯¢ç”¨æˆ· User user = bizService.queryByPhone(&quot;17770848782&quot;); log.info(&quot;user2===&#123;&#125;&quot;, user);&#125; 1234567891011121314@GetMapping@Operation(summary = &quot;test2&quot;)@RedisLock(lockName = &quot;test2&quot;, key = &quot;test2&quot;)public ObjectResponse&lt;String&gt; test2() &#123; userAppService.test2(); return ObjectResponse.success();&#125;@PostMapping@Operation(summary = &quot;test&quot;)public ObjectResponse&lt;String&gt; test() &#123; userAppService.test(); return ObjectResponse.success();&#125; ç»“è®ºï¼šå½“ä½¿ç”¨åˆ†å¸ƒå¼é”å’Œäº‹åŠ¡æ—¶ï¼Œå› ä¸ºåˆ‡é¢å¤„ç†æ˜¯ç”¨çš„å…ˆè¿›åå‡ºçš„æ ˆï¼Œåˆå› ä¸ºäº‹åŠ¡å¤„ç†çš„ä¼˜å…ˆçº§æ˜¯é»˜è®¤æœ€ä½çš„ï¼Œæ‰€ä»¥å¦‚æœæ²¡æœ‰çŸ¥é“åˆ†å¸ƒå¼é”çš„ä¼˜å…ˆçº§å°±ä¼šå¯¼è‡´é”å…ˆäºäº‹åŠ¡é‡Šæ”¾ï¼Œå¯¼è‡´å¯èƒ½å‡ºç°äº‹åŠ¡çš„éš”ç¦»æ€§è¢«ç ´åï¼Œäº§ç”Ÿè„æ•°æ®ã€‚","tags":[{"name":"æŠ€æœ¯åˆ†äº«","slug":"æŠ€æœ¯åˆ†äº«","permalink":"https://alexhuihui.github.io/tags/%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB/"}]},{"title":"ã€ELKã€‘springbootç»“åˆelkæ­å»ºæ—¥å¿—å¹³å°","date":"2023-12-06T11:54:06.000Z","path":"article/20231206.html","text":"æœ¬æ–‡ä»‹ç»å¦‚æœé€šè¿‡æ­å»ºELKæ”¶é›†springbootçš„æ—¥å¿—ã€‚ éƒ¨ç½²ELKé€šè¿‡docker composeå®‰è£… å®‰è£…docker compose 12yum install -y yum-utils device-mapper-persistent-data lvm2yum install docker-compose åˆ›å»ºä»¥ä¸‹ç›®å½•ä»¥åŠå¯¹åº”çš„é…ç½®æ–‡ä»¶ 12345678910111213141516.â”œâ”€â”€ docker-compose.ymlâ”œâ”€â”€ elasticsearchâ”‚ â”œâ”€â”€ configâ”‚ â”‚ â””â”€â”€ elasticsearch.ymlâ”‚ â”œâ”€â”€ dataâ”‚ â””â”€â”€ logsâ”œâ”€â”€ kibanaâ”‚ â””â”€â”€ configâ”‚ â””â”€â”€ kibana.ymlâ””â”€â”€ logstash â”œâ”€â”€ config â”‚ â”œâ”€â”€ logstash.yml â”‚ â””â”€â”€ small-tools â”‚ â””â”€â”€ dev-enlightrn-hub.config â””â”€â”€ data 1234567891011# elasticsearch.ymlcluster.name: &quot;docker-cluster&quot;network.host: 0.0.0.0http.port: 9200# å¼€å¯esè·¨åŸŸhttp.cors.enabled: truehttp.cors.allow-origin: &quot;*&quot;http.cors.allow-headers: Authorization# # å¼€å¯å®‰å…¨æ§åˆ¶xpack.security.enabled: truexpack.security.transport.ssl.enabled: true 123456789# kibana.ymlserver.name: kibanaserver.host: &quot;0.0.0.0&quot;server.publicBaseUrl: &quot;http://kibana:5601&quot;elasticsearch.hosts: [ &quot;http://elasticsearch:9200&quot; ] xpack.monitoring.ui.container.elasticsearch.enabled: trueelasticsearch.username: &quot;elastic&quot;elasticsearch.password: &quot;123456&quot;i18n.locale: zh-CN 123456# logstash.ymlhttp.host: &quot;0.0.0.0&quot;xpack.monitoring.enabled: truexpack.monitoring.elasticsearch.hosts: [ &quot;http://elasticsearch:9200&quot; ]xpack.monitoring.elasticsearch.username: &quot;elastic&quot;xpack.monitoring.elasticsearch.password: &quot;123456&quot; 1234567891011121314151617181920212223242526272829303132333435363738394041424344# dev-enlightrn-hub.configinput &#123; #è¾“å…¥ tcp &#123; mode =&gt; &quot;server&quot; host =&gt; &quot;0.0.0.0&quot; # å…è®¸ä»»æ„ä¸»æœºå‘é€æ—¥å¿— type =&gt; &quot;dev-enlighten-hub&quot; # è®¾å®štypeä»¥åŒºåˆ†æ¯ä¸ªè¾“å…¥æº port =&gt; 9999 codec =&gt; json_lines # æ•°æ®æ ¼å¼ &#125; &#125; filter &#123; mutate &#123; # å¯¼å…¥ä¹‹è¿‡æ»¤å­—æ®µ remove_field =&gt; [&quot;LOG_MAX_HISTORY_DAY&quot;, &quot;LOG_HOME&quot;, &quot;APP_NAME&quot;] remove_field =&gt; [&quot;@version&quot;, &quot;_score&quot;, &quot;port&quot;, &quot;level_value&quot;, &quot;tags&quot;, &quot;_type&quot;, &quot;host&quot;] &#125;&#125; output &#123; #è¾“å‡º-æ§åˆ¶å° stdout&#123; codec =&gt; rubydebug &#125;&#125; output &#123; #è¾“å‡º-es if [type] == &quot;dev-enlighten-hub&quot; &#123; elasticsearch &#123; action =&gt; &quot;index&quot; # è¾“å‡ºæ—¶åˆ›å»ºæ˜ å°„ hosts =&gt; &quot;http://elasticsearch:9200&quot; # ESåœ°å€å’Œç«¯å£ user =&gt; &quot;elastic&quot; # ESç”¨æˆ·å password =&gt; &quot;123456&quot; # ESå¯†ç  index =&gt; &quot;dev-enlighten-hub-%&#123;+YYYY.MM.dd&#125;&quot; # æŒ‡å®šç´¢å¼•å-æŒ‰å¤© codec =&gt; &quot;json&quot; &#125; &#125; &#125; ç¼–å†™docker-compose.yml 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859version: &#x27;3.3&#x27;networks: elk: driver: bridgeservices: elasticsearch: image: registry.cn-hangzhou.aliyuncs.com/zhengqing/elasticsearch:7.14.1 container_name: elk_elasticsearch restart: unless-stopped volumes: - &quot;./elasticsearch/data:/usr/share/elasticsearch/data&quot; - &quot;./elasticsearch/logs:/usr/share/elasticsearch/logs&quot; - &quot;./elasticsearch/config/elasticsearch.yml:/usr/share/elasticsearch/config/elasticsearch.yml&quot; environment: TZ: Asia/Shanghai LANG: en_US.UTF-8 TAKE_FILE_OWNERSHIP: &quot;true&quot; # æƒé™ discovery.type: single-node ES_JAVA_OPTS: &quot;-Xmx1g -Xms1g&quot; ELASTIC_PASSWORD: &quot;111111&quot; # elasticè´¦å·å¯†ç  ports: - &quot;9200:9200&quot; - &quot;9300:9300&quot; networks: - elk kibana: image: registry.cn-hangzhou.aliyuncs.com/zhengqing/kibana:7.14.1 container_name: elk_kibana restart: unless-stopped volumes: - &quot;./kibana/config/kibana.yml:/usr/share/kibana/config/kibana.yml&quot; ports: - &quot;5601:5601&quot; depends_on: - elasticsearch links: - elasticsearch networks: - elk logstash: image: registry.cn-hangzhou.aliyuncs.com/zhengqing/logstash:7.14.1 container_name: elk_logstash restart: unless-stopped environment: LS_JAVA_OPTS: &quot;-Xmx1g -Xms1g&quot; volumes: - &quot;./logstash/data:/usr/share/logstash/data&quot; - &quot;./logstash/config/logstash.yml:/usr/share/logstash/config/logstash.yml&quot; - &quot;./logstash/config/small-tools:/usr/share/logstash/config/small-tools&quot; command: logstash -f /usr/share/logstash/config/small-tools ports: - &quot;9600:9600&quot; - &quot;9999:9999&quot; depends_on: - elasticsearch networks: - elk æ‰§è¡Œå¯åŠ¨å‘½ä»¤ 1docker compose up -d å¦‚æœå¯åŠ¨å¤±è´¥å¯ä»¥é€šè¿‡ä¸‹è¿°å‘½ä»¤è¿›è¡Œæ£€æŸ¥é…ç½®é¡¹ 1docker-compose run --rm logstash logstash -t -f /usr/share/logstash/config/small-tools ä¿®æ”¹spring booté¡¹ç›® æ·»åŠ mavenä¾èµ– 12345&lt;dependency&gt; &lt;groupId&gt;net.logstash.logback&lt;/groupId&gt; &lt;artifactId&gt;logstash-logback-encoder&lt;/artifactId&gt; &lt;version&gt;7.3&lt;/version&gt;&lt;/dependency&gt; æ·»åŠ logback-spring.xml 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;configuration scan=&quot;true&quot; scanPeriod=&quot;60 seconds&quot; debug=&quot;false&quot;&gt; &lt;!-- æ—¥å¿—å­˜æ”¾è·¯å¾„ --&gt; &lt;property name=&quot;log.path&quot; value=&quot;$&#123;user.dir&#125;/logs&quot;/&gt; &lt;!-- æ—¥å¿—è¾“å‡ºæ ¼å¼ --&gt; &lt;property name=&quot;log.pattern&quot; value=&quot;%d&#123;HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;20&#125; - [%method,%line] - %msg%n&quot;/&gt; &lt;!-- æ§åˆ¶å°è¾“å‡º --&gt; &lt;appender name=&quot;console&quot; class=&quot;ch.qos.logback.core.ConsoleAppender&quot;&gt; &lt;encoder&gt; &lt;pattern&gt;$&#123;log.pattern&#125;&lt;/pattern&gt; &lt;/encoder&gt; &lt;/appender&gt; &lt;!-- ç³»ç»Ÿæ—¥å¿—è¾“å‡º --&gt; &lt;appender name=&quot;file_info&quot; class=&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;&gt; &lt;file&gt;$&#123;log.path&#125;/info.log&lt;/file&gt; &lt;!-- å¾ªç¯æ”¿ç­–ï¼šåŸºäºæ—¶é—´åˆ›å»ºæ—¥å¿—æ–‡ä»¶ --&gt; &lt;rollingPolicy class=&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;&gt; &lt;!-- æ—¥å¿—æ–‡ä»¶åæ ¼å¼ --&gt; &lt;fileNamePattern&gt;$&#123;log.path&#125;/info.%d&#123;yyyy-MM-dd&#125;.log&lt;/fileNamePattern&gt; &lt;!-- æ—¥å¿—æœ€å¤§çš„å†å² 7å¤© --&gt; &lt;maxHistory&gt;7&lt;/maxHistory&gt; &lt;/rollingPolicy&gt; &lt;encoder&gt; &lt;pattern&gt;$&#123;log.pattern&#125;&lt;/pattern&gt; &lt;/encoder&gt; &lt;filter class=&quot;ch.qos.logback.classic.filter.LevelFilter&quot;&gt; &lt;!-- è¿‡æ»¤çš„çº§åˆ« --&gt; &lt;level&gt;INFO&lt;/level&gt; &lt;!-- åŒ¹é…æ—¶çš„æ“ä½œï¼šæ¥æ”¶ï¼ˆè®°å½•ï¼‰ --&gt; &lt;onMatch&gt;ACCEPT&lt;/onMatch&gt; &lt;!-- ä¸åŒ¹é…æ—¶çš„æ“ä½œï¼šæ‹’ç»ï¼ˆä¸è®°å½•ï¼‰ --&gt; &lt;onMismatch&gt;DENY&lt;/onMismatch&gt; &lt;/filter&gt; &lt;/appender&gt; &lt;appender name=&quot;file_error&quot; class=&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;&gt; &lt;file&gt;$&#123;log.path&#125;/error.log&lt;/file&gt; &lt;!-- å¾ªç¯æ”¿ç­–ï¼šåŸºäºæ—¶é—´åˆ›å»ºæ—¥å¿—æ–‡ä»¶ --&gt; &lt;rollingPolicy class=&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;&gt; &lt;!-- æ—¥å¿—æ–‡ä»¶åæ ¼å¼ --&gt; &lt;fileNamePattern&gt;$&#123;log.path&#125;/error.%d&#123;yyyy-MM-dd&#125;.log&lt;/fileNamePattern&gt; &lt;!-- æ—¥å¿—æœ€å¤§çš„å†å² 60å¤© --&gt; &lt;maxHistory&gt;60&lt;/maxHistory&gt; &lt;/rollingPolicy&gt; &lt;encoder&gt; &lt;pattern&gt;$&#123;log.pattern&#125;&lt;/pattern&gt; &lt;/encoder&gt; &lt;filter class=&quot;ch.qos.logback.classic.filter.LevelFilter&quot;&gt; &lt;!-- è¿‡æ»¤çš„çº§åˆ« --&gt; &lt;level&gt;ERROR&lt;/level&gt; &lt;!-- åŒ¹é…æ—¶çš„æ“ä½œï¼šæ¥æ”¶ï¼ˆè®°å½•ï¼‰ --&gt; &lt;onMatch&gt;ACCEPT&lt;/onMatch&gt; &lt;!-- ä¸åŒ¹é…æ—¶çš„æ“ä½œï¼šæ‹’ç»ï¼ˆä¸è®°å½•ï¼‰ --&gt; &lt;onMismatch&gt;DENY&lt;/onMismatch&gt; &lt;/filter&gt; &lt;/appender&gt; &lt;!-- å°†æ—¥å¿—æ–‡ä»¶è¾“å‡ºåˆ°Logstash --&gt; &lt;appender name=&quot;logstash&quot; class=&quot;net.logstash.logback.appender.LogstashTcpSocketAppender&quot;&gt; &lt;!-- è·å–logstashåœ°å€ä½œä¸ºè¾“å‡ºçš„ç›®çš„åœ° --&gt; &lt;destination&gt;172.22.0.4:9999&lt;/destination&gt; &lt;encoder chatset=&quot;UTF-8&quot; class=&quot;net.logstash.logback.encoder.LogstashEncoder&quot;/&gt; &lt;/appender&gt; &lt;!-- ç³»ç»Ÿæ¨¡å—æ—¥å¿—çº§åˆ«æ§åˆ¶ --&gt; &lt;logger name=&quot;com.gyhappylife&quot; level=&quot;info&quot;/&gt; &lt;!-- Springæ—¥å¿—çº§åˆ«æ§åˆ¶ --&gt; &lt;logger name=&quot;org.springframework&quot; level=&quot;warn&quot;/&gt; &lt;root level=&quot;info&quot;&gt; &lt;appender-ref ref=&quot;console&quot;/&gt; &lt;/root&gt; &lt;!--ç³»ç»Ÿæ“ä½œæ—¥å¿—--&gt; &lt;root level=&quot;info&quot;&gt; &lt;appender-ref ref=&quot;file_info&quot;/&gt; &lt;appender-ref ref=&quot;file_error&quot;/&gt; &lt;appender-ref ref=&quot;logstash&quot;/&gt; &lt;/root&gt;&lt;/configuration&gt; æ³¨æ„äº‹é¡¹å¦‚æœspringåº”ç”¨ä¹Ÿæ˜¯è·‘åœ¨dockerä¸­çš„è¯ é‚£ä¹ˆå®ƒçš„ç½‘æ®µå¯èƒ½ä¼šå’ŒELKä¸ä¸€æ · ã€‚è¿™æ ·å°±å¿…é¡»åœ¨iptablesä¸­æ·»åŠ è·¯ç”±è§„åˆ™ä¾‹å¦‚: 12$ iptables -I DOCKER-USER -i br-3bed419583c5 -o br-787e52a81bb4 -j ACCEPT$ iptables -I DOCKER-USER -i br-787e52a81bb4 -o br-3bed419583c5 -j ACCEPT","tags":[{"name":"ELK","slug":"ELK","permalink":"https://alexhuihui.github.io/tags/ELK/"}]},{"title":"ã€æŠ€æœ¯åˆ†äº«ã€‘ä¼˜åŒ–å»¶è¿Ÿé˜Ÿåˆ—ä»»åŠ¡æ¶ˆè´¹æ—¶é—´çš„æŠ€æœ¯åˆ†äº«","date":"2023-10-19T11:54:06.000Z","path":"article/20231019.html","text":"å»¶è¿Ÿé˜Ÿåˆ—åœ¨å®é™…åº”ç”¨ä¸­æ˜¯ä¸€é¡¹é‡è¦çš„æŠ€æœ¯ï¼Œå¯ä»¥ç”¨äºä»»åŠ¡è°ƒåº¦ã€å®šæ—¶æé†’ã€æ¶ˆæ¯é‡è¯•ç­‰å¤šç§åœºæ™¯ã€‚ç„¶è€Œï¼Œå»¶è¿Ÿé˜Ÿåˆ—çš„ä»»åŠ¡æœ‰æ—¶ä¼šåœ¨è¿‡æœŸæ—¶é—´ä¹‹åæ‰å¾—ä»¥æ‰§è¡Œï¼Œè¿™å¯èƒ½å¯¼è‡´åº”ç”¨ç¨‹åºçš„æ€§èƒ½é—®é¢˜å’Œä¸ç¡®å®šæ€§ã€‚åœ¨æœ¬æŠ€æœ¯åˆ†äº«ä¸­ï¼Œæˆ‘å°†ä»‹ç»ä¸€ä¸ªä¼˜åŒ–å»¶è¿Ÿé˜Ÿåˆ—ä»»åŠ¡æ¶ˆè´¹æ—¶é—´çš„è§£å†³æ–¹æ¡ˆï¼Œä»¥åŠå¦‚ä½•å®ç°è¿™ä¸€è§£å†³æ–¹æ¡ˆã€‚ å»¶è¿Ÿé˜Ÿåˆ—å®ç°åŸç† åœ¨æˆ‘ä»¬å¼€å§‹è®¨è®ºå¦‚ä½•ä¼˜åŒ–å»¶è¿Ÿé˜Ÿåˆ—çš„ä»»åŠ¡æ¶ˆè´¹æ—¶é—´ä¹‹å‰ï¼Œè®©æˆ‘ä»¬é¦–å…ˆäº†è§£ä¸€ä¸‹å»¶è¿Ÿé˜Ÿåˆ—çš„å®ç°åŸç†ã€‚è¿™ä¸ªå»¶è¿Ÿé˜Ÿåˆ—åŸºäºRediså’ŒRedissonåº“å®ç°ï¼Œå®ƒåˆ†ä¸ºä¸‰ä¸ªä¸»è¦é˜¶æ®µï¼šå¯åŠ¨ã€ä»»åŠ¡æ·»åŠ å’Œä»»åŠ¡æ¶ˆè´¹ã€‚ ç¬¬ä¸€é˜¶æ®µï¼šå¯åŠ¨ è®¢é˜…é˜Ÿåˆ—ï¼šåœ¨è¿™ä¸ªé˜¶æ®µï¼Œæˆ‘ä»¬è®¢é˜…äº†ä¸€ä¸ªåä¸ºâ€redisson_delay_queue_channel:{dest_queue1}â€çš„å›ºå®šé˜Ÿåˆ—ï¼Œç”¨äºæ¥æ”¶ä»»åŠ¡åˆ°æœŸçš„é€šçŸ¥ã€‚ è·å–è¿‡æœŸä»»åŠ¡ï¼šä½¿ç”¨zrangebyscoreå‘½ä»¤ï¼Œæˆ‘ä»¬è·å–äº†è¿‡äº†å½“å‰æ—¶é—´çš„100æ¡ä»»åŠ¡æ•°æ®ï¼Œä»¥ç¡®ä¿æ²¡æœ‰æ¼æ‰ä¸Šæ¬¡å®•æœºåæœªæ‰§è¡Œçš„ä»»åŠ¡ã€‚ åˆ¤æ–­ä¸‹ä¸€é¡µï¼šé€šè¿‡zrangeå‘½ä»¤ï¼Œæˆ‘ä»¬æ£€æŸ¥æ˜¯å¦è¿˜æœ‰ä¸‹ä¸€é¡µçš„ä»»åŠ¡éœ€è¦å¤„ç†ã€‚ ç§»é™¤ä»»åŠ¡ï¼šä½¿ç”¨BLPOPå‘½ä»¤ï¼Œæˆ‘ä»¬ç§»é™¤å¹¶è·å–äº†é˜Ÿåˆ—â€dest_queue1â€ä¸­çš„ç¬¬ä¸€ä¸ªä»»åŠ¡ï¼Œå¦‚æœé˜Ÿåˆ—ä¸ºç©ºï¼Œè¯¥æ“ä½œä¼šä¸€ç›´é˜»å¡ã€‚ ç¬¬äºŒé˜¶æ®µï¼šæ·»åŠ å»¶æ—¶ä»»åŠ¡ æ·»åŠ ä»»åŠ¡ï¼šä½¿ç”¨zaddå‘½ä»¤ï¼Œæˆ‘ä»¬å°†ä»»åŠ¡æ·»åŠ åˆ°â€redisson_delay_queue_timeout:{dest_queue1}â€ã€‚ åŒæ­¥æ•°æ®ï¼šå°†ä»»åŠ¡æ•°æ®åŒæ­¥åˆ°â€redisson_delay_queue:{dest_queue1}â€ã€‚ è·å–å³å°†è§¦å‘çš„ä»»åŠ¡ï¼šé€šè¿‡zrangeå‘½ä»¤ï¼Œæˆ‘ä»¬è·å–äº†å³å°†è§¦å‘çš„ä»»åŠ¡ã€‚ å‘å¸ƒé€šçŸ¥ï¼šä½¿ç”¨publishå‘½ä»¤ï¼Œæˆ‘ä»¬å‘â€redisson_delay_queue_channel:{dest_queue1}â€å‘å¸ƒäº†ä»»åŠ¡åˆ°æœŸçš„æ¶ˆæ¯ï¼Œå®¢æˆ·ç«¯æ”¶åˆ°é€šçŸ¥åä¼šåœ¨è‡ªå·±çš„è¿›ç¨‹ä¸­æ‰§è¡Œå»¶æ—¶ä»»åŠ¡ã€‚ ç¬¬ä¸‰é˜¶æ®µï¼šä»»åŠ¡æ¶ˆè´¹ è·å–åˆ°æœŸä»»åŠ¡ï¼šä½¿ç”¨zrangebyscoreå‘½ä»¤ï¼Œæˆ‘ä»¬è·å–äº†â€redisson_delay_queue_timeout:{dest_queue1}â€ä¸­å·²åˆ°æœŸçš„ä»»åŠ¡ã€‚ å°†ä»»åŠ¡æ”¾å…¥é˜Ÿåˆ—ï¼šé€šè¿‡rpushå‘½ä»¤ï¼Œæˆ‘ä»¬å°†è¿™äº›ä»»åŠ¡æ”¾å…¥ç¬¬ä¸€é˜¶æ®µç›‘å¬çš„é˜»å¡é˜Ÿåˆ—â€dest_queue1â€ã€‚ å®¢æˆ·ç«¯æ¶ˆè´¹ä»»åŠ¡ï¼šå®¢æˆ·ç«¯è·å–è¿™äº›æ•°æ®å¹¶è¿›è¡Œå¤„ç†ã€‚ åˆ é™¤ä»»åŠ¡ï¼šä½¿ç”¨lremå’Œzremå‘½ä»¤ï¼Œæˆ‘ä»¬åˆ é™¤å·²ç»å¤„ç†è¿‡çš„ä»»åŠ¡ã€‚ æ£€æŸ¥ä¸‹ä¸€ä¸ªä»»åŠ¡ï¼šé€šè¿‡zrangeå‘½ä»¤ï¼Œæˆ‘ä»¬æ£€æŸ¥æ˜¯å¦æœ‰ä¸‹ä¸€ä¸ªä»»åŠ¡éœ€è¦å¤„ç†ã€‚ ç»§ç»­ç›‘å¬ï¼šä½¿ç”¨BLPOPå‘½ä»¤ï¼Œæˆ‘ä»¬ç»§ç»­ç›‘å¬â€dest_queue1â€è¿™ä¸ªé˜»å¡é˜Ÿåˆ—ã€‚ é—®é¢˜åˆ†æ ä¸Šè¿°å®ç°ä¸­ï¼Œå®¢æˆ·ç«¯è®¢é˜…äº†ä¸€ä¸ªå…³é”®å­—ï¼ˆkeyï¼‰ï¼Œå¹¶ä¸”ä¼šåœ¨ç±»åˆå§‹åŒ–ä¸­æ‰§è¡Œè¯¥è®¢é˜…æ“ä½œã€‚ç„¶è€Œï¼Œåœ¨æµ‹è¯•ç¯å¢ƒä¸­ï¼ŒæœåŠ¡é¢‘ç¹å‡çº§å’Œé‡å¯ï¼Œåªæœ‰åœ¨è°ƒç”¨å»¶è¿Ÿé˜Ÿåˆ—å®¢æˆ·ç«¯çš„é™æ€æ–¹æ³•æ—¶æ‰ä¼šæ‰§è¡Œç±»åˆå§‹åŒ–ã€‚å› æ­¤ï¼Œå½“æœåŠ¡é‡å¯åæœªå†æ¬¡è®¢é˜…ç›¸åº”çš„keyï¼Œå¯¼è‡´æ— æ³•ä»Redisè·å–ä»»åŠ¡æ•°æ®ï¼Œå»¶è¿Ÿé˜Ÿåˆ—çš„ä»»åŠ¡æ¶ˆè´¹æ—¶é—´è¢«æ¨è¿Ÿã€‚ ä¼˜åŒ–å»¶è¿Ÿé˜Ÿåˆ—ä»»åŠ¡æ¶ˆè´¹æ—¶é—´çš„è§£å†³æ–¹æ¡ˆ ä¸ºäº†ä¼˜åŒ–å»¶è¿Ÿé˜Ÿåˆ—ä»»åŠ¡çš„æ¶ˆè´¹æ—¶é—´ï¼Œæˆ‘ä»¬é‡‡ç”¨äº†Redissonåº“æ¥å®ç°å»¶è¿Ÿé˜Ÿåˆ—ã€‚ä¸‹é¢æ˜¯è§£å†³æ–¹æ¡ˆçš„ä¸»è¦æ­¥éª¤ï¼š 1. å®šä¹‰æ¥å£ é¦–å…ˆï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªåä¸ºQueueçš„æ¥å£ï¼Œç”¨äºè¡¨ç¤ºå»¶è¿Ÿé˜Ÿåˆ—ã€‚ 2. å®ç°æŠ½è±¡ç±» æˆ‘ä»¬å®ç°äº†ä¸€ä¸ªåä¸ºAbstractQueueçš„æŠ½è±¡ç±»ï¼Œè¯¥ç±»åŒ…å«äº†å®ç°å»¶è¿Ÿé˜Ÿåˆ—æ‰€éœ€çš„æ ¸å¿ƒé€»è¾‘ã€‚ä»¥ä¸‹æ˜¯è¯¥æŠ½è±¡ç±»çš„å…³é”®éƒ¨åˆ†ï¼š ä½¿ç”¨Redissonå®¢æˆ·ç«¯ï¼šé€šè¿‡Springé…ç½®ï¼Œæˆ‘ä»¬åˆå§‹åŒ–äº†Redissonå®¢æˆ·ç«¯ï¼Œä»¥ä¾¿ä¸RedisæœåŠ¡å™¨é€šä¿¡ã€‚ å®šä¹‰ç›‘å¬å™¨å®¹å™¨ï¼šæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªåä¸ºlistenerMapçš„å®¹å™¨ï¼Œç”¨äºå­˜å‚¨ä¸topicç›¸å…³çš„é˜Ÿåˆ—ç›‘å¬å™¨ã€‚ å¯åŠ¨ç›‘å¬çº¿ç¨‹ï¼šåœ¨æ„é€ å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬å¼€å¯äº†ä¸€ä¸ªç‹¬ç«‹çš„çº¿ç¨‹æ¥ç›‘å¬é˜Ÿåˆ—çš„æ¶ˆæ¯ã€‚è¿™ç¡®ä¿äº†ä»»åŠ¡èƒ½å¤ŸåŠæ—¶è¢«å¤„ç†ã€‚ å®ç°æ¶ˆè´¹é€»è¾‘ï¼šæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªconsumeræ–¹æ³•ï¼Œç”¨äºåœ¨ç›‘å¬åˆ°æ¶ˆæ¯æ—¶å¤„ç†é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ã€‚è¯¥æ–¹æ³•é¦–å…ˆè·å–ä¸æ¶ˆæ¯å¯¹åº”çš„é˜Ÿåˆ—ç›‘å¬å™¨ï¼Œç„¶åæ‰§è¡Œä»»åŠ¡çš„æ¶ˆè´¹é€»è¾‘ã€‚ 3. å­ç±»å®ç° æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªåä¸ºDelayQueueçš„å­ç±»ï¼Œå®ƒç»§æ‰¿äº†AbstractQueueå¹¶å®ç°äº†å…¶ä¸­çš„æŠ½è±¡æ–¹æ³•ã€‚ä»¥ä¸‹æ˜¯è¯¥å­ç±»çš„å…³é”®éƒ¨åˆ†ï¼š åˆ›å»ºå»¶è¿Ÿé˜Ÿåˆ—ï¼šæˆ‘ä»¬ä½¿ç”¨Redissonå®¢æˆ·ç«¯åˆ›å»ºäº†RBlockingDequeå’ŒRDelayedQueueï¼Œè¿™æ˜¯å»¶è¿Ÿé˜Ÿåˆ—çš„åŸºæœ¬æ•°æ®ç»“æ„ã€‚ æ·»åŠ ä»»åŠ¡ï¼šé€šè¿‡offeræ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥å‘RDelayedQueueä¸­æ·»åŠ å»¶æ—¶ä»»åŠ¡ã€‚ æ¶ˆè´¹ä»»åŠ¡ï¼šåœ¨takeæ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬ä»RBlockingDequeä¸­è·å–ä»»åŠ¡æ•°æ®ï¼Œç„¶åå¼€å¯çº¿ç¨‹æ‰§è¡Œæ¶ˆè´¹é€»è¾‘ã€‚ ä½¿ç”¨ç¤ºä¾‹ æœ€åï¼Œæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªDelayClientç±»ï¼Œå®ƒç”¨äºå‘å»¶è¿Ÿé˜Ÿåˆ—ä¸­æ·»åŠ ä»»åŠ¡ã€‚é€šè¿‡è°ƒç”¨offeræ–¹æ³•ï¼Œç”¨æˆ·å¯ä»¥æ–¹ä¾¿åœ°å°†ä»»åŠ¡åŠ å…¥å»¶è¿Ÿé˜Ÿåˆ—ï¼Œæ— éœ€æ‹…å¿ƒç±»åˆå§‹åŒ–é—®é¢˜ã€‚ å®ç°å»¶è¿Ÿé˜Ÿåˆ—çš„è®¾è®¡å…·æœ‰ä»¥ä¸‹ä¼˜ç‚¹ï¼š å®æ—¶æ€§ï¼šé‡‡ç”¨Rediså’ŒRedissonåº“å®ç°çš„å»¶è¿Ÿé˜Ÿåˆ—æ— éœ€è½®è¯¢ï¼Œä»»åŠ¡å¯ä»¥åœ¨åˆ°æœŸæ—¶ç«‹å³è¢«å¤„ç†ï¼Œæä¾›äº†æ›´å¥½çš„å®æ—¶æ€§ã€‚ å¯æ‰©å±•æ€§ï¼šå»¶è¿Ÿé˜Ÿåˆ—çš„è®¾è®¡æ”¯æŒåº”ç”¨ç¨‹åºçš„æ°´å¹³æ‰©å±•ã€‚å¯ä»¥è½»æ¾åœ°æ·»åŠ æ›´å¤šçš„æ¶ˆè´¹è€…æ¥å¤„ç†å¤§é‡çš„å»¶è¿Ÿä»»åŠ¡ï¼Œè€Œæ— éœ€æ‹…å¿ƒæ€§èƒ½é—®é¢˜ã€‚ å®¹é”™æ€§ï¼šå³ä½¿åœ¨æœåŠ¡å‡çº§æˆ–é‡å¯æ—¶ï¼Œå»¶è¿Ÿé˜Ÿåˆ—ä»èƒ½å¤Ÿæ­£å¸¸å·¥ä½œï¼Œä¸ä¼šä¸¢å¤±ä»»ä½•ä»»åŠ¡ã€‚ çµæ´»æ€§ï¼šä½¿ç”¨æŠ½è±¡ç±»å’Œæ¥å£çš„è®¾è®¡ï¼Œå¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚æ‰©å±•å’Œå®šåˆ¶å»¶è¿Ÿé˜Ÿåˆ—çš„åŠŸèƒ½ã€‚å¯ä»¥æ·»åŠ ä¸åŒç±»å‹çš„é˜Ÿåˆ—ç›‘å¬å™¨ï¼Œå®ç°å„ç§ä»»åŠ¡æ¶ˆè´¹é€»è¾‘ã€‚ ç»“è¯­ é€šè¿‡ä½¿ç”¨Redissonå’Œåˆç†çš„è®¾è®¡ï¼Œæˆ‘ä»¬æˆåŠŸä¼˜åŒ–äº†å»¶è¿Ÿé˜Ÿåˆ—çš„ä»»åŠ¡æ¶ˆè´¹æ—¶é—´ï¼Œæé«˜äº†ç³»ç»Ÿçš„æ€§èƒ½å’Œç¨³å®šæ€§ã€‚è¿™ç§æŠ€æœ¯å¯¹äºéœ€è¦å¤„ç†å»¶è¿Ÿä»»åŠ¡çš„åº”ç”¨ç¨‹åºéå¸¸æœ‰ç”¨ï¼Œå¦‚å®šæ—¶ä»»åŠ¡ã€æ¶ˆæ¯é€šçŸ¥å’Œæ¶ˆæ¯é‡è¯•ç­‰åœºæ™¯ã€‚ åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œå¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚è¿›ä¸€æ­¥æ‰©å±•å’Œä¼˜åŒ–è¿™ä¸€è§£å†³æ–¹æ¡ˆï¼Œä»¥é€‚åº”ä¸åŒçš„åº”ç”¨åœºæ™¯ã€‚åŒæ—¶ï¼Œè¿˜å¯ä»¥è€ƒè™‘æ·»åŠ ç›‘æ§å’Œæ—¥å¿—è®°å½•ï¼Œä»¥ä¾¿æ›´å¥½åœ°è·Ÿè¸ªå’Œè°ƒè¯•å»¶è¿Ÿé˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ã€‚é€šè¿‡åˆé€‚çš„å·¥å…·å’Œè®¾è®¡ï¼Œå»¶è¿Ÿé˜Ÿåˆ—å¯ä»¥æˆä¸ºæé«˜åº”ç”¨ç¨‹åºæ•ˆç‡å’Œå¯é æ€§çš„é‡è¦ç»„æˆéƒ¨åˆ†ã€‚","tags":[{"name":"æŠ€æœ¯åˆ†äº«","slug":"æŠ€æœ¯åˆ†äº«","permalink":"https://alexhuihui.github.io/tags/%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB/"}]},{"title":"ã€Kafkaã€‘Kafkaçš„åŸºæœ¬ä½¿ç”¨","date":"2023-09-15T11:54:06.000Z","path":"article/20230915.html","text":"æ¶ˆæ¯å¼•æ“ç³»ç»Ÿä»‹ç» Apache Kafkaæ˜¯ä¸€æ¬¾å¼€æºçš„æ¶ˆæ¯å¼•æ“ç³»ç»Ÿã€‚æ ¹æ®ç»´åŸºç™¾ç§‘çš„å®šä¹‰ï¼Œæ¶ˆæ¯å¼•æ“ç³»ç»Ÿæ˜¯ä¸€ç»„è§„èŒƒã€‚ä¼ä¸šåˆ©ç”¨è¿™ç»„è§„èŒƒåœ¨ä¸åŒç³»ç»Ÿä¹‹é—´ä¼ é€’è¯­ä¹‰å‡†ç¡®çš„æ¶ˆæ¯ï¼Œå®ç°æ¾è€¦åˆçš„å¼‚æ­¥å¼æ•°æ®ä¼ é€’ã€‚é€šä¿—æ¥è®²ï¼Œå°±æ˜¯ç³»ç»ŸAå‘é€æ¶ˆæ¯åˆ°æ¶ˆæ¯å¼•æ“ç³»ç»Ÿï¼Œç³»ç»ŸBä»æ¶ˆæ¯å¼•æ“ç³»ç»Ÿä¸­è¯»å–Aå‘é€çš„æ¶ˆæ¯ã€‚ æ¶ˆæ¯å¼•æ“ç³»ç»Ÿè¦è®¾å®šå…·ä½“çš„ä¼ è¾“åè®®ï¼Œå¸¸è§çš„æœ‰2ç§ï¼šç‚¹å¯¹ç‚¹æ¨¡å‹ï¼›å‘å¸ƒè®¢é˜…æ¨¡å‹ã€‚KafkaåŒäº‹æ”¯æŒè¿™ä¸¤ç§ã€‚ ä¸»è¦ä½œç”¨æ˜¯å‰Šå³°å¡«è°·ï¼Œé¿å…ä¸‹æ¸¸ç³»ç»Ÿå› çªå‘æµé‡è€Œå´©æºƒã€‚ æœ¯è¯­ç®€ä»‹ æ¶ˆæ¯ï¼šRecordã€‚Kafka æ˜¯æ¶ˆæ¯å¼•æ“å˜›ï¼Œè¿™é‡Œçš„æ¶ˆæ¯å°±æ˜¯æŒ‡ Kafka å¤„ç†çš„ä¸»è¦å¯¹è±¡ã€‚ ä¸»é¢˜ï¼šTopicã€‚ä¸»é¢˜æ˜¯æ‰¿è½½æ¶ˆæ¯çš„é€»è¾‘å®¹å™¨ï¼Œåœ¨å®é™…ä½¿ç”¨ä¸­å¤šç”¨æ¥åŒºåˆ†å…·ä½“çš„ä¸šåŠ¡ã€‚ åˆ†åŒºï¼šPartitionã€‚ä¸€ä¸ªæœ‰åºä¸å˜çš„æ¶ˆæ¯åºåˆ—ã€‚æ¯ä¸ªä¸»é¢˜ä¸‹å¯ä»¥æœ‰å¤šä¸ªåˆ†åŒºã€‚ æ¶ˆæ¯ä½ç§»ï¼šOffsetã€‚è¡¨ç¤ºåˆ†åŒºä¸­æ¯æ¡æ¶ˆæ¯çš„ä½ç½®ä¿¡æ¯ï¼Œæ˜¯ä¸€ä¸ªå•è°ƒé€’å¢ä¸”ä¸å˜çš„å€¼ã€‚ å‰¯æœ¬ï¼šReplicaã€‚Kafka ä¸­åŒä¸€æ¡æ¶ˆæ¯èƒ½å¤Ÿè¢«æ‹·è´åˆ°å¤šä¸ªåœ°æ–¹ä»¥æä¾›æ•°æ®å†—ä½™ï¼Œè¿™äº›åœ°æ–¹å°±æ˜¯æ‰€è°“çš„å‰¯æœ¬ã€‚å‰¯æœ¬è¿˜åˆ†ä¸ºé¢†å¯¼è€…å‰¯æœ¬å’Œè¿½éšè€…å‰¯æœ¬ï¼Œå„è‡ªæœ‰ä¸åŒçš„è§’è‰²åˆ’åˆ†ã€‚å‰¯æœ¬æ˜¯åœ¨åˆ†åŒºå±‚çº§ä¸‹çš„ï¼Œå³æ¯ä¸ªåˆ†åŒºå¯é…ç½®å¤šä¸ªå‰¯æœ¬å®ç°é«˜å¯ç”¨ã€‚ ç”Ÿäº§è€…ï¼šProducerã€‚å‘ä¸»é¢˜å‘å¸ƒæ–°æ¶ˆæ¯çš„åº”ç”¨ç¨‹åºã€‚ æ¶ˆè´¹è€…ï¼šConsumerã€‚ä»ä¸»é¢˜è®¢é˜…æ–°æ¶ˆæ¯çš„åº”ç”¨ç¨‹åºã€‚ æ¶ˆè´¹è€…ä½ç§»ï¼šConsumer Offsetã€‚è¡¨å¾æ¶ˆè´¹è€…æ¶ˆè´¹è¿›åº¦ï¼Œæ¯ä¸ªæ¶ˆè´¹è€…éƒ½æœ‰è‡ªå·±çš„æ¶ˆè´¹è€…ä½ç§»ã€‚ æ¶ˆè´¹è€…ç»„ï¼šConsumer Groupã€‚å¤šä¸ªæ¶ˆè´¹è€…å®ä¾‹å…±åŒç»„æˆçš„ä¸€ä¸ªç»„ï¼ŒåŒæ—¶æ¶ˆè´¹å¤šä¸ªåˆ†åŒºä»¥å®ç°é«˜ååã€‚ é‡å¹³è¡¡ï¼šRebalanceã€‚æ¶ˆè´¹è€…ç»„å†…æŸä¸ªæ¶ˆè´¹è€…å®ä¾‹æŒ‚æ‰åï¼Œå…¶ä»–æ¶ˆè´¹è€…å®ä¾‹è‡ªåŠ¨é‡æ–°åˆ†é…è®¢é˜…ä¸»é¢˜åˆ†åŒºçš„è¿‡ç¨‹ã€‚Rebalance æ˜¯ Kafka æ¶ˆè´¹è€…ç«¯å®ç°é«˜å¯ç”¨çš„é‡è¦æ‰‹æ®µã€‚","tags":[{"name":"Kafka","slug":"Kafka","permalink":"https://alexhuihui.github.io/tags/Kafka/"}]},{"title":"ã€å¹¶å‘ã€‘Javaå’ŒGoçš„å¹¶å‘ç¼–ç¨‹å¯¹æ¯”","date":"2023-06-16T11:54:06.000Z","path":"article/20230616.html","text":"Goä½¿ç”¨çš„æ˜¯CSPå¹¶å‘æ¨¡å‹ï¼Œè€ŒJAVAä½¿ç”¨çš„æ˜¯åŸºäºä¼ ç»Ÿçš„å†…å­˜è®¿é—®æ§åˆ¶çš„å¹¶å‘æ¨¡å‹ã€‚ä»–ä»¬æœ‰ä»¥ä¸‹åŒºåˆ«ã€‚æˆ‘ä»¬é€šè¿‡ç¤ºä¾‹ä»£ç æ¥æ¯”å¯¹ä¸€ä¸‹Goå’Œ Javaçš„å¹¶å‘ç¼–ç¨‹ â€œCommunicating Sequential Processesâ€ (CSP) æ˜¯ä¸€ç§å¹¶å‘è®¡ç®—çš„æ•°å­¦æ¨¡å‹ï¼Œæœ€æ—©ç”±è®¡ç®—æœºç§‘å­¦å®¶Tony Hoareäº1978å¹´æå‡ºã€‚CSP çš„ä¸»è¦ç›®æ ‡æ˜¯æè¿°å¹¶å‘ç³»ç»Ÿä¸­è¿›ç¨‹ä¹‹é—´çš„äº¤äº’å’Œé€šä¿¡æ–¹å¼ï¼Œè€Œä¸æ¶‰åŠå…±äº«å†…å­˜çš„æ¦‚å¿µã€‚ä¸ä¼ ç»Ÿçš„å†…å­˜è®¿é—®æ§åˆ¶æœ‰å¾ˆå¤§çš„åŒºåˆ«ï¼Œä¸‹é¢æ˜¯ä¸€äº›ä¸»è¦çš„åŒºåˆ«ï¼š é€šä¿¡æ–¹å¼ï¼š CSPï¼š ä½¿ç”¨è¿›ç¨‹ä¹‹é—´çš„æ˜ç¡®é€šä¿¡æ¥å®ç°ååŒå·¥ä½œã€‚è¿›ç¨‹é€šè¿‡å‘é€å’Œæ¥æ”¶æ¶ˆæ¯è¿›è¡Œé€šä¿¡ï¼Œä½†å®ƒä»¬å¹¶ä¸å…±äº«å†…å­˜ç©ºé—´ã€‚ ä¼ ç»Ÿå†…å­˜è®¿é—®æ§åˆ¶ï¼š å¤šä¸ªè¿›ç¨‹å¯èƒ½åœ¨åŒä¸€å—å†…å­˜ä¸­è¿›è¡Œè¯»å†™æ“ä½œï¼Œé€šè¿‡å…±äº«å†…å­˜æ¥å®ç°é€šä¿¡ã€‚è¿™å¯èƒ½å¯¼è‡´è¯¸å¦‚ç«æ€æ¡ä»¶å’Œæ­»é”ç­‰é—®é¢˜ã€‚ å¹¶å‘æ¨¡å‹ï¼š CSPï¼š é‡‡ç”¨äº‹ä»¶é©±åŠ¨çš„æ–¹å¼ï¼Œè¿›ç¨‹ä¹‹é—´é€šè¿‡æ¶ˆæ¯ä¼ é€’è¿›è¡Œé€šä¿¡ï¼Œä»¥å®ç°å¹¶å‘ã€‚å¹¶å‘åœ¨è¿™é‡Œæ˜¯é€šè¿‡åä½œå’Œé€šä¿¡è€Œéå…±äº«çŠ¶æ€æ¥å®ç°çš„ã€‚ ä¼ ç»Ÿå†…å­˜è®¿é—®æ§åˆ¶ï¼š å¹¶å‘é€šå¸¸æ˜¯é€šè¿‡å¤šä¸ªè¿›ç¨‹æˆ–çº¿ç¨‹å…±äº«åŒä¸€å—å†…å­˜æ¥å®ç°çš„ã€‚è¿™å¯èƒ½å¼•å…¥ä¸€ç³»åˆ—å¹¶å‘æ§åˆ¶é—®é¢˜ï¼Œå¦‚é”å’ŒåŒæ­¥ã€‚ æ•°æ®å…±äº«ï¼š CSPï¼š é¼“åŠ±é¿å…å…±äº«æ•°æ®ï¼Œè€Œæ˜¯é€šè¿‡æ¶ˆæ¯ä¼ é€’æ¥ä¼ é€’å¿…è¦çš„ä¿¡æ¯ã€‚è¿™æ ·è®¾è®¡æœ‰åŠ©äºå‡å°‘ç«æ€æ¡ä»¶å’Œæé«˜ç³»ç»Ÿçš„å¯é æ€§ã€‚ ä¼ ç»Ÿå†…å­˜è®¿é—®æ§åˆ¶ï¼š é€šå¸¸æ¶‰åŠå¤šä¸ªè¿›ç¨‹æˆ–çº¿ç¨‹å…±äº«ç›¸åŒçš„å†…å­˜åŒºåŸŸï¼Œéœ€è¦ä½¿ç”¨é”æˆ–å…¶ä»–åŒæ­¥æœºåˆ¶æ¥ç¡®ä¿æ•°æ®ä¸€è‡´æ€§ã€‚ åŒæ­¥å’Œäº’æ–¥ï¼š CSPï¼š ä½¿ç”¨é€šä¿¡æœºåˆ¶æ¥è¿›è¡ŒåŒæ­¥ï¼Œè¿›ç¨‹ä¹‹é—´é€šè¿‡æ¶ˆæ¯ä¼ é€’åè°ƒå„è‡ªçš„åŠ¨ä½œã€‚ ä¼ ç»Ÿå†…å­˜è®¿é—®æ§åˆ¶ï¼š å¸¸å¸¸éœ€è¦ä½¿ç”¨é”æˆ–ä¿¡å·é‡ç­‰æœºåˆ¶æ¥è¿›è¡ŒåŒæ­¥å’Œäº’æ–¥ï¼Œä»¥é˜²æ­¢å¤šä¸ªè¿›ç¨‹åŒæ—¶è®¿é—®å…±äº«çš„å†…å­˜åŒºåŸŸã€‚ æ€»çš„æ¥è¯´ï¼ŒCSP æä¾›äº†ä¸€ç§ä¸åŒäºä¼ ç»Ÿå…±äº«å†…å­˜çš„å¹¶å‘æ¨¡å‹ï¼Œå¼ºè°ƒé€šè¿‡æ˜ç¡®çš„é€šä¿¡æ¥å®ç°è¿›ç¨‹ä¹‹é—´çš„ååŒå·¥ä½œï¼Œä»¥å‡å°‘å¹¶å‘é—®é¢˜çš„å‡ºç°ã€‚è¿™ç§æ–¹å¼æ›´å®¹æ˜“æ¨ç†å’Œè°ƒè¯•ï¼Œå¹¶ä¸”æœ‰åŠ©äºæ„å»ºå¯é çš„å¹¶å‘ç³»ç»Ÿã€‚ Go1234567891011121314151617181920212223242526272829303132333435363738394041package mainimport ( &quot;fmt&quot; &quot;sync&quot;)func main() &#123; type Button struct &#123; Clicked *sync.Cond &#125; button := Button&#123;Clicked: sync.NewCond(&amp;sync.Mutex&#123;&#125;)&#125; subscribe := func(c *sync.Cond, fn func()) &#123; var goroutineRunning sync.WaitGroup goroutineRunning.Add(1) go func() &#123; defer c.L.Unlock() goroutineRunning.Done() c.L.Lock() c.Wait() fn() &#125;() goroutineRunning.Wait() &#125; var clickRegistered sync.WaitGroup clickRegistered.Add(3) subscribe(button.Clicked, func() &#123; fmt.Println(&quot;Maximizing window.&quot;) clickRegistered.Done() &#125;) subscribe(button.Clicked, func() &#123; fmt.Println(&quot;Displaying annoying dialog box!&quot;) clickRegistered.Done() &#125;) subscribe(button.Clicked, func() &#123; fmt.Println(&quot;Mouse clicked.&quot;) clickRegistered.Done() &#125;) button.Clicked.Broadcast() clickRegistered.Wait()&#125; è¿™æ®µä»£ç æ¼”ç¤ºäº†ä½¿ç”¨æ¡ä»¶å˜é‡ï¼ˆsync.Condï¼‰å®ç°è®¢é˜…å’Œå‘å¸ƒæ¨¡å¼çš„ç¤ºä¾‹ã€‚ é¦–å…ˆï¼Œä»£ç å®šä¹‰äº†ä¸€ä¸ªåä¸ºButtonçš„ç»“æ„ä½“ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªæŒ‡å‘æ¡ä»¶å˜é‡çš„æŒ‡é’ˆClickedã€‚é€šè¿‡sync.NewCondå‡½æ•°ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªä¸äº’æ–¥é”å…³è”çš„æ¡ä»¶å˜é‡ã€‚ æ¥ä¸‹æ¥ï¼Œä»£ç å®šä¹‰äº†ä¸€ä¸ªsubscribeå‡½æ•°ï¼Œç”¨äºè®¢é˜…äº‹ä»¶ã€‚è¯¥å‡½æ•°æ¥æ”¶ä¸€ä¸ªæ¡ä»¶å˜é‡cå’Œä¸€ä¸ªå›è°ƒå‡½æ•°fnä½œä¸ºå‚æ•°ã€‚åœ¨å‡½æ•°å†…éƒ¨ï¼Œå®ƒåˆ›å»ºäº†ä¸€ä¸ªsync.WaitGroupç±»å‹çš„å˜é‡goroutineRunningï¼Œç”¨äºç­‰å¾…goroutineçš„å¯åŠ¨ã€‚ç„¶åï¼Œå®ƒå¯åŠ¨ä¸€ä¸ªæ–°çš„goroutineï¼Œåœ¨å…¶ä¸­ç­‰å¾…æ¡ä»¶å˜é‡çš„ä¿¡å·ã€‚ä¸€æ—¦æ¥æ”¶åˆ°ä¿¡å·ï¼Œå®ƒä¼šæ‰§è¡Œå›è°ƒå‡½æ•°fnã€‚åœ¨ç­‰å¾…å’Œæ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå®ƒä½¿ç”¨äº’æ–¥é”æ¥ä¿æŠ¤å…±äº«èµ„æºã€‚æœ€åï¼Œé€šè¿‡goroutineRunning.Wait()ç¡®ä¿goroutineå·²ç»å¯åŠ¨ã€‚è¿™æ ·åšæ˜¯ä¸ºäº†é¿å…å‡ºç°ç«äº‰æ¡ä»¶ï¼Œç¡®ä¿å›è°ƒå‡½æ•°åœ¨è®¢é˜…å®Œæˆä¹‹åæ‰ä¼šæ‰§è¡Œã€‚ åœ¨mainå‡½æ•°ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªButtonå®ä¾‹buttonï¼Œå¹¶è°ƒç”¨subscribeå‡½æ•°ä¸‰æ¬¡ï¼Œæ¯æ¬¡ä¼ é€’ä¸åŒçš„å›è°ƒå‡½æ•°ã€‚è¿™äº›å›è°ƒå‡½æ•°åˆ†åˆ«æ‰“å°ä¸åŒçš„æ¶ˆæ¯ã€‚ éšåï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªsync.WaitGroupç±»å‹çš„å˜é‡clickRegisteredï¼Œç”¨äºç­‰å¾…æ‰€æœ‰è®¢é˜…çš„å›è°ƒå‡½æ•°æ‰§è¡Œå®Œæˆã€‚é€šè¿‡clickRegistered.Add(3)å°†ç­‰å¾…è®¡æ•°è®¾ç½®ä¸º3ï¼Œå› ä¸ºæˆ‘ä»¬æœ‰ä¸‰ä¸ªè®¢é˜…çš„å›è°ƒå‡½æ•°ã€‚ æœ€åï¼Œæˆ‘ä»¬è°ƒç”¨button.Clicked.Broadcast()å‘é€å¹¿æ’­ä¿¡å·ï¼Œé€šçŸ¥æ‰€æœ‰è®¢é˜…è€…äº‹ä»¶å·²å‘ç”Ÿã€‚è¿™å°†è§¦å‘æ‰€æœ‰ç­‰å¾…ä¸­çš„subscribeå‡½æ•°ä¸­çš„æ¡ä»¶å˜é‡çš„ä¿¡å·ï¼Œå¹¶æ‰§è¡Œå¯¹åº”çš„å›è°ƒå‡½æ•°ã€‚ é€šè¿‡ä½¿ç”¨æ¡ä»¶å˜é‡å’Œäº’æ–¥é”ï¼Œä»£ç å®ç°äº†ä¸€ä¸ªç®€å•çš„è®¢é˜…å’Œå‘å¸ƒæ¨¡å¼ã€‚å½“äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œè®¢é˜…è€…æ”¶åˆ°ä¿¡å·å¹¶æ‰§è¡Œç›¸åº”çš„å›è°ƒå‡½æ•°ã€‚è¿™ç§æ¨¡å¼å¯ä»¥åœ¨å¹¶å‘ç¯å¢ƒä¸­å®ç°è§£è€¦å’Œäº‹ä»¶é©±åŠ¨çš„ç¼–ç¨‹ Java12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576import java.util.concurrent.locks.Condition;import java.util.concurrent.locks.Lock;import java.util.concurrent.locks.ReentrantLock;public class Main &#123; public static void main(String[] args) &#123; Button button = new Button(); Thread thread1 = new Thread(() -&gt; &#123; button.subscribe(() -&gt; &#123; System.out.println(&quot;Maximizing window.&quot;); &#125;); &#125;); Thread thread2 = new Thread(() -&gt; &#123; button.subscribe(() -&gt; &#123; System.out.println(&quot;Displaying annoying dialog box!&quot;); &#125;); &#125;); Thread thread3 = new Thread(() -&gt; &#123; button.subscribe(() -&gt; &#123; System.out.println(&quot;Mouse clicked.&quot;); &#125;); &#125;); thread1.start(); thread2.start(); thread3.start(); // æ¨¡æ‹ŸæŒ‰é’®ç‚¹å‡»äº‹ä»¶ button.click(); try &#123; thread1.join(); thread2.join(); thread3.join(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125;&#125;class Button &#123; private Lock lock; private Condition condition; public Button() &#123; lock = new ReentrantLock(); condition = lock.newCondition(); &#125; public void click() &#123; lock.lock(); try &#123; condition.signalAll(); &#125; finally &#123; lock.unlock(); &#125; &#125; public void subscribe(Runnable callback) &#123; Thread thread = new Thread(() -&gt; &#123; lock.lock(); try &#123; condition.await(); callback.run(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; finally &#123; lock.unlock(); &#125; &#125;); thread.start(); &#125;&#125; åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œä½¿ç”¨äº†Conditionã€Lockå’ŒReentrantLockæ¥å®ç°çº¿ç¨‹é—´çš„åŒæ­¥å’Œé€šä¿¡ã€‚ Lockæ¥å£æ˜¯Javaæä¾›çš„ç”¨äºå¤šçº¿ç¨‹åŒæ­¥çš„æœºåˆ¶ä¹‹ä¸€ã€‚ReentrantLockæ˜¯Lockæ¥å£çš„ä¸€ä¸ªå…·ä½“å®ç°ç±»ï¼Œå®ƒæä¾›äº†ç‹¬å é”çš„åŠŸèƒ½ã€‚åœ¨ç¤ºä¾‹ä»£ç ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªReentrantLockå®ä¾‹ï¼Œç”¨äºä¿æŠ¤å…±äº«èµ„æºçš„è®¿é—®ã€‚ Conditionæ¥å£æ˜¯ä¸é”å…³è”çš„æ¡ä»¶ï¼Œå¯ä»¥ç”¨äºå®ç°çº¿ç¨‹é—´çš„ç­‰å¾…å’Œé€šçŸ¥æœºåˆ¶ã€‚åœ¨ç¤ºä¾‹ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨lock.newCondition()åˆ›å»ºäº†ä¸€ä¸ªConditionå®ä¾‹ï¼Œç”¨äºå®ç°è®¢é˜…è€…çº¿ç¨‹çš„ç­‰å¾…å’Œä¸»çº¿ç¨‹çš„é€šçŸ¥ã€‚ lock.lock()å’Œlock.unlock()ç”¨äºè·å–å’Œé‡Šæ”¾é”ã€‚é€šè¿‡ä½¿ç”¨lock.lock()è·å–é”ï¼Œå¯ä»¥ç¡®ä¿åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥æ‰§è¡Œè¢«ä¿æŠ¤çš„ä»£ç å—ï¼Œå…¶ä»–çº¿ç¨‹å°†è¢«é˜»å¡ã€‚ä¸€æ—¦çº¿ç¨‹å®Œæˆäº†å¯¹å…±äº«èµ„æºçš„æ“ä½œï¼Œä½¿ç”¨lock.unlock()é‡Šæ”¾é”ï¼Œä»¥ä¾¿å…¶ä»–çº¿ç¨‹å¯ä»¥è·å–é”å¹¶æ‰§è¡Œã€‚ condition.await()ç”¨äºä½¿å½“å‰çº¿ç¨‹è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œç›´åˆ°å…¶ä»–çº¿ç¨‹é€šè¿‡è°ƒç”¨condition.signal()æˆ–condition.signalAll()å‘å‡ºä¿¡å·ã€‚åœ¨ç¤ºä¾‹ä»£ç ä¸­ï¼Œè®¢é˜…è€…çº¿ç¨‹åœ¨æ”¶åˆ°ä¿¡å·å‰ä¼šè°ƒç”¨condition.await()è¿›å…¥ç­‰å¾…çŠ¶æ€ã€‚ condition.signalAll()ç”¨äºå”¤é†’æ‰€æœ‰ç­‰å¾…åœ¨è¯¥æ¡ä»¶ä¸Šçš„çº¿ç¨‹ã€‚åœ¨ç¤ºä¾‹ä»£ç ä¸­ï¼Œä¸»çº¿ç¨‹è°ƒç”¨button.click()åä¼šè°ƒç”¨condition.signalAll()ï¼Œä»¥é€šçŸ¥æ‰€æœ‰ç­‰å¾…çš„è®¢é˜…è€…çº¿ç¨‹ã€‚ é€šè¿‡ä½¿ç”¨Conditionã€Lockå’ŒReentrantLockï¼Œæˆ‘ä»¬å¯ä»¥å®ç°æ›´ç²¾ç»†çš„çº¿ç¨‹åŒæ­¥å’Œé€šä¿¡ã€‚å®ƒä»¬æä¾›äº†æ›´çµæ´»çš„æ§åˆ¶æœºåˆ¶ï¼Œä½¿å¾—çº¿ç¨‹ä¹‹é—´çš„äº¤äº’æ›´åŠ å¯æ§å’Œé«˜æ•ˆã€‚ å¯ä»¥ä½¿ç”¨Objectç±»ä¸­çš„wait()å’ŒnotifyAll()æ–¹æ³•æ¥å®ç°çº¿ç¨‹é—´çš„ç­‰å¾…å’Œé€šçŸ¥æœºåˆ¶ï¼Œç”¨äºæ›¿ä»£Conditionæ¥å£å’ŒLockæœºåˆ¶ã€‚ åœ¨ä½¿ç”¨wait()å’ŒnotifyAll()æ—¶ï¼Œéœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š wait()æ–¹æ³•ç”¨äºä½¿å½“å‰çº¿ç¨‹è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œç›´åˆ°å…¶ä»–çº¿ç¨‹è°ƒç”¨ç›¸åŒå¯¹è±¡çš„notify()æˆ–notifyAll()æ–¹æ³•ã€‚åœ¨ç­‰å¾…æœŸé—´ï¼Œå½“å‰çº¿ç¨‹ä¼šé‡Šæ”¾å¯¹è±¡çš„é”ã€‚ notifyAll()æ–¹æ³•ç”¨äºå”¤é†’æ‰€æœ‰ç­‰å¾…åœ¨ç›¸åŒå¯¹è±¡ä¸Šçš„çº¿ç¨‹ã€‚å®ƒä¼šé€šçŸ¥æ‰€æœ‰ç­‰å¾…çš„çº¿ç¨‹ç»§ç»­æ‰§è¡Œï¼Œä½†åªæœ‰åœ¨è·å–åˆ°å¯¹è±¡çš„é”ä¹‹åæ‰èƒ½çœŸæ­£æ‰§è¡Œã€‚ åœ¨ä½¿ç”¨wait()å’ŒnotifyAll()æ—¶ï¼Œå¿…é¡»åœ¨åŒæ­¥ä»£ç å—æˆ–åŒæ­¥æ–¹æ³•ä¸­è°ƒç”¨ï¼Œä»¥ç¡®ä¿å¯¹å¯¹è±¡çš„é”çš„æ­£ç¡®ä½¿ç”¨ã€‚ é€šå¸¸ï¼Œä½ éœ€è¦ä½¿ç”¨ä¸€ä¸ªå…±äº«çš„å¯¹è±¡ä½œä¸ºé€šä¿¡çš„é”ï¼Œç±»ä¼¼äºç¤ºä¾‹ä»£ç ä¸­çš„buttonå¯¹è±¡ã€‚ ä¸‹é¢æ˜¯ä¿®æ”¹åçš„ç¤ºä¾‹ä»£ç ï¼Œä½¿ç”¨wait()å’ŒnotifyAll()å®ç°çº¿ç¨‹é—´çš„ç­‰å¾…å’Œé€šçŸ¥ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455class Button &#123; private final Object lock = new Object(); public void click() &#123; synchronized (lock) &#123; lock.notifyAll(); &#125; &#125; public void subscribe(Runnable task) &#123; synchronized (lock) &#123; try &#123; lock.wait(); task.run(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; &#125;&#125;public class Main &#123; public static void main(String[] args) &#123; Button button = new Button(); Thread subscriber1 = new Thread(() -&gt; &#123; button.subscribe(() -&gt; &#123; System.out.println(&quot;Maximizing window.&quot;); &#125;); &#125;); Thread subscriber2 = new Thread(() -&gt; &#123; button.subscribe(() -&gt; &#123; System.out.println(&quot;Displaying annoying dialog box!&quot;); &#125;); &#125;); Thread subscriber3 = new Thread(() -&gt; &#123; button.subscribe(() -&gt; &#123; System.out.println(&quot;Mouse clicked.&quot;); &#125;); &#125;); subscriber1.start(); subscriber2.start(); subscriber3.start(); // ä¸»çº¿ç¨‹ç­‰å¾…è®¢é˜…è€…çº¿ç¨‹å®Œæˆ try &#123; subscriber1.join(); subscriber2.join(); subscriber3.join(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; button.click(); &#125;&#125; åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼ŒButtonç±»ä½¿ç”¨äº†ä¸€ä¸ªå…±äº«çš„é”å¯¹è±¡lockã€‚åœ¨è®¢é˜…è€…çº¿ç¨‹ä¸­ï¼Œè°ƒç”¨lock.wait()ä½¿çº¿ç¨‹è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œåœ¨ä¸»çº¿ç¨‹ä¸­è°ƒç”¨lock.notifyAll()å”¤é†’æ‰€æœ‰ç­‰å¾…çš„çº¿ç¨‹ã€‚ä¸»çº¿ç¨‹ä½¿ç”¨join()æ–¹æ³•ç­‰å¾…è®¢é˜…è€…çº¿ç¨‹å®Œæˆåå†è°ƒç”¨button.click()ã€‚ ä½¿ç”¨wait()å’ŒnotifyAll()å¯ä»¥å®ç°åŸºæœ¬çš„çº¿ç¨‹é—´ç­‰å¾…å’Œé€šçŸ¥æœºåˆ¶ï¼Œä½†ç›¸æ¯”Conditionå’ŒLockï¼Œå®ƒä»¬çš„ä½¿ç”¨æ›´åŠ åŸºç¡€å’Œä½çº§ï¼Œéœ€è¦æ‰‹åŠ¨å¤„ç†é”çš„è·å–å’Œé‡Šæ”¾ï¼Œå¹¶ä¸”å¯èƒ½å­˜åœ¨æ›´å¤šçš„é£é™©ï¼Œå¦‚æ­»é”å’Œç«æ€æ¡ä»¶ã€‚å› æ­¤ï¼Œåœ¨å®é™…å¼€å‘ä¸­ï¼Œå»ºè®®ä½¿ç”¨Conditionå’ŒLockæœºåˆ¶ï¼Œå› ä¸ºå®ƒä»¬æä¾›äº†æ›´çµæ´»ã€æ›´å¯é çš„çº¿ç¨‹åŒæ­¥å’Œé€šä¿¡æ–¹å¼ã€‚ç›¸æ¯”äºä½¿ç”¨wait()å’ŒnotifyAll()ï¼ŒConditionå’ŒLockå…·æœ‰ä»¥ä¸‹ä¼˜åŠ¿ï¼š ç²¾ç¡®çš„é€šçŸ¥æœºåˆ¶ï¼šConditionæ¥å£æä¾›äº†æ›´ç»†ç²’åº¦çš„é€šçŸ¥æœºåˆ¶ï¼Œå¯ä»¥é€‰æ‹©æ€§åœ°é€šçŸ¥ç­‰å¾…çº¿ç¨‹ã€‚ä½ å¯ä»¥åˆ›å»ºå¤šä¸ªConditionå®ä¾‹æ¥æ§åˆ¶ä¸åŒçš„ç­‰å¾…æ¡ä»¶ï¼Œå¹¶ä½¿ç”¨signal()æˆ–signalAll()æ–¹æ³•é€šçŸ¥ç‰¹å®šçš„ç­‰å¾…çº¿ç¨‹ã€‚ æ›´çµæ´»çš„é”æ§åˆ¶ï¼šLockæ¥å£æä¾›äº†æ›´çµæ´»çš„é”æ§åˆ¶æœºåˆ¶ã€‚å®ƒæ”¯æŒå¯é‡å…¥é”ï¼ˆReentrantLockï¼‰å’Œè¯»å†™é”ï¼ˆReentrantReadWriteLockï¼‰ï¼Œä»¥åŠå„ç§é”çš„é«˜çº§åŠŸèƒ½ï¼Œå¦‚å…¬å¹³æ€§ã€è¶…æ—¶ç­‰å¾…å’Œä¸­æ–­å“åº”ã€‚ æ›´å®‰å…¨çš„å¹¶å‘æ§åˆ¶ï¼šConditionå’ŒLockæä¾›äº†æ›´å®‰å…¨çš„å¹¶å‘æ§åˆ¶æœºåˆ¶ï¼Œé¿å…äº†å¯èƒ½å¯¼è‡´æ­»é”ã€ç«æ€æ¡ä»¶å’Œçº¿ç¨‹é¥¥é¥¿ç­‰é—®é¢˜ã€‚å®ƒä»¬é€šè¿‡æ˜¾ç¤ºåœ°è·å–å’Œé‡Šæ”¾é”æ¥ç¡®ä¿çº¿ç¨‹çš„æ­£ç¡®åŒæ­¥å’Œåè°ƒã€‚ å¯æ‰©å±•æ€§å’Œæ€§èƒ½ä¼˜åŒ–ï¼šConditionå’ŒLockæœºåˆ¶æä¾›äº†æ›´é«˜çº§çš„çº¿ç¨‹åŒæ­¥åŠŸèƒ½ï¼Œå¯ä»¥æ›´å¥½åœ°æ»¡è¶³å¤æ‚çš„å¹¶å‘éœ€æ±‚ã€‚å®ƒä»¬æ”¯æŒæ›´å¤šçš„é«˜çº§æ“ä½œï¼Œå¦‚æ¡ä»¶ç­‰å¾…ã€å¤šä¸ªç­‰å¾…é˜Ÿåˆ—ã€å¯ä¸­æ–­çš„ç­‰å¾…ç­‰ï¼Œå¹¶æä¾›äº†æ›´å¥½çš„æ€§èƒ½ä¼˜åŒ–é€‰é¡¹ã€‚ ç»¼ä¸Šæ‰€è¿°ï¼Œå°½ç®¡å¯ä»¥ä½¿ç”¨wait()å’ŒnotifyAll()æ¥å®ç°ç®€å•çš„çº¿ç¨‹åŒæ­¥å’Œé€šä¿¡ï¼Œä½†åœ¨æ›´å¤æ‚çš„å¹¶å‘åœºæ™¯ä¸‹ï¼Œä½¿ç”¨Conditionå’ŒLockä¼šæ›´åŠ å¯é å’Œçµæ´»ã€‚å®ƒä»¬æä¾›äº†æ›´å¤šçš„åŠŸèƒ½å’Œæ€§èƒ½ä¼˜åŒ–é€‰é¡¹ï¼Œå¯ä»¥æ›´å¥½åœ°ç®¡ç†çº¿ç¨‹çš„çŠ¶æ€ã€ç­‰å¾…å’Œå”¤é†’ï¼Œç¡®ä¿çº¿ç¨‹é—´çš„æ­£ç¡®åŒæ­¥å’Œåä½œã€‚","tags":[{"name":"å¹¶å‘","slug":"å¹¶å‘","permalink":"https://alexhuihui.github.io/tags/%E5%B9%B6%E5%8F%91/"}]},{"title":"ã€é‡æ„ã€‘æ”¹å–„æ—¢æœ‰ä»£ç è®¾è®¡çš„é˜…è¯»ç¬”è®°","date":"2023-06-13T11:54:06.000Z","path":"article/20230613.html","text":"æ‰€è°“é‡æ„ï¼ˆrefactoringï¼‰æ˜¯è¿™æ ·ä¸€ä¸ªè¿‡ç¨‹ï¼šåœ¨ä¸æ”¹å˜ä»£ç å¤–åœ¨è¡Œä¸ºçš„å‰æä¸‹ï¼Œå¯¹ä»£ç åšå‡ºä¿®æ”¹ï¼Œä»¥æ”¹è¿›ç¨‹åºçš„å†…éƒ¨ç»“æ„ã€‚é‡æ„æ˜¯ä¸€ç§ç»åƒé”¤ç™¾ç‚¼å½¢æˆçš„æœ‰æ¡ä¸ç´Šçš„ç¨‹åºæ•´ç†æ–¹æ³•ï¼Œå¯ä»¥æœ€å¤§é™åº¦åœ°å‡å°‘æ•´ç†è¿‡ç¨‹ä¸­å¼•å…¥é”™è¯¯çš„å‡ ç‡ã€‚è¿™æœ¬ä¹¦å‘Šè¯‰ä½ å¦‚ä½•ä»¥ä¸€ç§å¯æ§åˆ¶ä¸”é«˜æ•ˆç‡çš„æ–¹å¼è¿›è¡Œé‡æ„ï¼Œå¦‚ä½•æœ‰æ¡ä¸ç´Šåœ°æ”¹è¿›ç¨‹åºç»“æ„ï¼Œè€Œä¸”ä¸ä¼šå¼•å…¥é”™è¯¯ã€‚ é‡æ„ç¬¬ä¸€ä¸ªæ¡ˆä¾‹å¦‚æœä½ å‘ç°è‡ªå·±éœ€è¦ä¸ºç¨‹åºæ·»åŠ ä¸€ä¸ªç‰¹æ€§ï¼Œè€Œä»£ç ç»“æ„ä½¿ä½ æ— æ³•å¾ˆæ–¹ä¾¿åœ°è¾¾æˆç›®çš„ï¼Œé‚£å°±å…ˆé‡æ„é‚£ä¸ªç¨‹åºï¼Œä½¿ç‰¹æ€§çš„æ·»åŠ æ¯”è¾ƒå®¹æ˜“è¿›è¡Œï¼Œç„¶åå†æ·»åŠ ç‰¹æ€§ã€‚ ç¬¬ä¸€æ­¥æ„å»ºå®Œæ•´çš„æµ‹è¯•ç”¨ä¾‹ï¼Œä¿è¯é‡æ„ä¹‹åçš„ä»£ç è¡Œä¸ºè¡¨ç°ä¸ä¹‹å‰æ— å¼‚ã€‚ Extract Method ä¿®æ”¹å˜é‡å‘½å Move Method Replace Temp with Query Replace Conditional with Polymorphism ç”¨å¤šæ€å–ä»£æ¡ä»¶è¡¨è¾¾å¼ Self Encapsulate Field è‡ªå°è£…å­—æ®µï¼ˆå­—æ®µè®¿é—®ä¿æŠ¤ï¼‰ Replace Type Code with State/Strategy ç”¨äºæ”¹å–„åŸºäºç±»å‹ç ï¼ˆType Codeï¼‰çš„æ¡ä»¶é€»è¾‘ï¼Œå¹¶é€šè¿‡å¼•å…¥çŠ¶æ€æ¨¡å¼ï¼ˆState Patternï¼‰æˆ–ç­–ç•¥æ¨¡å¼ï¼ˆStrategy Patternï¼‰æ¥å®ç°æ›´æ¸…æ™°å’Œå¯æ‰©å±•çš„ä»£ç ç»“æ„ é‡æ„åŸåˆ™ä»€ä¹ˆæ˜¯é‡æ„å¯¹è½¯ä»¶å†…éƒ¨ç»“æ„çš„ä¸€ç§è°ƒæ•´ï¼Œç›®çš„æ˜¯åœ¨ä¸æ”¹å˜è½¯ä»¶å¯è§‚å¯Ÿè¡Œä¸ºçš„å‰æä¸‹ï¼Œæé«˜å…¶å¯ç†è§£æ€§ï¼Œé™ä½å…¶ä¿®æ”¹æˆæœ¬ ä¸¤é¡¶å¸½å­ï¼Œå½“ä½ ä½¿ç”¨é‡æ„æŠ€æœ¯è¿›è¡Œå¼€å‘æ—¶ï¼ŒæŠŠæ—¶é—´åˆ†é…åˆ°ä¸¤ç§ä¸åŒçš„è¡Œä¸ºï¼šæ·»åŠ æ–°åŠŸèƒ½ä»¥åŠé‡æ„ã€‚æ·»åŠ æ–°åŠŸèƒ½æ—¶ï¼Œä½ ä¸åº”è¯¥ä¿®æ”¹æ—¢æœ‰ä»£ç ï¼Œåªç®¡æ·»åŠ æ–°åŠŸèƒ½ã€‚ é‡æ„æ—¶ä½ å°±ä¸åº”è¯¥æ·»åŠ æ–°åŠŸèƒ½è€Œæ˜¯åªç®¡æ”¹å˜ç¨‹åºç»“æ„ã€‚ä¸¤é¡¶å¸½å­è¦éšæ—¶åˆ‡æ¢ï¼Œåº”è¯¥æ¸…é™¤æ„è¯†åˆ°ä½ æˆ´çš„æ˜¯ä»€ä¹ˆå¸½å­ã€‚ ä¸ºä½•é‡æ„é‡æ„æ”¹è¿›è½¯ä»¶è®¾è®¡ é‡æ„ä½¿è½¯ä»¶æ›´å®¹æ˜“ç†è§£ ä½•æ—¶é‡æ„äº‹ä¸è¿‡ä¸‰ï¼Œä¸‰åˆ™é‡æ„ ä»£ç çš„åå‘³é“Duplicated Code Long Methodï¼ˆè¿‡é•¿å‡½æ•°ï¼‰ Large Classï¼ˆè¿‡å¤§çš„ç±»ï¼‰ Long Parameter Listï¼ˆè¿‡é•¿å‚æ•°åˆ—ï¼‰ Divergent Changeï¼ˆå‘æ•£å¼å˜åŒ–ï¼‰ Shotgun Surgeryï¼ˆéœ°å¼¹å¼ä¿®æ”¹ï¼‰ Feature Envyï¼ˆä¾æ‹æƒ…ç»“ï¼‰ é‡æ„åˆ—è¡¨","tags":[{"name":"é‡æ„","slug":"é‡æ„","permalink":"https://alexhuihui.github.io/tags/%E9%87%8D%E6%9E%84/"}]},{"title":"ã€Mybatisã€‘Mybatisæºç è§£æâ€”åŸºç¡€åŠŸèƒ½åŒ…","date":"2023-06-08T11:54:06.000Z","path":"article/20230608.html","text":"é˜…è¯»mybatisæºç å¯ä»¥å…ˆä»å¤–å›´çš„åŸºç¡€åŠŸèƒ½åŒ…å¼€å§‹ï¼Œå‰¥æ´‹è‘±ä¸€æ ·ä¸€å±‚ä¸€å±‚æ·±å…¥ type åŒ…å½’ç±»æ€»ç»“ ç±»å‹å¤„ç†å™¨ ç±»å‹æ³¨å†Œå™¨ æ³¨è§£ç±» è®¾è®¡æ¨¡å¼ æ¨¡æ¿æ¨¡å¼ æ¨¡æ¿ä¸­å®šä¹‰äº†å¤§ä½“çš„å¤„ç†æ¡†æ¶ï¼Œç•™ä¸‹ä¸€äº›ç»†èŠ‚ä¾›ä½¿ç”¨è€…æ¥å®Œå–„ã€‚åœ¨è®¾è®¡æ¨¡å¼ä¸­ï¼Œä½¿ç”¨ä¸€ä¸ªæŠ½è±¡ç±»å®šä¹‰ä¸€æ•´å¥—çš„æ“ä½œæµç¨‹ï¼Œè€ŒæŠ½è±¡ç±»çš„å­ç±»åˆ™å®Œæˆæ¯ä¸ªæ“ä½œæ­¥éª¤çš„å®ç°ã€‚ ç±»å‹å¤„ç†å™¨ç”¨äºORMæ¡†æ¶ä¸­å¤„ç†Javaç±»å‹å’Œæ•°æ®åº“ç±»å‹ï¼Œä½¿ç”¨æ¨¡æ¿æ–¹å¼å®šä¹‰äº†ä¸€ä¸ªBaseTypeHandlerï¼ŒgetResultæ–¹æ³•å®Œæˆäº†å¼‚å¸¸å¤„ç†ç­‰ç»Ÿä¸€çš„å·¥ä½œï¼Œè€Œä¸å…·ä½“ç±»å‹çš„æ“ä½œåˆ™é€šè¿‡æŠ½è±¡æ–¹æ³•ç”±å…·ä½“çš„å­ç±»ç±»å‹å¤„ç†å™¨å®ç°ã€‚ ç±»å‹æ³¨å†Œè¡¨å…‰æœ‰ç±»å‹å¤„ç†å™¨è¿˜ä¸å¤Ÿï¼Œè¿˜éœ€è¦å¿«é€ŸæŸ¥æ‰¾æ•°æ®ç±»å‹å¯¹åº”çš„ç±»å‹å¤„ç†å™¨ æ ¹æ®ä¸€ä¸ªJavaç±»å‹å’ŒJDBCç±»å‹å°±èƒ½ç¡®å®šä¸€ä¸ªç±»å‹å¤„ç†å™¨ 1234567891011121314151617181920// TypeHandlerRegistry.classprivate &lt;T&gt; TypeHandler&lt;T&gt; getTypeHandler(Type type, JdbcType jdbcType) &#123; if (ParamMap.class.equals(type)) &#123; return null; &#125; Map&lt;JdbcType, TypeHandler&lt;?&gt;&gt; jdbcHandlerMap = getJdbcHandlerMap(type); TypeHandler&lt;?&gt; handler = null; if (jdbcHandlerMap != null) &#123; handler = jdbcHandlerMap.get(jdbcType); if (handler == null) &#123; handler = jdbcHandlerMap.get(null); &#125; if (handler == null) &#123; // #591 handler = pickSoleHandler(jdbcHandlerMap); &#125; &#125; // type drives generics here return (TypeHandler&lt;T&gt;) handler; &#125; io åŒ…ioåŒ…å³è¾“å…¥/è¾“å‡ºåŒ…ï¼Œè´Ÿè´£å®Œæˆ MyBatisä¸­ä¸è¾“å…¥/è¾“å‡ºç›¸å…³çš„æ“ä½œ è®¾è®¡æ¨¡å¼å•ä¾‹æ¨¡å¼å•ä¾‹æ¨¡å¼ï¼ˆSingleton Patternï¼‰æ˜¯ä¸€ç§éå¸¸ç®€å•çš„è®¾è®¡æ¨¡å¼ã€‚ä½¿ ç”¨äº†å•ä¾‹æ¨¡å¼çš„ç±»æä¾›ä¸€ä¸ªæ–¹æ³•å¾—åˆ°è¯¥ç±»çš„å¯¹è±¡ï¼Œå¹¶ä¸”æ€»ä¿è¯è¿™ä¸ªå¯¹ è±¡æ˜¯å”¯ä¸€çš„ã€‚ 123456789public class Singleton &#123; private static final Singleton INSTANCE = new Singleton(); private Singleton() &#123;&#125;; public static Singleton getInstance() &#123; return INSTANCE; &#125;&#125; ä»£ç†æ¨¡å¼ä»£ç†æ¨¡å¼ï¼ˆProxy Patternï¼‰æ˜¯æŒ‡å»ºç«‹æŸä¸€ä¸ªå¯¹è±¡çš„ä»£ç†å¯¹è±¡ï¼Œå¹¶ä¸”ç”±ä»£ç†å¯¹è±¡æ§åˆ¶å¯¹åŸå¯¹è±¡çš„å¼•ç”¨ã€‚ logging åŒ…loggingåŒ…è´Ÿè´£å®Œæˆ MyBatisæ“ä½œä¸­çš„æ—¥å¿—è®°å½•å·¥ä½œã€‚ è®¾è®¡æ¨¡å¼é€‚é…å™¨æ¨¡å¼é€‚é…å™¨æ¨¡å¼ï¼ˆAdapter Patternï¼‰æ˜¯ä¸€ç§ç»“æ„å‹æ¨¡å¼ï¼ŒåŸºäºè¯¥æ¨¡å¼ è®¾è®¡çš„ç±»èƒ½å¤Ÿåœ¨ä¸¤ä¸ªæˆ–è€…å¤šä¸ªä¸å…¼å®¹çš„ç±»ä¹‹é—´èµ·åˆ°æ²Ÿé€šæ¡¥æ¢çš„ä½œç”¨ã€‚ è½¬æ¢æ’å¤´å°±æ˜¯ä¸€ä¸ªé€‚é…å™¨çš„å…¸å‹ä¾‹å­ã€‚ä¸åŒçš„è½¬æ¢æ’å¤´èƒ½å¤Ÿé€‚é… ä¸åŒå›½å®¶çš„æ’åº§æ ‡å‡†ï¼Œä»è€Œä½¿å¾—ä¸€ä¸ªç”µå™¨èƒ½åœ¨å„ä¸ªå›½å®¶ä½¿ç”¨ã€‚","tags":[{"name":"Mybatis","slug":"Mybatis","permalink":"https://alexhuihui.github.io/tags/Mybatis/"}]},{"title":"ã€Mybatisã€‘Mybatisè¿è¡Œæµç¨‹","date":"2023-06-07T11:54:06.000Z","path":"article/20230607.html","text":"ä»Šå¤©è®©æˆ‘ä»¬æ¥æ¢å¯»ä¸€ä¸‹Mybatisçš„è¿è¡Œæµç¨‹ï¼Œæˆ‘ä»¬å°†å®ƒçš„è¿è¡Œæµç¨‹åˆ†ä¸º2ä¸ªé˜¶æ®µã€‚ ç¬¬ä¸€é˜¶æ®µï¼šMyBatisåˆå§‹åŒ–é˜¶æ®µã€‚è¯¥é˜¶æ®µç”¨æ¥å®Œæˆ MyBatisè¿è¡Œç¯å¢ƒçš„å‡†å¤‡å·¥ä½œï¼Œåªåœ¨ MyBatiså¯åŠ¨æ—¶è¿è¡Œä¸€æ¬¡ã€‚ ç¬¬äºŒé˜¶æ®µï¼šæ•°æ®è¯»å†™é˜¶æ®µã€‚è¯¥é˜¶æ®µç”±æ•°æ®è¯»å†™æ“ä½œè§¦å‘ï¼Œå°†æ ¹æ®è¦æ±‚å®Œæˆå…·ä½“çš„å¢ã€åˆ ã€æ”¹ã€æŸ¥ç­‰æ•°æ®åº“æ“ä½œã€‚ åˆå§‹åŒ–é˜¶æ®µ æ ¹æ®é…ç½®æ–‡ä»¶çš„ä½ç½®ï¼Œè·å–å®ƒçš„è¾“å…¥æµ InputStream 12345678910111213141516171819InputStream getResourceAsStream(String resource, ClassLoader[] classLoader) &#123; for (ClassLoader cl : classLoader) &#123; if (null != cl) &#123; // try to find the resource as passed InputStream returnValue = cl.getResourceAsStream(resource); // now, some class loaders want this leading &quot;/&quot;, so we&#x27;ll add it and try again if we didn&#x27;t find the resource if (null == returnValue) &#123; returnValue = cl.getResourceAsStream(&quot;/&quot; + resource); &#125; if (null != returnValue) &#123; return returnValue; &#125; &#125; &#125; return null; &#125; ä»é…ç½®æ–‡ä»¶çš„æ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œé€å±‚è§£æé…ç½®æ–‡ä»¶ï¼Œä¹ŸåŒ…æ‹¬ç›¸å…³çš„æ˜ å°„æ–‡ä»¶ã€‚è§£æè¿‡ç¨‹ä¸­ä¸æ–­å°†è§£æç»“æœæ”¾å…¥ Configurationå¯¹è±¡ã€‚ ä»¥é…ç½®å¥½çš„ Configurationå¯¹è±¡ä¸ºå‚æ•°ï¼Œè·å–ä¸€ä¸ª SqlSessionFactoryå¯¹è±¡ã€‚ 1234567891011121314151617public SqlSessionFactory build(Reader reader, String environment, Properties properties) &#123; try &#123; XMLConfigBuilder parser = new XMLConfigBuilder(reader, environment, properties); return build(parser.parse()); &#125; catch (Exception e) &#123; throw ExceptionFactory.wrapException(&quot;Error building SqlSession.&quot;, e); &#125; finally &#123; ErrorContext.instance().reset(); try &#123; if (reader != null) &#123; reader.close(); &#125; &#125; catch (IOException e) &#123; // Intentionally ignore. Prefer previous error. &#125; &#125; &#125; é‡è¦ä»£ç æ³¨é‡Š: ç”Ÿæˆäº†ä¸€ä¸ª XMLConfigBuilder å¯¹è±¡ï¼Œå¹¶è°ƒç”¨äº†å…¶ parse æ–¹æ³•ï¼Œå¾—åˆ°ä¸€ä¸ªConfigurationå¯¹è±¡ï¼ˆå› ä¸º parseæ–¹æ³•çš„è¾“å‡ºç»“æœä¸º Configurationå¯¹è±¡ï¼‰ã€‚ è°ƒç”¨äº† SqlSessionFactoryBuilder è‡ªèº«çš„ buildæ–¹æ³•ï¼Œ ä¼ å…¥å‚æ•°ä¸ºä¸Šä¸€æ­¥å¾—åˆ°çš„Configurationå¯¹è±¡ã€‚ æ•°æ®è¯»å†™é˜¶æ®µè¿½è¸ªè¿›è¡Œä¸€æ¬¡æ•°æ®åº“çš„è¯»æˆ–å†™æ“ä½œæ—¶ï¼ŒMyBatiså†…éƒ¨éƒ½è¦ç»è¿‡å“ªäº›æ­¥éª¤ è·å¾—SqlSessioné€šè¿‡åˆå§‹åŒ–é˜¶æ®µè·å–çš„SqlSessionFactoryç”Ÿæˆæ•°æ®åº“æ“ä½œä¸­æ‰€éœ€è¦çš„SqlSession 1SqlSession sqlSession = sqlSessionFactory.openSession(); æ˜ å°„æ¥å£æ–‡ä»¶ä¸æ˜ å°„æ–‡ä»¶çš„ç»‘å®šæ˜ å°„æ¥å£æ–‡ä»¶æ˜¯æŒ‡å­˜æœ‰Javaæ¥å£çš„æ–‡ä»¶ï¼Œè€Œæ˜ å°„æ–‡ä»¶æ˜¯æŒ‡å­˜æœ‰sqlæ“ä½œçš„xmlæ–‡ä»¶ åœ¨è¿›è¡Œæ•°æ®æŸ¥è¯¢ä¹‹å‰ï¼Œå…ˆé€šè¿‡SqlSessionçš„getMapper()è·å–æ˜ å°„æ¥å£çš„å®ç°, è¯¥æ“ä½œé€šè¿‡ Configurationç±»çš„ getMapperæ–¹æ³•è½¬æ¥ï¼Œæœ€ç»ˆè¿›å…¥ MapperRegistryç±»ä¸­çš„getMapperæ–¹æ³•ã€‚MapperRegistryç±»ä¸­çš„ getMapper() 1234567891011121314151617181920212223// DefaultSqlSession.class@Overridepublic &lt;T&gt; T getMapper(Class&lt;T&gt; type) &#123; return configuration.getMapper(type, this);&#125;// Configuration.classpublic &lt;T&gt; T getMapper(Class&lt;T&gt; type, SqlSession sqlSession) &#123; return mapperRegistry.getMapper(type, sqlSession);&#125;// MapperRegistry.classpublic &lt;T&gt; T getMapper(Class&lt;T&gt; type, SqlSession sqlSession) &#123; final MapperProxyFactory&lt;T&gt; mapperProxyFactory = (MapperProxyFactory&lt;T&gt;) knownMappers.get(type); if (mapperProxyFactory == null) &#123; throw new BindingException(&quot;Type &quot; + type + &quot; is not known to the MapperRegistry.&quot;); &#125; try &#123; return mapperProxyFactory.newInstance(sqlSession); &#125; catch (Exception e) &#123; throw new BindingException(&quot;Error getting mapper instance. Cause: &quot; + e, e); &#125; &#125; æ˜ å°„æ¥å£çš„ä»£ç†session.getMapper() å¾—åˆ°çš„æ˜¯ä¸€ä¸ªmapperProxyFactory.newInstance(sqlSession)è¿”å›çš„å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡æ˜¯ä¸€ä¸ªåŸºäºåå°„çš„åŠ¨æ€ä»£ç†å¯¹è±¡ 123456789@SuppressWarnings(&quot;unchecked&quot;)protected T newInstance(MapperProxy&lt;T&gt; mapperProxy) &#123; return (T) Proxy.newProxyInstance(mapperInterface.getClassLoader(), new Class[] &#123; mapperInterface &#125;, mapperProxy);&#125;public T newInstance(SqlSession sqlSession) &#123; final MapperProxy&lt;T&gt; mapperProxy = new MapperProxy&lt;&gt;(sqlSession, mapperInterface, methodCache); return newInstance(mapperProxy);&#125; æœ€ç»ˆæ•°æ®æŸ¥è¯¢ä¼šè¿›å…¥MapperProxyçš„invoke()ï¼Œè¿™æ˜¯å› ä¸ºè¢«ä»£ç†å¯¹è±¡çš„æ–¹æ³•ä¼šè¢«ä»£ç†å¯¹è±¡çš„invoke()æ‹¦æˆª 1234567891011@Overridepublic Object invoke(Object proxy, Method method, Object[] args) throws Throwable &#123; try &#123; if (Object.class.equals(method.getDeclaringClass())) &#123; return method.invoke(this, args); &#125; return cachedInvoker(method).invoke(proxy, method, args, sqlSession); &#125; catch (Throwable t) &#123; throw ExceptionUtil.unwrapThrowable(t); &#125;&#125; ç„¶åä¼šè§¦å‘MapperMethodå¯¹è±¡çš„execute() 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748public Object execute(SqlSession sqlSession, Object[] args) &#123; Object result; switch (command.getType()) &#123; case INSERT: &#123; Object param = method.convertArgsToSqlCommandParam(args); result = rowCountResult(sqlSession.insert(command.getName(), param)); break; &#125; case UPDATE: &#123; Object param = method.convertArgsToSqlCommandParam(args); result = rowCountResult(sqlSession.update(command.getName(), param)); break; &#125; case DELETE: &#123; Object param = method.convertArgsToSqlCommandParam(args); result = rowCountResult(sqlSession.delete(command.getName(), param)); break; &#125; case SELECT: if (method.returnsVoid() &amp;&amp; method.hasResultHandler()) &#123; executeWithResultHandler(sqlSession, args); result = null; &#125; else if (method.returnsMany()) &#123; result = executeForMany(sqlSession, args); &#125; else if (method.returnsMap()) &#123; result = executeForMap(sqlSession, args); &#125; else if (method.returnsCursor()) &#123; result = executeForCursor(sqlSession, args); &#125; else &#123; Object param = method.convertArgsToSqlCommandParam(args); result = sqlSession.selectOne(command.getName(), param); if (method.returnsOptional() &amp;&amp; (result == null || !method.getReturnType().equals(result.getClass()))) &#123; result = Optional.ofNullable(result); &#125; &#125; break; case FLUSH: result = sqlSession.flushStatements(); break; default: throw new BindingException(&quot;Unknown execution method for: &quot; + command.getName()); &#125; if (result == null &amp;&amp; method.getReturnType().isPrimitive() &amp;&amp; !method.returnsVoid()) &#123; throw new BindingException(&quot;Mapper method &#x27;&quot; + command.getName() + &quot;&#x27; attempted to return null from a method with a primitive return type (&quot; + method.getReturnType() + &quot;).&quot;); &#125; return result; &#125; MyBatisæ ¹æ®ä¸åŒæ•°æ®åº“æ“ä½œç±»å‹è°ƒç”¨äº†ä¸åŒçš„å¤„ç†æ–¹æ³• executeForMany æ–¹æ³•ä¸­ï¼ŒMyBatis å¼€å§‹é€šè¿‡ SqlSession å¯¹è±¡çš„selectListæ–¹æ³•å¼€å±•åç»­çš„æŸ¥è¯¢å·¥ä½œã€‚ è¿½è¸ªåˆ°è¿™é‡Œï¼ŒMyBatis å·²ç»å®Œæˆäº†ä¸ºæ˜ å°„æ¥å£æ³¨å…¥å®ç°çš„è¿‡ç¨‹ã€‚ äºæ˜¯ï¼Œå¯¹æ˜ å°„æ¥å£ä¸­æŠ½è±¡æ–¹æ³•çš„è°ƒç”¨è½¬å˜ä¸ºäº†æ•°æ®æŸ¥è¯¢æ“ä½œã€‚ SQLè¯­å¥çš„æŸ¥æ‰¾æ¯ä¸ª MappedStatement å¯¹è±¡å¯¹åº”äº†æˆ‘ä»¬è®¾ç½®çš„ä¸€ä¸ªæ•°æ®åº“æ“ä½œèŠ‚ ç‚¹ï¼Œå®ƒä¸»è¦å®šä¹‰äº†æ•°æ®åº“æ“ä½œè¯­å¥ã€è¾“å…¥/è¾“å‡ºå‚æ•°ç­‰ä¿¡æ¯ã€‚configuration.getMappedStatementï¼ˆstatementï¼‰è¯­å¥å°†è¦æ‰§è¡Œçš„MappedStatementå¯¹è±¡ä» Configuration`å¯¹è±¡å­˜å‚¨çš„æ˜ å°„æ–‡ä»¶ä¿¡æ¯ä¸­æ‰¾äº†å‡ºæ¥ã€‚ 1234567891011private &lt;E&gt; List&lt;E&gt; selectList(String statement, Object parameter, RowBounds rowBounds, ResultHandler handler) &#123; try &#123; MappedStatement ms = configuration.getMappedStatement(statement); dirty |= ms.isDirtySelect(); return executor.query(ms, wrapCollection(parameter), rowBounds, handler); &#125; catch (Exception e) &#123; throw ExceptionFactory.wrapException(&quot;Error querying database. Cause: &quot; + e, e); &#125; finally &#123; ErrorContext.instance().reset(); &#125; &#125; æŸ¥è¯¢ç»“æœç¼“å­˜queryæ–¹æ³•æ˜¯ä¸€ä¸ª Executoræ¥å£ä¸­çš„æŠ½è±¡æ–¹æ³•ï¼Œå®é™…æ‰§è¡Œçš„æ˜¯ CachingExecutorç±»ä¸­çš„æ–¹æ³• 1234567// CachingExecutor.classpublic &lt;E&gt; List&lt;E&gt; query(MappedStatement ms, Object parameterObject, RowBounds rowBounds, ResultHandler resultHandler) throws SQLException &#123; BoundSql boundSql = ms.getBoundSql(parameterObject); CacheKey key = createCacheKey(ms, parameterObject, rowBounds, boundSql); return query(ms, parameterObject, rowBounds, resultHandler, key, boundSql); &#125; BoundSqlæ˜¯ç»è¿‡å±‚å±‚è½¬åŒ–åå»é™¤æ‰ ifã€whereç­‰æ ‡ç­¾çš„ SQLè¯­ å¥ï¼Œè€Œ CacheKeyæ˜¯ä¸ºè¯¥æ¬¡æŸ¥è¯¢æ“ä½œè®¡ç®—å‡ºæ¥çš„ç¼“å­˜é”® æ•°æ®åº“æŸ¥è¯¢12345678910111213141516171819// CachingExecutor.classpublic &lt;E&gt; List&lt;E&gt; query(MappedStatement ms, Object parameterObject, RowBounds rowBounds, ResultHandler resultHandler, CacheKey key, BoundSql boundSql) throws SQLException &#123; Cache cache = ms.getCache(); if (cache != null) &#123; flushCacheIfRequired(ms); if (ms.isUseCache() &amp;&amp; resultHandler == null) &#123; ensureNoOutParams(ms, boundSql); @SuppressWarnings(&quot;unchecked&quot;) List&lt;E&gt; list = (List&lt;E&gt;) tcm.getObject(cache, key); if (list == null) &#123; list = delegate.query(ms, parameterObject, rowBounds, resultHandler, key, boundSql); tcm.putObject(cache, key, list); // issue #578 and #116 &#125; return list; &#125; &#125; return delegate.query(ms, parameterObject, rowBounds, resultHandler, key, boundSql); &#125; MyBatisæŸ¥çœ‹å½“å‰çš„æŸ¥è¯¢æ“ä½œæ˜¯å¦å‘½ä¸­ç¼“å­˜ã€‚å¦‚æœ æ˜¯ï¼Œåˆ™ä»ç¼“å­˜ä¸­è·å–æ•°æ®ç»“æœï¼›å¦åˆ™ï¼Œä¾¿é€šè¿‡ delegateè°ƒç”¨ queryæ–¹ æ³•ã€‚ delegateè°ƒç”¨çš„ queryæ–¹æ³•å®é™…ä¸Šæ˜¯BaseExecutorç±»ä¸­çš„ queryæ–¹æ³• 1234567891011121314151617181920212223242526272829303132333435// BaseExecutor.classpublic &lt;E&gt; List&lt;E&gt; query(MappedStatement ms, Object parameter, RowBounds rowBounds, ResultHandler resultHandler, CacheKey key, BoundSql boundSql) throws SQLException &#123; ErrorContext.instance().resource(ms.getResource()).activity(&quot;executing a query&quot;).object(ms.getId()); if (closed) &#123; throw new ExecutorException(&quot;Executor was closed.&quot;); &#125; if (queryStack == 0 &amp;&amp; ms.isFlushCacheRequired()) &#123; clearLocalCache(); &#125; List&lt;E&gt; list; try &#123; queryStack++; list = resultHandler == null ? (List&lt;E&gt;) localCache.getObject(key) : null; if (list != null) &#123; handleLocallyCachedOutputParameters(ms, key, parameter, boundSql); &#125; else &#123; list = queryFromDatabase(ms, parameter, rowBounds, resultHandler, key, boundSql); &#125; &#125; finally &#123; queryStack--; &#125; if (queryStack == 0) &#123; for (DeferredLoad deferredLoad : deferredLoads) &#123; deferredLoad.load(); &#125; // issue #601 deferredLoads.clear(); if (configuration.getLocalCacheScope() == LocalCacheScope.STATEMENT) &#123; // issue #482 clearLocalCache(); &#125; &#125; return list; &#125; MyBatiså¼€å§‹è°ƒç”¨æ•°æ®åº“å±•å¼€æŸ¥è¯¢æ“ ä½œ 12345678910111213141516// BaseExecutor.classprivate &lt;E&gt; List&lt;E&gt; queryFromDatabase(MappedStatement ms, Object parameter, RowBounds rowBounds, ResultHandler resultHandler, CacheKey key, BoundSql boundSql) throws SQLException &#123; List&lt;E&gt; list; localCache.putObject(key, EXECUTION_PLACEHOLDER); try &#123; list = doQuery(ms, parameter, rowBounds, resultHandler, boundSql); &#125; finally &#123; localCache.removeObject(key); &#125; localCache.putObject(key, list); if (ms.getStatementType() == StatementType.CALLABLE) &#123; localOutputParameterCache.putObject(key, parameter); &#125; return list; &#125; MyBatiså…ˆåœ¨ç¼“å­˜ä¸­æ”¾ç½®ä¸€ä¸ªå ä½ç¬¦ï¼Œç„¶ åè°ƒç”¨ doQueryæ–¹æ³•å®é™…æ‰§è¡ŒæŸ¥è¯¢æ“ä½œã€‚æœ€åï¼ŒåˆæŠŠç¼“å­˜ä¸­çš„å ä½ç¬¦ æ›¿æ¢æˆçœŸæ­£çš„æŸ¥è¯¢ç»“æœ 1234567891011121314// SimpleExecutor.classpublic &lt;E&gt; List&lt;E&gt; doQuery(MappedStatement ms, Object parameter, RowBounds rowBounds, ResultHandler resultHandler, BoundSql boundSql) throws SQLException &#123; Statement stmt = null; try &#123; Configuration configuration = ms.getConfiguration(); StatementHandler handler = configuration.newStatementHandler(wrapper, ms, parameter, rowBounds, resultHandler, boundSql); stmt = prepareStatement(handler, ms.getStatementLog()); return handler.query(stmt, resultHandler); &#125; finally &#123; closeStatement(stmt); &#125; &#125; ä¸Šè¿°æ–¹æ³•ç”Ÿæˆäº†Statementå¯¹è±¡stmtã€‚Statementç±»å¹¶ä¸æ˜¯MyBatis ä¸­çš„ç±»ï¼Œè€Œæ˜¯java.sqlåŒ…ä¸­çš„ç±»ã€‚Statementç±»èƒ½å¤Ÿæ‰§è¡Œé™æ€ SQLè¯­å¥ å¹¶è¿”å›ç»“æœã€‚ ç¨‹åºè¿˜é€šè¿‡ Configurationçš„ newStatementHandleræ–¹æ³•è·å¾—äº† ä¸€ä¸ª StatementHandlerå¯¹è±¡ handlerï¼Œç„¶åå°†æŸ¥è¯¢æ“ä½œäº¤ç»™ StatementHandlerå¯¹è±¡è¿›è¡Œã€‚StatementHandleræ˜¯ä¸€ä¸ªè¯­å¥å¤„ç†å™¨ç±»ï¼Œå…¶ä¸­å° è£…äº†å¾ˆå¤šè¯­å¥æ“ä½œæ–¹æ³• 123456// PreparedStatementHandler.classpublic &lt;E&gt; List&lt;E&gt; query(Statement statement, ResultHandler resultHandler) throws SQLException &#123; PreparedStatement ps = (PreparedStatement) statement; ps.execute(); return resultSetHandler.handleResultSets(ps); &#125; è¿™é‡Œ ps.executeï¼ˆï¼‰çœŸæ­£æ‰§è¡Œäº† SQL è¯­å¥ï¼Œç„¶åæŠŠæ‰§è¡Œç»“æœäº¤ ç»™ ResultHandler å¯¹è±¡å¤„ç†ã€‚è€ŒPreparedStatementç±»å¹¶ä¸æ˜¯MyBatis ä¸­çš„ç±»ï¼Œå› è€Œps.executeï¼ˆï¼‰çš„æ‰§è¡Œä¸å†ç”±MyBatisè´Ÿè´£ï¼Œè€Œæ˜¯ç”± com.mysql.cj.jdbcåŒ…ä¸­çš„ç±»è´Ÿè´£ï¼Œè¿™é‡Œä¸å†ç»§ç»­è¿½è¸ªã€‚ æ€»ç»“ï¼š åœ¨è¿›è¡Œæ•°æ®åº“æŸ¥è¯¢å‰ï¼Œå…ˆæŸ¥è¯¢ç¼“å­˜ï¼›å¦‚æœç¡®å®éœ€è¦æŸ¥è¯¢æ•°æ® åº“ï¼Œåˆ™æ•°æ®åº“æŸ¥è¯¢ä¹‹åçš„ç»“æœä¹Ÿæ”¾å…¥ç¼“å­˜ä¸­ã€‚ Â· SQL è¯­å¥çš„æ‰§è¡Œç»è¿‡äº†å±‚å±‚è½¬åŒ–ï¼Œä¾æ¬¡ç»è¿‡äº† MappedStatement å¯¹è±¡ã€Statementå¯¹è±¡å’Œ PreparedStatementå¯¹è±¡ï¼Œæœ€åæ‰å¾—ä»¥æ‰§ è¡Œã€‚ Â· æœ€ç»ˆæ•°æ®åº“æŸ¥è¯¢å¾—åˆ°çš„ç»“æœäº¤ç»™ ResultHandlerå¯¹è±¡å¤„ç†ã€‚ å¤„ç†ç»“æœé›†12345678910111213141516171819202122232425262728293031323334353637// DefaultResultSetHandler.classpublic List&lt;Object&gt; handleResultSets(Statement stmt) throws SQLException &#123; ErrorContext.instance().activity(&quot;handling results&quot;).object(mappedStatement.getId()); final List&lt;Object&gt; multipleResults = new ArrayList&lt;&gt;(); int resultSetCount = 0; ResultSetWrapper rsw = getFirstResultSet(stmt); List&lt;ResultMap&gt; resultMaps = mappedStatement.getResultMaps(); int resultMapCount = resultMaps.size(); validateResultMapsCount(rsw, resultMapCount); while (rsw != null &amp;&amp; resultMapCount &gt; resultSetCount) &#123; ResultMap resultMap = resultMaps.get(resultSetCount); handleResultSet(rsw, resultMap, multipleResults, null); rsw = getNextResultSet(stmt); cleanUpAfterHandlingResultSet(); resultSetCount++; &#125; String[] resultSets = mappedStatement.getResultSets(); if (resultSets != null) &#123; while (rsw != null &amp;&amp; resultSetCount &lt; resultSets.length) &#123; ResultMapping parentMapping = nextResultMaps.get(resultSets[resultSetCount]); if (parentMapping != null) &#123; String nestedResultMapId = parentMapping.getNestedResultMapId(); ResultMap resultMap = configuration.getResultMap(nestedResultMapId); handleResultSet(rsw, resultMap, null, parentMapping); &#125; rsw = getNextResultSet(stmt); cleanUpAfterHandlingResultSet(); resultSetCount++; &#125; &#125; return collapseSingleResultList(multipleResults); &#125;","tags":[{"name":"Mybatis","slug":"Mybatis","permalink":"https://alexhuihui.github.io/tags/Mybatis/"}]},{"title":"ã€äº‹åŠ¡å¤„ç†ã€‘æœ¬åœ°äº‹åŠ¡","date":"2023-05-17T11:54:06.000Z","path":"article/20230517.html","text":"å¤§å®¶éƒ½çŸ¥é“æ•°æ®åº“äº‹åŠ¡ä¸­æœ‰ç€AICDçš„è¯´æ³•ï¼Œå®é™…ä¸ŠC(ä¸€è‡´æ€§)æ˜¯ç›®çš„ï¼Œè€Œå¯¹åº”çš„A(åŸå­æ€§)ã€I(éš”ç¦»æ€§)ã€D(æŒä¹…æ€§)æ˜¯æ‰‹æ®µï¼ŒAID -&gt; Cã€‚ æ¦‚å¿µä»‹ç»åŸå­æ€§åŸå­æ€§ä¿è¯äº†äº‹åŠ¡çš„å¤šä¸ªæ“ä½œè¦ä¹ˆéƒ½ç”Ÿæ•ˆè¦ä¹ˆéƒ½ä¸ç”Ÿæ•ˆï¼Œä¸ä¼šå­˜åœ¨ä¸­é—´çŠ¶æ€ éš”ç¦»æ€§åœ¨ä¸åŒçš„ä¸šåŠ¡å¤„ç†è¿‡ç¨‹ä¸­ï¼Œäº’ä¸å½±å“å„è‡ªè¯»å†™æ•°æ® æŒä¹…æ€§æ‰€æœ‰æäº¤æˆåŠŸçš„æ•°æ®ä¿®æ”¹éƒ½åº”è¯¥è¢«æŒä¹…åŒ–ä¿å­˜ å®ç°åŸå­æ€§å’ŒæŒä¹…æ€§","tags":[{"name":"äº‹åŠ¡","slug":"äº‹åŠ¡","permalink":"https://alexhuihui.github.io/tags/%E4%BA%8B%E5%8A%A1/"}]},{"title":"ã€é¡¹ç›®ã€‘åˆ†è¯ŠçŸ¥è¯†åº“ç³»ç»Ÿè®¾è®¡","date":"2023-05-12T11:45:55.000Z","path":"article/20230512.html","text":"åˆ†è¯ŠçŸ¥è¯†åº“çš„ç³»ç»Ÿè®¾è®¡ è®¾è®¡æ–¹æ¡ˆï¼š æ•°æ®åº“è®¾è®¡é’ˆå¯¹ç–¾ç—…ã€è¯å“ã€æ€¥æ•‘å’Œå¼‚å¸¸åˆ†è¯Šæ¡ˆä¾‹ï¼Œåˆ†åˆ«è®¾è®¡å¯¹åº”çš„æ•°æ®è¡¨ä»¥åŠå…³è”çš„æ•°æ®è¡¨ã€‚ Elasticsearchç´¢å¼•è®¾è®¡åœ¨Elasticsearchä¸­ï¼Œä¸ºç–¾ç—…ã€è¯å“å’Œæ€¥æ•‘å»ºç«‹ä¸€ä¸ªç»Ÿä¸€çš„ç´¢å¼•ï¼Œæ–¹ä¾¿è¿›è¡Œæœç´¢ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176&#123; &quot;index_patterns&quot;: [ &quot;local-knowledge-*&quot;, &quot;dev-knowledge-*&quot;, &quot;sit-knowledge-*&quot;, &quot;uat-knowledge-*&quot;, &quot;prod-knowledge-*&quot; ], &quot;settings&quot;: &#123; &quot;number_of_shards&quot;: 1, &quot;number_of_replicas&quot;: 1, &quot;analysis&quot;: &#123; &quot;filter&quot;: &#123; &quot;len&quot;: &#123; &quot;type&quot;: &quot;length&quot;, &quot;min&quot;: 2 &#125; &#125;, &quot;analyzer&quot;: &#123; &quot;custom_ik_max&quot;: &#123; &quot;tokenizer&quot;: &quot;ik_max_word&quot;, &quot;filter&quot;: [ &quot;len&quot; ] &#125; &#125; &#125; &#125;, &quot;mappings&quot;: &#123; &quot;properties&quot;: &#123; &quot;name&quot;: &#123; &quot;type&quot;: &quot;text&quot;, &quot;analyzer&quot;: &quot;custom_ik_max&quot;, &quot;search_analyzer&quot;: &quot;ik_smart&quot; &#125;, &quot;commonName&quot;: &#123; &quot;type&quot;: &quot;text&quot;, &quot;analyzer&quot;: &quot;custom_ik_max&quot;, &quot;search_analyzer&quot;: &quot;ik_smart&quot; &#125;, &quot;infoType&quot;: &#123; &quot;type&quot;: &quot;integer&quot; &#125;, &quot;introduction&quot;: &#123; &quot;type&quot;: &quot;text&quot;, &quot;analyzer&quot;: &quot;custom_ik_max&quot;, &quot;search_analyzer&quot;: &quot;ik_smart&quot; &#125;, &quot;typeId&quot;: &#123; &quot;type&quot;: &quot;long&quot; &#125;, &quot;typeName&quot;: &#123; &quot;type&quot;: &quot;keyword&quot; &#125;, &quot;relatedDepartments&quot;: &#123; &quot;type&quot;: &quot;nested&quot;, &quot;properties&quot;: &#123; &quot;departmentId&quot;: &#123; &quot;type&quot;: &quot;long&quot; &#125;, &quot;departmentName&quot;: &#123; &quot;type&quot;: &quot;keyword&quot; &#125; &#125; &#125;, &quot;relatedPositions&quot;: &#123; &quot;type&quot;: &quot;nested&quot;, &quot;properties&quot;: &#123; &quot;positionId&quot;: &#123; &quot;type&quot;: &quot;long&quot; &#125;, &quot;positionName&quot;: &#123; &quot;type&quot;: &quot;keyword&quot; &#125; &#125; &#125;, &quot;fdaId&quot;: &#123; &quot;type&quot;: &quot;long&quot; &#125;, &quot;fdaName&quot;: &#123; &quot;type&quot;: &quot;keyword&quot; &#125;, &quot;morbidityId&quot;: &#123; &quot;type&quot;: &quot;long&quot; &#125;, &quot;morbidityName&quot;: &#123; &quot;type&quot;: &quot;keyword&quot; &#125;, &quot;symptomDescription&quot;: &#123; &quot;type&quot;: &quot;text&quot;, &quot;analyzer&quot;: &quot;custom_ik_max&quot;, &quot;search_analyzer&quot;: &quot;ik_smart&quot; &#125;, &quot;checkDescription&quot;: &#123; &quot;type&quot;: &quot;text&quot;, &quot;analyzer&quot;: &quot;custom_ik_max&quot;, &quot;search_analyzer&quot;: &quot;ik_smart&quot; &#125;, &quot;treatment&quot;: &#123; &quot;type&quot;: &quot;text&quot;, &quot;analyzer&quot;: &quot;ik_max_word&quot;, &quot;search_analyzer&quot;: &quot;ik_smart&quot; &#125;, &quot;prevention&quot;: &#123; &quot;type&quot;: &quot;text&quot;, &quot;analyzer&quot;: &quot;custom_ik_max&quot;, &quot;search_analyzer&quot;: &quot;ik_smart&quot; &#125;, &quot;concurrent&quot;: &#123; &quot;type&quot;: &quot;text&quot;, &quot;analyzer&quot;: &quot;custom_ik_max&quot;, &quot;search_analyzer&quot;: &quot;ik_smart&quot; &#125;, &quot;diagnosis&quot;: &#123; &quot;type&quot;: &quot;text&quot;, &quot;analyzer&quot;: &quot;ik_max_word&quot;, &quot;search_analyzer&quot;: &quot;ik_smart&quot; &#125;, &quot;adverseReaction&quot;: &#123; &quot;type&quot;: &quot;text&quot;, &quot;analyzer&quot;: &quot;custom_ik_max&quot;, &quot;search_analyzer&quot;: &quot;ik_smart&quot; &#125;, &quot;component&quot;: &#123; &quot;type&quot;: &quot;text&quot;, &quot;analyzer&quot;: &quot;custom_ik_max&quot;, &quot;search_analyzer&quot;: &quot;ik_smart&quot; &#125;, &quot;contraindication&quot;: &#123; &quot;type&quot;: &quot;text&quot;, &quot;analyzer&quot;: &quot;custom_ik_max&quot;, &quot;search_analyzer&quot;: &quot;ik_smart&quot; &#125;, &quot;dosage&quot;: &#123; &quot;type&quot;: &quot;text&quot;, &quot;analyzer&quot;: &quot;custom_ik_max&quot;, &quot;search_analyzer&quot;: &quot;ik_smart&quot; &#125;, &quot;indication&quot;: &#123; &quot;type&quot;: &quot;text&quot;, &quot;analyzer&quot;: &quot;custom_ik_max&quot;, &quot;search_analyzer&quot;: &quot;ik_smart&quot; &#125;, &quot;content&quot;: &#123; &quot;type&quot;: &quot;text&quot;, &quot;analyzer&quot;: &quot;custom_ik_max&quot;, &quot;search_analyzer&quot;: &quot;ik_smart&quot; &#125;, &quot;note&quot;: &#123; &quot;type&quot;: &quot;text&quot;, &quot;analyzer&quot;: &quot;custom_ik_max&quot;, &quot;search_analyzer&quot;: &quot;ik_smart&quot; &#125;, &quot;crtId&quot;: &#123; &quot;type&quot;: &quot;long&quot; &#125;, &quot;crtName&quot;: &#123; &quot;type&quot;: &quot;text&quot; &#125;, &quot;crtTime&quot;: &#123; &quot;type&quot;: &quot;date&quot;, &quot;format&quot;: &quot;yyyy-MM-dd HH:mm:ss||yyyy-MM-dd||epoch_millis&quot; &#125;, &quot;updId&quot;: &#123; &quot;type&quot;: &quot;long&quot; &#125;, &quot;updName&quot;: &#123; &quot;type&quot;: &quot;text&quot; &#125;, &quot;updTime&quot;: &#123; &quot;type&quot;: &quot;date&quot;, &quot;format&quot;: &quot;yyyy-MM-dd HH:mm:ss||yyyy-MM-dd||epoch_millis&quot; &#125; &#125; &#125;&#125; åº”ç”¨ç¨‹åºè®¾è®¡ä¸ºç–¾ç—…ã€è¯å“ã€æ€¥æ•‘å’Œå¼‚å¸¸åˆ†è¯Šæ¡ˆä¾‹æä¾›åŸºç¡€æ•°æ®ç®¡ç†èƒ½åŠ›ï¼ŒAPIå¦‚ä¸‹ ç–¾ç—…æ¨¡å—APIæ¥å£ APIåç§° è¯·æ±‚æ–¹å¼ æ¥å£è·¯å¾„ è¯·æ±‚å‚æ•° è¿”å›ç»“æœ å¤‡æ³¨ è·å–ç–¾ç—…åˆ—è¡¨ GET /diseases - ç–¾ç—…åˆ—è¡¨ åˆ†é¡µè·å–æ‰€æœ‰ç–¾ç—…ä¿¡æ¯ è·å–ç–¾ç—…è¯¦æƒ… GET /diseases/{id} id (ç–¾ç—…ID) ç–¾ç—…è¯¦æƒ… æ ¹æ®ç–¾ç—…IDè·å–ç–¾ç—…è¯¦ç»†ä¿¡æ¯ åˆ›å»ºç–¾ç—… POST /diseases ç–¾ç—…ä¿¡æ¯ åˆ›å»ºæˆåŠŸçš„ç–¾ç—… åˆ›å»ºæ–°çš„ç–¾ç—… æ›´æ–°ç–¾ç—… PUT /diseases/{id} id (ç–¾ç—…ID) æ›´æ–°æˆåŠŸçš„ç–¾ç—… æ ¹æ®ç–¾ç—…IDæ›´æ–°ç–¾ç—…ä¿¡æ¯ åˆ é™¤ç–¾ç—… DELETE /diseases/{id} id (ç–¾ç—…ID) åˆ é™¤æˆåŠŸçš„ç–¾ç—… æ ¹æ®ç–¾ç—…IDåˆ é™¤ç–¾ç—… è¯å“æ¨¡å—APIæ¥å£ APIåç§° è¯·æ±‚æ–¹å¼ æ¥å£è·¯å¾„ è¯·æ±‚å‚æ•° è¿”å›ç»“æœ å¤‡æ³¨ è·å–è¯å“åˆ—è¡¨ GET /drugs - è¯å“åˆ—è¡¨ åˆ†é¡µè·å–æ‰€æœ‰è¯å“ä¿¡æ¯ è·å–è¯å“è¯¦æƒ… GET /drugs/{id} id (è¯å“ID) è¯å“è¯¦æƒ… æ ¹æ®è¯å“IDè·å–è¯å“è¯¦ç»†ä¿¡æ¯ åˆ›å»ºè¯å“ POST /drugs è¯å“ä¿¡æ¯ åˆ›å»ºæˆåŠŸçš„è¯å“ åˆ›å»ºæ–°çš„è¯å“ æ›´æ–°è¯å“ PUT /drugs/{id} id (è¯å“ID) æ›´æ–°æˆåŠŸçš„è¯å“ æ ¹æ®è¯å“IDæ›´æ–°è¯å“ä¿¡æ¯ åˆ é™¤è¯å“ DELETE /drugs/{id} id (è¯å“ID) åˆ é™¤æˆåŠŸçš„è¯å“ æ ¹æ®è¯å“IDåˆ é™¤è¯å“ æ€¥æ•‘æ¨¡å—APIæ¥å£ APIåç§° è¯·æ±‚æ–¹å¼ æ¥å£è·¯å¾„ è¯·æ±‚å‚æ•° è¿”å›ç»“æœ å¤‡æ³¨ è·å–æ€¥æ•‘ä¿¡æ¯åˆ—è¡¨ GET /emergencies - æ€¥æ•‘ä¿¡æ¯åˆ—è¡¨ åˆ†é¡µè·å–æ‰€æœ‰æ€¥æ•‘ä¿¡æ¯ è·å–æ€¥æ•‘ä¿¡æ¯è¯¦æƒ… GET /emergencies/{id} id (æ€¥æ•‘ä¿¡æ¯ID) æ€¥æ•‘ä¿¡æ¯è¯¦æƒ… æ ¹æ®æ€¥æ•‘ä¿¡æ¯IDè·å–æ€¥æ•‘ä¿¡æ¯è¯¦ç»†ä¿¡æ¯ åˆ›å»ºæ€¥æ•‘ä¿¡æ¯ POST /emergencies æ€¥æ•‘ä¿¡æ¯ åˆ›å»ºæˆåŠŸçš„æ€¥æ•‘ä¿¡æ¯ åˆ›å»ºæ–°çš„æ€¥æ•‘ä¿¡æ¯ æ›´æ–°æ€¥æ•‘ä¿¡æ¯ PUT /emergencies/{id} id (æ€¥æ•‘ä¿¡æ¯ID) æ›´æ–°æˆåŠŸçš„æ€¥æ•‘ä¿¡æ¯ æ ¹æ®æ€¥æ•‘ä¿¡æ¯IDæ›´æ–°æ€¥æ•‘ä¿¡æ¯ åˆ é™¤æ€¥æ•‘ä¿¡æ¯ DELETE /emergencies/{id} id (æ€¥æ•‘ä¿¡æ¯ID) åˆ é™¤æˆåŠŸçš„æ€¥æ•‘ä¿¡æ¯ æ ¹æ®æ€¥æ•‘ä¿¡æ¯IDåˆ é™¤æ€¥æ•‘ä¿¡æ¯ å¼‚å¸¸åˆ†è¯Šæ¡ˆä¾‹æ¨¡å—APIæ¥å£ APIåç§° è¯·æ±‚æ–¹å¼ æ¥å£è·¯å¾„ è¯·æ±‚å‚æ•° è¿”å›ç»“æœ å¤‡æ³¨ è·å–å¼‚å¸¸åˆ†è¯Šæ¡ˆä¾‹åˆ—è¡¨ GET /case - å¼‚å¸¸åˆ†è¯Šæ¡ˆä¾‹åˆ—è¡¨ åˆ†é¡µè·å–æ‰€æœ‰å¼‚å¸¸åˆ†è¯Šæ¡ˆä¾‹ä¿¡æ¯ è·å–å¼‚å¸¸åˆ†è¯Šæ¡ˆä¾‹è¯¦æƒ… GET /case/{id} id (æ¡ˆä¾‹ID) å¼‚å¸¸åˆ†è¯Šæ¡ˆä¾‹è¯¦æƒ… æ ¹æ®æ¡ˆä¾‹IDè·å–å¼‚å¸¸åˆ†è¯Šæ¡ˆä¾‹è¯¦ç»†ä¿¡æ¯ åˆ›å»ºå¼‚å¸¸åˆ†è¯Šæ¡ˆä¾‹ POST /case å¼‚å¸¸åˆ†è¯Šæ¡ˆä¾‹ä¿¡æ¯ åˆ›å»ºæˆåŠŸçš„å¼‚å¸¸åˆ†è¯Šæ¡ˆä¾‹ åˆ›å»ºæ–°çš„å¼‚å¸¸åˆ†è¯Šæ¡ˆä¾‹ æ›´æ–°å¼‚å¸¸åˆ†è¯Šæ¡ˆä¾‹ PUT /case/{id} id (æ¡ˆä¾‹ID) æ›´æ–°æˆåŠŸçš„å¼‚å¸¸åˆ†è¯Šæ¡ˆä¾‹ æ ¹æ®æ¡ˆä¾‹IDæ›´æ–°å¼‚å¸¸åˆ†è¯Šæ¡ˆä¾‹ä¿¡æ¯ åˆ é™¤å¼‚å¸¸åˆ†è¯Šæ¡ˆä¾‹ DELETE /case/{id} id (æ¡ˆä¾‹ID) åˆ é™¤æˆåŠŸçš„å¼‚å¸¸åˆ†è¯Šæ¡ˆä¾‹ æ ¹æ®æ¡ˆä¾‹IDåˆ é™¤å¼‚å¸¸åˆ†è¯Šæ¡ˆä¾‹ è·å–æ¡ˆä¾‹å…³è”ç–¾ç—…åˆ—è¡¨ GET /case/{id}/diseases id (æ¡ˆä¾‹ID) å…³è”ç–¾ç—…åˆ—è¡¨ æ ¹æ®æ¡ˆä¾‹IDè·å–å…³è”çš„ç–¾ç—…åˆ—è¡¨ è·å–æ¡ˆä¾‹å…³è”ç§‘å®¤åˆ—è¡¨ GET /case/{id}/departments id (æ¡ˆä¾‹ID) å…³è”ç§‘å®¤åˆ—è¡¨ å®‰å…¨æ€§è®¾è®¡é’ˆå¯¹æ•æ„Ÿæ•°æ®ï¼Œä¾‹å¦‚è¯å“åç§°ã€ç–¾ç—…åç§°å’Œç—…äººéšç§ä¿¡æ¯ç­‰ï¼Œéœ€è¦å®ç°è®¿é—®æ§åˆ¶å’Œå®‰å…¨ä¿æŠ¤æªæ–½ã€‚åŸºäºè§’è‰²å’Œæƒé™çš„è®¿é—®æ§åˆ¶ï¼Œä»¥åŠå¯¹æ•°æ®çš„åŠ å¯†å’Œè§£å¯†ä¿æŠ¤ã€‚","tags":[{"name":"è®¾è®¡","slug":"è®¾è®¡","permalink":"https://alexhuihui.github.io/tags/%E8%AE%BE%E8%AE%A1/"}]},{"title":"ã€LLMã€‘LLMå…¥é—¨","date":"2023-04-14T11:54:06.000Z","path":"article/20230414.html","text":"LLMä»‹ç»è¯­è¨€æ¨¡å‹åœ¨æœ€è¿‘å‡ å¹´å†…è¿…é€Ÿæé«˜ï¼Œå¤§å‹è¯­è¨€æ¨¡å‹ï¼ˆLLMsï¼‰å¦‚GPT-3å’ŒGPT-4æˆä¸ºä¸­å¿ƒã€‚è¿™äº›æ¨¡å‹å› å…¶èƒ½å¤Ÿä»¥æƒŠäººçš„æŠ€å·§æ‰§è¡Œå„ç§ä»»åŠ¡è€Œå˜å¾—æµè¡Œã€‚æ­¤å¤–ï¼Œéšç€è¿™äº›æ¨¡å‹çš„å‚æ•°æ•°é‡ï¼ˆæ•°åäº¿ï¼ï¼‰å¢åŠ ï¼Œå®ƒä»¬ä¸å¯é¢„æµ‹åœ°è·å¾—äº†æ–°çš„èƒ½åŠ›ã€‚ åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†æ¢è®¨LLMsã€å®ƒä»¬å¯ä»¥æ‰§è¡Œçš„ä»»åŠ¡ã€å®ƒä»¬çš„ç¼ºç‚¹ä»¥åŠå„ç§æç¤ºå·¥ç¨‹ç­–ç•¥ã€‚ ä»€ä¹ˆæ˜¯LLMsï¼ŸLLMsæ˜¯ç¥ç»ç½‘ç»œï¼Œåœ¨å¤§é‡æ–‡æœ¬æ•°æ®ä¸Šè¿›è¡Œäº†è®­ç»ƒã€‚è®­ç»ƒè¿‡ç¨‹ä½¿æ¨¡å‹å­¦ä¹ æ–‡æœ¬ä¸­çš„æ¨¡å¼ï¼ŒåŒ…æ‹¬è¯­æ³•ã€å¥æ³•å’Œè¯æ±‡å…³è”ã€‚è¿™äº›å­¦ä¹ åˆ°çš„æ¨¡å¼è¢«ç”¨äºç”Ÿæˆç±»ä¼¼äººç±»æ–‡å­—ï¼Œä½¿å…¶éå¸¸é€‚åˆè‡ªç„¶è¯­è¨€å¤„ç†ï¼ˆNLPï¼‰ä»»åŠ¡ã€‚ å“ªäº›LLMå¯ç”¨ï¼Ÿæœ‰å‡ ä¸ªLLMå¯ç”¨ï¼Œå…¶ä¸­GPT-4æœ€å—æ¬¢è¿ã€‚å…¶ä»–æ¨¡å‹åŒ…æ‹¬ LLaMAã€PaLMã€BERT å’Œ T5 ç­‰ç­‰ã€‚æ¯ä¸ªæ¨¡å‹éƒ½æœ‰å…¶ä¼˜ç‚¹å’Œç¼ºç‚¹ï¼Œå¹¶ä¸”ä¸€äº›æ˜¯å¼€æ”¾æ€§ä½¿ç”¨è€Œå…¶ä»–åˆ™åªèƒ½é€šè¿‡APIä½¿ç”¨ã€‚ LLM çš„å±€é™æ€§å°½ç®¡è¡¨ç°å‡ºè‰², ä½† LLMS ä¹Ÿå­˜åœ¨ä¸€äº›é™åˆ¶. å…¶ä¸­ä¸€ä¸ªé‡è¦ç¼ºé™·æ˜¯æ— æ³•è¶…è¶Šæç¤ºä¸­æä¾›çš„ä¿¡æ¯è¿›è¡Œæ¨ç†ã€‚æ­¤å¤–ï¼ŒLLMs å¯ä»¥æ ¹æ®å®ƒä»¬æ‰€è®­ç»ƒçš„æ•°æ®ç”Ÿæˆæœ‰åè§çš„æ–‡æœ¬ã€‚æ§åˆ¶ LLMs çš„è¾“å‡ºä¹Ÿå¾ˆå…·æŒ‘æˆ˜æ€§ï¼Œå› æ­¤éœ€è¦ä½¿ç”¨æç¤ºå·¥ç¨‹ç­–ç•¥æ¥å®ç°æ‰€éœ€çš„è¾“å‡ºã€‚ã€‚ ä½ èƒ½æ‰§è¡Œå“ªäº›ä»»åŠ¡ï¼Ÿæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸ºæ¯ä¸ªæ¡ˆä¾‹æ ¼å¼åŒ–æç¤ºæ¥æŒ‡å¯¼LLMsæ‰§è¡Œç‰¹å®šçš„ä»»åŠ¡ã€‚ä»¥ä¸‹æ˜¯è¿™äº›ä»»åŠ¡å’Œæç¤ºæ¨¡æ¿ä»¥åŠæ¯ä¸ªç¤ºä¾‹çš„åˆ—è¡¨ã€‚ æ–‡æœ¬æ‘˜è¦LLMså¯ä»¥ç”Ÿæˆé•¿æ–‡æœ¬çš„æ‘˜è¦ï¼Œä½¿å†…å®¹æ›´æ˜“äºç†è§£å’Œæ¶ˆåŒ–ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æç¤ºæ¨¡æ¿è¯·æ±‚å¯¹ä¸€æ®µæ–‡å­—è¿›è¡Œæ‘˜è¦ï¼š 12&lt;Full text&gt;Summarize the text above: / Explain the text above in &lt;N&gt; sentences: ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥è¦æ±‚æŒ‰ç…§ä»¥ä¸‹æç¤ºå¯¹è¿™æ®µæ–‡æœ¬è¿›è¡Œæ€»ç»“ï¼š 123In a mechanical watch the watch&#x27;s gears are turned by a spiral spring called a mainspring. In a manual watch energy is stored in the mainspring by turning a knob, the crown on the side of the watch. Then the energy from the mainspring powers the watch movement until it runs down, requiring the spring to be wound again.A self-winding watch movement has a mechanism which winds the mainspring using the natural motions of the wearer&#x27;s body. The watch contains an oscillating weight that turns on a pivot. The normal movements of the watch in the user&#x27;s pocket (for a pocketwatch) or on the user&#x27;s arm (for a wristwatch) cause the rotor to pivot on its staff, which is attached to a ratcheted winding mechanism. The motion of the watch is thereby translated into circular motion of the weight which, through a series of reverser and reducing gears, eventually winds the mainspring. There are many different designs for modern self-winding mechanisms. Some designs allow winding of the watch to take place while the weight swings in only one direction while other, more advanced, mechanisms have two ratchets and wind the mainspring during both clockwise and anti-clockwise weight motions.Explain the text above in 2 sentences: è¿™å°†äº§ç”Ÿä»¥ä¸‹è¾“å‡ºï¼š 1A mechanical watch uses a mainspring to power the movement of the watch&#x27;s gears. In a manual watch, the mainspring is wound by turning a knob, while a self-winding watch uses the natural motion of the wearer&#x27;s body to wind the mainspring through an oscillating weight and ratcheted winding mechanism. ä¿¡æ¯æå–LLMså¯ä»¥ä»å¤§é‡æ–‡æœ¬ä¸­è¯†åˆ«å’Œæå–ç‰¹å®šä¿¡æ¯ã€‚è¿™åœ¨æ–°é—»å’Œå•†ä¸šæƒ…æŠ¥ç­‰é¢†åŸŸéå¸¸æœ‰ç”¨ã€‚ä»¥ä¸‹æ¨¡æ¿æŒ‡å¯¼æ¨¡å‹æå–ä¿¡æ¯ï¼š 12&lt;Full text&gt;Mention X in the text above: / List X in the text above: ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥è¦æ±‚ä»ä»¥ä¸‹æ–‡æœ¬ä¸­æå–åœ°ç‚¹åç§°ï¼š 12The earliest credible evidence for a successful design is the watch made by the Swiss watchmaker Abraham-Louis Perrelet, who lived in Le Locle. In late 1776 or early 1777, he invented a self-winding mechanism for pocket watches using an oscillating weight inside the watch that moved up and down. The Geneva Society of Arts, reporting on this watch in 1777, stated that 15 minutes walking was necessary to fully wind the watch.List the names of places in the text above: è¿™å°†äº§ç”Ÿä»¥ä¸‹è¾“å‡ºï¼š 1Le Locle, Geneva. é—®ç­”LLMsè¿˜å¯ä»¥æ ¹æ®æç¤ºæä¾›çš„ä¿¡æ¯å›ç­”é—®é¢˜ã€‚ä»¥ä¸‹æ¨¡æ¿å¯ç”¨äºæŒ‡å¯¼LLMå›ç­”é—®é¢˜ï¼š æ¨¡æ¿ 1234åŸºäºä¸‹é¢çš„ä¸Šä¸‹æ–‡å›ç­”é—®é¢˜ã€‚&lt;å…¶ä»–è¯´æ˜&gt;ã€‚å¦‚æœä¸ç¡®å®šï¼Œè¯·å›å¤â€œä¸ç¡®å®šâ€ã€‚ä¸Šä¸‹æ–‡ï¼š&lt;Context&gt;Qï¼š&lt;Question&gt;Aï¼š ä¾‹å¦‚ï¼Œä½¿ç”¨ä»¥ä¸‹æç¤ºï¼š æç¤º 1234åŸºäºä¸‹é¢çš„ä¸Šä¸‹æ–‡å›ç­”é—®é¢˜ã€‚ç”¨ä¸€å¥è¯å›ç­”ã€‚å¦‚æœä¸ç¡®å®šï¼Œè¯·å›å¤â€œä¸ç¡®å®šâ€ã€‚ä¸Šä¸‹æ–‡ï¼šè‡ªåŠ¨è¡¨ä¹Ÿç§°ä¸ºè‡ªåŠ¨ç»•çº¿è¡¨æˆ–ç®€å•åœ°ç§°ä¸ºè‡ªåŠ¨è¡¨ï¼Œæ˜¯ä¸€ç§æœºæ¢°è¡¨ï¼Œåœ¨ä½©æˆ´è€…çš„è‡ªç„¶è¿åŠ¨ä¸­æä¾›èƒ½é‡æ¥ç»•åˆ¶ä¸»å‘æ¡ï¼Œä½¿æ‰‹å·¥ç»•çº¿å˜å¾—ä¸å¿…è¦ã€‚å®ƒä¸æ‰‹åŠ¨è¡¨æœ‰æ‰€åŒºåˆ«ï¼Œå› ä¸ºæ‰‹åŠ¨è¡¨å¿…é¡»å®šæœŸæ‰‹æ‘‡å…¶ä¸»å‘æ¡ã€‚Qï¼šè‡ªåŠ¨è…•è¡¨éœ€è¦æ‰‹åŠ¨ç»•å—ï¼ŸAï¼š ChatGPT å›åº”é“ï¼š è¾“å‡º 1å¦ï¼Œå¦‚æœè¶³å¤Ÿä½©æˆ´ï¼Œåˆ™æ— éœ€æ‰‹åŠ¨ç¼ ç»•è‡ªåŠ¨è…•è¡¨ï¼Œå› ä¸ºä½©æˆ´è€…çš„è‡ªç„¶è¿åŠ¨ä¼šæä¾›èƒ½é‡æ¥ç»´æŒå…¶æ­£å¸¸è¿è½¬ã€‚ æ–‡æœ¬åˆ†ç±»LLMså¯ä»¥å°†æ–‡æœ¬åˆ†ç±»ä¸ºé¢„å®šä¹‰çš„ç±»åˆ«ï¼Œä¾‹å¦‚æƒ…æ„Ÿåˆ†ææˆ–åƒåœ¾é‚®ä»¶æ£€æµ‹ã€‚æ‚¨å¯ä»¥æŒ‰ä»¥ä¸‹æ–¹å¼æ ¼å¼åŒ–æ–‡æœ¬åˆ†ç±»æŒ‡ä»¤ï¼š æ¨¡æ¿ 123å°†æ–‡æœ¬åˆ†ç±»ä¸º&lt;é€‰æ‹©åˆ—è¡¨&gt;ï¼šæ–‡æœ¬ï¼š&lt;å®Œæ•´æ–‡æœ¬&gt;åˆ†ç±»ï¼š ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•å¯¹ä¸€æ®µæ–‡å­—è¿›è¡Œæƒ…æ„Ÿåˆ†æï¼Œåˆ¤æ–­å…¶æƒ…ç»ªæ˜¯ç§¯æçš„ã€ä¸­æ€§çš„è¿˜æ˜¯æ¶ˆæçš„ï¼š æç¤º 123å°†è¯¥æ®µæ–‡å­—å½’ç±»ä¸ºç§¯æã€ä¸­æ€§æˆ–æ¶ˆæï¼šæ–‡æœ¬ï¼šé‚£ä¸ªæŠ•ç¯®é€‰æ‹©å¤ªç³Ÿç³•äº†ã€‚åˆ†ç±»ï¼š è¾“å‡º 1æ¶ˆæ å¯¹è¯LLMå¯ä»¥ç”Ÿæˆç±»ä¼¼äººç±»çš„å¯¹è¯ï¼Œä½¿å®ƒä»¬åœ¨èŠå¤©æœºå™¨äººå’Œå®¢æˆ·æœåŠ¡åº”ç”¨ç¨‹åºä¸­éå¸¸æœ‰ç”¨ã€‚æˆ‘ä»¬å¯ä»¥æŒ‡ç¤ºLLMæŒ‰ç…§ç‰¹å®šæ–¹å¼è·Ÿéšå¯¹è¯è¡ŒåŠ¨ã€‚ æ¨¡æ¿ 12345ä»¥ä¸‹æ˜¯ä¸&lt;Actor&gt;çš„å¯¹è¯ã€‚ &lt;Actor&gt;åº”è¯¥å›ç­”&lt;Further instructions&gt;ã€‚ä¸ªäººï¼š&lt;Conversation&gt;&lt;Actor&gt;ï¼š&lt;Response&gt;ä¸ªäººï¼š&lt;Conversation&gt;&lt;Actor&gt;ï¼š LLMå°†å¡«å†™æˆ‘ä»¬æŒ‡ç¤ºå…¶ç±»å‹æ¼”å‘˜çš„å“åº”ï¼Œå¹¶ä¸”æˆ‘ä»¬å¯ä»¥é€šè¿‡å†æ¬¡å°†æ•´ä¸ªä¼šè¯åŠæ–°å“åº”ä¼ é€’ç»™å®ƒæ¥ç»§ç»­ä¼šè¯ã€‚ä¾‹å¦‚ï¼š æç¤º 123ä»¥ä¸‹æ˜¯ä¸å¾‹å¸ˆçš„å¯¹è¯ã€‚ å¾‹å¸ˆåº”ç®€å•æ˜äº†åœ°å›ç­”ã€‚ä¸ªäººï¼šæ‚¨å¥½ï¼Œæˆ‘æƒ³çŸ¥é“å¦‚ä½•äº‰è®®åœè½¦ç½šå•å¾‹å¸ˆï¼š è¾“å‡º 1å½“ç„¶ï¼Œæˆ‘èƒ½å¤Ÿæä¾›å¸®åŠ©ã€‚ç¬¬ä¸€æ­¥æ˜¯æ£€æŸ¥ç½šå•æ˜¯å¦å­˜åœ¨ä»»ä½•é”™è¯¯æˆ–å¤±è¯¯ã€‚å¦‚æœå‘ç°ä»»ä½•é—®é¢˜ï¼Œåˆ™å¯ä»¥ä½¿ç”¨è¿™äº›ä½œä¸ºäº‰è®®ç½šæ¬¾çš„ç†ç”±ã€‚å¦‚æœæ²¡æœ‰é”™è¯¯ï¼Œåˆ™ä»ç„¶å¯ä»¥é€šè¿‡æä¾›è¯æ®æ”¯æŒæ‚¨çš„æ¡ˆä»¶ï¼ˆä¾‹å¦‚ç…§ç‰‡æˆ–è¯è¨€ï¼‰æ¥äº‰è®®ç½šæ¬¾ã€‚æ‚¨è¿˜å¯ä»¥è¯·æ±‚å¬è¯ä¼šä»¥äº²è‡ªé™ˆè¿°æ‚¨çš„æ¡ˆä»¶ã€‚ æç¤º 12345ä»¥ä¸‹æ˜¯ä¸å¾‹å¸ˆçš„å¯¹è¯ã€‚ å¾‹å¸ˆåº”ç®€å•æ˜äº†åœ°å›ç­”ã€‚ä¸ªäººï¼šæ‚¨å¥½ï¼Œæˆ‘æƒ³çŸ¥é“å¦‚ä½•äº‰è®®åœè½¦ç½šå•å¾‹å¸ˆï¼šå½“ç„¶ï¼Œæˆ‘èƒ½å¤Ÿæä¾›å¸®åŠ©ã€‚ç¬¬ä¸€æ­¥æ˜¯æ£€æŸ¥ç½šå•æ˜¯å¦å­˜åœ¨ä»»ä½•é”™è¯¯æˆ–å¤±è¯¯ã€‚å¦‚æœå‘ç°ä»»ä½•é—®é¢˜ï¼Œåˆ™å¯ä»¥ä½¿ç”¨è¿™äº›ä½œä¸ºäº‰è®®ç½šæ¬¾çš„ç†ç”±ã€‚å¦‚æœæ²¡æœ‰é”™è¯¯ï¼Œåˆ™ä»ç„¶å¯ä»¥é€šè¿‡æä¾›è¯æ®æ”¯æŒæ‚¨çš„æ¡ˆä»¶ï¼ˆä¾‹å¦‚ç…§ç‰‡æˆ–è¯è¨€ï¼‰æ¥äº‰è®®ç½šæ¬¾ã€‚æ‚¨è¿˜å¯ä»¥è¯·æ±‚å¬è¯ä¼šä»¥äº²è‡ªé™ˆè¿°æ‚¨çš„æ¡ˆä»¶ã€‚ä¸ªäººï¼šæˆ‘å¦‚ä½•è¯·æ±‚å¬è¯ä¼šï¼Ÿå¾‹å¸ˆï¼š è¾“å‡º 1è¦è¯·æ±‚å¬è¯ä¼šï¼Œæ‚¨éœ€è¦æŒ‰ç…§ç¥¨æ®èƒŒé¢æˆ–ç½‘ç«™ä¸Šçš„è¯´æ˜è¿›è¡Œæ“ä½œ ä»£ç ç”ŸæˆLLMså¯ä»¥ç”Ÿæˆä»£ç ï¼Œä½¿å¼€å‘äººå‘˜æ›´å®¹æ˜“åˆ›å»ºå¤æ‚çš„è½¯ä»¶ç¨‹åºã€‚æˆ‘ä»¬å¯ä»¥ç¼–å†™ä¸€ä¸ªä»£ç æ³¨é‡Šæ¥æè¿°æˆ‘ä»¬å¸Œæœ›ä»£ç æ‰§è¡Œçš„æ“ä½œï¼ŒLLMå°†èƒ½å¤Ÿå°½åŠ›å®Œæˆå®ƒã€‚æˆ‘ä»¬å¸Œæœ›ä»£ç æ‰§è¡Œçš„æ“ä½œè¶Šå¤æ‚ï¼Œæˆ‘ä»¬åœ¨æç¤ºæ³¨é‡Šä¸­éœ€è¦æä¾›çš„ä¿¡æ¯å°±è¶Šå…·ä½“å’Œè¯¦ç»†ã€‚ æ¨¡æ¿å¯èƒ½å› æ‰€éœ€ç”Ÿæˆçš„ç¼–ç¨‹è¯­è¨€è€Œå¼‚ï¼Œä½†æˆ‘å»ºè®®å¤§è‡´éµå¾ªä»¥ä¸‹æ¨¡æ¿ï¼š æ¨¡æ¿ 12345678&lt;æ‚¨é€‰æ‹©çš„è¯­è¨€çš„æ³¨é‡Šç¬¦å·ï¼ˆ/*æˆ–&#x27;&#x27;&#x27;æˆ–#ï¼‰&gt;æ–¹æ³•ï¼š&lt;æ–¹æ³•åç§°&gt;è¯­è¨€ï¼š&lt;ç¼–ç¨‹è¯­è¨€&gt;è¯´æ˜ï¼š&lt;æ–¹æ³•å¿…é¡»æ‰§è¡Œä»€ä¹ˆæ“ä½œ&gt;å‚æ•°ï¼š&lt;æ–¹æ³•å°†æ¥æ”¶å“ªäº›å‚æ•°&gt;ä¸Šä¸‹æ–‡ï¼š&lt;å®ç°è¯¥æ–¹æ³•æ‰€éœ€è¿›ä¸€æ­¥ä¿¡æ¯ï¼ˆURLã€æ•°æ®åº“ç­‰ï¼‰&gt;è¾“å‡ºï¼š&lt;è¯¥æ–¹æ³•è¾“å‡ºå†…å®¹&gt;&lt;æ‚¨é€‰æ‹©çš„è¯­è¨€çš„æ³¨é‡Šç¬¦å·ï¼ˆ/*æˆ–&#x27;&#x27;&#x27;æˆ–#ï¼‰&gt; ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦è·å–åˆ†é¡µAPIï¼Œåˆ™å¯ä»¥ç¼–å†™ä»¥ä¸‹è¯„è®ºï¼š æç¤º 1234567/* Method: fetchFirst5Pages * Language: Javascript * Description: Fetch the first 5 pages from this paginated API: http://example.com/pages/?n=x * Context: This API accepts the following URL parameters: * n: the number of the page to fetch * Output: the content of the first 5 pages */ è¾“å‡º 1234567891011121314151617181920212223è¿™æ˜¯JavaScriptä¸­fetchFirst5Pageså‡½æ•°å®ç°ç¤ºä¾‹ï¼Œå‡è®¾ä½¿ç”¨äº†fetchå‡½æ•°ï¼šasync function fetchFirst5Pages() &#123; const baseUrl = &#x27;http://example.com/pages/?n=&#x27;; const pages = []; for (let i = 1; i &lt;= 5; i++) &#123; const url = baseUrl + i; const response = await fetch(url); if (!response.ok) &#123; throw new Error(`Error fetching page $&#123;i&#125;`); &#125; const pageData = await response.json(); pages.push(pageData); &#125; return pages;&#125;è¯¥å‡½æ•°ä½¿ç”¨å¾ªç¯é€šè¿‡å°†é¡µç é™„åŠ åˆ°åŸºæœ¬URLæ¥è·å–APIçš„å‰5ä¸ªé¡µé¢ã€‚å®ƒæ£€æŸ¥æœåŠ¡å™¨çš„å“åº”æ˜¯å¦æ­£å¸¸ï¼Œå¦‚æœä¸æ­£å¸¸åˆ™æŠ›å‡ºé”™è¯¯ã€‚ç„¶åï¼Œå®ƒä»å“åº”ä¸­è§£æJSONæ•°æ®å¹¶å°†å…¶æ·»åŠ åˆ°é¡µé¢æ•°ç»„ä¸­ã€‚æœ€åï¼Œå®ƒè¿”å›é¡µé¢æ•°ç»„ã€‚ æ¨ç†æ³•å­¦ç¡•å£«å¯èƒ½ä¼šåœ¨ä¸€äº›åŸºæœ¬ä»»åŠ¡ä¸Šé‡åˆ°å›°éš¾ï¼Œæ¯”å¦‚ç®—æœ¯é—®é¢˜ã€‚ç„¶è€Œï¼Œå¦‚æœæˆ‘ä»¬è¦æ±‚LLMå¯¹å…¶å›ç­”è¿›è¡Œæ¨ç†ï¼Œæˆ‘ä»¬å¯ä»¥å¸®åŠ©å®ƒå¾—å‡ºæ­£ç¡®çš„ç­”æ¡ˆã€‚è¿™æ˜¯æˆ‘æ¨èçš„æ¨¡æ¿ï¼š æ¨¡æ¿ 12é—®ï¼š &lt;é—®é¢˜&gt;ç­”ï¼š è®©æˆ‘ä»¬é€æ­¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œç¡®ä¿æˆ‘ä»¬æœ‰æ­£ç¡®çš„ç­”æ¡ˆã€‚é¦–å…ˆï¼Œ&lt;è¯´æ˜&gt;ã€‚ åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå¦‚æœæ²¡æœ‰æ¨ç†å°±æå‡ºä¸€ä¸ªç®€å•çš„ç®—æœ¯é—®é¢˜ï¼Œåˆ™æ— æ³•æˆåŠŸï¼š æç¤º 123å›ç­”ä»¥ä¸‹é—®é¢˜ã€‚ å¦‚æœä¸ç¡®å®šç­”æ¡ˆï¼Œè¯·å›å¤â€œä¸ç¡®å®šâ€ã€‚é—®ï¼šä»¥ä¸‹åˆ—è¡¨ä¸­è´¨æ•°ä¹‹å’Œæ˜¯3çš„å€æ•°ï¼š[2, 4, 6, 7, 9, 14]A: [æ˜¯æˆ–å¦] è¾“å‡º ä¸æ˜¯ã€‚ åˆ—è¡¨[2ã€4ã€6ã€7ã€9ã€14]ä¸­è´¨æ•°ä¹‹å’Œä¸æ˜¯3çš„å€æ•°ã€‚ å› æ­¤ï¼Œç­”æ¡ˆä¸ºâ€œå¦â€ã€‚ ä½†æ˜¯ï¼Œå¦‚æœæŒ‡ç¤ºLLMå¯¹å…¶å›ç­”è¿›è¡Œæ¨ç†ï¼Œåˆ™ä¼šå¾—åˆ°éå¸¸ä¸åŒçš„ç»“æœï¼š æç¤º 12é—®ï¼šä»¥ä¸‹åˆ—è¡¨ä¸­è´¨æ•°ä¹‹å’Œæ˜¯å¦ä¸º3çš„å€æ•°ï¼Ÿ [2ã€4ã€6ã€7ã€9ã€14]A: è®©æˆ‘ä»¬é€æ­¥è§£å†³è¿™ä¸ªé—®é¢˜ä»¥ç¡®ä¿æˆ‘ä»¬æœ‰æ­£ç¡®çš„ç­”æ¡ˆã€‚ é¦–å…ˆæ‰¾åˆ°åˆ—è¡¨ä¸­æ‰€æœ‰è´¨æ•°å¹¶å°†å®ƒä»¬åŠ èµ·æ¥ã€‚ ç„¶åæ£€æŸ¥æ‰€å¾—æ•°å­—æ˜¯å¦å¯ä»¥è¢«3æ•´é™¤ã€‚ è¾“å‡º 12345678910111213å¥½å§ï¼Œè¯·è®©æˆ‘ä»¬é€æ­¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚åˆ—è¡¨ä¸­çš„è´¨æ•°æ˜¯2å’Œ7ã€‚ æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°†å®ƒä»¬åŠ åœ¨ä¸€èµ·ï¼š2 + 7 = 9ç»“æœä¸º9ã€‚ ç°åœ¨æˆ‘ä»¬éœ€è¦æ£€æŸ¥å®ƒæ˜¯å¦æ˜¯3çš„å€æ•°ã€‚ æˆ‘ä»¬å¯ä»¥é€šè¿‡æ£€æŸ¥9é™¤ä»¥3çš„ä½™æ•°æ˜¯å¦ç­‰äº0æ¥åšåˆ°è¿™ä¸€ç‚¹ï¼š9ï¼…3 = 0ç”±äºä½™æ•°ä¸º0ï¼Œå› æ­¤æˆ‘ä»¬çŸ¥é“9ç¡®å®æ˜¯3çš„å€æ•°ã€‚å› æ­¤ï¼Œç­”æ¡ˆæ˜¯â€œæ˜¯â€ï¼Œåˆ—è¡¨[2ã€4ã€6ã€7ã€9ã€14]ä¸­è´¨æ•°ä¹‹å’Œæ˜¯3çš„å€æ•°ã€‚ ç­–ç•¥è™½ç„¶è¿™äº›æ¨¡æ¿å¯ä»¥å¸®åŠ©æ‚¨æŒ¤å‡ºLLMsçš„æ½œåŠ›ä»¥æ»¡è¶³æ‚¨çš„éœ€æ±‚ï¼Œä½†æœ‰æ—¶å®ƒä»¬ä»ç„¶å¯èƒ½åœ¨æŸäº›å¤æ‚ä»»åŠ¡ä¸Šé‡åˆ°å›°éš¾ã€‚å·²ç»å¼€å‘äº†ä¸€äº›æŠ€æœ¯æ¥å¸®åŠ©LLMså¾—å‡ºä»¤äººæ»¡æ„çš„ç­”æ¡ˆã€‚åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬åªä½¿ç”¨äº†é›¶-shotæç¤ºï¼Œç°åœ¨æˆ‘ä»¬å°†å¯¹å…¶è¿›è¡Œå®šä¹‰ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ›´å¤æ‚çš„æŠ€æœ¯ã€‚ é›¶-shotæç¤ºåœ¨æœ¬æ–‡ä¸­çš„æ‰€æœ‰ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬éƒ½ä½¿ç”¨äº†é›¶-shotæç¤ºã€‚é›¶-shotæç¤ºæ„å‘³ç€å‘LLMä¼ é€’ä¸€ä¸ªæç¤ºï¼Œå…¶ä¸­åªåŒ…å«æˆ‘ä»¬æƒ³è¦å®ƒå›ç­”çš„é—®é¢˜ï¼Œå¹¶æ²¡æœ‰ä»»ä½•å…¶ä»–æƒ…å†µä¸‹åº”è¯¥å¦‚ä½•å“åº”çš„ç¤ºä¾‹ã€‚ä¾‹å¦‚ï¼Œåœ¨æ—©æœŸç¤ºä¾‹ä¸­ï¼š Prompt 123å°†æ–‡æœ¬åˆ†ç±»ä¸ºç§¯æã€ä¸­æ€§æˆ–æ¶ˆæï¼šText: That shot selection was awfulClassification: Output 1Negative è¿™å¯èƒ½ä¸è¶³ä»¥è®©æ¨¡å‹å‡†ç¡®åœ°å›ç­”æˆ‘ä»¬æƒ³è¦å®ƒå›ç­”çš„é—®é¢˜ã€‚è®©æˆ‘ä»¬çœ‹çœ‹è¿˜æœ‰å“ªäº›æ›¿ä»£æ–¹æ¡ˆã€‚ å°‘é‡æ ·æœ¬æç¤ºä¸é›¶-shotæç¤ºç›¸åï¼Œåœ¨å°‘é‡æ ·æœ¬æç¤ºä¸­ï¼Œåœ¨æé—®ä¹‹å‰ç»™LLMæä¾›ä¸€äº›å¦‚ä½•å“åº”çš„ç¤ºä¾‹ã€‚ä¾‹å¦‚ï¼Œå‡è®¾æˆ‘ä»¬æƒ³åƒå…ˆå‰ç¤ºä¾‹é‚£æ ·å¯¹æ–‡æœ¬è¿›è¡Œæƒ…æ„Ÿåˆ†ç±»ã€‚ä½†æ˜¯æ¯æ¬¡éƒ½å¸Œæœ›ä»¥éå¸¸ç‰¹å®šæ ¼å¼è·å¾—ç­”æ¡ˆã€‚æˆ‘ä»¬å¯ä»¥äº‹å…ˆç»™å®ƒä¸€äº›ç¤ºä¾‹ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š Prompt 123456789å°†æ–‡æœ¬åˆ†ç±»ä¸ºç§¯æã€ä¸­æ€§æˆ–æ¶ˆæï¼šText: Today the weather is fantasticClassification: PosText: The furniture is small.Classification: NeuText: I don&#x27;t like your attitudeClassification: NegText: That shot selection was awfulClassification: Output 1Neg æ€ç»´é“¾æç¤ºå¯¹äºæ›´å¤æ‚çš„ä»»åŠ¡ï¼Œæˆ‘ä»¬å¯ä»¥å°†å°‘é‡ç¤ºä¾‹æç¤ºä¸ä½¿æ¨¡å‹æ¨ç†å…¶ç­”æ¡ˆç›¸ç»“åˆã€‚ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¹‹å‰çš„ç›¸åŒç¤ºä¾‹æ¥æŸ¥çœ‹æ¨ç†å’Œå°‘é‡æç¤ºå¦‚ä½•å½±å“ç»“æœï¼š 123456789Q: The sum of prime numbers in the following list are a multiple of 3: [2, 4, 6, 7, 9, 14]A: The prime numbers in the list are 2 and 7. Their sum is 9. 9 % 3 = 0. The answer is yes.Q: The sum of prime numbers in the following list are a multiple of 3: [1, 2, 4, 7, 8, 10]A: The prime numbers in the list are 1, 2 and 7. Their sum is 10. 10 % 3 = 1. The answer is no.Q: The sum of prime numbers in the following list are a multiple of 3: [1, 2, 3, 4]A: The prime numbers in the list are 1, 2 and 3. Their sum is 6. 6 % 3 = 0. The answer is yes.Q: The sum of prime numbers in the following list are a multiple of 3: [5, 6, 7, 8]A:The prime numbers in the list are 5 and 7. Their sum is 12. 12 % 3 = 0. The answer is yes. æœ€åçš„æ³¨é‡ŠLLMå·²ç»å½»åº•æ”¹å˜äº†è‡ªç„¶è¯­è¨€å¤„ç†é¢†åŸŸï¼Œä½†ä¸ºäº†æœ€å¤§åŒ–å…¶æ½œåŠ›ï¼Œæç¤ºå·¥ç¨‹è‡³å…³é‡è¦ã€‚é€šè¿‡ç†è§£LLMå¯ä»¥æ‰§è¡Œçš„ä»»åŠ¡ã€å®ƒä»¬çš„ç¼ºç‚¹ä»¥åŠå„ç§æç¤ºå·¥ç¨‹ç­–ç•¥ï¼Œå¼€å‘äººå‘˜å¯ä»¥åˆ©ç”¨LLMçš„èƒ½åŠ›æ¥åˆ›å»ºåˆ›æ–°å’Œæœ‰æ•ˆçš„è§£å†³æ–¹æ¡ˆã€‚æœªæ¥å¯èƒ½ä¼šå¼€å‘æ›´å¤šçš„ç­–ç•¥å’ŒæŠ€æœ¯ï¼Œå› æ­¤è¯·ç»§ç»­å…³æ³¨è¿™ä¸ªé¢†åŸŸçš„è¿›å±•ï¼Œä»¥è¿›ä¸€æ­¥æœ€å¤§åŒ–LLMæ½œåŠ›ã€‚æ­¤å¤–ï¼Œéšç€LLMså‚æ•°æ•°é‡ä¸æ–­å¢åŠ åˆ°æ•°åäº¿çº§åˆ«ï¼Œæˆ‘ä»¬ç°åœ¨ç”šè‡³æ— æ³•æƒ³è±¡æ›´å¤šä»»åŠ¡å°†æœ‰å¯èƒ½è¢«å®ç°ã€‚æƒ³åˆ°ä½¿ç”¨è¿™äº›æ–°å·¥å…·æ‰€èƒ½å®ç°ä»€ä¹ˆæ ·å­ä»¥åŠå®ƒä»¬å°†ä¸ºæˆ‘ä»¬æœåŠ¡äºå“ªäº›ç”¨ä¾‹æ˜¯éå¸¸ä»¤äººå…´å¥‹çš„äº‹æƒ…ã€‚","tags":[{"name":"LLM","slug":"LLM","permalink":"https://alexhuihui.github.io/tags/LLM/"}]},{"title":"ã€é¡¹ç›®ã€‘å‡çº§ç°æœ‰çš„æˆæƒç³»ç»Ÿ","date":"2023-04-11T11:45:55.000Z","path":"article/20230411.html","text":"ç°æœ‰çš„æˆæƒç³»ç»Ÿå·²æ— æ³•æ»¡è¶³å¯¹ä¸šåŠ¡çš„æ”¯æŒï¼Œæ‰€ä»¥æœ‰å¿…è¦é’ˆå¯¹æˆæƒç³»ç»Ÿè¿›è¡Œä¸€æ¬¡å‡çº§ã€‚åœ¨å‡çº§ä¹‹å‰å…ˆè¯¦ç»†æ‹†è§£ä¸€ä¸‹ä¹‹å‰çš„æˆæƒç³»ç»Ÿã€‚ æ—§çš„æˆæƒç³»ç»Ÿè¯¦æƒ…è®¤è¯ç³»ç»Ÿè´Ÿè´£é¢å‘ä»¤ç‰Œï¼Œç³»ç»Ÿä¸€å…±æ‹¥æœ‰3ç§ç±»å‹çš„ç”¨æˆ·ï¼Œåˆ†åˆ«æ˜¯æ™®é€šç”¨æˆ·ã€ç³»ç»Ÿç”¨æˆ·å’Œå¾®æœåŠ¡ã€‚å…¶ä¸­æ™®é€šç”¨æˆ·å’Œç³»ç»Ÿç”¨æˆ·éƒ½æ˜¯å…±ç”¨çš„åŒä¸€ç§ç±»å‹çš„tokenï¼Œå«åšUserTokenï¼Œå¾®æœåŠ¡ä½¿ç”¨çš„æ˜¯ClientTokenã€‚è¿™ä¸¤ç§ä¸åŒç±»å‹çš„tokenåœ¨ä¼ è¾“è¿‡ç¨‹ä¸­ä½¿ç”¨ä¸åŒçš„è¯·æ±‚å¤´è¿›è¡Œå­˜å‚¨ï¼Œå½“å¾®æœåŠ¡ä¹‹é—´äº’ç›¸è°ƒç”¨çš„æ—¶å€™ï¼Œä¼šæœ‰ä¸€ä¸ªfeignæ‹¦æˆªå™¨è´Ÿè´£æŠŠå½“å‰çº¿ç¨‹ä¸­çš„ç”¨æˆ·tokenå’Œæœ¬èº«çš„å¾®æœåŠ¡tokenï¼Œå­˜å…¥åˆ°å¯¹åº”çš„è¯·æ±‚å¤´ä¸­ã€‚å‘é€mqæ—¶ï¼Œä¹Ÿæ˜¯é‡‡ç”¨äº†ç±»ä¼¼çš„æœºåˆ¶è¿›è¡Œä¼ é€’tokenã€‚å°¤å…¶è¦æ³¨æ„çš„æ˜¯åœ¨åªæœ‰å¾®æœåŠ¡tokenæ—¶å¹¶ä¸”CheckUserTokenæ³¨è§£ä¸ä¸ºç©ºæ—¶ï¼Œæ‹¦æˆªå™¨ä¼šæŠŠå¾®æœåŠ¡çš„ä¿¡æ¯è½¬æ¢æˆç”¨æˆ·ä¿¡æ¯å­˜å‚¨åˆ°å®‰å…¨ä¸Šä¸‹æ–‡ä¸­ï¼Œä½†ä¸ä¼šè®¾ç½®ç”¨æˆ·tokenã€‚ æµç¨‹å›¾ æ—§ç³»ç»Ÿçš„ç—›ç‚¹ æ— æ³•åšåˆ°é’ˆå¯¹æ¯ä¸ªæ¥å£è¿›è¡Œè®¿é—®æ§åˆ¶ æ²¡æœ‰tokenç»­æœŸåŠŸèƒ½ï¼Œç”¨æˆ·ä½“éªŒä¸å¥½ æ²¡æœ‰èƒ½åŠ›æä¾›ç»™å¤–éƒ¨ç³»ç»Ÿä¸æˆ‘ä»¬è¿›è¡Œå¯¹æ¥ æ–°çš„æˆæƒç³»ç»Ÿå¯¹æ¯ä¸ªæ¥å£è¿›è¡Œè®¿é—®æ§åˆ¶æˆæƒè¿‡ç¨‹åœ¨å®é™…çš„æˆæƒè¿‡ç¨‹ä¸­ï¼Œå¯ä»¥åœ¨è¯·æ±‚åˆ°è¾¾æ¥å£ä¹‹å‰ï¼Œä½¿ç”¨æ‹¦æˆªå™¨æ¥è¿›è¡Œèº«ä»½éªŒè¯å’Œæˆæƒå¤„ç†ã€‚åœ¨æ‹¦æˆªå™¨ä¸­ï¼Œé¦–å…ˆä»è¯·æ±‚å¤´ä¸­è·å–Tokenï¼Œå¦‚æœTokenä¸å­˜åœ¨ï¼Œåˆ™è¿”å›â€œæœªæˆæƒâ€çš„é”™è¯¯ä¿¡æ¯ã€‚ å¦‚æœTokenå­˜åœ¨ï¼Œåˆ™ä½¿ç”¨JWTå¯¹Tokenè¿›è¡Œè§£å¯†å’ŒéªŒè¯ï¼Œå¦‚æœè§£å¯†å’ŒéªŒè¯æˆåŠŸï¼Œåˆ™ä»Tokenä¸­è·å–ç”¨æˆ·ä¿¡æ¯å’Œè®¿é—®æƒé™ä¿¡æ¯ï¼Œå¹¶å°†å®ƒä»¬å­˜å‚¨åœ¨ThreadLocalä¸­ï¼Œä»¥ä¾¿åœ¨æ•´ä¸ªè¯·æ±‚å¤„ç†è¿‡ç¨‹ä¸­å¯ä»¥æ–¹ä¾¿åœ°è®¿é—®å®ƒä»¬ã€‚ æœ€åï¼Œåœ¨è¯·æ±‚å¤„ç†å®Œæˆåï¼Œæ¸…é™¤ThreadLocalä¸­å­˜å‚¨çš„ä¿¡æ¯ï¼Œä»¥é¿å…å¯¹ä¸‹ä¸€ä¸ªè¯·æ±‚äº§ç”Ÿå¹²æ‰°ã€‚ æµç¨‹å›¾ Tokenç»­æœŸTokenåˆ·æ–°æœºåˆ¶JWT Tokenè‡ªåŠ¨åˆ·æ–°æœºåˆ¶éœ€è¦åœ¨å‰ç«¯å’Œåç«¯åŒæ—¶å®ç°ã€‚ åœ¨æ¯æ¬¡è¯·æ±‚çš„è¿”å›ä¸­éƒ½æ£€æŸ¥ token æ˜¯å¦å¿«è¿‡æœŸï¼Œå¦‚æœä¸´è¿‘è¿‡æœŸå°±åˆ·æ–° tokenï¼Œå¹¶ä¸”åœ¨ response çš„ header ä¸­è¿”å›ç»™å‰ç«¯ã€‚å‰ç«¯å¯ä»¥é€šè¿‡è¯»å–å“åº” header ä¸­çš„ token æ¥æ›´æ–°æœ¬åœ°çš„ tokenã€‚ å…·ä½“å®ç°å¯ä»¥åœ¨åç«¯çš„æ‹¦æˆªå™¨ä¸­æ·»åŠ ä¸€ä¸ªé€»è¾‘ï¼Œåœ¨æ¯æ¬¡è¯·æ±‚è¿”å›æ—¶æ£€æŸ¥ token æ˜¯å¦å¿«è¿‡æœŸï¼Œå¦‚æœæ˜¯ï¼Œåˆ™è¿›è¡Œ token çš„åˆ·æ–°ã€‚åŒæ—¶ï¼Œå°†æ–°çš„ token æ”¾å…¥ response çš„ header ä¸­è¿”å›ç»™å‰ç«¯ã€‚ 123456789101112131415161718192021// ä¼ªä»£ç public class TokenRefreshInterceptor implements HandlerInterceptor &#123; private TokenProvider tokenProvider; public TokenRefreshInterceptor(TokenProvider tokenProvider) &#123; this.tokenProvider = tokenProvider; &#125; @Override public void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex) throws Exception &#123; // æ£€æŸ¥ token æ˜¯å¦éœ€è¦åˆ·æ–° String token = tokenProvider.resolveToken(request); if (token != null &amp;&amp; tokenProvider.isTokenNeedRefresh(token)) &#123; // åˆ·æ–° token String newToken = tokenProvider.refreshToken(token); // å°†æ–°çš„ token æ”¾å…¥å“åº” header ä¸­ response.setHeader(&quot;Authorization&quot;, &quot;Bearer &quot; + newToken); &#125; &#125;&#125; æµç¨‹å›¾c","tags":[{"name":"æˆæƒ","slug":"æˆæƒ","permalink":"https://alexhuihui.github.io/tags/%E6%8E%88%E6%9D%83/"}]},{"title":"ã€Redisã€‘æ•°æ®ç»“æ„å’Œå¯¹è±¡","date":"2023-03-29T11:21:05.000Z","path":"article/20230329.html","text":"å¼€ç¯‡æœ¬æ–‡ä»‹ç»redisä¸­çš„æ•°æ®ç»“æ„å’Œå¯¹è±¡ ç®€å•åŠ¨æ€å­—ç¬¦ä¸²Redisæ²¡æœ‰ä½¿ç”¨Cè¯­è¨€ä¼ ç»Ÿçš„å­—ç¬¦ä¸²è¡¨ç¤ºï¼Œè€Œæ˜¯è‡ªå·±æ„å»ºäº†ä¸€ç§åä¸ºç®€å•åŠ¨æ€å­—ç¬¦ä¸²çš„æŠ½è±¡ç±»å‹ï¼Œç”¨åœ¨å¯ä»¥è¢«ä¿®æ”¹çš„å­—ç¬¦ä¸²å€¼ï¼Œæ¯”å¦‚åŒ…å«å­—ç¬¦ä¸²å€¼çš„é”®å€¼å¯¹ã€‚ SDSçš„å®šä¹‰æ¯ä¸ª sds.h/sdshdrç»“æ„è¡¨ç¤ºä¸€ä¸ª SDSå€¼: 12345678struct sdshdr &#123; // è®°å½•å·²ä½¿ç”¨å­—èŠ‚çš„æ•°é‡ int len; // è®°å½•bufæ•°ç»„ä¸­æœªä½¿ç”¨å­—èŠ‚çš„æ•°é‡ int free; // å­—èŠ‚æ•°ç»„ï¼Œç”¨äºä¿å­˜å­—ç¬¦ä¸² chat buf[];&#125; SDS ä¸ C å­—ç¬¦ä¸²çš„åŒºåˆ«æ ¹æ®ä¼ ç»Ÿï¼ŒCè¯­è¨€ä½¿ç”¨é•¿åº¦ä¸ºN+1çš„å­—ç¬¦æ•°ç»„æ¥è¡¨ç¤ºé•¿åº¦ä¸ºNçš„å­—ç¬¦ä¸²ï¼Œå¹¶ä¸”å­—ç¬¦æ•°ç»„çš„æœ€åä¸€ä¸ªå…ƒç´ æ€»æ˜¯ç©ºå­—ç¬¦Â·\\0â€™ã€‚Cè¯­è¨€ä½¿ç”¨çš„è¿™ç§ç®€å•çš„å­—ç¬¦ä¸²è¡¨ç¤ºæ–¹å¼ï¼Œå¹¶ä¸èƒ½æ»¡è¶³Rdiså¯¹å­—ç¬¦ä¸²åœ¨å®‰å…¨æ€§ã€æ•ˆç‡ä»¥åŠåŠŸèƒ½æ–¹é¢çš„è¦æ±‚ã€‚ å¸¸æ•°å¤æ‚åº¦è·å–å­—ç¬¦ä¸²é•¿åº¦ æœç»ç¼“å†²åŒºæº¢å‡º å‡å°‘ä¿®æ”¹å­—ç¬¦ä¸²æ—¶å¸¦æ¥çš„å†…å­˜é‡åˆ†é…æ¬¡æ•° äºŒè¿›åˆ¶å®‰å…¨ å…¼å®¹éƒ¨åˆ†Cå­—ç¬¦ä¸²å‡½æ•° é“¾è¡¨é“¾è¡¨æä¾›äº†é«˜æ•ˆçš„èŠ‚ç‚¹é‡æ’èƒ½åŠ›ï¼Œä»¥åŠé¡ºåºæ€§çš„èŠ‚ç‚¹è®¿é—®æ–¹å¼ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡å¢åˆ èŠ‚ç‚¹æ¥çµæ´»åœ°è°ƒæ•´é“¾è¡¨çš„é•¿åº¦ã€‚ä½œä¸ºä¸€ç§å¸¸ç”¨æ•°æ®ç»“æ„ï¼Œé“¾è¡¨å†…ç½®åœ¨å¾ˆå¤šé«˜çº§çš„ç¼–ç¨‹è¯­è¨€é‡Œé¢ï¼Œå› ä¸ºRdisä½¿ç”¨çš„Cè¯­è¨€å¹¶æ²¡æœ‰å†…ç½®è¿™ç§æ•°æ®ç»“æ„ï¼Œæ‰€ä»¥Redisæ„å»ºäº†è‡ªå·±çš„é“¾è¡¨å®ç°ã€‚ ä½¿ç”¨åœºæ™¯ï¼š åˆ—è¡¨é”® å‘å¸ƒè®¢é˜… æ…¢æŸ¥è¯¢ ç›‘è§†å™¨ æœåŠ¡ç«¯ä¿å­˜å„ä¸ªå®¢æˆ·ç«¯çš„çŠ¶æ€ä¿¡æ¯ ä½¿ç”¨é“¾è¡¨æ¥æ„å»ºå®¢æˆ·ç«¯è¾“å‡ºç¼“å†²åŒº é“¾è¡¨å’Œé“¾è¡¨èŠ‚ç‚¹çš„å®ç°æ¯ä¸ªé“¾è¡¨èŠ‚ç‚¹ä½¿ç”¨ä¸€ä¸ª adlist.h/listNodeç»“æ„æ¥è¡¨ç¤º 12345678typedef struct listNode &#123; // å‰ç½®èŠ‚ç‚¹ struct listNode *prev; // åç½®èŠ‚ç‚¹ struct listNode *next; // èŠ‚ç‚¹çš„å€¼ void *value;&#125; è™½ç„¶ä»…ä»…ä½¿ç”¨å¤šä¸ªlistNodeç»“æ„å°±å¯ä»¥ç»„æˆé“¾è¡¨ï¼Œä½†ä½¿ç”¨adlist.h/listæ¥æŒæœ‰é“¾è¡¨çš„è¯ï¼Œæ“ä½œèµ·æ¥ä¼šæ›´æ–¹ä¾¿ï¼š 12345678910111213141516171819typedef struct list &#123; // è¡¨å¤´èŠ‚ç‚¹ listNode *head; // è¡¨å°¾ç»“ç‚¹ listNode *tail; // é“¾è¡¨æ‰€åŒ…å«çš„èŠ‚ç‚¹æ•°é‡ unsigned long len; // èŠ‚ç‚¹å€¼å¤åˆ¶å‡½æ•° void *(*dup) (void *ptr); // èŠ‚ç‚¹å€¼é‡Šæ”¾å‡½æ•° void *(*free) (void *ptr); // èŠ‚ç‚¹å€¼å¯¹æ¯”å‡½æ•° int (*match) (void *ptr, void *key);&#125; Redisçš„é“¾è¡¨å®ç°çš„ç‰¹æ€§å¯ä»¥æ€»ç»“å¦‚ä¸‹ï¼š åŒç«¯ï¼šé“¾è¡¨èŠ‚ç‚¹å¸¦æœ‰prevå’ŒnextæŒ‡é’ˆï¼Œè·å–æŸä¸ªèŠ‚ç‚¹çš„å‰ç½®èŠ‚ç‚¹å’Œåç½®èŠ‚ç‚¹çš„å¤æ‚åº¦éƒ½æ˜¯O(1) æ— ç¯ï¼šè¡¨å¤´èŠ‚ç‚¹çš„prevæŒ‡é’ˆå’Œè¡¨å°¾èŠ‚ç‚¹çš„nextæŒ‡é’ˆéƒ½æŒ‡å‘NULL,å¯¹é“¾è¡¨çš„è®¿é—®ä»¥NULLä¸ºç»ˆç‚¹ã€‚ å¸¦è¡¨å¤´æŒ‡é’ˆå’Œè¡¨å°¾æŒ‡é’ˆï¼šé€šè¿‡listç»“æ„çš„headæŒ‡é’ˆå’ŒtailæŒ‡é’ˆï¼Œç¨‹åºè·å–é“¾è¡¨çš„è¡¨å¤´èŠ‚ç‚¹å’Œè¡¨å°¾èŠ‚ç‚¹çš„å¤æ‚åº¦ä¸ºO(1)ã€‚ å¸¦é“¾è¡¨é•¿åº¦è®¡æ•°å™¨ï¼šç¨‹åºä½¿ç”¨1istç»“æ„çš„1enå±æ€§æ¥å¯¹1istæŒæœ‰çš„é“¾è¡¨èŠ‚ç‚¹è¿›è¡Œè®¡æ•°ï¼Œç¨‹åºè·å–é“¾è¡¨ä¸­èŠ‚ç‚¹æ•°é‡çš„å¤æ‚åº¦ä¸ºO(1)ã€‚ å¤šæ€ï¼šé“¾è¡¨èŠ‚ç‚¹ä½¿ç”¨void*æŒ‡é’ˆæ¥ä¿å­˜èŠ‚ç‚¹å€¼ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡istç»“æ„çš„dupã€freeã€matchä¸‰ä¸ªå±æ€§ä¸ºèŠ‚ç‚¹å€¼è®¾ç½®ç±»å‹ç‰¹å®šå‡½æ•°ï¼Œæ‰€ä»¥é“¾è¡¨å¯ä»¥ç”¨äºä¿å­˜å„ç§ä¸åŒç±»å‹çš„å€¼ã€‚ å­—å…¸å­—å…¸ï¼Œåˆç§°ä¸ºç¬¦å·è¡¨ï¼ˆsymbol tableï¼‰å…³è”æ•°ç»„(associative array)æˆ–æ˜ å°„ï¼ˆmap),æ˜¯ä¸€ç§ç”¨äºä¿å­˜é”®å€¼å¯¹(key-value pair)çš„æŠ½è±¡æ•°æ®ç»“æ„ã€‚","tags":[{"name":"Redis","slug":"Redis","permalink":"https://alexhuihui.github.io/tags/Redis/"}]},{"title":"ã€ElasticSearchã€‘Elasticsearchç®€ä»‹åŠå…¶å‘å±•å†å²","date":"2023-02-28T11:54:06.000Z","path":"article/20230228.html","text":"Elasticsearch æ˜¯ä¸€ç§å¼€æºçš„æœç´¢å¼•æ“ï¼Œå®ƒé‡‡ç”¨ Lucene åº“ä½œä¸ºåº•å±‚æœç´¢å¼•æ“ï¼Œå¹¶ä¸”é€šè¿‡ RESTful API æä¾›åˆ†å¸ƒå¼æœç´¢å’Œåˆ†æåŠŸèƒ½ã€‚ Elasticsearch èƒ½å¤Ÿå¿«é€Ÿåœ°å¤„ç†å¤§é‡çš„ç»“æ„åŒ–å’Œéç»“æ„åŒ–æ•°æ®ï¼Œå¹¶æä¾›äº†å…¨æ–‡æœç´¢ã€èšåˆåˆ†æã€åœ°ç†ç©ºé—´æœç´¢ç­‰å¤šç§åŠŸèƒ½ã€‚ Elasticsearch çš„å‘å±•å†å²å¯ä»¥è¿½æº¯åˆ° 2010 å¹´ï¼Œå½“æ—¶ Shay Banonï¼ˆç°åœ¨æ˜¯ Elasticsearch å…¬å¸çš„ CEOï¼‰å¼€å§‹å¼€å‘ä¸€ç§åä¸º Compass çš„æœç´¢å¼•æ“ã€‚éšç€æ—¶é—´çš„æ¨ç§»ï¼ŒCompass é€æ¸å‘å±•æˆä¸º Elasticsearchã€‚Elasticsearch åœ¨å¼€æºç¤¾åŒºå¾—åˆ°äº†å¹¿æ³›çš„å…³æ³¨å’Œä½¿ç”¨ï¼Œå¹¶ä¸”é€æ¸æˆä¸ºä¸€ç§éå¸¸æµè¡Œçš„æœç´¢å¼•æ“ã€‚ Elasticsearch çš„ä¸€ä¸ªå…¸å‹åº”ç”¨åœºæ™¯æ˜¯æ—¥å¿—åˆ†æã€‚ä¾‹å¦‚ï¼Œå½“ä¸€ä¸ªå…¬å¸çš„ç½‘ç»œè®¾å¤‡ã€æœåŠ¡å™¨å’Œåº”ç”¨ç¨‹åºå‘ç”Ÿæ•…éšœæ—¶ï¼Œæ—¥å¿—æ•°æ®é€šå¸¸ä¼šè¢«è®°å½•ä¸‹æ¥ã€‚ä½¿ç”¨ Elasticsearch å¯ä»¥å¸®åŠ©å·¥ç¨‹å¸ˆå¿«é€Ÿåœ°æŸ¥æ‰¾æ•…éšœåŸå› ï¼Œä¾‹å¦‚ç¡®å®šå“ªäº›è®¾å¤‡ã€æœåŠ¡å™¨æˆ–åº”ç”¨ç¨‹åºå‡ºç°äº†é—®é¢˜ã€‚Elasticsearch è¿˜å¯ä»¥ä¸ Kibana ç­‰å·¥å…·é›†æˆï¼Œä½¿ç”¨æˆ·å¯ä»¥å¯è§†åŒ–åœ°åˆ†ææ•°æ®ã€‚ ä»¥ä¸‹æ˜¯ Elasticsearch çš„ä¸€äº›ä¸»è¦ç‰¹ç‚¹ï¼š åˆ†å¸ƒå¼ï¼š Elasticsearch æ˜¯ä¸€ç§åˆ†å¸ƒå¼æœç´¢å¼•æ“ï¼Œå¯ä»¥è·¨å¤šå°æœåŠ¡å™¨åˆ†å¸ƒå¼åœ°å­˜å‚¨å’Œå¤„ç†æ•°æ®ã€‚è¿™ä½¿å¾— Elasticsearch å…·æœ‰é«˜å¯ç”¨æ€§ã€å®¹é”™æ€§å’Œå¯æ‰©å±•æ€§ã€‚ å®æ—¶æœç´¢å’Œåˆ†æï¼š Elasticsearch å¯ä»¥å®æ—¶åœ°æœç´¢å’Œåˆ†ææ•°æ®ï¼Œä½¿ç”¨æˆ·å¯ä»¥åŠæ—¶åœ°è·å¾—æœ€æ–°çš„ç»“æœã€‚ å…¨æ–‡æœç´¢ï¼š Elasticsearch å¯ä»¥å¯¹å…¨æ–‡è¿›è¡Œæœç´¢ï¼Œæ”¯æŒå¤šç§è¯­è¨€å’Œå¤æ‚æŸ¥è¯¢ã€‚ èšåˆåˆ†æï¼š Elasticsearch å¯ä»¥å¯¹æ•°æ®è¿›è¡Œèšåˆåˆ†æï¼Œä¾‹å¦‚è®¡ç®—å¹³å‡å€¼ã€æœ€å¤§å€¼ã€æœ€å°å€¼ç­‰ç­‰ã€‚ åœ°ç†ç©ºé—´æœç´¢ï¼š Elasticsearch æ”¯æŒåœ°ç†ç©ºé—´æœç´¢ï¼Œä½¿ç”¨æˆ·å¯ä»¥åœ¨åœ°å›¾ä¸Šæœç´¢ä½ç½®ç›¸å…³çš„ä¿¡æ¯ã€‚ æ€»ä¹‹ï¼ŒElasticsearch æ˜¯ä¸€ç§åŠŸèƒ½å¼ºå¤§ã€å¯é çš„æœç´¢å¼•æ“ï¼Œå®ƒåœ¨æœç´¢ã€åˆ†æå’Œå¯è§†åŒ–æ•°æ®æ–¹é¢éƒ½æœ‰å¹¿æ³›çš„åº”ç”¨ã€‚","tags":[{"name":"ElasticSearch","slug":"ElasticSearch","permalink":"https://alexhuihui.github.io/tags/ElasticSearch/"}]},{"title":"ã€Javaã€‘JVMå­¦ä¹ ","date":"2023-02-24T11:54:06.000Z","path":"article/20230224.html","text":"JVM çš„åƒåœ¾å›æ”¶ï¼Œå…¶å®å°±æ˜¯æ”¶æ‹¾é‚£äº›ä¸å†ä½¿ç”¨çš„ Java å¯¹è±¡ï¼ŒæŠŠä»–ä»¬æ›¾ç»å ç”¨çš„å†…å­˜é‡æ–°é‡Šæ”¾å‡ºæ¥ã€‚æ‰€ä»¥æˆ‘ä»¬è¦ææ¸…æ¥šï¼š å¯¹è±¡æ˜¯å¦‚ä½•åˆ›å»ºçš„ï¼Ÿå¯¹è±¡æ˜¯å¦‚ä½•è¢«è®¿é—®çš„ï¼Ÿåˆ°åº•å“ªäº›å¯¹è±¡æ˜¯åºŸå¼ƒçš„ï¼Ÿäºæ˜¯æˆ‘ä»¬å°±éœ€è¦ææ¸…æ¥šå¯¹è±¡çš„ç”Ÿå’Œæ­»ã€‚ è¿™äº›åºŸå¼ƒäº†çš„å¯¹è±¡åˆ°åº•æ”¾åœ¨å“ªï¼Ÿäºæ˜¯å°±éœ€è¦äº†è§£JVM çš„å†…å­˜ç»“æ„ï¼šæ–¹æ³•åŒºã€å †ã€ç¨‹åºè®¡æ•°å™¨ã€è™šæ‹Ÿæœºæ ˆå’Œæœ¬åœ°æ–¹æ³•æ ˆã€‚ è¿™äº›åºŸå¼ƒäº†çš„å¯¹è±¡ä¼šä¸ä¼šé€ æˆå†…å­˜æ³„éœ²ï¼ˆOOMï¼ŒOutOfMemoryErrorï¼‰ï¼Ÿäºæ˜¯æˆ‘ä»¬å°±éœ€è¦äº†è§£æ¯ä¸ªåˆ†åŒºçš„ OOMã€‚ è¿™äº›åºŸå¼ƒäº†å¯¹è±¡ä»€ä¹ˆæ—¶å€™è¢«å›æ”¶ï¼Ÿäºæ˜¯æˆ‘ä»¬å°±éœ€è¦äº†è§£åƒåœ¾å›æ”¶ç®—æ³•ï¼Œæ¯”å¦‚è¯´æ¸…é™¤ç®—æ³•ã€å¤åˆ¶ç®—æ³•ã€æ ‡è®°æ•´ç†ç®—æ³•å’Œåˆ†ä»£æ”¶é›†ç®—æ³•ã€‚ çŸ¥é“äº†ä¸€ä¸ªå¯¹è±¡åœ¨å†…å­˜ä¸­çš„ç”Ÿå’Œæ­»ï¼Œæˆ‘ä»¬è¿˜éœ€è¦çŸ¥é“ç±»æ˜¯å¦‚ä½•åœ¨å†…å­˜ä¸­å˜æˆå¯¹è±¡çš„ï¼Ÿå¯¹è±¡çš„æ–¹æ³•æ˜¯å¦‚ä½•æ‰§è¡Œçš„ï¼Ÿ äºæ˜¯æˆ‘ä»¬å¼€å§‹å­¦ä¹  Java è™šæ‹Ÿæœºçš„æ‰§è¡Œè¿‡ç¨‹ï¼Œå­¦ä¹ å­—èŠ‚ç æ–‡ä»¶ï¼ˆ .class æ–‡ä»¶ï¼‰ï¼Œå­¦ä¹ ç±»çš„åŠ è½½æœºåˆ¶ï¼Œå­¦ä¹ è™šæ‹Ÿæœºæ ˆçš„æ ˆå¸§ç»“æ„ï¼Œå­¦ä¹ æ–¹æ³•çš„è°ƒç”¨è¿‡ç¨‹ï¼Œå­¦ä¹ å­—èŠ‚ç æŒ‡ä»¤ç­‰ç­‰ã€‚ ä¸ºäº†ç›‘æ§è™šæ‹Ÿæœºå’Œæ•…éšœæ’æŸ¥ï¼Œæˆ‘ä»¬éœ€è¦å­¦ä¹ å¸¸ç”¨çš„ JDK å‘½ä»¤è¡Œå·¥å…·ï¼ŒæŒæ¡å¿…è¦çš„çº¿ä¸Šé—®é¢˜æ’æŸ¥æ–¹æ³•ï¼›æ­¤å¤–ï¼Œè¿˜éœ€è¦äº†è§£ JIT (Just In Time)å¹¶ä¸æ˜¯ç®€å•çš„å°†çƒ­ç‚¹ä»£ç ç¼–è¯‘æˆæœºå™¨ç å°±æ”¶å·¥çš„ï¼Œå®ƒè¿˜ä¼šå¯¹ä»£ç çš„æ‰§è¡Œè¿›è¡Œä¼˜åŒ–ï¼ˆæ–¹æ³•å†…è”å’Œé€ƒé€¸åˆ†æï¼‰ã€‚ JVM ç›¸å…³çš„çŸ¥è¯†å·²ç»æˆä¸ºé¢è¯•å¿…è€ƒçš„ç§‘ç›®äº†ï¼Œä½†è€å®è®²ï¼ŒJVM ç›¸å…³çš„çŸ¥è¯†è¿˜çœŸçš„ä¸å¤ªå¥½ç”¨åœ¨é¡¹ç›®ä¸­ï¼Œæˆ–è€…è¯´ä¸å¤ªå¥½åœ¨é¡¹ç›®ä¸­ä½“ç°å‡ºæ¥ã€‚ é‚£è¿™é‡Œç»™å¤§å®¶æ¨èä¸€ä¸ªå®æˆ˜é¡¹ç›®ï¼ŒåŸºäº Spring Boot çš„åœ¨çº¿ Java IDEï¼Œå¯ä»¥è¿œç¨‹æ‰§è¡Œ Java ä»£ç å¹¶å°†ç¨‹åºçš„è¿è¡Œç»“æœåé¦ˆå‡ºæ¥ã€‚æ¶‰åŠäº† Java ç±»æ–‡ä»¶çš„ç»“æ„ã€Java ç±»åŠ è½½å™¨å’Œ Java ç±»çš„çƒ­æ›¿æ¢ç­‰ JVM ç›¸å…³çš„æŠ€æœ¯ã€‚ https://github.com/TangBean/OnlineExecutor å¬æˆ‘è¿™ä¹ˆä¸€è¯´ï¼Œæ˜¯ä¸æ˜¯ä¸€ä¸‹å­å°±æ¸…æ™°å¤šäº†ï¼","tags":[{"name":"JVM","slug":"JVM","permalink":"https://alexhuihui.github.io/tags/JVM/"}]},{"title":"ã€ElasticSearchã€‘dockerå®‰è£…es8å’Œkibana8","date":"2022-12-10T11:54:06.000Z","path":"article/20221210.html","text":"æœ¬æ–‡ä»‹ç»å¦‚ä½•é€šè¿‡Dockerå®‰è£…elasticsearch å’Œ kibana ä¸‹è½½é•œåƒ123docker pull docker.elastic.co/elasticsearch/elasticsearch:8.5.2docker pull kibana:8.5.2 åˆ›å»ºç½‘ç»œ1docker network create elastic å¯åŠ¨es123456789docker run -it \\--name elasticsearch \\--net elastic \\--restart=always \\-p 9200:9200 \\-p 9300:9300 \\-e &quot;discovery.type=single-node&quot; \\-e &quot;ES_JAVA_OPTS=-Xms512m -Xmx512m&quot; \\docker.elastic.co/elasticsearch/elasticsearch:8.5.2 å®¹å™¨å¯åŠ¨ä¹‹åä¼šæ‰“å°å¯†ç å’Œtokenï¼Œç­‰ä¼šç”¨äºç™»å½•kibana å¯åŠ¨kibana123456docker run \\--name kibana \\--net elastic \\-p 5601:5601 \\-d \\kibana:8.5.2 è®¿é—®ç­‰kibanaå®¹å™¨å¯åŠ¨æˆåŠŸä¹‹åï¼Œç‚¹å‡»è¿›å…¥æ—¥å¿—ä¸­è¾“å‡ºçš„åœ°å€ï¼Œç„¶åæŒ‰ç…§æç¤ºä¾æ¬¡è¾“å…¥tokenå’Œå¯†ç å°±å¯ä»¥è®¿é—®å•¦ã€‚ æ•ˆæœå›¾ï¼š","tags":[{"name":"ElasticSearch","slug":"ElasticSearch","permalink":"https://alexhuihui.github.io/tags/ElasticSearch/"}]},{"title":"ã€Kafkaã€‘Linuxå®‰è£…Kafkaä»¥åŠå¯è§†åŒ–ç•Œé¢","date":"2022-11-29T11:54:06.000Z","path":"article/20221129.html","text":"Kafkaæ˜¯å½“ä¸‹éå¸¸æµè¡Œçš„æ¶ˆæ¯ä¸­é—´ä»¶ï¼Œæ®å®˜ç½‘é€éœ²ï¼Œå·²æœ‰æˆåƒä¸Šä¸‡çš„å…¬å¸åœ¨ä½¿ç”¨å®ƒã€‚æœ¬æ–‡ä»‹ç»å¦‚ä½•åœ¨Linuxä¸Šå®‰è£…kafkaä»¥åŠYahooå¼€æºçš„ä¸€æ¬¾å¯è§†åŒ–ç®¡ç†é¡µé¢ã€‚ Kafkaç®€ä»‹Kafkaæ˜¯ç”±LinkedInå…¬å¸å¼€å‘çš„ä¸€æ¬¾å¼€æºåˆ†å¸ƒå¼æ¶ˆæ¯æµå¹³å°ï¼Œç”±Scalaå’ŒJavaç¼–å†™ã€‚ä¸»è¦ä½œç”¨æ˜¯ä¸ºå¤„ç†å®æ—¶æ•°æ®æä¾›ä¸€ä¸ªç»Ÿä¸€ã€é«˜ååã€ä½å»¶è¿Ÿçš„å¹³å°ï¼Œå…¶æœ¬è´¨æ˜¯åŸºäºå‘å¸ƒè®¢é˜…æ¨¡å¼çš„æ¶ˆæ¯å¼•æ“ç³»ç»Ÿã€‚ Kafkaå…·æœ‰ä»¥ä¸‹ç‰¹æ€§ï¼š é«˜ååã€ä½å»¶è¿Ÿï¼šKafkaæ”¶å‘æ¶ˆæ¯éå¸¸å¿«ï¼Œä½¿ç”¨é›†ç¾¤å¤„ç†æ¶ˆæ¯å»¶è¿Ÿå¯ä½è‡³2msã€‚ é«˜æ‰©å±•æ€§ï¼šKafkaå¯ä»¥å¼¹æ€§åœ°æ‰©å±•å’Œæ”¶ç¼©ï¼Œå¯ä»¥æ‰©å±•åˆ°ä¸Šåƒä¸ªbrokerï¼Œæ•°åä¸‡ä¸ªpartitionï¼Œæ¯å¤©å¤„ç†æ•°ä¸‡äº¿æ¡æ¶ˆæ¯ã€‚ æ°¸ä¹…å­˜å‚¨ï¼šKafkaå¯ä»¥å°†æ•°æ®å®‰å…¨åœ°å­˜å‚¨åœ¨åˆ†å¸ƒå¼çš„ï¼ŒæŒä¹…çš„ï¼Œå®¹é”™çš„ç¾¤é›†ä¸­ã€‚ é«˜å¯ç”¨æ€§ï¼šKafkaåœ¨å¯ç”¨åŒºä¸Šå¯ä»¥æœ‰æ•ˆåœ°æ‰©å±•ç¾¤é›†ï¼ŒæŸä¸ªèŠ‚ç‚¹å®•æœºï¼Œé›†ç¾¤ç…§æ ·èƒ½å¤Ÿæ­£å¸¸å·¥ä½œã€‚ Kafkaå®‰è£… é¦–å…ˆæˆ‘ä»¬éœ€è¦ä¸‹è½½Kafkaçš„å®‰è£…åŒ…ï¼Œä¸‹è½½åœ°å€ ä¸‹è½½å®Œæˆåå°†Kafkaè§£å‹åˆ°æŒ‡å®šç›®å½• 123cd /opt/moduletar -zxvf kafka_2.13-3.3.1.tgzcd kafka_2.13-3.3.1 Kafkaå¯ä»¥ä½¿ç”¨ZooKeeperæˆ–KRaftå¯åŠ¨ï¼Œä½¿ç”¨ä»»æ„ä¸€ä¸ªå³å¯ï¼Œè¿™é‡Œä½¿ç”¨ZooKeeperã€‚ å¯åŠ¨ZookeeperæœåŠ¡ï¼ŒæœåŠ¡å°†è¿è¡Œåœ¨2181ç«¯å£ 12# åå°è¿è¡ŒæœåŠ¡ï¼Œå¹¶æŠŠæ—¥å¿—è¾“å‡ºåˆ°å½“å‰æ–‡ä»¶å¤¹ä¸‹çš„zookeeper-out.fileæ–‡ä»¶ä¸­nohup bin/zookeeper-server-start.sh config/zookeeper.properties &gt; zookeeper-out.file 2&gt;&amp;1 &amp; ç”±äºç›®å‰Kafkaæ˜¯éƒ¨ç½²åœ¨LinuxæœåŠ¡å™¨ä¸Šçš„ï¼Œå¤–ç½‘å¦‚æœæƒ³è¦è®¿é—®ï¼Œéœ€è¦ä¿®æ”¹Kafkaçš„é…ç½®æ–‡ä»¶config/server.propertiesï¼Œä¿®æ”¹ä¸‹Kafkaçš„ç›‘å¬åœ°å€ï¼Œå¦åˆ™ä¼šæ— æ³•è¿æ¥ï¼› 1234567# The address the socket server listens on. If not configured, the host name will be equal to the value of# java.net.InetAddress.getCanonicalHostName(), with PLAINTEXT listener name, and port 9092.# FORMAT:# listeners = listener_name://host_name:port# EXAMPLE:# listeners = PLAINTEXT://your.host.name:9092listeners=PLAINTEXT://:9092 æœ€åå¯åŠ¨KafkaæœåŠ¡ï¼ŒæœåŠ¡å°†è¿è¡Œåœ¨9092ç«¯å£ã€‚ 12# åå°è¿è¡ŒæœåŠ¡ï¼Œå¹¶æŠŠæ—¥å¿—è¾“å‡ºåˆ°å½“å‰æ–‡ä»¶å¤¹ä¸‹çš„kafka-out.fileæ–‡ä»¶ä¸­nohup bin/kafka-server-start.sh config/server.properties &gt; kafka-out.file 2&gt;&amp;1 &amp; Kafkaå‘½ä»¤è¡Œæ“ä½œ æ¥ä¸‹æ¥æˆ‘ä»¬ä½¿ç”¨å‘½ä»¤è¡Œæ¥æ“ä½œä¸‹Kafkaï¼Œç†Ÿæ‚‰ä¸‹Kafkaçš„ä½¿ç”¨ã€‚ é¦–å…ˆåˆ›å»ºä¸€ä¸ªå«consoleTopicçš„Topicï¼› 1bin/kafka-topics.sh --create --topic consoleTopic --bootstrap-server 10.0.20.3:9092 æ¥ä¸‹æ¥æŸ¥çœ‹Topicï¼› 1bin/kafka-topics.sh --describe --topic consoleTopic --bootstrap-server 10.0.20.3:9092 ä¼šæ˜¾ç¤ºå¦‚ä¸‹Topicä¿¡æ¯ï¼› å‘Topicä¸­å‘é€æ¶ˆæ¯ï¼š 1bin/kafka-console-producer.sh --topic consoleTopic --bootstrap-server 10.0.20.3:9092 ç›´æ¥åœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥ä¿¡æ¯å³å¯å‘é€ï¼› é‡æ–°æ‰“å¼€ä¸€ä¸ªçª—å£ï¼Œé€šè¿‡å¦‚ä¸‹å‘½ä»¤å¯ä»¥ä»Topicä¸­è·å–æ¶ˆæ¯ï¼š 1bin/kafka-console-consumer.sh --topic consoleTopic --from-beginning --bootstrap-server 10.0.20.3:9092 Kafkaå¯è§†åŒ– ä¸‹è½½cmakçš„å®‰è£…åŒ…ï¼Œä¸‹è½½åœ°å€ å¿…é¡»é€šè¿‡jdk11æ¥å¯åŠ¨ï¼Œå‚è€ƒæ–‡æ¡£ ä¿®æ”¹conf/application.conf 1234kafka-manager.zkhosts=&quot;127.0.0.1:2181&quot;kafka-manager.zkhosts=$&#123;?ZK_HOSTS&#125;cmak.zkhosts=&quot;127.0.0.1:2181&quot;cmak.zkhosts=$&#123;?ZK_HOSTS&#125; å¯åŠ¨ 1nohup bin/cmak -java-home /opt/soft/jdk-11.0.17 &gt; cmak-out.file 2&gt;&amp;1 &amp; é…ç½®nginxé€šè¿‡åŸŸåè®¿é—® 123456789101112131415161718192021222324upstream kafka&#123; server localhost:9000; &#125;server&#123; listen 80; server_name kafka.alexmmd.top; access_log /var/log/nginx/kafka-access.log main; if ( $host ~* &quot;\\d+\\.\\d+\\.\\d+\\.\\d+&quot; ) &#123; return 400; &#125; location / &#123; proxy_set_header Host $http_host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_pass http://kafka; &#125; error_page 500 502 503 504 /50x.html; location = /50x.html&#123; root html; &#125;&#125; å‚è€ƒæ–‡æ¡£kafkaçš„listenersçš„é…ç½® kafkaçš„å®‰è£…","tags":[{"name":"Kafka","slug":"Kafka","permalink":"https://alexhuihui.github.io/tags/Kafka/"}]},{"title":"ã€GitHubã€‘ä½¿ç”¨Mavenå‘å¸ƒJavaåŒ…","date":"2022-11-03T11:25:18.000Z","path":"article/20221103.html","text":"æœ¬æ–‡ä»‹ç»å¦‚ä½•é€šè¿‡GitHubçš„actionsåœ¨ä»£ç æ¨é€åˆ°ä»“åº“æ—¶ï¼Œå°†JavaåŒ…å‘å¸ƒåˆ°mavenä»“åº“çš„è¿‡ç¨‹ã€‚ ä¿®æ”¹pomæ–‡ä»¶é¦–å…ˆä½ è¦åœ¨é¡¹ç›®çš„pomæ–‡ä»¶ä¸­æ·»åŠ è¦å‘å¸ƒçš„ä»“åº“åœ°å€ï¼Œæˆ‘ä»¬å‡†å¤‡å‘åˆ°github packageä¸Š 12345678&lt;!-- å‘å¸ƒmavenç§æœ --&gt; &lt;distributionManagement&gt; &lt;repository&gt; &lt;id&gt;github&lt;/id&gt; &lt;name&gt;GitHub OWNER Apache Maven Packages&lt;/name&gt; &lt;url&gt;https://maven.pkg.github.com/Alexhuihui/alex-common&lt;/url&gt; &lt;/repository&gt; &lt;/distributionManagement&gt; åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹æ–°å»º.github/workflows/maven-publish.yml1234567891011121314151617181920212223# This workflow will build a package using Maven and then publish it to GitHub packages when a release is created# For more information see: https://github.com/actions/setup-java/blob/main/docs/advanced-usage.md#apache-maven-with-a-settings-pathname: Maven Packageon: [push]jobs: publish: runs-on: ubuntu-latest permissions: contents: read packages: write steps: - uses: actions/checkout@v2 - uses: actions/setup-java@v2 with: java-version: &#x27;8&#x27; distribution: &#x27;temurin&#x27; - name: Publish package run: mvn --batch-mode deploy env: GITHUB_TOKEN: $&#123;&#123; secrets.REPOSITORY_TOKEN &#125;&#125; ç”³è¯·è‡ªå·±çš„accessTokenè¿›å…¥è‡ªå·±githubï¼Œç„¶ååœ¨è®¾ç½®ä¸‹é¢çš„å¼€å‘è€…è®¾ç½®ä¸­ç”³è¯·ä¸€ä¸ªæ–°çš„personal access token é…ç½®åŠ å¯†æœºå¯†è¿›å…¥è‡ªå·±çš„ä»“åº“ï¼Œåœ¨è®¾ç½®ä¸‹é¢çš„æœºå¯†ä¸­çš„å·¥ä½œæµä¸­æ–°å»ºä¸€ä¸ªæœºå¯†ã€‚ å‚è€ƒå‘å¸ƒåŒ…åˆ° Maven ä¸­å¿ƒä»“åº“å’Œ GitHub Packages","tags":[{"name":"Maven","slug":"Maven","permalink":"https://alexhuihui.github.io/tags/Maven/"}]},{"title":"ã€é¡¹ç›®ã€‘ä½¿ç”¨pythonåšæ•°æ®è¿ç§»","date":"2022-10-28T11:45:55.000Z","path":"article/20221028.html","text":"å·¥ä½œä¸­ç»å¸¸ä¼šé‡åˆ°é‡æ„è€é¡¹ç›®ï¼Œæ‰€ä»¥éœ€è¦è¿ç§»ä¹‹å‰çš„æ•°æ®åº“åˆ°æ–°çš„æ•°æ®åº“ä¸­ï¼Œä¸ºæ­¤æˆ‘ä½¿ç”¨pythonæ¥åšæ•°æ®è¿ç§»è„šæœ¬ã€‚ åˆå§‹ç‰ˆæœ¬ç¬¬ä¸€ä¸ªç‰ˆæœ¬çš„æ•°æ®è¿ç§»è„šæœ¬ï¼Œä¸»è¦æ˜¯ä½¿ç”¨å•æ¡sqlçš„æ’å…¥ï¼Œæ•ˆç‡åä½ã€‚ å…ˆè·å–åŸå§‹æ•°æ®è¯»å–åˆ°å†…å­˜ä¸­ 1234567def get_original(): connect = Connect.get_original_connect() select_sql = &#x27;&#x27;&#x27;select * from table&#x27;&#x27;&#x27; cursor = connect.cursor() cursor.execute(select_sql) # è·å–æ‰€æœ‰è®°å½•åˆ—è¡¨ return cursor.fetchall() å†åœ¨mainå‡½æ•°ä¸­å¤„ç†åŸå§‹æ•°æ®ï¼Œè°ƒç”¨æ’å…¥å‡½æ•°ï¼Œæ’å…¥åˆ°æ–°æ•°æ®åº“ä¸­ 123456789def main(): original_list = get_original() a = 0 for original in original_list: print(original) insert_into_target(original) print(&#x27;æ’å…¥æ•°æ®æˆåŠŸ&#x27; + str(original[0])) a = a + 1 print(a) æ’å…¥æ•°æ® 1234567891011def insert_into_usr(mbr): connect = Connect.get_user_connect() cursor = connect.cursor() id = mbr[0] name = mbr[1] value_lo = ((id, name)) insert_sql = &#x27;&#x27;&#x27;insert into usr_user(id, name) values (%s, %s)&#x27;&#x27;&#x27; cursor.execute(insert_sql, value_lo) connect.commit() cursor.close() ç¬¬ä¸€ä¸ªç‰ˆæœ¬çš„è„šæœ¬æ˜“äºç†è§£ï¼Œä»£ç ç®€å•ï¼Œä½†æ˜¯ç”±äºæ˜¯å•æ¡æ’å…¥ï¼Œé€Ÿåº¦å¾ˆæ…¢ã€‚æ‰€ä»¥æ¥ä¸‹æ¥æˆ‘ä»¬æ”¹è¿›ä¸€ä¸‹è„šæœ¬ã€‚ æ”¹è¿›ç‰ˆæ”¹è¿›æ€è·¯å°±æ˜¯ç”±å•æ¡æ’å…¥æ”¹æˆæ‰¹é‡æ’å…¥executemany ç¬¬ä¸€æ­¥å…ˆè·å–åŸå§‹æ•°æ®è¯»å–åˆ°å†…å­˜ä¸­ 1234567def get_original(): connect = Connect.get_original_connect() select_sql = &#x27;&#x27;&#x27;select * from table&#x27;&#x27;&#x27; cursor = connect.cursor() cursor.execute(select_sql) # è·å–æ‰€æœ‰è®°å½•åˆ—è¡¨ return cursor.fetchall() å®šä¹‰å…¨å±€æ•°ç»„å˜é‡ï¼Œç„¶ååœ¨mainå‡½æ•°ä¸­è°ƒç”¨æ’å…¥å‡½æ•°æ‹¼æ¥å¥½æ•°æ®å¾€è¿™ä¸ªå…¨å±€å˜é‡ä¸­æ’å…¥ï¼Œç„¶ååˆ°ä¸€å®šæ¬¡æ•°åè°ƒç”¨æ•°æ®åº“æ‰¹é‡æ’å…¥æ•°æ® 123456789101112131415161718192021222324252627282930313233343536target_data = []def main(): original_list = get_original() a = 0 for i in range(len(original_list)): original = original_list[i] insert_into_target(original) if i == (len(original_list) - 1): do_insert_target() a = a + 1 if i != 0 and i % 1000 == 0: do_insert_target() a = a + 1 print(a) def do_insert_target(): connect = Connect.get_user_connect() cursor = connect.cursor() insert_sql = &#x27;&#x27;&#x27;insert into target(id, name) values (%s, %s)&#x27;&#x27;&#x27; cursor.executemany(insert_sql, target_data) connect.commit() cursor.close() print(&#x27;æ’å…¥æ•°æ®æˆåŠŸ&#x27; + str(len(target_data))) user_data.clear()def insert_into_target(mbr): id = mbr[0] name = mbr[1] value_lo = (id, name) target_data.append(value_lo) æ€»ç»“é‡åˆ°æ•°æ®é‡å¾ˆå¤§çš„æƒ…å†µï¼Œä½¿ç”¨æ‰¹é‡æ’å…¥èƒ½æå¤§ç¨‹åº¦æé«˜æ•°æ®è¿ç§»çš„é€Ÿåº¦ï¼Œä½†è¦åšå¥½æ•°æ®é˜²ä¸¢å¤±çš„æªæ–½ã€‚","tags":[{"name":"python","slug":"python","permalink":"https://alexhuihui.github.io/tags/python/"}]},{"title":"ã€Kubernetesã€‘ä½¿ç”¨minikube","date":"2022-05-07T14:05:44.000Z","path":"article/20220507.html","text":"Kubernetesä½¿ç”¨minikubeå®‰è£…å®˜ç½‘åœ°å€ åœ¨linuxä¸Šå®‰è£… using binary download 12curl -LO https://storage.googleapis.com/minikube/releases/latest/minikube-linux-amd64sudo install minikube-linux-amd64 /usr/local/bin/minikube Start a cluster using the docker driver 1minikube start --driver=docker å¯åŠ¨é›†ç¾¤ä¸èƒ½ç”¨rootå¯åŠ¨ï¼Œæ–°å¢ä¸€ä¸ªtestç”¨æˆ·åŠ å…¥åˆ°sudoç»„é‡Œï¼Œå†æŠŠå®ƒåŠ å…¥åˆ°dockerçš„ç”¨æˆ·ç»„ä¸­ 12su testminikube start ä¸é›†ç¾¤äº¤äº’123minikube kubectl -- get po -Aalias kubectl=&quot;minikube kubectl --&quot;minikube dashboard éƒ¨ç½²åº”ç”¨12kubectl create deployment hello-minikube --image=k8s.gcr.io/echoserver:1.4kubectl expose deployment hello-minikube --type=NodePort --port=8080 ç®€è¿°NodePortå‰è¨€æœ€è¿‘åœ¨å­¦ä¹ Kubernetesçš„è¿‡ç¨‹ä¸­ï¼Œç”±äºéƒ½æ˜¯åœ¨K8sé›†ç¾¤å†…éƒ¨è¿›è¡ŒDockeré€šä¿¡çš„ï¼Œå°±é‡åˆ°äº†å¦‚ä½•æš´éœ²æœåŠ¡ç»™å¤–ç•Œè®¿é—®çš„é—®é¢˜ï¼Œç”Ÿäº§ç¯å¢ƒæ¯”è¾ƒå¥½çš„æ–¹æ¡ˆå°±æ˜¯å€ŸåŠ©äº‘æœåŠ¡å•†ä½¿ç”¨LoadBalancerçš„æ–¹å¼ï¼Œä½†ç”±äºæ˜¯æµ‹è¯•ç¯å¢ƒå°±ä½¿ç”¨äº†æ¯”è¾ƒç®€å•çš„NodePortæ¥æš´éœ²æœåŠ¡ï¼Œåœ¨å®è·µè¿‡ç¨‹ä¸­ï¼Œä¹ŸåŠ æ·±äº†å¯¹K8sæ¦‚å¿µçš„ç†è§£ã€‚ ServiceæŠŠä¸€ç»„PodsæŠ½è±¡ä¸ºç½‘ç»œæœåŠ¡ï¼Œé€šè¿‡K8sä½ ä¸éœ€è¦é€šè¿‡ä¿®æ”¹ç¨‹åºçš„æœåŠ¡å‘ç°æœºåˆ¶æ¥ç®¡ç†é€šä¿¡ã€‚K8sç»™æ¯ä¸ªPodsç‹¬ç«‹çš„IPï¼Œä»¥åŠç»™ä¸€ç»„Podsä¸€ä¸ªDNSå¹¶é€šè¿‡è´Ÿè½½å‡è¡¡çš„æ–¹å¼è¿›è¡Œè®¿é—®ã€‚ åŠ¨æœºK8sçš„Podsæ˜¯æœ‰ç”Ÿå‘½å‘¨æœŸçš„ï¼Œé€šå¸¸æ˜¯å¯ä»¥è¢«åˆ›å»ºå’Œé”€æ¯çš„ï¼Œç„¶åé”€æ¯ä¹‹åå°±ä¸ä¼šå†å¯åŠ¨äº†ã€‚å¦‚æœé‡‡ç”¨çš„æ˜¯Deploymentï¼Œåˆ™å¯ä»¥åŠ¨æ€çš„åˆ›å»ºå’Œé”€æ¯Podã€‚ æ¯ä¸ªPodéƒ½æœ‰è‡ªå·±çš„IPï¼Œä½†æ˜¯åœ¨Deploymentä¸­åˆ›å»ºçš„Podï¼Œå…ˆåˆ›å»ºçš„å¯èƒ½ä¼šå’Œåé¢åˆ›å»ºPodçš„IPåœ°å€ä¸åŒã€‚ é‚£ä¹ˆå°±ä¼šå‡ºç°ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœä¸€ç»„Podä¸ºæœåŠ¡è°ƒç”¨æ–¹ï¼Œä¸€ç»„Podä¸ºæœåŠ¡æä¾›æ–¹ï¼ŒæœåŠ¡è°ƒç”¨è€…æ€ä¹ˆæ‰¾åˆ°æœåŠ¡æä¾›è€…çš„åœ°å€ï¼Ÿ Service èµ„æºKubernetesçš„Serviceå®šä¹‰äº†ä¸€ç§æŠ½è±¡ï¼šé€»è¾‘ä¸Šçš„ä¸€ç»„Podï¼Œä¸€ç§å¯ä»¥è®¿é—®å®ƒä»¬çš„æ–¹å¼ã€‚è¿™ä¸€ç»„Podèƒ½é€šè¿‡Serviceè¢«è®¿é—®åˆ°ï¼Œé€šè¿‡æ˜¯é€šè¿‡Selectoræ¥å®ç°çš„ã€‚ ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœåå°æœ‰ä¸‰ä¸ªèŠ‚ç‚¹æä¾›å›¾ç‰‡è®¿é—®æœåŠ¡ï¼Œè°ƒç”¨è€…å¯ä»¥é€šè¿‡Serviceè¿›è¡Œè®¿é—®ï¼Œå®ƒä¸éœ€è¦çŸ¥é“å…·ä½“è®¿é—®çš„æ˜¯å“ªä¸€ä¸ªèŠ‚ç‚¹ï¼Œå…·ä½“çš„ç­–ç•¥ç”±Serviceæ¥é…ç½®ï¼Œå¹¶å®ç°è´Ÿè½½å‡è¡¡ã€‚æŸç§æ„ä¹‰ä¸Šä¹Ÿæ˜¯æœåŠ¡å‘ç°å’Œè§£è€¦ã€‚ nodePortå¤–éƒ¨æµé‡è®¿é—®K8sçš„ä¸€ç§æ–¹å¼ï¼Œå³nodeIP:nodePortï¼Œæ˜¯æä¾›ç»™å¤–éƒ¨æµé‡è®¿é—®K8sé›†ç¾¤èµ„æºçš„ä¸€ç§æ–¹å¼ã€‚ ä¾‹å¦‚éœ€è¦æš´éœ²æœåŠ¡çš„ç«¯å£ç»™å¤–ç•Œè®¿é—®çš„è¯å¯ä»¥é€šè¿‡å‘½ä»¤ï¼š 1kubectl expose deployment nginx --type=NodePort å¯ä»¥éšæœºæš´éœ²å‡ºä¸€ä¸ªç«¯å£å¤–éƒ¨è®¿é—®çš„ç«¯å£ï¼ˆé»˜è®¤å€¼ï¼š30000-32767ï¼‰å‡ºæ¥ã€‚ç”±äºæš´éœ²çš„ç«¯å£å¾€å¾€éƒ½æ¯”è¾ƒå¤§ï¼Œè¿™æ—¶å€™å¯ä»¥é‡‡ç”¨nginxåå‘ä»£ç†çš„æ–¹å¼ï¼Œä¸ºå¤–ç•Œæä¾›è®¿é—®æœåŠ¡(HTTP:80ï¼ŒHTTPS:443)ã€‚ é™¤äº†ä½¿ç”¨å‘½ä»¤ä¹‹å¤–ä¹Ÿå¯ä»¥ä½¿ç”¨yamlé…ç½®æ–‡ä»¶çš„æ–¹å¼è¿›è¡ŒæœåŠ¡çš„é…ç½®ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š 12345678910111213apiVersion: v1kind: Servicemetadata: name: webapp-servicespec: type: NodePort selector: app: webapp ports: - protocol: TCP port: 3000 targetPort: 3000 nodePort: 30100 ç„¶åå¦‚æœæ˜¯ä¸€äº›å†…éƒ¨çš„æœåŠ¡ï¼Œæ¯”å¦‚æ•°æ®åº“æœåŠ¡ï¼Œæˆ–è€…é™¤äº†ç½‘å…³ä»¥å¤–çš„å¾®æœåŠ¡ï¼Œè¿™äº›æœåŠ¡æ˜¯ä¸éœ€è¦å¤–éƒ¨è®¿é—®çš„ã€‚å› æ­¤æ²¡æœ‰å¿…è¦è®¾ç½®nodePortå±æ€§ã€‚ portK8sé›†ç¾¤å†…éƒ¨æœåŠ¡è®¿é—®serviceçš„å…¥å£ã€‚æ˜¯serviceæš´éœ²åœ¨Clusterä¸Šçš„ç«¯å£ï¼ŒClusterIP:Portã€‚ targetPortå®¹å™¨çš„ç«¯å£ï¼Œä¹Ÿæ˜¯æœ€ç»ˆåº•å±‚çš„æœåŠ¡æ‰€æä¾›çš„ç«¯å£ï¼Œæ‰€ä»¥è¯´targetPodä¹Ÿå°±æ˜¯Podçš„ç«¯å£ã€‚ä»portæˆ–è€…æ˜¯nodePortè¿›å…¥çš„æµé‡ï¼Œç»è¿‡è·¯ç”±è½¬å‘ä¹‹åï¼Œæœ€ç»ˆéƒ½ä¼šéƒ½é€šè¿‡targetPortè¿›å…¥åˆ°Podä¸­ã€‚ æ€»ç»“æ€»ä½“æ¥è¯´ï¼Œé™¤äº†targetPortæ˜¯å®¹å™¨æœ¬èº«çš„ç«¯å£ä¹‹å¤–ï¼Œportå’ŒnodePodéƒ½æ˜¯Serviceçš„ç«¯å£ã€‚ä¸åŒçš„æ˜¯portæ˜¯æš´éœ²ç»™K8sè®¿é—®çš„ï¼ŒnodePortæ˜¯æš´éœ²ç»™å¤–éƒ¨è®¿é—®çš„ã€‚ å°† minikube çš„æœåŠ¡æš´éœ²åˆ°å®¿ä¸»æœºå¤–minikube æ˜¯ä¸€æ¬¾åŸºäº Kubernetes çš„å®šä½äºå¿«é€ŸéªŒè¯åŠŸèƒ½çš„å°å‹å®¹å™¨ç¼–æ’ç¯å¢ƒã€‚ ç”±äºå®ƒçš„å®šä½ç‰¹æ€§ï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨ä¸­ä¼šå‘ç° minikube è™šæ‹Ÿå‡ºäº†ä¸€ä¸ª IP ä½œä¸ºè‡ªèº«çš„èŠ‚ç‚¹ IPï¼Œè¯¥ IP å’Œå®¿ä¸»æœºä¸åŒã€‚å¯¹äº NodePort ç±»å‹çš„ Service ä¹Ÿæ²¡æœ‰åŠæ³•é€šè¿‡ 127.0.0.1 è®¿é—®ã€‚ Host å†…è®¿é—®å¯ä»¥é€šè¿‡ &lt;minikube-ip&gt;:&lt;service-port&gt; æ¥è®¿é—® service Host å¤–è®¿é—®é€šè¿‡ minikube å¯ä»¥å¾ˆæ–¹ä¾¿åœ°åœ¨æœ¬æœºè®¿é—®ï¼ŒåŒæ—¶é¿å…äº†å¯¹å®¿ä¸»æœºç«¯å£çš„å ç”¨ã€‚ä½†æ˜¯ä¹Ÿå¸¦æ¥äº†å¦ä¸€ä¸ªé—®é¢˜ï¼šæ— æ³•ç›´æ¥é€šè¿‡è®¿é—®å®¿ä¸»æœºçš„ç«¯å£æ¥è®¿é—® services è¿›è¡Œè°ƒè¯•ã€‚ æ¯”å¦‚æˆ‘çš„å®éªŒæœºæ˜¯ä¸€å°äº‘æœåŠ¡è™šæ‹Ÿæœºï¼Œæˆ‘åœ¨è‡ªå·±çš„ç”µè„‘ä¸Šå¯ä»¥è®¿é—®è¿™å°è™šæ‹Ÿæœºï¼Œä½†æ˜¯ä¸èƒ½è®¿é—®è™šæ‹Ÿæœºä¸Š minikube æš´éœ²çš„æœåŠ¡ã€‚ è™½ç„¶æ²¡æœ‰åŠæ³•è®© minikube ç›´æ¥é€šè¿‡å®¿ä¸»æœºç«¯å£å¯¹å¤–æš´éœ² servicesï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬æŠŠé—®é¢˜æ¢ä¸ªè§’åº¦æ€è€ƒï¼Œå°±å¾ˆå®¹æ˜“æ‰¾åˆ°è§£å†³åŠæ³•ï¼šå¦‚ä½•å°†ä¸€ä¸ª serviceï¼ˆä¸ç‰¹å®šç±»å‹ï¼‰æš´éœ²åˆ°æœ¬æœºã€‚ è¿™æ—¶å€™æœ€ç®€å•çš„åŠæ³•å°±æ˜¯é€šè¿‡ kubectl port-forward è½¬å‘ç«¯å£ã€‚ æˆ‘æœ‰ä¸€å°webæœåŠ¡ï¼Œserviceç›‘å¬3000ç«¯å£ï¼ˆportï¼‰ï¼Œæˆ‘å¸Œæœ›æš´éœ²åœ¨å®¿ä¸»æœºä¸Šçš„8888ç«¯å£ï¼Œå°±å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼š 1kubectl port-forward --address 0.0.0.0 service/webapp-service 8888:3000 kubectlæ“ä½œå‘½ä»¤ä¼¸ç¼©pod 1kubectl scale deployment my-nginx --replicas=0 æ¸…é™¤ Deploymentã€ReplicaSet å’Œ Pod 12kubectl delete services frontend backendkubectl delete deployment frontend backend","tags":[{"name":"Kubernetes","slug":"Kubernetes","permalink":"https://alexhuihui.github.io/tags/Kubernetes/"},{"name":"minikube","slug":"minikube","permalink":"https://alexhuihui.github.io/tags/minikube/"}]},{"title":"ã€spring-authorization-serverã€‘åŸºäºspring-authorization-serverå®ç°Oauth2æˆæƒæµç¨‹","date":"2022-04-10T09:31:06.000Z","path":"article/20220410.html","text":"","tags":[{"name":"oauth2","slug":"oauth2","permalink":"https://alexhuihui.github.io/tags/oauth2/"},{"name":"spring-authorization-server","slug":"spring-authorization-server","permalink":"https://alexhuihui.github.io/tags/spring-authorization-server/"}]},{"title":"ã€Kubernetesã€‘kubernetes-tutorial","date":"2022-04-05T09:34:23.000Z","path":"article/20220405.html","text":"Kubernetesä»‹ç»å®ƒæ˜¯ä¸€æ¬¾ç”±Googleå¼€å‘å¹¶å¼€æºçš„å®¹å™¨ç¼–æ’å·¥å…·ï¼Œå¸®åŠ©ä½ åœ¨ä¸åŒçš„éƒ¨ç½²ç¯å¢ƒä¸­ç®¡ç†å®¹å™¨åŒ–åº”ç”¨ã€‚","tags":[{"name":"Kubernetes","slug":"Kubernetes","permalink":"https://alexhuihui.github.io/tags/Kubernetes/"}]},{"title":"ã€Dockerã€‘docker tutorial","date":"2022-04-04T03:53:36.000Z","path":"article/20220404.html","text":"docker æ˜¯ä»€ä¹ˆ Docker is a tool for running applications in an isolated Environment Similar to VM App run in same environment Just works Standard for software deployment containerså®¹å™¨æ˜¯ä¸€ä¸ªåº”ç”¨å±‚çš„æŠ½è±¡ï¼Œå¯ä»¥æ‰“åŒ…ä»£ç å’Œä¾èµ–ã€‚å¤šä¸ªå®¹å™¨å¯ä»¥è¿è¡Œåœ¨åŒä¸€å°æœºå™¨å¹¶å…±äº«ä¸€ä¸ªOSå†…æ ¸ï¼Œæ¯ä¸ªå®¹å™¨éƒ½æ˜¯è¿è¡Œåœ¨å•ç‹¬çš„è¿›ç¨‹ä¸­çš„ã€‚ VMVMæ˜¯ä¸€ä¸ªç‰©ç†ç¡¬ä»¶çš„ä¸€ä¸ªæŠ½è±¡ï¼ŒæŠŠä¸€å°æœåŠ¡å˜æˆäº†å¤šä¸ªæœåŠ¡ã€‚æ¯ä¸ªVMéƒ½æ˜¯å¯¹OSçš„å®Œæ•´å¤åˆ¶ï¼Œå ç”¨ç©ºé—´æ›´å¤§ï¼Œå¯åŠ¨æ›´æ…¢ã€‚ pulling nginx image123456# æ‹‰å–é•œåƒdocker pull nginx# å±•ç¤ºæ‰€æœ‰é•œåƒdocekr images# è¿è¡Œå®¹å™¨docker run --name website -d -p 3000:80 -p 8080:80 nginx:latest format docker ps12345docker ps --format=&quot;ID\\t&#123;&#123;.ID&#125;&#125;\\nNAME\\t&#123;&#123;.Names&#125;&#125;\\nIMAGE\\t&#123;&#123;.Image&#125;&#125;\\nPORTS\\t&#123;&#123;.Ports&#125;&#125;\\nCOMMAND\\t&#123;&#123;.Command&#125;&#125;\\nCREATED\\t&#123;&#123;.CreatedAt&#125;&#125;\\nSTATUS\\t&#123;&#123;.Status&#125;&#125;\\n&quot;export Format=&quot;ID\\t&#123;&#123;.ID&#125;&#125;\\nNAME\\t&#123;&#123;.Names&#125;&#125;\\nIMAGE\\t&#123;&#123;.Image&#125;&#125;\\nPORTS\\t&#123;&#123;.Ports&#125;&#125;\\nCOMMAND\\t&#123;&#123;.Command&#125;&#125;\\nCREATED\\t&#123;&#123;.CreatedAt&#125;&#125;\\nSTATUS\\t&#123;&#123;.Status&#125;&#125;\\n&quot;docker ps --format=$Format Volumeså…è®¸å®¿ä¸»æœºå’Œå®¹å™¨ã€å®¹å™¨å’Œå®¹å™¨ä¹‹é—´ç›¸äº’å…±äº«æ•°æ®åŒ…æ‹¬æ–‡ä»¶æˆ–è€…æ–‡ä»¶å¤¹ã€‚ 1docker run --name website -v $(pwd):/usr/share/nginx/html:ro -d -p 8080:80 nginx:latest å®¹å™¨ä¹‹é—´å…±äº«æ•°æ® 1docker run --name website_copy --volumes-from website -d -p 8081:80 nginx DockerfileBuild own image dockerå®˜ç½‘æ–‡æ¡£ åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º Dockerfile æ–‡ä»¶ 12FROM nginx:latestADD . /usr/share/nginx/html 12docker build --tag website:latest .docker run --name website -d -p 8080:80 website:latest æ„å»º user-service-api 12345FROM node:latestWORKDIR /appADD . .RUN npm installCMD node index.js ç¼–å†™ .dockerignore 123node_modulesDockerfile.git ä½¿ç”¨ç¼“å­˜ï¼Œåªæ”¹å˜æºç çš„æƒ…å†µä¸‹ä¸ç”¨é‡æ–°ä¸‹è½½ä¾èµ– 123456FROM node:latestWORKDIR /appADD package*.json .RUN npm installADD . .CMD node index.js Alpineé€‰æ‹©é•œåƒtagé‡ŒåŒ…å«alpineå»æ„å»ºï¼Œä¼šå¤§å¤§çš„å‡å°‘é•œåƒä½“ç§¯ Tags and VersionUsage: docker tag SOURCE_IMAGE[:TAG] TARGET_IMAGE[:TAG] Create a tag TARGET_IMAGE that refers to SOURCE_IMAGE Docker Registriesæ³¨å†Œ hub.docker.com è´¦å·ï¼Œåˆ›å»ºä»“åº“ï¼ŒæŠŠæœ¬åœ°çš„é•œåƒé€šè¿‡tagå‘½ä»¤æŒ‡å®šæˆè¿œç¨‹ä»“åº“çš„åç§°ï¼Œç„¶åæ¨é€ä¸Šå»ã€‚ Docker Inspect123docker inspect name/iddocker logs name/iddocker exec -it name/id /bash","tags":[{"name":"Docker","slug":"Docker","permalink":"https://alexhuihui.github.io/tags/Docker/"}]},{"title":"ã€é¡¹ç›®ã€‘ä½¿ç”¨pythonç”Ÿæˆankiæ–‡ä»¶å¹¶ä¸Šä¼ åˆ°iCloudä¸­","date":"2022-03-11T08:45:55.000Z","path":"article/20220311.html","text":"è¿™å‘¨å¼€å§‹çœ‹ java-design-partternsçš„æ—¶å€™ç»å¸¸åœ¨ä¾‹å­ä¸­çœ‹åˆ°å¾ˆå¤šä¸è®¤è¯†çš„å•è¯ï¼Œå°±æƒ³ç€æŠŠæ¯æ¬¡é‡åˆ°çš„ä¸è®¤è¯†çš„å•è¯è®°å½•ä¸‹æ¥å‘é€åˆ°æ‰‹æœºé‡Œï¼Œå¯ä»¥éšæ—¶å¤ä¹ ã€‚ç»è¿‡è°ƒç ”ï¼Œå‘ç°pythonéƒ½æœ‰ç°æˆçš„åº“å¯ä»¥ä½¿ç”¨ï¼Œä½¿ç”¨genankiç”Ÿæˆankiæ–‡ä»¶ï¼Œå†ä½¿ç”¨pyicloudç™»å½•è‡ªå·±çš„icloudè´¦å·ï¼Œä¸Šä¼ æ–‡ä»¶åˆ°icloud driveä¸­ï¼Œæœ€åä½ å°±èƒ½é€šè¿‡anki å¤‡å¿˜å½•ä¹‹ç±»çš„è½¯ä»¶ä»icloud driveä¸­å¯¼å…¥ä½ çš„æ–‡ä»¶äº†ã€‚ ä½¿ç”¨pyicloudä¸Šä¼ æ–‡ä»¶ä»é…ç½®æ–‡ä»¶è¯»å–ä½ çš„appleè´¦å·å¯†ç ï¼Œåœ¨åˆå§‹åŒ–çš„æ–¹æ³•ä¸­ç™»å½•ã€‚å¯¹å¤–æš´éœ²ä¸€ä¸ªä¸Šä¼ æ–‡ä»¶çš„æ¥å£ï¼Œé»˜è®¤ä½¿ç”¨ankiæ–‡ä»¶å¤¹å­˜å‚¨ã€‚ 12345678910111213141516from pyicloud import PyiCloudServiceclass Cloud(object): def __init__(self): username = &#x27;&#x27; password = &#x27;&#x27; for line in open(&#x27;account.txt&#x27;, &#x27;r&#x27;, encoding=&#x27;utf-8&#x27;): lines = line.split(&#x27; &#x27;) username = lines[0] password = lines[1] self.api = PyiCloudService(username, password) def upload_file(self, file_path): with open(file_path, &#x27;rb&#x27;) as file_in: self.api.drive[&#x27;anki&#x27;].upload(file_in) ä½¿ç”¨genankiç”Ÿæˆankiæ–‡ä»¶æ¯”è¾ƒç®€å•ï¼Œå…ˆå®šä¹‰æ¨¡æ¿modelï¼Œç„¶åå†æŠŠå•è¯çš„ä¸­è‹±æ–‡å¡«å…¥æ¨¡æ¿ç”Ÿæˆä¸€ä¸ªä¸ªçš„noteï¼Œæœ€åå†ä½¿ç”¨deckå†™å…¥æ–‡ä»¶ï¼ˆä¹Ÿå¯ä»¥å†™å…¥æ•°æ®åº“ï¼‰ã€‚ æ•ˆæœå›¾ def get_original(): connect = Connect.get_original_connect() select_sql = â€˜â€™â€™select * from tableâ€™â€™â€™ cursor = connect.cursor() cursor.execute(select_sql) # è·å–æ‰€æœ‰è®°å½•åˆ—è¡¨ return cursor.fetchall()python å¯¼å…¥ä¹‹åçš„æ•ˆæœ æºç åœ°å€https://github.com/Alexhuihui/anki-icloud.git","tags":[{"name":"genanki","slug":"genanki","permalink":"https://alexhuihui.github.io/tags/genanki/"},{"name":"anki","slug":"anki","permalink":"https://alexhuihui.github.io/tags/anki/"},{"name":"pyicloud","slug":"pyicloud","permalink":"https://alexhuihui.github.io/tags/pyicloud/"}]},{"title":"ã€Goè¯­è¨€å­¦ä¹ ã€‘04-ç»“æ„ä½“","date":"2022-03-06T10:35:10.000Z","path":"article/20220306.html","text":"åœ¨ç¼–ç¨‹è¯­è¨€ä¸­ï¼Œè¡¨è¾¾å¼ï¼ˆExpressionï¼‰ã€è¯­å¥ï¼ˆStatementï¼‰å’Œç®€å•è¯­å¥ï¼ˆSimple Statementï¼‰æ˜¯ä¸‰ä¸ªä¸åŒçš„æ¦‚å¿µã€‚ è¡¨è¾¾å¼ï¼ˆExpressionï¼‰æ˜¯è®¡ç®—å‡ºä¸€ä¸ªå€¼çš„ä»£ç ç‰‡æ®µï¼Œå®ƒå¯ä»¥åŒ…å«å˜é‡ã€å¸¸é‡ã€è¿ç®—ç¬¦ã€å‡½æ•°è°ƒç”¨ç­‰ã€‚è¡¨è¾¾å¼æ˜¯ç¨‹åºä¸­çš„åŸºæœ¬æ„å»ºå—ä¹‹ä¸€ï¼Œå¯ä»¥ç”¨äºèµ‹å€¼ã€æ¯”è¾ƒã€æ¡ä»¶åˆ†æ”¯ç­‰åœºæ™¯ã€‚ ä¸¾ä¾‹æ¥è¯´ï¼Œåœ¨ Go ä¸­ï¼Œä»¥ä¸‹æ˜¯ä¸€äº›è¡¨è¾¾å¼çš„ä¾‹å­ï¼š 123456789101112131415161718// å­—é¢é‡è¡¨è¾¾å¼10&quot;Hello World&quot;true// å˜é‡è¡¨è¾¾å¼ab + 5c &gt; 0// å‡½æ•°è°ƒç”¨è¡¨è¾¾å¼math.Sqrt(x)fmt.Println(&quot;Hello&quot;)// è¿ç®—ç¬¦è¡¨è¾¾å¼a + bc * d - 1!isDone è¯­å¥ï¼ˆStatementï¼‰æ˜¯æ‰§è¡Œä¸€äº›æ“ä½œçš„ä»£ç ç‰‡æ®µï¼Œå®ƒå¯ä»¥æ˜¯èµ‹å€¼è¯­å¥ã€æ§åˆ¶æµè¯­å¥ã€å‡½æ•°è°ƒç”¨è¯­å¥ç­‰ã€‚è¯­å¥å¯ä»¥æ”¹å˜ç¨‹åºçŠ¶æ€æˆ–æ‰§è¡Œä¸€äº›è®¡ç®—ï¼Œå®ƒä»¬é€šå¸¸ç”±ä¸€ä¸ªæˆ–å¤šä¸ªè¡¨è¾¾å¼ç»„æˆã€‚ ä¸¾ä¾‹æ¥è¯´ï¼Œåœ¨ Go ä¸­ï¼Œä»¥ä¸‹æ˜¯ä¸€äº›è¯­å¥çš„ä¾‹å­ï¼š 1234567891011121314151617181920// èµ‹å€¼è¯­å¥a = 10b = 5 + ac, d = d, c // äº¤æ¢å˜é‡å€¼// æ§åˆ¶æµè¯­å¥if x &gt; 0 &#123; fmt.Println(&quot;Positive&quot;)&#125; else if x &lt; 0 &#123; fmt.Println(&quot;Negative&quot;)&#125; else &#123; fmt.Println(&quot;Zero&quot;)&#125;for i := 0; i &lt; 10; i++ &#123; fmt.Println(i)&#125;// å‡½æ•°è°ƒç”¨è¯­å¥fmt.Println(&quot;Hello World&quot;) ç®€å•è¯­å¥ï¼ˆSimple Statementï¼‰æ˜¯ä¸€ç§ç‰¹æ®Šçš„è¯­å¥ï¼Œå®ƒåªåŒ…å«ä¸€ä¸ªå•ç‹¬çš„è¡¨è¾¾å¼ã€‚ç®€å•è¯­å¥é€šå¸¸å‡ºç°åœ¨å¾ªç¯ä½“ä¸­æˆ–è€…æ§åˆ¶æµè¯­å¥ä¸­çš„æ¡ä»¶éƒ¨åˆ†ã€‚ ä¸¾ä¾‹æ¥è¯´ï¼Œåœ¨ Go ä¸­ï¼Œä»¥ä¸‹æ˜¯ä¸€äº›ç®€å•è¯­å¥çš„ä¾‹å­ï¼š 1234567// èµ‹å€¼è¯­å¥æ˜¯ä¸€ç§ç®€å•è¯­å¥a = 10// å‡½æ•°è°ƒç”¨è¯­å¥æ˜¯ä¸€ç§ç®€å•è¯­å¥fmt.Println(&quot;Hello World&quot;)// ç©ºè¯­å¥æ˜¯ä¸€ç§ç‰¹æ®Šçš„ç®€å•è¯­å¥ï¼Œå®ƒä¸åšä»»ä½•æ“ä½œ æ€»ä¹‹ï¼Œè¡¨è¾¾å¼æ˜¯è®¡ç®—å€¼çš„ä»£ç ç‰‡æ®µï¼Œè¯­å¥æ˜¯æ‰§è¡Œæ“ä½œçš„ä»£ç ç‰‡æ®µï¼Œè€Œç®€å•è¯­å¥æ˜¯ä¸€ç§ç‰¹æ®Šçš„è¯­å¥ï¼ŒåªåŒ…å«ä¸€ä¸ªè¡¨è¾¾å¼ã€‚åœ¨ç¼–å†™ç¨‹åºæ—¶ï¼Œç†è§£å®ƒä»¬ä¹‹é—´çš„å·®å¼‚éå¸¸é‡è¦ï¼Œä»¥ä¾¿æ­£ç¡®åœ°ç»„ç»‡ä»£ç ã€‚","tags":[{"name":"Go","slug":"Go","permalink":"https://alexhuihui.github.io/tags/Go/"}]},{"title":"ã€Goè¯­è¨€å­¦ä¹ ã€‘04-ç»“æ„ä½“","date":"2022-03-05T10:35:10.000Z","path":"article/20220305.html","text":"ç¼–ç¨‹å®é™…ä¸Šæ˜¯å¯¹çœŸå®ä¸–ç•Œçš„æ˜ å°„ åœ¨goä¸­å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹å¼å®šä¹‰ç±»å‹ 1type T S æ¯ä¸ªç±»å‹éƒ½æœ‰å…¶åº•å±‚ç±»å‹ åº•å±‚ç±»å‹ä¸åŒçš„ä¸¤ä¸ªç±»å‹æ— æ³•åšåˆ°æ˜¾ç¤ºè½¬æ¢","tags":[{"name":"Go","slug":"Go","permalink":"https://alexhuihui.github.io/tags/Go/"}]},{"title":"ã€Goè¯­è¨€å­¦ä¹ ã€‘03-å¤åˆæ•°æ®ç±»å‹","date":"2022-03-04T10:35:10.000Z","path":"article/20220304.html","text":"æœ¬æ–‡ä»‹ç»goçš„å¦ä¸€ä¸ªå¤åˆç±»å‹ map ä»€ä¹ˆæ˜¯mapç±»å‹map æ˜¯ Go è¯­è¨€æä¾›çš„ä¸€ç§æŠ½è±¡æ•°æ®ç±»å‹ï¼Œå®ƒè¡¨ç¤ºä¸€ç»„æ— åºçš„é”®å€¼å¯¹ã€‚åœ¨åé¢çš„è®²è§£ä¸­ï¼Œæˆ‘ä»¬ä¼šç›´æ¥ä½¿ç”¨ key å’Œ value åˆ†åˆ«ä»£è¡¨ map çš„é”®å’Œå€¼ã€‚è€Œä¸”ï¼Œmap é›†åˆä¸­æ¯ä¸ª key éƒ½æ˜¯å”¯ä¸€çš„ï¼š å’Œåˆ‡ç‰‡ç±»ä¼¼ï¼Œä½œä¸ºå¤åˆç±»å‹çš„ mapï¼Œå®ƒåœ¨ Go ä¸­çš„ç±»å‹è¡¨ç¤ºä¹Ÿæ˜¯ç”± key ç±»å‹ä¸ value ç±»å‹ç»„æˆçš„ï¼Œå°±åƒä¸‹é¢ä»£ç ï¼š 1map[key_type]value_type key ä¸ value çš„ç±»å‹å¯ä»¥ç›¸åŒï¼Œä¹Ÿå¯ä»¥ä¸åŒï¼š 12map[string]string // keyä¸valueå…ƒç´ çš„ç±»å‹ç›¸åŒmap[int]string // keyä¸valueå…ƒç´ çš„ç±»å‹ä¸åŒ map ç±»å‹å¯¹ value çš„ç±»å‹æ²¡æœ‰é™åˆ¶ï¼Œä½†æ˜¯å¯¹ key çš„ç±»å‹å´æœ‰ä¸¥æ ¼è¦æ±‚ï¼Œå› ä¸º map ç±»å‹è¦ä¿è¯ key çš„å”¯ä¸€æ€§ã€‚Go è¯­è¨€ä¸­è¦æ±‚ï¼Œkey çš„ç±»å‹å¿…é¡»æ”¯æŒâ€œ==â€å’Œâ€œ!=â€ä¸¤ç§æ¯”è¾ƒæ“ä½œç¬¦ã€‚ä½†æ˜¯ï¼Œåœ¨ Go è¯­è¨€ä¸­ï¼Œå‡½æ•°ç±»å‹ã€map ç±»å‹è‡ªèº«ï¼Œä»¥åŠåˆ‡ç‰‡åªæ”¯æŒä¸ nil çš„æ¯”è¾ƒï¼Œè€Œä¸æ”¯æŒåŒç±»å‹ä¸¤ä¸ªå˜é‡çš„æ¯”è¾ƒã€‚å¦‚æœåƒä¸‹é¢ä»£ç è¿™æ ·ï¼Œè¿›è¡Œè¿™äº›ç±»å‹çš„æ¯”è¾ƒï¼ŒGo ç¼–è¯‘å™¨å°†ä¼šæŠ¥é”™ï¼š 123456789s1 := make([]int, 1)s2 := make([]int, 2)f1 := func() &#123;&#125;f2 := func() &#123;&#125;m1 := make(map[int]string)m2 := make(map[int]string)println(s1 == s2) // é”™è¯¯ï¼šinvalid operation: s1 == s2 (slice can only be compared to nil)println(f1 == f2) // é”™è¯¯ï¼šinvalid operation: f1 == f2 (func can only be compared to nil)println(m1 == m2) // é”™è¯¯ï¼šinvalid operation: m1 == m2 (map can only be compared to nil) æ‰€ä»¥å‡½æ•°ç±»å‹ã€map ç±»å‹è‡ªèº«ï¼Œä»¥åŠåˆ‡ç‰‡ç±»å‹æ˜¯ä¸èƒ½ä½œä¸º map çš„ key ç±»å‹çš„ã€‚ map å˜é‡çš„å£°æ˜å’Œåˆå§‹åŒ–æ–¹æ³•ä¸€ï¼šä½¿ç”¨å¤åˆå­—é¢å€¼åˆå§‹åŒ– map ç±»å‹å˜é‡ã€‚ 1234567type Position struct &#123; x float64 y float64&#125;m := map[Position]string&#123; &#123;29.935523, 52.568915&#125;: &quot;school&quot;, &#123;25.352594, 113.304361&#125;: &quot;shopping-mall&quot;, &#123;73.224455, 111.804306&#125;: &quot;hospital&quot;,&#125; æ–¹æ³•äºŒï¼šä½¿ç”¨ make ä¸º map ç±»å‹å˜é‡è¿›è¡Œæ˜¾å¼åˆå§‹åŒ–ã€‚ 12m1 := make(map[int]string) // æœªæŒ‡å®šåˆå§‹å®¹é‡m2 := make(map[int]string, 8) // æŒ‡å®šåˆå§‹å®¹é‡ä¸º8 mapçš„åŸºæœ¬æ“ä½œæ’å…¥ æŸ¥æ‰¾ï¼š 12m := make(map[string]int)v := m[&quot;key1&quot;] å½“æˆ‘ä»¬å°è¯•å»è·å–ä¸€ä¸ªé”®å¯¹åº”çš„å€¼çš„æ—¶å€™ï¼Œå¦‚æœè¿™ä¸ªé”®åœ¨ map ä¸­å¹¶ä¸å­˜åœ¨ï¼Œæˆ‘ä»¬ä¹Ÿä¼šå¾—åˆ°ä¸€ä¸ªå€¼ï¼Œè¿™ä¸ªå€¼æ˜¯ value å…ƒç´ ç±»å‹çš„é›¶å€¼ã€‚æ‰€ä»¥goé‡‡ç”¨ comma okçš„æ–¹å¼åˆ¤æ–­keyå¯¹åº”çš„valueå€¼å­˜åœ¨ä¸å¦ 1234567m := make(map[string]int)v, ok := m[&quot;key1&quot;]if !ok &#123; // &quot;key1&quot;ä¸åœ¨mapä¸­&#125;// &quot;key1&quot;åœ¨mapä¸­ï¼Œvå°†è¢«èµ‹äºˆ&quot;key1&quot;é”®å¯¹åº”çš„value åˆ é™¤ï¼š åªèƒ½ä½¿ç”¨deleteå‡½æ•°ï¼Œå³ä½¿keyå€¼ä¸å­˜åœ¨ï¼Œå‡½æ•°æ‰§è¡Œä¹Ÿä¸ä¼šå¤±è´¥ 12345678m := map[string]int &#123; &quot;key1&quot; : 1, &quot;key2&quot; : 2,&#125;fmt.Println(m) // map[key1:1 key2:2]delete(m, &quot;key2&quot;) // åˆ é™¤&quot;key2&quot;fmt.Println(m) // map[key1:1] éå†ï¼š éå† map çš„é”®å€¼å¯¹åªæœ‰ä¸€ç§æ–¹æ³•ï¼Œé‚£å°±æ˜¯åƒå¯¹å¾…åˆ‡ç‰‡é‚£æ ·é€šè¿‡ for range è¯­å¥å¯¹ map æ•°æ®è¿›è¡Œéå† 1234567891011121314151617package main import &quot;fmt&quot;func main() &#123; m := map[int]int&#123; 1: 11, 2: 12, 3: 13, &#125; fmt.Printf(&quot;&#123; &quot;) for k, v := range m &#123; fmt.Printf(&quot;[%d, %d] &quot;, k, v) &#125; fmt.Printf(&quot;&#125;\\n&quot;)&#125; mapçš„åº•å±‚å®ç°å¾…è¡¥å……","tags":[{"name":"Go","slug":"Go","permalink":"https://alexhuihui.github.io/tags/Go/"}]},{"title":"ã€Goè¯­è¨€å­¦ä¹ ã€‘02-æ•°æ®ç±»å‹","date":"2022-03-02T03:10:37.000Z","path":"article/20220302.html","text":"åˆ‡ç‰‡Go å€¼ä¼ é€’çš„æœºåˆ¶è®©æ•°ç»„åœ¨å„ä¸ªå‡½æ•°é—´ä¼ é€’èµ·æ¥æ¯”è¾ƒâ€œç¬¨é‡â€ï¼Œå¼€é”€è¾ƒå¤§ï¼Œä¸”å¼€é”€éšæ•°ç»„é•¿åº¦çš„å¢åŠ è€Œå¢åŠ ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒGo å¼•å…¥äº†åˆ‡ç‰‡è¿™ä¸€ä¸å®šé•¿åŒæ„æ•°æ®ç±»å‹ã€‚ sliceå¯ä»¥çœ‹åšæ•°ç»„çš„æ–‡ä»¶æè¿°ç¬¦ã€‚å®ƒç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼šæŒ‡å‘åº•å±‚æ•°ç»„çš„æŒ‡é’ˆã€å½“å‰å¤§å°å’Œæ€»å®¹é‡ã€‚å®ƒè¿˜å¯ä»¥è¿›è¡ŒåŠ¨æ€æ‰©å®¹ï¼Œä½†æ˜¯è¦å°å¿ƒå®ƒçš„åº•å±‚æ•°ç»„åœ¨æ‰©å®¹çš„æ—¶å€™æ˜¯å¤åˆ¶åˆ°æ–°çš„æ•°ç»„ä¸­çš„ã€‚","tags":[{"name":"Go","slug":"Go","permalink":"https://alexhuihui.github.io/tags/Go/"}]},{"title":"ã€æ•°æ®ç»“æ„ã€‘çº¿æ€§è¡¨","date":"2022-02-28T02:35:13.000Z","path":"article/20220228.html","text":"çº¿æ€§è¡¨å°±æ˜¯æ•°æ®æ’æˆåƒä¸€æ¡çº¿ä¸€æ ·çš„ç»“æ„ã€‚æ¯ä¸ªçº¿æ€§è¡¨ä¸Šçš„æ•°æ®æœ€å¤šåªæœ‰å‰å’Œåä¸¤ä¸ªæ–¹å‘ é™¤äº†æ•°ç»„ï¼Œé“¾è¡¨ã€é˜Ÿåˆ—ã€æ ˆç­‰ä¹Ÿæ˜¯çº¿æ€§è¡¨ç»“æ„ã€‚","tags":[{"name":"æ•°ç»„","slug":"æ•°ç»„","permalink":"https://alexhuihui.github.io/tags/%E6%95%B0%E7%BB%84/"},{"name":"é“¾è¡¨","slug":"é“¾è¡¨","permalink":"https://alexhuihui.github.io/tags/%E9%93%BE%E8%A1%A8/"},{"name":"æ ˆ","slug":"æ ˆ","permalink":"https://alexhuihui.github.io/tags/%E6%A0%88/"},{"name":"é˜Ÿåˆ—","slug":"é˜Ÿåˆ—","permalink":"https://alexhuihui.github.io/tags/%E9%98%9F%E5%88%97/"}]},{"title":"ã€ZooKeeperã€‘The ZooKeeper Data Model","date":"2022-02-25T08:54:06.000Z","path":"article/20220225.html","text":"zookeeperæ‹¥æœ‰å¤šå±‚çš„å‘½åç©ºé—´ï¼Œå°±åƒä¸€ä¸ªåˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿã€‚å”¯ä¸€çš„ä¸åŒå°±æ˜¯å®ƒçš„æ¯ä¸ªèŠ‚ç‚¹éƒ½å¯ä»¥åŒ…å«æ•°æ®ï¼Œå°±åƒæ–‡ä»¶ç³»ç»Ÿä¸­å…è®¸ä¸€ä¸ªæ–‡ä»¶å¯ä»¥ä½œä¸ºç›®å½•ã€‚å®ƒæ²¡æœ‰ç›¸å¯¹è·¯å¾„ã€‚ ZNodeszookeeperä¸­æ¯ä¸ªèŠ‚ç‚¹éƒ½éƒ½è¢«å«åšznodeã€‚å®ƒåŒ…å«äº†æ•°æ®æœ¬èº«ã€æ•°æ®å˜æ›´çš„ç‰ˆæœ¬å’Œè®¿é—®æ§åˆ¶(acl)çš„ç‰ˆæœ¬ Watcheså®¢æˆ·ç«¯å¯ä»¥åœ¨znodesä¸Šè®¾ç½®ç›‘æ§ï¼Œå½“znodeå‡ºå‘äº†ç›‘æ§ï¼Œzookeeperå°±ä¼šå‘å®¢æˆ·ç«¯å‘é€ä¸€ä¸ªé€šçŸ¥ï¼Œç„¶åæ¸…é™¤ç›‘æ§ã€‚ Data Accessæ•°æ®åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸­çš„è¯»å†™æ“ä½œéƒ½æ˜¯åŸå­çš„ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ª Access Control List (ACL)æ¥å†³å®šè°å¯ä»¥å¹²ä»€ä¹ˆã€‚ Ephemeral Nodeszookeeperå¯ä»¥åˆ›å»ºä¸´æ—¶æ€§çš„èŠ‚ç‚¹ï¼Œè¿™äº›èŠ‚ç‚¹åªæœ‰åœ¨sessionåˆ›å»ºå’Œç»“æŸæœŸé—´æ‰æ˜¯æ´»è·ƒçš„ï¼Œå¯ä»¥é€šè¿‡getEphemerals() è·å–å½“å‰sessionåˆ›å»ºçš„ä¸´æ—¶èŠ‚ç‚¹ã€‚ Sequence Nodesæœ‰åºçš„èŠ‚ç‚¹ï¼Œæ‹¥æœ‰å”¯ä¸€çš„åå­—ã€‚ Container Nodeså®¹å™¨èŠ‚ç‚¹æ˜¯ä¸“é—¨ç”¨æ¥ä½œä¸ºleaderæˆ–è€…lockã€‚å½“å®¹å™¨çš„æœ€åä¸€ä¸ªèŠ‚ç‚¹è¢«åˆ é™¤ï¼Œå®¹å™¨å°±ä¼šè¢«æœåŠ¡ç«¯åœ¨æœªæ¥çš„æŸä¸ªæ—¶é—´åˆ é™¤ã€‚ TTL Nodeså½“åˆ›å»ºæ°¸ä¹…æˆ–æ°¸ä¹…æœ‰åºçš„èŠ‚ç‚¹ï¼Œä½ å¯ä»¥é€‰æ‹©è®¾ç½®è¿‡æœŸæ—¶é—´ã€‚ Time in ZooKeeper","tags":[{"name":"ZooKeeper","slug":"ZooKeeper","permalink":"https://alexhuihui.github.io/tags/ZooKeeper/"}]},{"title":"ã€spring-authorization-serverã€‘æ ·ä¾‹è¯´æ˜","date":"2022-02-23T07:21:05.000Z","path":"article/20220223.html","text":"ä»‹ç»å‰æ®µæ—¶é—´spring-securityå›¢é˜Ÿæ¨å‡ºäº†æ–°çš„åŸºäºOauth2.0çš„æˆæƒæœåŠ¡å™¨å®ç°ï¼Œå«åšspring-authorization-serverï¼Œè®©æˆ‘ä»¬æ¥æ¢ç©¶ä¸€ä¸‹é‡Œé¢exampleã€‚ client : å®¢æˆ·ç«¯é¦–å…ˆå‘æˆæƒæœåŠ¡å™¨çš„æˆæƒèŠ‚ç‚¹ï¼ˆAuthorization endpointï¼‰å‘èµ·æˆæƒè¯·æ±‚ï¼Œé€šè¿‡@RegisteredOAuth2AuthorizedClient(â€œmessaging-client-authorization-codeâ€) 1OAuth2AuthorizedClientArgumentResolver è·å–æ³¨è§£é‡Œé¢å®šä¹‰çš„ clientRegistrationId = messaging-client-authorization-code 1DefaultOAuth2AuthorizedClientManager åœ¨authorize()ä¸­å»å¯»æ‰¾OAuth2AuthorizedClientï¼Œå‘ç°æ²¡æœ‰ä¹‹åå†å»å¯»æ‰¾ClientRegistrationï¼Œåœ¨InMemoryClientRegistrationRepositoryä¸­å¯ä»¥æ‰¾åˆ°clientRegistrationIdå¯¹åº”çš„ClientRegistrationã€‚ ç„¶åç”¨è¿™ä¸ªclientRegistrationæ„å»ºOAuth2AuthorizationContextï¼Œå†ä½¿ç”¨DelegatingOAuth2AuthorizedClientProviderå»è°ƒç”¨authorizedClientProvidersä¸­çš„authorize() 1AuthorizationCodeOAuth2AuthorizedClientProvider æŠ›å‡ºClientAuthorizationRequiredExceptionè¢«OAuth2AuthorizationRequestRedirectFilteræ•è· ç„¶åè¿”å›ä¸€ä¸ªé‡å®šå‘åœ°å€ï¼šhttp://auth-server:9000/oauth2/authorize?response_type=code&amp;client_id=messaging-client&amp;scope=message.read%20message.write&amp;state=NVdF9Kzi80STPhHHHs9BTv9oAJlODlzpFEFVtl_TI6g%3D&amp;redirect_uri=http://127.0.0.1:8080/authorized auth-server: 1OAuth2AuthorizationEndpointFilter å¤„ç†æˆæƒè¯·æ±‚ï¼Œå‘ç°æ²¡æœ‰è®¤è¯ï¼Œç„¶åå°±ä¼šç»è¿‡DelegatingAuthenticationEntryPointé€‰æ‹©å¯¹åº”çš„LoginUrlAuthenticationEntryPointè¿”å›401çŠ¶æ€ç ","tags":[{"name":"oauth2","slug":"oauth2","permalink":"https://alexhuihui.github.io/tags/oauth2/"},{"name":"spring-authorization-server","slug":"spring-authorization-server","permalink":"https://alexhuihui.github.io/tags/spring-authorization-server/"}]},{"title":"ã€gRPCã€‘Javaå’ŒPythonä½¿ç”¨gRPC","date":"2022-02-10T10:35:10.000Z","path":"article/20220210.html","text":"ä½¿ç”¨Javaæ­å»ºgRPCæœåŠ¡ç«¯1ã€å¦‚ä½•é…ç½®Mavenæ–¹å¼ä¸€ï¼š io.grpc grpc-all 1.26.0 æ–¹å¼äºŒï¼š 12345678910111213141516171819202122&lt;dependency&gt; &lt;groupId&gt;io.grpc&lt;/groupId&gt; &lt;artifactId&gt;grpc-netty-shaded&lt;/artifactId&gt; &lt;version&gt;1.44.0&lt;/version&gt; &lt;scope&gt;runtime&lt;/scope&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;io.grpc&lt;/groupId&gt; &lt;artifactId&gt;grpc-protobuf&lt;/artifactId&gt; &lt;version&gt;1.44.0&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;io.grpc&lt;/groupId&gt; &lt;artifactId&gt;grpc-stub&lt;/artifactId&gt; &lt;version&gt;1.44.0&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;!-- necessary for Java 9+ --&gt; &lt;groupId&gt;org.apache.tomcat&lt;/groupId&gt; &lt;artifactId&gt;annotations-api&lt;/artifactId&gt; &lt;version&gt;6.0.53&lt;/version&gt; &lt;scope&gt;provided&lt;/scope&gt;&lt;/dependency&gt; map[key_type]value_typego io.grpc grpc-netty 1.26.0 io.grpc grpc-protobuf 1.26.0 io.grpc grpc-stub 1.26.0 ä¸‰ç§æ–¹å¼çš„åŒºåˆ«ï¼ša.æ–¹å¼ä¸€ä¼šæŠŠä¸gRPCç›¸å…³çš„æ‰€æœ‰jaréƒ½å¼•å…¥ï¼Œä¸ç®¡å®é™…é¡¹ç›®ä¸­æ˜¯å¦ä¼šç”¨åˆ°ã€‚å¼•å…¥ç›¸å…³jarè¾ƒå¤šï¼Œä½†å…¶é…ç½®ç®€å•ã€‚æ–¹å¼ä¸‰åªä¼šå¼•å…¥ä¸gRPCå’Œnettyç›¸å…³çš„jarï¼Œå¦‚æœè¦ä½¿ç”¨OkHttpï¼Œåˆ™è¦å†å¼•å…¥ã€‚é…ç½®ç›¸å¯¹è¾ƒå¤šï¼Œä½†å¼•å…¥jarç›¸å¯¹è¾ƒå°‘ã€‚æ–¹å¼äºŒå¼•å…¥çš„jarçš„æ•°é‡ä»‹äºæ–¹å¼ä¸€ä¸æ–¹å¼ä¸‰ä¹‹é—´ã€‚ b.æ–¹å¼ä¸€ä¸­nettyæ˜¯ä»¥åŸå§‹jarå¼•ç”¨çš„ã€‚è¿™æ ·æ–¹ä¾¿åœ¨ä½¿ç”¨çš„è¿‡ç¨‹ä¸­æŸ¥çœ‹nettyæºä»£ç ï¼Œæ–¹ä¾¿å¼€å‘ã€‚æ–¹å¼äºŒä¸­nettyè¢«æ”¾å…¥grpc-netty-shaded-1.26.0.jarçš„io.grpc.netty.shadedåŒ…ä¸­ã€‚è¿™æ ·çš„å¥½å¤„æ˜¯å½“é¡¹ç›®ä¸­æœ‰å¤šä¸ªæ¨¡å—ä½¿ç”¨äº†ä¸åŒç‰ˆæœ¬çš„nettyæ—¶ï¼ŒgRPCåŠŸèƒ½ä¸ä¼šå—åˆ°å½±å“ã€‚ä½†åå¤„å°±æ˜¯ä¸æ–¹ä¾¿æŸ¥çœ‹nettyæºä»£ç äº†ã€‚æ–¹å¼ä¸‰ä¸æ–¹å¼ä¸€ç›¸åŒï¼Œä½†ä¸ä¼šå¼•å…¥åƒOkHttpè¿™æ ·ä¸nettyä¸gRPCä¸ç›¸å…³çš„jarã€‚ æ€»ä¹‹ï¼Œæ–¹å¼ä¸€å’Œæ–¹å¼ä¸‰éƒ½é€‚åˆç”¨åœ¨åªéœ€è¦ä½¿ç”¨å•ä¸€nettyç‰ˆæœ¬çš„ç¯å¢ƒï¼Œæ–¹å¼äºŒé€‚åˆç”¨åœ¨å¤šä¸ªnettyç‰ˆæœ¬å…±å­˜çš„ç¯å¢ƒ ã€‚ 2ã€ç¼–å†™protobufæ–‡ä»¶åœ¨ideaçš„æ’ä»¶å¸‚åœºä¸‹è½½å®‰è£…protobufçš„æ’ä»¶ åˆ›å»ºsrc/main/proto/rpc_date.proto 12345678910111213141516171819202122232425syntax = &quot;proto3&quot;; // åè®®ç‰ˆæœ¬// é€‰é¡¹é…ç½®option java_package = &quot;top.alexmmd.grpc.api&quot;;option java_outer_classname = &quot;RPCDateServiceApi&quot;;option java_multiple_files = true;// å®šä¹‰åŒ…åpackage top.alexmmd.grpc.api;// æœåŠ¡æ¥å£.å®šä¹‰è¯·æ±‚å‚æ•°å’Œç›¸åº”ç»“æœservice RPCDateService &#123; rpc getDate (RPCDateRequest) returns (RPCDateResponse) &#123; &#125;&#125;// å®šä¹‰è¯·æ±‚ä½“message RPCDateRequest &#123; string userName = 1;&#125;// å®šä¹‰ç›¸åº”å†…å®¹message RPCDateResponse &#123; string serverDate = 1;&#125; ä½¿ç”¨mavenæ’ä»¶è¿›è¡Œç¼–è¯‘ æŠŠtargetç›®å½•ä¸­ç”Ÿæˆçš„æ–‡ä»¶å¤åˆ¶åˆ°javaç›®å½•ä¸­ 3ã€ç¼–å†™æ¥å£å®ç°ç±»12345678910111213141516171819202122232425// RPCDateServiceGrpc.RPCDateServiceImplBase è¿™ä¸ªå°±æ˜¯æ¥å£.// RPCDateServiceImpl æˆ‘ä»¬éœ€è¦ç»§æ‰¿ä»–çš„,å®ç°æ–¹æ³•å›è°ƒpublic class RPCDateServiceImpl extends RPCDateServiceGrpc.RPCDateServiceImplBase &#123; @Override public void getDate(RPCDateRequest request, StreamObserver&lt;RPCDateResponse&gt; responseObserver) &#123; System.out.println(&quot;request = &quot; + request); // è¯·æ±‚ç»“æœ,æˆ‘ä»¬å®šä¹‰çš„ RPCDateResponse rpcDateResponse = null; String userName = request.getUserName(); String response = String.format(&quot;ä½ å¥½: %s, ä»Šå¤©æ˜¯%s.&quot;, userName, LocalDate.now().format(DateTimeFormatter.ofPattern(&quot;yyyy-MM-dd&quot;))); try &#123; // å®šä¹‰å“åº”,æ˜¯ä¸€ä¸ªbuilderæ„é€ å™¨. rpcDateResponse = RPCDateResponse .newBuilder() .setServerDate(response) .build(); &#125; catch (Exception e) &#123; responseObserver.onError(e); &#125; finally &#123; // è¿™ç§å†™æ³•æ˜¯observer,å¼‚æ­¥å†™æ³•,è€å¤–å–œæ¬¢ç”¨è¿™ä¸ªæ¡†æ¶. responseObserver.onNext(rpcDateResponse); &#125; responseObserver.onCompleted(); &#125;&#125; 4ã€å®šä¹‰æœåŠ¡ç«¯12345678910111213public class GRPCServer &#123; private static final int port = 9999; public static void main(String[] args) throws Exception &#123; // è®¾ç½®serviceæ¥å£. Server server = ServerBuilder. forPort(port) .addService(new RPCDateServiceImpl()) .build().start(); System.out.println(String.format(&quot;GRpcæœåŠ¡ç«¯å¯åŠ¨æˆåŠŸ, ç«¯å£å·: %d.&quot;, port)); server.awaitTermination(); &#125;&#125; 5ã€å®šä¹‰å®¢æˆ·ç«¯123456789101112131415161718192021222324public class GRPCClient &#123; private static final String host = &quot;localhost&quot;; private static final int serverPort = 9999; public static void main(String[] args) throws Exception &#123; // 1. æ‹¿åˆ°ä¸€ä¸ªé€šä¿¡çš„channel ManagedChannel managedChannel = ManagedChannelBuilder.forAddress(host, serverPort).usePlaintext().build(); try &#123; // 2.æ‹¿åˆ°é“ç†å¯¹è±¡ RPCDateServiceGrpc.RPCDateServiceBlockingStub rpcDateService = RPCDateServiceGrpc.newBlockingStub(managedChannel); RPCDateRequest rpcDateRequest = RPCDateRequest .newBuilder() .setUserName(&quot;anthony&quot;) .build(); // 3. è¯·æ±‚ RPCDateResponse rpcDateResponse = rpcDateService.getDate(rpcDateRequest); // 4. è¾“å‡ºç»“æœ System.out.println(rpcDateResponse.getServerDate()); &#125; finally &#123; // 5.å…³é—­channel, é‡Šæ”¾èµ„æº. managedChannel.shutdown(); &#125; &#125;&#125; ä½¿ç”¨Pythonæ­å»ºgRPCå®¢æˆ·ç«¯1ã€ç¯å¢ƒé…ç½® protobuf è¿è¡Œæ—¶(runtime) 1pip install grpcio å®‰è£… python ä¸‹çš„ protoc ç¼–è¯‘å™¨ 1pip install grpcio-tools 2ã€ç¼–è¯‘protoæ–‡ä»¶1python -m grpc_tools.protoc --python_out=. --grpc_python_out=. -I. rpc_date.proto 3ã€ç¼–å†™å®¢æˆ·ç«¯12345678910111213141516import grpcimport rpc_date_pb2import rpc_date_pb2_grpcdef run(): # è¿æ¥ rpc æœåŠ¡å™¨ channel = grpc.insecure_channel(&#x27;127.0.0.1:9999&#x27;) # è°ƒç”¨ rpc æœåŠ¡ stub = rpc_date_pb2_grpc.RPCDateServiceStub(channel) response = stub.getDate(rpc_date_pb2.RPCDateRequest(userName=&#x27;czl&#x27;)) print(response)if __name__ == &#x27;__main__&#x27;: run() æœ€åprotoæ–‡ä»¶ä¸­çš„åŒ…åä¹Ÿè¦ä¿æŒä¸€è‡´ï¼Œæœ€å¥½ä¸è¦æ”¹åŠ¨","tags":[{"name":"gRPC","slug":"gRPC","permalink":"https://alexhuihui.github.io/tags/gRPC/"}]},{"title":"ã€Goè¯­è¨€å­¦ä¹ ã€‘01 | åˆçª¥é—¨å¾„","date":"2022-01-25T07:25:18.000Z","path":"article/20220125.html","text":"åˆ›å»ºhello, worldç¨‹åºåˆ›å»ºhello, worldæ–‡ä»¶å¤¹12345$mkdir ~/goprojects // åˆ›å»ºä¸€ä¸ªå¯ä»¥é›†åˆæ‰€æœ‰ä¸“æ é¡¹ç›®çš„æ ¹æ–‡ä»¶å¤¹$cd ~/goprojects$mkdir helloworld // åˆ›å»ºå­˜å‚¨helloworldç¤ºä¾‹çš„æ–‡ä»¶å¤¹$cd helloworld ç¼–å†™å’Œè¿è¡Œç¬¬ä¸€ä¸ªGoç¨‹åºé¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªåä¸º main.go çš„æºæ–‡ä»¶ã€‚ Go æºæ–‡ä»¶æ€»æ˜¯ç”¨å…¨å°å†™å­—æ¯å½¢å¼çš„çŸ­å°å•è¯å‘½åï¼Œå¹¶ä¸”ä»¥.go æ‰©å±•åç»“å°¾ã€‚ å¦‚æœè¦åœ¨æºæ–‡ä»¶çš„åå­—ä¸­ä½¿ç”¨å¤šä¸ªå•è¯ï¼Œæˆ‘ä»¬é€šå¸¸ç›´æ¥æ˜¯å°†å¤šä¸ªå•è¯è¿æ¥èµ·æ¥ä½œä¸ºæºæ–‡ä»¶åï¼Œè€Œä¸æ˜¯ä½¿ç”¨å…¶ä»–åˆ†éš”ç¬¦ï¼Œæ¯”å¦‚ä¸‹åˆ’çº¿ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬é€šå¸¸ä½¿ç”¨ helloworld.go ä½œä¸ºæ–‡ä»¶åè€Œä¸æ˜¯ hello_world.goã€‚ 12345678package mainimport &quot;fmt&quot;func main() &#123; fmt.Println(&quot;hello, world&quot;)&#125; ä¿å­˜æ–‡ä»¶ï¼Œç¼–è¯‘å’Œè¿è¡Œ 1234$go build main.go$./mainhello, world hello, worldç¨‹åºçš„ç»“æ„ä¸Šè¿°ä»£ç å¯ä»¥åˆ†æˆä¸‰éƒ¨åˆ†å‰–æï¼š package main è¿™ä¸€è¡Œä»£ç å®šä¹‰äº† Go ä¸­çš„ä¸€ä¸ªåŒ… packageã€‚åŒ…æ˜¯ Go è¯­è¨€çš„åŸºæœ¬ç»„æˆå•å…ƒï¼Œé€šå¸¸ä½¿ç”¨å•ä¸ªçš„å°å†™å•è¯å‘½åï¼Œä¸€ä¸ª Go ç¨‹åºæœ¬è´¨ä¸Šå°±æ˜¯ä¸€ç»„åŒ…çš„é›†åˆã€‚æ‰€æœ‰ Go ä»£ç éƒ½æœ‰è‡ªå·±éš¶å±çš„åŒ…ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬çš„â€œhelloï¼Œworldâ€ç¤ºä¾‹çš„æ‰€æœ‰ä»£ç éƒ½åœ¨ä¸€ä¸ªåä¸º main çš„åŒ…ä¸­ã€‚main åŒ…åœ¨ Go ä¸­æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„åŒ…ï¼Œæ•´ä¸ª Go ç¨‹åºä¸­ä»…å…è®¸å­˜åœ¨ä¸€ä¸ªåä¸º main çš„åŒ… main å‡½æ•° 1234func main() &#123; fmt.Println(&quot;hello, world&quot;)&#125; è¿™é‡Œçš„ main å‡½æ•°ä¼šæ¯”è¾ƒç‰¹æ®Šï¼šå½“ä½ è¿è¡Œä¸€ä¸ªå¯æ‰§è¡Œçš„ Go ç¨‹åºçš„æ—¶å€™ï¼Œæ‰€æœ‰çš„ä»£ç éƒ½ä¼šä»è¿™ä¸ªå…¥å£å‡½æ•°å¼€å§‹è¿è¡Œã€‚ import â€œfmtâ€ import â€œfmtâ€ ä¸€è¡Œä¸­â€œfmtâ€ä»£è¡¨çš„æ˜¯åŒ…çš„å¯¼å…¥è·¯å¾„ï¼ˆImportï¼‰ï¼Œå®ƒè¡¨ç¤ºçš„æ˜¯æ ‡å‡†åº“ä¸‹çš„ fmt ç›®å½•ï¼Œæ•´ä¸ª import å£°æ˜è¯­å¥çš„å«ä¹‰æ˜¯å¯¼å…¥æ ‡å‡†åº“ fmt ç›®å½•ä¸‹çš„åŒ…ï¼› fmt.Println å‡½æ•°è°ƒç”¨ä¸€è¡Œä¸­çš„â€œfmtâ€ä»£è¡¨çš„åˆ™æ˜¯åŒ…åã€‚ å¯¼å…¥å¤šä¸ªåŒ…å¯ä»¥ä½¿ç”¨åœ†æ‹¬å· 1234import ( &quot;fmt&quot; &quot;strings&quot;) Goè¯­è¨€ä¸­ç¨‹åºæ˜¯æ€ä¹ˆç¼–è¯‘çš„Go æ˜¯ä¸€ç§ç¼–è¯‘å‹è¯­è¨€ï¼Œè¿™æ„å‘³ç€åªæœ‰ä½ ç¼–è¯‘å®Œ Go ç¨‹åºä¹‹åï¼Œæ‰å¯ä»¥å°†ç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶äº¤ä»˜äºå…¶ä»–äººï¼Œå¹¶è¿è¡Œåœ¨æ²¡æœ‰å®‰è£… Go çš„ç¯å¢ƒä¸­ã€‚ 1go build main.go å½“ç„¶ï¼ŒGo ä¹Ÿå€Ÿé‰´äº†åŠ¨æ€è¯­è¨€çš„ä¸€äº›å¯¹å¼€å‘è€…ä½“éªŒè¾ƒå¥½çš„ç‰¹æ€§ï¼Œæ¯”å¦‚åŸºäºæºç æ–‡ä»¶çš„ç›´æ¥æ‰§è¡Œï¼ŒGo æä¾›äº† run å‘½ä»¤å¯ä»¥ç›´æ¥è¿è¡Œ Go æºç æ–‡ä»¶ï¼Œæ¯”å¦‚æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸‹é¢å‘½ä»¤ç›´æ¥åŸºäº main.go è¿è¡Œï¼š 1go run main.go å¤æ‚é¡¹ç›®ä¸‹Goç¨‹åºçš„ç¼–è¯‘æˆ‘ä»¬æ–°å»ºä¸€ä¸ªé¡¹ç›®: 1234$cd ~/goprojects$mkdir hellomodule$cd hellomodule åœ¨hellomoduleæ–‡ä»¶å¤¹ä¸­åˆ›å»ºå¹¶ç¼–è¾‘main.goæ–‡ä»¶ 123456789101112131415161718192021package mainimport ( &quot;github.com/valyala/fasthttp&quot; &quot;go.uber.org/zap&quot;)var logger *zap.Loggerfunc init() &#123; logger, _ = zap.NewProduction()&#125;func fastHTTPHandler(ctx *fasthttp.RequestCtx) &#123; logger.Info(&quot;hello, go module&quot;, zap.ByteString(&quot;uri&quot;, ctx.RequestURI()))&#125;func main() &#123; fasthttp.ListenAndServe(&quot;:9090&quot;, fastHTTPHandler)&#125; å¯¹äºå¤æ‚é¡¹ç›®çš„æ„å»ºï¼Œæˆ‘ä»¬é‡‡ç”¨ Go module Go module æ„å»ºæ¨¡å¼æ˜¯åœ¨ Go 1.11 ç‰ˆæœ¬æ­£å¼å¼•å…¥çš„ï¼Œä¸ºçš„æ˜¯å½»åº•è§£å†³ Go é¡¹ç›®å¤æ‚ç‰ˆæœ¬ä¾èµ–çš„é—®é¢˜ï¼Œåœ¨ Go 1.16 ç‰ˆæœ¬ä¸­ï¼ŒGo module å·²ç»æˆä¸ºäº† Go é»˜è®¤çš„åŒ…ä¾èµ–ç®¡ç†æœºåˆ¶å’Œ Go æºç æ„å»ºæœºåˆ¶ã€‚ Go Module çš„æ ¸å¿ƒæ˜¯ä¸€ä¸ªåä¸º go.mod çš„æ–‡ä»¶ï¼Œåœ¨è¿™ä¸ªæ–‡ä»¶ä¸­å­˜å‚¨äº†è¿™ä¸ª module å¯¹ç¬¬ä¸‰æ–¹ä¾èµ–çš„å…¨éƒ¨ä¿¡æ¯ã€‚ é€šè¿‡ initæ¥åˆ›å»ºgo.modæ–‡ä»¶: 12345$go mod init github.com/alexhuihui/hellomodulego: creating new go.mod: module github.com/bigwhite/hellomodulego: to add module requirements and sums: go mod tidy è®©æˆ‘ä»¬çœ‹çœ‹ç”Ÿæˆçš„go.modæ–‡ä»¶ä¸­æœ‰ä»€ä¹ˆ: 12345$cat go.modmodule github.com/alexhuihui/hellomodulego 1.17 å…¶å®ï¼Œä¸€ä¸ª module å°±æ˜¯ä¸€ä¸ªåŒ…çš„é›†åˆï¼Œè¿™äº›åŒ…å’Œ module ä¸€èµ·æ‰“ç‰ˆæœ¬ã€å‘å¸ƒå’Œåˆ†å‘ã€‚go.mod æ‰€åœ¨çš„ç›®å½•è¢«æˆ‘ä»¬ç§°ä¸ºå®ƒå£°æ˜çš„ module çš„æ ¹ç›®å½•ã€‚ä¸è¿‡å‘¢ï¼Œè¿™ä¸ªæ—¶å€™çš„ go.mod æ–‡ä»¶å†…å®¹è¿˜æ¯”è¾ƒç®€å•ï¼Œç¬¬ä¸€è¡Œå†…å®¹æ˜¯ç”¨äºå£°æ˜ module è·¯å¾„ï¼ˆmodule pathï¼‰çš„ã€‚è€Œä¸”ï¼Œmodule éšå«äº†ä¸€ä¸ªå‘½åç©ºé—´çš„æ¦‚å¿µï¼Œmodule ä¸‹æ¯ä¸ªåŒ…çš„å¯¼å…¥è·¯å¾„éƒ½æ˜¯ç”± module path å’ŒåŒ…æ‰€åœ¨å­ç›®å½•çš„åå­—ç»“åˆåœ¨ä¸€èµ·æ„æˆã€‚æ¯”å¦‚ï¼Œå¦‚æœ hellomodule ä¸‹æœ‰å­ç›®å½• pkg/pkg1ï¼Œé‚£ä¹ˆ pkg1 ä¸‹é¢çš„åŒ…çš„å¯¼å…¥è·¯å¾„å°±æ˜¯ç”± module pathï¼ˆgithub.com/alexhuihui/hellomoduleï¼‰å’ŒåŒ…æ‰€åœ¨å­ç›®å½•çš„åå­—ï¼ˆpkg/pkg1ï¼‰ç»“åˆè€Œæˆï¼Œä¹Ÿå°±æ˜¯ github.com/alexhuihui/hellomodule/pkg/pkg1ã€‚å¦å¤–ï¼Œgo.mod çš„æœ€åä¸€è¡Œæ˜¯ä¸€ä¸ª Go ç‰ˆæœ¬æŒ‡ç¤ºç¬¦ï¼Œç”¨äºè¡¨ç¤ºè¿™ä¸ª module æ˜¯åœ¨æŸä¸ªç‰¹å®šçš„ Go ç‰ˆæœ¬çš„ module è¯­ä¹‰çš„åŸºç¡€ä¸Šç¼–å†™çš„ã€‚ é€šè¿‡ go mod tidyï¼Œè®© Goå·¥å…·è‡ªåŠ¨æ·»åŠ ä¾èµ– 1234567891011121314151617181920$ go mod tidygo: finding module for package go.uber.org/zapgo: finding module for package github.com/valyala/fasthttpgo: downloading go.uber.org/zap v1.20.0go: downloading github.com/valyala/fasthttp v1.32.0go: found github.com/valyala/fasthttp in github.com/valyala/fasthttp v1.32.0go: found go.uber.org/zap in go.uber.org/zap v1.20.0go: downloading go.uber.org/atomic v1.7.0go: downloading go.uber.org/multierr v1.6.0go: downloading github.com/pkg/errors v0.8.1go: downloading github.com/stretchr/testify v1.7.0go: downloading go.uber.org/goleak v1.1.11go: downloading github.com/andybalholm/brotli v1.0.2go: downloading github.com/klauspost/compress v1.13.4go: downloading github.com/valyala/bytebufferpool v1.0.0go: downloading gopkg.in/yaml.v2 v2.2.8go: downloading github.com/davecgh/go-spew v1.1.1go: downloading github.com/pmezard/go-difflib v1.0.0go: downloading gopkg.in/yaml.v3 v3.0.0-20210107192922-496545a6307bgo: downloading github.com/benbjohnson/clock v1.1.0 ä¸‹è½½ä¾èµ–çš„æ—¶å€™ä½ å¯èƒ½ä¼šç¢°ä¸Šè¶…æ—¶çš„é—®é¢˜ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤å³å¯: 1$ go env -w GOPROXY=https://goproxy.cn,direct go mod tidyæ‰§è¡Œä¹‹åï¼Œgo.modå°±å˜æˆäº†è¿™ä¸ªæ ·å­: 12345678910111213141516module github.com/bigwhite/hellomodulego 1.17require ( github.com/valyala/fasthttp v1.32.0 go.uber.org/zap v1.20.0)require ( github.com/andybalholm/brotli v1.0.2 // indirect github.com/klauspost/compress v1.13.4 // indirect github.com/valyala/bytebufferpool v1.0.0 // indirect go.uber.org/atomic v1.7.0 // indirect go.uber.org/multierr v1.6.0 // indirect) è¿™ä¸ªæ—¶å€™ï¼Œgo.mod å·²ç»è®°å½•äº† hellomodule ç›´æ¥ä¾èµ–çš„åŒ…çš„ä¿¡æ¯ã€‚ä¸ä»…å¦‚æ­¤ï¼Œhellomodule ç›®å½•ä¸‹è¿˜å¤šäº†ä¸€ä¸ªåä¸º go.sum çš„æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶è®°å½•äº† hellomodule çš„ç›´æ¥ä¾èµ–å’Œé—´æ¥ä¾èµ–åŒ…çš„ç›¸å…³ç‰ˆæœ¬çš„ hash å€¼ï¼Œç”¨æ¥æ ¡éªŒæœ¬åœ°åŒ…çš„çœŸå®æ€§ã€‚åœ¨æ„å»ºçš„æ—¶å€™ï¼Œå¦‚æœæœ¬åœ°ä¾èµ–åŒ…çš„ hash å€¼ä¸ go.sum æ–‡ä»¶ä¸­è®°å½•çš„ä¸ä¸€è‡´ï¼Œå°±ä¼šè¢«æ‹’ç»æ„å»ºã€‚ æœ‰äº† go.mod ä»¥åŠ hellomodule ä¾èµ–çš„åŒ…ç‰ˆæœ¬ä¿¡æ¯åï¼Œæˆ‘ä»¬å†æ¥æ‰§è¡Œæ„å»ºï¼š 1234$go build main.go$lsgo.mod go.sum main main.go æˆåŠŸæ„å»ºåï¼Œæ‰§è¡Œmainå‘½ä»¤ï¼Œç„¶åæ–°å¼€ä¸€ä¸ªçª—å£æ‰§è¡Œcurl localhost:9090/foo/bar 123$ ./main &#123;&quot;level&quot;:&quot;info&quot;,&quot;ts&quot;:1643097830.6936307,&quot;caller&quot;:&quot;hellomodule/main.go:16&quot;,&quot;msg&quot;:&quot;hello, go module&quot;,&quot;uri&quot;:&quot;/foo/bar&quot;&#125; æ€»ç»“ Go åŒ…æ˜¯ Go è¯­è¨€çš„åŸºæœ¬ç»„æˆå•å…ƒã€‚ä¸€ä¸ª Go ç¨‹åºå°±æ˜¯ä¸€ç»„åŒ…çš„é›†åˆï¼Œæ‰€æœ‰ Go ä»£ç éƒ½ä½äºåŒ…ä¸­ï¼› Go æºç å¯ä»¥å¯¼å…¥å…¶ä»– Go åŒ…ï¼Œå¹¶ä½¿ç”¨å…¶ä¸­çš„å¯¼å‡ºè¯­æ³•å…ƒç´ ï¼ŒåŒ…æ‹¬ç±»å‹ã€å˜é‡ã€å‡½æ•°ã€æ–¹æ³•ç­‰ï¼Œè€Œä¸”ï¼Œmain å‡½æ•°æ˜¯æ•´ä¸ª Go åº”ç”¨çš„å…¥å£å‡½æ•°ï¼› Go æºç éœ€è¦å…ˆç¼–è¯‘ï¼Œå†åˆ†å‘å’Œè¿è¡Œã€‚å¦‚æœæ˜¯å• Go æºæ–‡ä»¶çš„æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨ go build å‘½ä»¤ +Go æºæ–‡ä»¶åçš„æ–¹å¼ç¼–è¯‘ã€‚ä¸è¿‡ï¼Œå¯¹äºå¤æ‚çš„ Go é¡¹ç›®ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ Go Module çš„å¸®åŠ©ä¸‹å®Œæˆé¡¹ç›®çš„æ„å»ºã€‚","tags":[{"name":"Go","slug":"Go","permalink":"https://alexhuihui.github.io/tags/Go/"}]},{"title":"ã€å¾®ä¿¡æœºå™¨äººã€‘(ä¸€)CentOS7å®‰è£…wechatyè¿è¡Œç¯å¢ƒ","date":"2022-01-24T11:08:45.000Z","path":"article/20220124.html","text":"å®‰è£…Node14.x è¿è¡ŒNode.jså®‰è£…ç¨‹åºè„šæœ¬ 123$ sudo yum -y install curl$ curl -sL https://rpm.nodesource.com/setup_14.x | sudo bash - åœ¨CentOS7ä¸Šå®‰è£…Node.js 14ç‰ˆæœ¬ 1$ sudo yum install -y nodejs æŸ¥çœ‹ç‰ˆæœ¬ 12$ node -v$ npm -v åˆ›å»ºå’Œåˆå§‹åŒ–ä½ çš„æœºå™¨äººé¡¹ç›®ï¼ˆnpm installï¼‰å› ä¸º PadLocal ä½¿ç”¨çš„æŸäº›ä¾èµ–ï¼ˆç‰¹åˆ«æ˜¯ better-sqlite3ï¼‰æ˜¯ node native moduleã€‚æ‰€ä»¥ npm install ä¼šé€šè¿‡ gyp ç¼–è¯‘é¡¹ç›®ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­ä¸åŒå¹³å°ä¸Šå¯èƒ½å‡ºç°é”™è¯¯ã€‚ centoså®‰è£… Build Tools 1$ sudo yum groupinstall &quot;Development Tools&quot; centoså‡çº§gccç‰ˆæœ¬ å®‰è£…ä¾èµ– 1234mkdir node-wechat &amp;&amp; cd node-wechatnpm init -ynpm install ts-node typescript -g --registry=https://r.npm.taobao.orgtsc --init --target ES6 ç¼–å†™demo 1234567891011121314151617181920212223242526272829303132333435363738// bot.tsimport &#123;PuppetPadlocal&#125; from &quot;wechaty-puppet-padlocal&quot;;import &#123;Contact, Message, ScanStatus, Wechaty&#125; from &quot;wechaty&quot;;const token: string = &quot;&quot; // padlocal tokenconst puppet = new PuppetPadlocal(&#123; token &#125;)const bot = new Wechaty(&#123; name: &quot;TestBot&quot;, puppet,&#125;)bot.on(&quot;scan&quot;, (qrcode: string, status: ScanStatus) =&gt; &#123; if (status === ScanStatus.Waiting &amp;&amp; qrcode) &#123; const qrcodeImageUrl = [&quot;https://api.qrserver.com/v1/create-qr-code/?data=&quot;, encodeURIComponent(qrcode)].join(&quot;&quot;); console.log(`onScan: $&#123;ScanStatus[status]&#125;($&#123;status&#125;) - $&#123;qrcodeImageUrl&#125;`); &#125; else &#123; console.log(`onScan: $&#123;ScanStatus[status]&#125;($&#123;status&#125;)`); &#125;&#125;).on(&quot;login&quot;, (user: Contact) =&gt; &#123; console.log(`$&#123;user&#125; login`);&#125;).on(&quot;logout&quot;, (user: Contact) =&gt; &#123; console.log(`$&#123;user&#125; logout`);&#125;).on(&quot;message&quot;, async (message: Message) =&gt; &#123; console.log(`on message: $&#123;message.toString()&#125;`);&#125;).start()console.log(&quot;TestBot&quot;, &quot;started&quot;); è¿è¡Œdemo 1ts-node bot.ts","tags":[{"name":"node","slug":"node","permalink":"https://alexhuihui.github.io/tags/node/"},{"name":"å¾®ä¿¡æœºå™¨äºº","slug":"å¾®ä¿¡æœºå™¨äºº","permalink":"https://alexhuihui.github.io/tags/%E5%BE%AE%E4%BF%A1%E6%9C%BA%E5%99%A8%E4%BA%BA/"},{"name":"gcc","slug":"gcc","permalink":"https://alexhuihui.github.io/tags/gcc/"}]},{"title":"ã€Javaã€‘æ·±å…¥è§£æThreadLocal","date":"2022-01-20T06:21:42.000Z","path":"article/20220120.html","text":"æ— è®ºæ˜¯è½»é‡çº§çš„Atomicã€volatileï¼Œè¿˜æ˜¯synchronizedï¼Œå…¶å®éƒ½æ˜¯é‡‡ç”¨åŒæ­¥çš„æ–¹å¼è§£å†³äº†çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚è¿˜æœ‰å¦å¤–ä¸€ç§è§£å†³çº¿ç¨‹å®‰å…¨é—®é¢˜çš„æ€è·¯ï¼Œçº¿ç¨‹å°é—­ã€‚ å¦‚æœä½ æœ‰ä¸€ä¸ªå…¨å±€å…±äº«çš„å˜é‡ï¼Œé‚£ä¹ˆå¤šçº¿ç¨‹å¹¶å‘çš„æ—¶å€™ï¼Œå¯¹è¿™ä¸ªå…±äº«å˜é‡çš„è®¿é—®æ˜¯ä¸å®‰å…¨çš„ã€‚æ–¹æ³•å†…çš„å±€éƒ¨å˜é‡æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œç”±äºæ¯ä¸ªçº¿ç¨‹éƒ½ä¼šæœ‰è‡ªå·±çš„å‰¯æœ¬ã€‚ä¹Ÿå°±æ˜¯è¯´å±€éƒ¨å˜é‡è¢«å°é—­åœ¨çº¿ç¨‹å†…éƒ¨ï¼Œå…¶å®ƒçº¿ç¨‹æ— æ³•è®¿é—®ï¼ˆå¼•ç”¨å‹æœ‰æ‰€åŒºåˆ«ï¼‰ã€‚é‚£ä¹ˆæœ‰æ²¡æœ‰ä½œç”¨åŸŸä»‹äºä¸¤è€…ä¹‹é—´ï¼Œæ—¢èƒ½ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œåˆä¸è‡³äºåªå±€é™äºæ–¹æ³•å†…éƒ¨çš„æ–¹å¼å‘¢ï¼Ÿ ç­”æ¡ˆæ˜¯è‚¯å®šçš„ï¼Œæˆ‘ä»¬ä½¿ç”¨ThreadLocalå°±å¯ä»¥åšåˆ°è¿™ä¸€ç‚¹ã€‚ThreadLocalå˜é‡çš„ä½œç”¨åŸŸæ˜¯ä¸ºçº¿ç¨‹ï¼Œä¹Ÿå°±æ˜¯è¯´çº¿ç¨‹å†…è·¨æ–¹æ³•å…±äº«ã€‚ä¾‹å¦‚æŸä¸ªå¯¹è±¡çš„æ–¹æ³•Aå¯¹threadLocalå˜é‡èµ‹å€¼ï¼Œåœ¨åŒä¸€ä¸ªçº¿ç¨‹ä¸­çš„å¦å¤–ä¸€ä¸ªå¯¹è±¡çš„æ–¹æ³•Bèƒ½å¤Ÿè¯»å–åˆ°è¯¥å€¼ã€‚å› ä¸ºä½œç”¨åŸŸä¸ºåŒä¸€ä¸ªçº¿ç¨‹ï¼Œé‚£ä¹ˆè‡ªç„¶å°±æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœthreadLocalå­˜å‚¨çš„æ˜¯å…±äº«å˜é‡çš„å¼•ç”¨ï¼Œé‚£ä¹ˆåŒæ ·ä¼šæœ‰çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚","tags":[{"name":"å¤šçº¿ç¨‹","slug":"å¤šçº¿ç¨‹","permalink":"https://alexhuihui.github.io/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"}]},{"title":"ã€MySQLã€‘MySQL booleanç±»å‹","date":"2022-01-17T11:12:49.000Z","path":"article/20220117.html","text":"MySQL BOOLEANæ•°æ®ç±»å‹MySQLæ²¡æœ‰å†…ç½®çš„å¸ƒå°”ç±»å‹ã€‚ ä½†æ˜¯å®ƒä½¿ç”¨TINYINT(1)ã€‚ ä¸ºäº†æ›´æ–¹ä¾¿ï¼ŒMySQLæä¾›BOOLEANæˆ–BOOLä½œä¸ºTINYINT(1)çš„åŒä¹‰è¯ã€‚åœ¨MySQLä¸­ï¼Œ0è¢«è®¤ä¸ºæ˜¯falseï¼Œéé›¶å€¼è¢«è®¤ä¸ºæ˜¯trueã€‚ MySQL BOOLEANç¤ºä¾‹MySQLå°†å¸ƒå°”å€¼ä½œä¸ºæ•´æ•°å­˜å‚¨åœ¨è¡¨ä¸­ï¼Œæˆ‘ä»¬å»ºç«‹ä¸€å¼ tasksè¡¨æ¥ä½œä¸ºç¤ºä¾‹å±•ç¤ºã€‚ 12345CREATE TABLE tasks ( id INT PRIMARY KEY AUTO_INCREMENT, title VARCHAR(255) NOT NULL, completed BOOLEAN); æˆ‘ä»¬åœ¨å»ºè¡¨è¯­å¥ä¸­å°† completedè®¾ä¸ºbooleanç±»å‹ï¼Œä½†æ˜¯å±•ç¤ºè¡¨ç»“æ„çš„æ—¶å€™å®ƒä¼šå˜ä¸º tinyint(1)ã€‚ 123456CREATE TABLE `tasks` ( `id` int(11) NOT NULL AUTO_INCREMENT, `title` varchar(255) NOT NULL, `completed` tinyint(1) DEFAULT NULL, PRIMARY KEY (`id`)) ENGINE=InnoDB AUTO_INCREMENT=5 DEFAULT CHARSET=utf8mb4; æˆ‘ä»¬å‘è¡¨ä¸­æ’å…¥ä¸¤æ¡æ•°æ® 12INSERT INTO `Test`.`tasks` (`id`, `title`, `completed`) VALUES (2, &#x27;æµ‹è¯•&#x27;, true);INSERT INTO `Test`.`tasks` (`id`, `title`, `completed`) VALUES (3, &#x27;æµ‹è¯•2&#x27;, false); MySQLä¼šåœ¨å­˜å‚¨æ•°æ®ä¹‹å‰ï¼ŒæŠŠtrueå’Œfalseè½¬æ¢æˆ1å’Œ2å†ä¿å­˜ï¼Œä¸‹å›¾æ˜¯æŸ¥è¯¢ç»“æœ å› ä¸ºBooleanç±»å‹æ˜¯tinyint(1)çš„åŒä¹‰è¯ï¼Œæ‰€ä»¥å¯ä»¥åœ¨å¸ƒå°”åˆ—ä¸­æ’å…¥1å’Œ0ä»¥å¤–çš„å€¼ã€‚å¦‚ä¸‹ç¤ºä¾‹ï¼š 12INSERT INTO `Test`.`tasks` (`id`, `title`, `completed`) VALUES (1, &#x27;æ‰“ç®—&#x27;, NULL);INSERT INTO `Test`.`tasks` (`id`, `title`, `completed`) VALUES (4, &#x27;MySQL&#x27;, 2); ç°åœ¨è¡¨ä¸­çš„æ•°æ®å¦‚ä¸‹: å¦‚æœè¦å°†ç»“æœè¾“å‡ºä¸ºtrueå’Œfalseï¼Œå¯ä»¥ä½¿ç”¨IFå‡½æ•°ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š 123456SELECT id, title, IF(completed, &#x27;true&#x27;, &#x27;false&#x27;) completedFROM tasks; æ‰§è¡Œä»¥ä¸Šè¯­å¥ï¼Œç»“æœå¦‚ä¸‹ MySQL BOOLEANè¿ç®—ç¬¦å¦‚æœä½ æƒ³æŸ¥è¯¢è¡¨ä¸­æ‰€æœ‰ completedä¸ºtrueçš„æ•°æ®ï¼Œé‚£ä¹ˆå°±åº”è¯¥ä½¿ç”¨ISè¿ç®—ç¬¦è€Œä¸æ˜¯= 123456SELECT id, title, completedFROM tasksWHERE completed = TRUE æ‰§è¡Œä»¥ä¸Šè¯­å¥ï¼Œç»“æœå¦‚ä¸‹: å®ƒåªè¿”å›completedåˆ—å€¼ä¸º1çš„æ•°æ®ï¼Œè¦æƒ³è¿”å›æ‰€æœ‰ä¸ºtrueçš„åˆ™å¿…é¡»ä½¿ç”¨ ISè¿ç®—ç¬¦ 123456SELECT id, title, completedFROM tasksWHERE completed IS TRUE; æ‰§è¡Œç»“æœ: å½“ç„¶ä½ è¿˜å¯ä»¥ä½¿ç”¨ IS FALSE æˆ–è€…IS NOT TRUEï¼Œæ¥æŸ¥è¯¢æ‰€æœ‰å¾…å¤„ç†çš„æ•°æ®ã€‚å¿…é¡»æ³¨æ„çš„æ˜¯ï¼Œå‰è€…åªèƒ½æŸ¥è¯¢å‡ºcompletedç­‰äº0çš„æ•°æ®ï¼Œåè€…è¿˜å¯ä»¥æŸ¥è¯¢å‡ºcompletedç­‰äºnullçš„æ•°æ®ã€‚","tags":[{"name":"MySQL","slug":"MySQL","permalink":"https://alexhuihui.github.io/tags/MySQL/"}]},{"title":"ã€RocketMqã€‘rocketmqæ¦‚å¿µå’Œç‰¹æ€§","date":"2022-01-07T03:53:49.000Z","path":"article/20220107.html","text":"åŸºæœ¬æ¦‚å¿µ 1 æ¶ˆæ¯æ¨¡å‹ï¼ˆMessage Modelï¼‰RocketMQä¸»è¦ç”± Producerã€Brokerã€Consumer ä¸‰éƒ¨åˆ†ç»„æˆï¼Œå…¶ä¸­Producer è´Ÿè´£ç”Ÿäº§æ¶ˆæ¯ï¼ŒConsumer è´Ÿè´£æ¶ˆè´¹æ¶ˆæ¯ï¼ŒBroker è´Ÿè´£å­˜å‚¨æ¶ˆæ¯ã€‚Broker åœ¨å®é™…éƒ¨ç½²è¿‡ç¨‹ä¸­å¯¹åº”ä¸€å°æœåŠ¡å™¨ï¼Œæ¯ä¸ª Broker å¯ä»¥å­˜å‚¨å¤šä¸ªTopicçš„æ¶ˆæ¯ï¼Œæ¯ä¸ªTopicçš„æ¶ˆæ¯ä¹Ÿå¯ä»¥åˆ†ç‰‡å­˜å‚¨äºä¸åŒçš„ Brokerã€‚Message Queue ç”¨äºå­˜å‚¨æ¶ˆæ¯çš„ç‰©ç†åœ°å€ï¼Œæ¯ä¸ªTopicä¸­çš„æ¶ˆæ¯åœ°å€å­˜å‚¨äºå¤šä¸ª Message Queue ä¸­ã€‚ConsumerGroup ç”±å¤šä¸ªConsumer å®ä¾‹æ„æˆã€‚ 2 æ¶ˆæ¯ç”Ÿäº§è€…ï¼ˆProducerï¼‰è´Ÿè´£ç”Ÿäº§æ¶ˆæ¯ï¼Œä¸€èˆ¬ç”±ä¸šåŠ¡ç³»ç»Ÿè´Ÿè´£ç”Ÿäº§æ¶ˆæ¯ã€‚ä¸€ä¸ªæ¶ˆæ¯ç”Ÿäº§è€…ä¼šæŠŠä¸šåŠ¡åº”ç”¨ç³»ç»Ÿé‡Œäº§ç”Ÿçš„æ¶ˆæ¯å‘é€åˆ°brokeræœåŠ¡å™¨ã€‚RocketMQæä¾›å¤šç§å‘é€æ–¹å¼ï¼ŒåŒæ­¥å‘é€ã€å¼‚æ­¥å‘é€ã€é¡ºåºå‘é€ã€å•å‘å‘é€ã€‚åŒæ­¥å’Œå¼‚æ­¥æ–¹å¼å‡éœ€è¦Brokerè¿”å›ç¡®è®¤ä¿¡æ¯ï¼Œå•å‘å‘é€ä¸éœ€è¦ã€‚ 3 æ¶ˆæ¯æ¶ˆè´¹è€…ï¼ˆConsumerï¼‰è´Ÿè´£æ¶ˆè´¹æ¶ˆæ¯ï¼Œä¸€èˆ¬æ˜¯åå°ç³»ç»Ÿè´Ÿè´£å¼‚æ­¥æ¶ˆè´¹ã€‚ä¸€ä¸ªæ¶ˆæ¯æ¶ˆè´¹è€…ä¼šä»BrokeræœåŠ¡å™¨æ‹‰å–æ¶ˆæ¯ã€å¹¶å°†å…¶æä¾›ç»™åº”ç”¨ç¨‹åºã€‚ä»ç”¨æˆ·åº”ç”¨çš„è§’åº¦è€Œè¨€æä¾›äº†ä¸¤ç§æ¶ˆè´¹å½¢å¼ï¼šæ‹‰å–å¼æ¶ˆè´¹ã€æ¨åŠ¨å¼æ¶ˆè´¹ã€‚ 4 ä¸»é¢˜ï¼ˆTopicï¼‰è¡¨ç¤ºä¸€ç±»æ¶ˆæ¯çš„é›†åˆï¼Œæ¯ä¸ªä¸»é¢˜åŒ…å«è‹¥å¹²æ¡æ¶ˆæ¯ï¼Œæ¯æ¡æ¶ˆæ¯åªèƒ½å±äºä¸€ä¸ªä¸»é¢˜ï¼Œæ˜¯RocketMQè¿›è¡Œæ¶ˆæ¯è®¢é˜…çš„åŸºæœ¬å•ä½ã€‚ 5 ä»£ç†æœåŠ¡å™¨ï¼ˆBroker Serverï¼‰æ¶ˆæ¯ä¸­è½¬è§’è‰²ï¼Œè´Ÿè´£å­˜å‚¨æ¶ˆæ¯ã€è½¬å‘æ¶ˆæ¯ã€‚ä»£ç†æœåŠ¡å™¨åœ¨RocketMQç³»ç»Ÿä¸­è´Ÿè´£æ¥æ”¶ä»ç”Ÿäº§è€…å‘é€æ¥çš„æ¶ˆæ¯å¹¶å­˜å‚¨ã€åŒæ—¶ä¸ºæ¶ˆè´¹è€…çš„æ‹‰å–è¯·æ±‚ä½œå‡†å¤‡ã€‚ä»£ç†æœåŠ¡å™¨ä¹Ÿå­˜å‚¨æ¶ˆæ¯ç›¸å…³çš„å…ƒæ•°æ®ï¼ŒåŒ…æ‹¬æ¶ˆè´¹è€…ç»„ã€æ¶ˆè´¹è¿›åº¦åç§»å’Œä¸»é¢˜å’Œé˜Ÿåˆ—æ¶ˆæ¯ç­‰ã€‚ 6 åå­—æœåŠ¡ï¼ˆName Serverï¼‰åç§°æœåŠ¡å……å½“è·¯ç”±æ¶ˆæ¯çš„æä¾›è€…ã€‚ç”Ÿäº§è€…æˆ–æ¶ˆè´¹è€…èƒ½å¤Ÿé€šè¿‡åå­—æœåŠ¡æŸ¥æ‰¾å„ä¸»é¢˜ç›¸åº”çš„Broker IPåˆ—è¡¨ã€‚å¤šä¸ªNamesrvå®ä¾‹ç»„æˆé›†ç¾¤ï¼Œä½†ç›¸äº’ç‹¬ç«‹ï¼Œæ²¡æœ‰ä¿¡æ¯äº¤æ¢ã€‚ 7 æ‹‰å–å¼æ¶ˆè´¹ï¼ˆPull Consumerï¼‰Consumeræ¶ˆè´¹çš„ä¸€ç§ç±»å‹ï¼Œåº”ç”¨é€šå¸¸ä¸»åŠ¨è°ƒç”¨Consumerçš„æ‹‰æ¶ˆæ¯æ–¹æ³•ä»BrokeræœåŠ¡å™¨æ‹‰æ¶ˆæ¯ã€ä¸»åŠ¨æƒç”±åº”ç”¨æ§åˆ¶ã€‚ä¸€æ—¦è·å–äº†æ‰¹é‡æ¶ˆæ¯ï¼Œåº”ç”¨å°±ä¼šå¯åŠ¨æ¶ˆè´¹è¿‡ç¨‹ã€‚ 8 æ¨åŠ¨å¼æ¶ˆè´¹ï¼ˆPush Consumerï¼‰Consumeræ¶ˆè´¹çš„ä¸€ç§ç±»å‹ï¼Œè¯¥æ¨¡å¼ä¸‹Brokeræ”¶åˆ°æ•°æ®åä¼šä¸»åŠ¨æ¨é€ç»™æ¶ˆè´¹ç«¯ï¼Œè¯¥æ¶ˆè´¹æ¨¡å¼ä¸€èˆ¬å®æ—¶æ€§è¾ƒé«˜ã€‚ 9 ç”Ÿäº§è€…ç»„ï¼ˆProducer Groupï¼‰åŒä¸€ç±»Producerçš„é›†åˆï¼Œè¿™ç±»Producerå‘é€åŒä¸€ç±»æ¶ˆæ¯ä¸”å‘é€é€»è¾‘ä¸€è‡´ã€‚å¦‚æœå‘é€çš„æ˜¯äº‹åŠ¡æ¶ˆæ¯ä¸”åŸå§‹ç”Ÿäº§è€…åœ¨å‘é€ä¹‹åå´©æºƒï¼Œåˆ™BrokeræœåŠ¡å™¨ä¼šè”ç³»åŒä¸€ç”Ÿäº§è€…ç»„çš„å…¶ä»–ç”Ÿäº§è€…å®ä¾‹ä»¥æäº¤æˆ–å›æº¯æ¶ˆè´¹ã€‚ 10 æ¶ˆè´¹è€…ç»„ï¼ˆConsumer Groupï¼‰åŒä¸€ç±»Consumerçš„é›†åˆï¼Œè¿™ç±»Consumeré€šå¸¸æ¶ˆè´¹åŒä¸€ç±»æ¶ˆæ¯ä¸”æ¶ˆè´¹é€»è¾‘ä¸€è‡´ã€‚æ¶ˆè´¹è€…ç»„ä½¿å¾—åœ¨æ¶ˆæ¯æ¶ˆè´¹æ–¹é¢ï¼Œå®ç°è´Ÿè½½å‡è¡¡å’Œå®¹é”™çš„ç›®æ ‡å˜å¾—éå¸¸å®¹æ˜“ã€‚è¦æ³¨æ„çš„æ˜¯ï¼Œæ¶ˆè´¹è€…ç»„çš„æ¶ˆè´¹è€…å®ä¾‹å¿…é¡»è®¢é˜…å®Œå…¨ç›¸åŒçš„Topicã€‚RocketMQ æ”¯æŒä¸¤ç§æ¶ˆæ¯æ¨¡å¼ï¼šé›†ç¾¤æ¶ˆè´¹ï¼ˆClusteringï¼‰å’Œå¹¿æ’­æ¶ˆè´¹ï¼ˆBroadcastingï¼‰ã€‚ 11 é›†ç¾¤æ¶ˆè´¹ï¼ˆClusteringï¼‰é›†ç¾¤æ¶ˆè´¹æ¨¡å¼ä¸‹,ç›¸åŒConsumer Groupçš„æ¯ä¸ªConsumerå®ä¾‹å¹³å‡åˆ†æ‘Šæ¶ˆæ¯ã€‚ 12 å¹¿æ’­æ¶ˆè´¹ï¼ˆBroadcastingï¼‰å¹¿æ’­æ¶ˆè´¹æ¨¡å¼ä¸‹ï¼Œç›¸åŒConsumer Groupçš„æ¯ä¸ªConsumerå®ä¾‹éƒ½æ¥æ”¶å…¨é‡çš„æ¶ˆæ¯ã€‚ 13 æ™®é€šé¡ºåºæ¶ˆæ¯ï¼ˆNormal Ordered Messageï¼‰æ™®é€šé¡ºåºæ¶ˆè´¹æ¨¡å¼ä¸‹ï¼Œæ¶ˆè´¹è€…é€šè¿‡åŒä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ï¼ˆ Topic åˆ†åŒºï¼Œç§°ä½œ Message Queueï¼‰ æ”¶åˆ°çš„æ¶ˆæ¯æ˜¯æœ‰é¡ºåºçš„ï¼Œä¸åŒæ¶ˆæ¯é˜Ÿåˆ—æ”¶åˆ°çš„æ¶ˆæ¯åˆ™å¯èƒ½æ˜¯æ— é¡ºåºçš„ã€‚ 14 ä¸¥æ ¼é¡ºåºæ¶ˆæ¯ï¼ˆStrictly Ordered Messageï¼‰ä¸¥æ ¼é¡ºåºæ¶ˆæ¯æ¨¡å¼ä¸‹ï¼Œæ¶ˆè´¹è€…æ”¶åˆ°çš„æ‰€æœ‰æ¶ˆæ¯å‡æ˜¯æœ‰é¡ºåºçš„ã€‚ 15 æ¶ˆæ¯ï¼ˆMessageï¼‰æ¶ˆæ¯ç³»ç»Ÿæ‰€ä¼ è¾“ä¿¡æ¯çš„ç‰©ç†è½½ä½“ï¼Œç”Ÿäº§å’Œæ¶ˆè´¹æ•°æ®çš„æœ€å°å•ä½ï¼Œæ¯æ¡æ¶ˆæ¯å¿…é¡»å±äºä¸€ä¸ªä¸»é¢˜ã€‚RocketMQä¸­æ¯ä¸ªæ¶ˆæ¯æ‹¥æœ‰å”¯ä¸€çš„Message IDï¼Œä¸”å¯ä»¥æºå¸¦å…·æœ‰ä¸šåŠ¡æ ‡è¯†çš„Keyã€‚ç³»ç»Ÿæä¾›äº†é€šè¿‡Message IDå’ŒKeyæŸ¥è¯¢æ¶ˆæ¯çš„åŠŸèƒ½ã€‚ 16 æ ‡ç­¾ï¼ˆTagï¼‰ä¸ºæ¶ˆæ¯è®¾ç½®çš„æ ‡å¿—ï¼Œç”¨äºåŒä¸€ä¸»é¢˜ä¸‹åŒºåˆ†ä¸åŒç±»å‹çš„æ¶ˆæ¯ã€‚æ¥è‡ªåŒä¸€ä¸šåŠ¡å•å…ƒçš„æ¶ˆæ¯ï¼Œå¯ä»¥æ ¹æ®ä¸åŒä¸šåŠ¡ç›®çš„åœ¨åŒä¸€ä¸»é¢˜ä¸‹è®¾ç½®ä¸åŒæ ‡ç­¾ã€‚æ ‡ç­¾èƒ½å¤Ÿæœ‰æ•ˆåœ°ä¿æŒä»£ç çš„æ¸…æ™°åº¦å’Œè¿è´¯æ€§ï¼Œå¹¶ä¼˜åŒ–RocketMQæä¾›çš„æŸ¥è¯¢ç³»ç»Ÿã€‚æ¶ˆè´¹è€…å¯ä»¥æ ¹æ®Tagå®ç°å¯¹ä¸åŒå­ä¸»é¢˜çš„ä¸åŒæ¶ˆè´¹é€»è¾‘ï¼Œå®ç°æ›´å¥½çš„æ‰©å±•æ€§ã€‚ ç‰¹æ€§(features) 1 è®¢é˜…ä¸å‘å¸ƒæ¶ˆæ¯çš„å‘å¸ƒæ˜¯æŒ‡æŸä¸ªç”Ÿäº§è€…å‘æŸä¸ªtopicå‘é€æ¶ˆæ¯ï¼›æ¶ˆæ¯çš„è®¢é˜…æ˜¯æŒ‡æŸä¸ªæ¶ˆè´¹è€…å…³æ³¨äº†æŸä¸ªtopicä¸­å¸¦æœ‰æŸäº›tagçš„æ¶ˆæ¯ï¼Œè¿›è€Œä»è¯¥topicæ¶ˆè´¹æ•°æ®ã€‚ 2 æ¶ˆæ¯é¡ºåºæ¶ˆæ¯æœ‰åºæŒ‡çš„æ˜¯ä¸€ç±»æ¶ˆæ¯æ¶ˆè´¹æ—¶ï¼Œèƒ½æŒ‰ç…§å‘é€çš„é¡ºåºæ¥æ¶ˆè´¹ã€‚ä¾‹å¦‚ï¼šä¸€ä¸ªè®¢å•äº§ç”Ÿäº†ä¸‰æ¡æ¶ˆæ¯åˆ†åˆ«æ˜¯è®¢å•åˆ›å»ºã€è®¢å•ä»˜æ¬¾ã€è®¢å•å®Œæˆã€‚æ¶ˆè´¹æ—¶è¦æŒ‰ç…§è¿™ä¸ªé¡ºåºæ¶ˆè´¹æ‰èƒ½æœ‰æ„ä¹‰ï¼Œä½†æ˜¯åŒæ—¶è®¢å•ä¹‹é—´æ˜¯å¯ä»¥å¹¶è¡Œæ¶ˆè´¹çš„ã€‚RocketMQå¯ä»¥ä¸¥æ ¼çš„ä¿è¯æ¶ˆæ¯æœ‰åºã€‚ é¡ºåºæ¶ˆæ¯åˆ†ä¸ºå…¨å±€é¡ºåºæ¶ˆæ¯ä¸åˆ†åŒºé¡ºåºæ¶ˆæ¯ï¼Œå…¨å±€é¡ºåºæ˜¯æŒ‡æŸä¸ªTopicä¸‹çš„æ‰€æœ‰æ¶ˆæ¯éƒ½è¦ä¿è¯é¡ºåºï¼›éƒ¨åˆ†é¡ºåºæ¶ˆæ¯åªè¦ä¿è¯æ¯ä¸€ç»„æ¶ˆæ¯è¢«é¡ºåºæ¶ˆè´¹å³å¯ã€‚ å…¨å±€é¡ºåº å¯¹äºæŒ‡å®šçš„ä¸€ä¸ª Topicï¼Œæ‰€æœ‰æ¶ˆæ¯æŒ‰ç…§ä¸¥æ ¼çš„å…ˆå…¥å…ˆå‡ºï¼ˆFIFOï¼‰çš„é¡ºåºè¿›è¡Œå‘å¸ƒå’Œæ¶ˆè´¹ã€‚ é€‚ç”¨åœºæ™¯ï¼šæ€§èƒ½è¦æ±‚ä¸é«˜ï¼Œæ‰€æœ‰çš„æ¶ˆæ¯ä¸¥æ ¼æŒ‰ç…§ FIFO åŸåˆ™è¿›è¡Œæ¶ˆæ¯å‘å¸ƒå’Œæ¶ˆè´¹çš„åœºæ™¯ åˆ†åŒºé¡ºåº å¯¹äºæŒ‡å®šçš„ä¸€ä¸ª Topicï¼Œæ‰€æœ‰æ¶ˆæ¯æ ¹æ® sharding key è¿›è¡ŒåŒºå—åˆ†åŒºã€‚ åŒä¸€ä¸ªåˆ†åŒºå†…çš„æ¶ˆæ¯æŒ‰ç…§ä¸¥æ ¼çš„ FIFO é¡ºåºè¿›è¡Œå‘å¸ƒå’Œæ¶ˆè´¹ã€‚ Sharding key æ˜¯é¡ºåºæ¶ˆæ¯ä¸­ç”¨æ¥åŒºåˆ†ä¸åŒåˆ†åŒºçš„å…³é”®å­—æ®µï¼Œå’Œæ™®é€šæ¶ˆæ¯çš„ Key æ˜¯å®Œå…¨ä¸åŒçš„æ¦‚å¿µã€‚ é€‚ç”¨åœºæ™¯ï¼šæ€§èƒ½è¦æ±‚é«˜ï¼Œä»¥ sharding key ä½œä¸ºåˆ†åŒºå­—æ®µï¼Œåœ¨åŒä¸€ä¸ªåŒºå—ä¸­ä¸¥æ ¼çš„æŒ‰ç…§ FIFO åŸåˆ™è¿›è¡Œæ¶ˆæ¯å‘å¸ƒå’Œæ¶ˆè´¹çš„åœºæ™¯ã€‚ 3 æ¶ˆæ¯è¿‡æ»¤ RocketMQçš„æ¶ˆè´¹è€…å¯ä»¥æ ¹æ®Tagè¿›è¡Œæ¶ˆæ¯è¿‡æ»¤ï¼Œä¹Ÿæ”¯æŒè‡ªå®šä¹‰å±æ€§è¿‡æ»¤ã€‚æ¶ˆæ¯è¿‡æ»¤ç›®å‰æ˜¯åœ¨Brokerç«¯å®ç°çš„ï¼Œä¼˜ç‚¹æ˜¯å‡å°‘äº†å¯¹äºConsumeræ— ç”¨æ¶ˆæ¯çš„ç½‘ç»œä¼ è¾“ï¼Œç¼ºç‚¹æ˜¯å¢åŠ äº†Brokerçš„è´Ÿæ‹…ã€è€Œä¸”å®ç°ç›¸å¯¹å¤æ‚ã€‚ 4 æ¶ˆæ¯å¯é æ€§ RocketMQæ”¯æŒæ¶ˆæ¯çš„é«˜å¯é ï¼Œå½±å“æ¶ˆæ¯å¯é æ€§çš„å‡ ç§æƒ…å†µï¼š 1) Brokeréæ­£å¸¸å…³é—­ 2) Brokerå¼‚å¸¸Crash 3) OS Crash 4) æœºå™¨æ‰ç”µï¼Œä½†æ˜¯èƒ½ç«‹å³æ¢å¤ä¾›ç”µæƒ…å†µ 5) æœºå™¨æ— æ³•å¼€æœºï¼ˆå¯èƒ½æ˜¯cpuã€ä¸»æ¿ã€å†…å­˜ç­‰å…³é”®è®¾å¤‡æŸåï¼‰ 6) ç£ç›˜è®¾å¤‡æŸå 1)ã€2)ã€3)ã€4) å››ç§æƒ…å†µéƒ½å±äºç¡¬ä»¶èµ„æºå¯ç«‹å³æ¢å¤æƒ…å†µï¼ŒRocketMQåœ¨è¿™å››ç§æƒ…å†µä¸‹èƒ½ä¿è¯æ¶ˆæ¯ä¸ä¸¢ï¼Œæˆ–è€…ä¸¢å¤±å°‘é‡æ•°æ®ï¼ˆä¾èµ–åˆ·ç›˜æ–¹å¼æ˜¯åŒæ­¥è¿˜æ˜¯å¼‚æ­¥ï¼‰ã€‚ 5)ã€6)å±äºå•ç‚¹æ•…éšœï¼Œä¸”æ— æ³•æ¢å¤ï¼Œä¸€æ—¦å‘ç”Ÿï¼Œåœ¨æ­¤å•ç‚¹ä¸Šçš„æ¶ˆæ¯å…¨éƒ¨ä¸¢å¤±ã€‚RocketMQåœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹ï¼Œé€šè¿‡å¼‚æ­¥å¤åˆ¶ï¼Œå¯ä¿è¯99%çš„æ¶ˆæ¯ä¸ä¸¢ï¼Œä½†æ˜¯ä»ç„¶ä¼šæœ‰æå°‘é‡çš„æ¶ˆæ¯å¯èƒ½ä¸¢å¤±ã€‚é€šè¿‡åŒæ­¥åŒå†™æŠ€æœ¯å¯ä»¥å®Œå…¨é¿å…å•ç‚¹ï¼ŒåŒæ­¥åŒå†™åŠ¿å¿…ä¼šå½±å“æ€§èƒ½ï¼Œé€‚åˆå¯¹æ¶ˆæ¯å¯é æ€§è¦æ±‚æé«˜çš„åœºåˆï¼Œä¾‹å¦‚ä¸Moneyç›¸å…³çš„åº”ç”¨ã€‚æ³¨ï¼šRocketMQä»3.0ç‰ˆæœ¬å¼€å§‹æ”¯æŒåŒæ­¥åŒå†™ã€‚ 5 è‡³å°‘ä¸€æ¬¡è‡³å°‘ä¸€æ¬¡(At least Once)æŒ‡æ¯ä¸ªæ¶ˆæ¯å¿…é¡»æŠ•é€’ä¸€æ¬¡ã€‚Consumerå…ˆPullæ¶ˆæ¯åˆ°æœ¬åœ°ï¼Œæ¶ˆè´¹å®Œæˆåï¼Œæ‰å‘æœåŠ¡å™¨è¿”å›ackï¼Œå¦‚æœæ²¡æœ‰æ¶ˆè´¹ä¸€å®šä¸ä¼šackæ¶ˆæ¯ï¼Œæ‰€ä»¥RocketMQå¯ä»¥å¾ˆå¥½çš„æ”¯æŒæ­¤ç‰¹æ€§ã€‚ 6 å›æº¯æ¶ˆè´¹å›æº¯æ¶ˆè´¹æ˜¯æŒ‡Consumerå·²ç»æ¶ˆè´¹æˆåŠŸçš„æ¶ˆæ¯ï¼Œç”±äºä¸šåŠ¡ä¸Šéœ€æ±‚éœ€è¦é‡æ–°æ¶ˆè´¹ï¼Œè¦æ”¯æŒæ­¤åŠŸèƒ½ï¼ŒBrokeråœ¨å‘ConsumeræŠ•é€’æˆåŠŸæ¶ˆæ¯åï¼Œæ¶ˆæ¯ä»ç„¶éœ€è¦ä¿ç•™ã€‚å¹¶ä¸”é‡æ–°æ¶ˆè´¹ä¸€èˆ¬æ˜¯æŒ‰ç…§æ—¶é—´ç»´åº¦ï¼Œä¾‹å¦‚ç”±äºConsumerç³»ç»Ÿæ•…éšœï¼Œæ¢å¤åéœ€è¦é‡æ–°æ¶ˆè´¹1å°æ—¶å‰çš„æ•°æ®ï¼Œé‚£ä¹ˆBrokerè¦æä¾›ä¸€ç§æœºåˆ¶ï¼Œå¯ä»¥æŒ‰ç…§æ—¶é—´ç»´åº¦æ¥å›é€€æ¶ˆè´¹è¿›åº¦ã€‚RocketMQæ”¯æŒæŒ‰ç…§æ—¶é—´å›æº¯æ¶ˆè´¹ï¼Œæ—¶é—´ç»´åº¦ç²¾ç¡®åˆ°æ¯«ç§’ã€‚ 7 äº‹åŠ¡æ¶ˆæ¯RocketMQäº‹åŠ¡æ¶ˆæ¯ï¼ˆTransactional Messageï¼‰æ˜¯æŒ‡åº”ç”¨æœ¬åœ°äº‹åŠ¡å’Œå‘é€æ¶ˆæ¯æ“ä½œå¯ä»¥è¢«å®šä¹‰åˆ°å…¨å±€äº‹åŠ¡ä¸­ï¼Œè¦ä¹ˆåŒæ—¶æˆåŠŸï¼Œè¦ä¹ˆåŒæ—¶å¤±è´¥ã€‚RocketMQçš„äº‹åŠ¡æ¶ˆæ¯æä¾›ç±»ä¼¼ X/Open XA çš„åˆ†å¸ƒäº‹åŠ¡åŠŸèƒ½ï¼Œé€šè¿‡äº‹åŠ¡æ¶ˆæ¯èƒ½è¾¾åˆ°åˆ†å¸ƒå¼äº‹åŠ¡çš„æœ€ç»ˆä¸€è‡´ã€‚ 8 å®šæ—¶æ¶ˆæ¯å®šæ—¶æ¶ˆæ¯ï¼ˆå»¶è¿Ÿé˜Ÿåˆ—ï¼‰æ˜¯æŒ‡æ¶ˆæ¯å‘é€åˆ°brokeråï¼Œä¸ä¼šç«‹å³è¢«æ¶ˆè´¹ï¼Œç­‰å¾…ç‰¹å®šæ—¶é—´æŠ•é€’ç»™çœŸæ­£çš„topicã€‚ brokeræœ‰é…ç½®é¡¹messageDelayLevelï¼Œé»˜è®¤å€¼ä¸ºâ€œ1s 5s 10s 30s 1m 2m 3m 4m 5m 6m 7m 8m 9m 10m 20m 30m 1h 2hâ€ï¼Œ18ä¸ªlevelã€‚å¯ä»¥é…ç½®è‡ªå®šä¹‰messageDelayLevelã€‚æ³¨æ„ï¼ŒmessageDelayLevelæ˜¯brokerçš„å±æ€§ï¼Œä¸å±äºæŸä¸ªtopicã€‚å‘æ¶ˆæ¯æ—¶ï¼Œè®¾ç½®delayLevelç­‰çº§å³å¯ï¼šmsg.setDelayLevel(level)ã€‚levelæœ‰ä»¥ä¸‹ä¸‰ç§æƒ…å†µï¼š level == 0ï¼Œæ¶ˆæ¯ä¸ºéå»¶è¿Ÿæ¶ˆæ¯ 1&lt;=level&lt;=maxLevelï¼Œæ¶ˆæ¯å»¶è¿Ÿç‰¹å®šæ—¶é—´ï¼Œä¾‹å¦‚level==1ï¼Œå»¶è¿Ÿ1s level &gt; maxLevelï¼Œåˆ™level== maxLevelï¼Œä¾‹å¦‚level==20ï¼Œå»¶è¿Ÿ2h å®šæ—¶æ¶ˆæ¯ä¼šæš‚å­˜åœ¨åä¸ºSCHEDULE_TOPIC_XXXXçš„topicä¸­ï¼Œå¹¶æ ¹æ®delayTimeLevelå­˜å…¥ç‰¹å®šçš„queueï¼ŒqueueId = delayTimeLevel â€“ 1ï¼Œå³ä¸€ä¸ªqueueåªå­˜ç›¸åŒå»¶è¿Ÿçš„æ¶ˆæ¯ï¼Œä¿è¯å…·æœ‰ç›¸åŒå‘é€å»¶è¿Ÿçš„æ¶ˆæ¯èƒ½å¤Ÿé¡ºåºæ¶ˆè´¹ã€‚brokerä¼šè°ƒåº¦åœ°æ¶ˆè´¹SCHEDULE_TOPIC_XXXXï¼Œå°†æ¶ˆæ¯å†™å…¥çœŸå®çš„topicã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå®šæ—¶æ¶ˆæ¯ä¼šåœ¨ç¬¬ä¸€æ¬¡å†™å…¥å’Œè°ƒåº¦å†™å…¥çœŸå®topicæ—¶éƒ½ä¼šè®¡æ•°ï¼Œå› æ­¤å‘é€æ•°é‡ã€tpséƒ½ä¼šå˜é«˜ã€‚ 9 æ¶ˆæ¯é‡è¯•Consumeræ¶ˆè´¹æ¶ˆæ¯å¤±è´¥åï¼Œè¦æä¾›ä¸€ç§é‡è¯•æœºåˆ¶ï¼Œä»¤æ¶ˆæ¯å†æ¶ˆè´¹ä¸€æ¬¡ã€‚Consumeræ¶ˆè´¹æ¶ˆæ¯å¤±è´¥é€šå¸¸å¯ä»¥è®¤ä¸ºæœ‰ä»¥ä¸‹å‡ ç§æƒ…å†µï¼š ç”±äºæ¶ˆæ¯æœ¬èº«çš„åŸå› ï¼Œä¾‹å¦‚ååºåˆ—åŒ–å¤±è´¥ï¼Œæ¶ˆæ¯æ•°æ®æœ¬èº«æ— æ³•å¤„ç†ï¼ˆä¾‹å¦‚è¯è´¹å……å€¼ï¼Œå½“å‰æ¶ˆæ¯çš„æ‰‹æœºå·è¢«æ³¨é”€ï¼Œæ— æ³•å……å€¼ï¼‰ç­‰ã€‚è¿™ç§é”™è¯¯é€šå¸¸éœ€è¦è·³è¿‡è¿™æ¡æ¶ˆæ¯ï¼Œå†æ¶ˆè´¹å…¶å®ƒæ¶ˆæ¯ï¼Œè€Œè¿™æ¡å¤±è´¥çš„æ¶ˆæ¯å³ä½¿ç«‹åˆ»é‡è¯•æ¶ˆè´¹ï¼Œ99%ä¹Ÿä¸æˆåŠŸï¼Œæ‰€ä»¥æœ€å¥½æä¾›ä¸€ç§å®šæ—¶é‡è¯•æœºåˆ¶ï¼Œå³è¿‡10ç§’åå†é‡è¯•ã€‚ ç”±äºä¾èµ–çš„ä¸‹æ¸¸åº”ç”¨æœåŠ¡ä¸å¯ç”¨ï¼Œä¾‹å¦‚dbè¿æ¥ä¸å¯ç”¨ï¼Œå¤–ç³»ç»Ÿç½‘ç»œä¸å¯è¾¾ç­‰ã€‚é‡åˆ°è¿™ç§é”™è¯¯ï¼Œå³ä½¿è·³è¿‡å½“å‰å¤±è´¥çš„æ¶ˆæ¯ï¼Œæ¶ˆè´¹å…¶ä»–æ¶ˆæ¯åŒæ ·ä¹Ÿä¼šæŠ¥é”™ã€‚è¿™ç§æƒ…å†µå»ºè®®åº”ç”¨sleep 30sï¼Œå†æ¶ˆè´¹ä¸‹ä¸€æ¡æ¶ˆæ¯ï¼Œè¿™æ ·å¯ä»¥å‡è½»Brokeré‡è¯•æ¶ˆæ¯çš„å‹åŠ›ã€‚ RocketMQä¼šä¸ºæ¯ä¸ªæ¶ˆè´¹ç»„éƒ½è®¾ç½®ä¸€ä¸ªTopicåç§°ä¸ºâ€œ%RETRY%+consumerGroupâ€çš„é‡è¯•é˜Ÿåˆ—ï¼ˆè¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ªTopicçš„é‡è¯•é˜Ÿåˆ—æ˜¯é’ˆå¯¹æ¶ˆè´¹ç»„ï¼Œè€Œä¸æ˜¯é’ˆå¯¹æ¯ä¸ªTopicè®¾ç½®çš„ï¼‰ï¼Œç”¨äºæš‚æ—¶ä¿å­˜å› ä¸ºå„ç§å¼‚å¸¸è€Œå¯¼è‡´Consumerç«¯æ— æ³•æ¶ˆè´¹çš„æ¶ˆæ¯ã€‚è€ƒè™‘åˆ°å¼‚å¸¸æ¢å¤èµ·æ¥éœ€è¦ä¸€äº›æ—¶é—´ï¼Œä¼šä¸ºé‡è¯•é˜Ÿåˆ—è®¾ç½®å¤šä¸ªé‡è¯•çº§åˆ«ï¼Œæ¯ä¸ªé‡è¯•çº§åˆ«éƒ½æœ‰ä¸ä¹‹å¯¹åº”çš„é‡æ–°æŠ•é€’å»¶æ—¶ï¼Œé‡è¯•æ¬¡æ•°è¶Šå¤šæŠ•é€’å»¶æ—¶å°±è¶Šå¤§ã€‚RocketMQå¯¹äºé‡è¯•æ¶ˆæ¯çš„å¤„ç†æ˜¯å…ˆä¿å­˜è‡³Topicåç§°ä¸ºâ€œSCHEDULE_TOPIC_XXXXâ€çš„å»¶è¿Ÿé˜Ÿåˆ—ä¸­ï¼Œåå°å®šæ—¶ä»»åŠ¡æŒ‰ç…§å¯¹åº”çš„æ—¶é—´è¿›è¡ŒDelayåé‡æ–°ä¿å­˜è‡³â€œ%RETRY%+consumerGroupâ€çš„é‡è¯•é˜Ÿåˆ—ä¸­ã€‚ 10 æ¶ˆæ¯é‡æŠ•ç”Ÿäº§è€…åœ¨å‘é€æ¶ˆæ¯æ—¶ï¼ŒåŒæ­¥æ¶ˆæ¯å¤±è´¥ä¼šé‡æŠ•ï¼Œå¼‚æ­¥æ¶ˆæ¯æœ‰é‡è¯•ï¼Œonewayæ²¡æœ‰ä»»ä½•ä¿è¯ã€‚æ¶ˆæ¯é‡æŠ•ä¿è¯æ¶ˆæ¯å°½å¯èƒ½å‘é€æˆåŠŸã€ä¸ä¸¢å¤±ï¼Œä½†å¯èƒ½ä¼šé€ æˆæ¶ˆæ¯é‡å¤ï¼Œæ¶ˆæ¯é‡å¤åœ¨RocketMQä¸­æ˜¯æ— æ³•é¿å…çš„é—®é¢˜ã€‚æ¶ˆæ¯é‡å¤åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ä¸ä¼šå‘ç”Ÿï¼Œå½“å‡ºç°æ¶ˆæ¯é‡å¤§ã€ç½‘ç»œæŠ–åŠ¨ï¼Œæ¶ˆæ¯é‡å¤å°±ä¼šæ˜¯å¤§æ¦‚ç‡äº‹ä»¶ã€‚å¦å¤–ï¼Œç”Ÿäº§è€…ä¸»åŠ¨é‡å‘ã€consumerè´Ÿè½½å˜åŒ–ä¹Ÿä¼šå¯¼è‡´é‡å¤æ¶ˆæ¯ã€‚å¦‚ä¸‹æ–¹æ³•å¯ä»¥è®¾ç½®æ¶ˆæ¯é‡è¯•ç­–ç•¥ï¼š retryTimesWhenSendFailed:åŒæ­¥å‘é€å¤±è´¥é‡æŠ•æ¬¡æ•°ï¼Œé»˜è®¤ä¸º2ï¼Œå› æ­¤ç”Ÿäº§è€…ä¼šæœ€å¤šå°è¯•å‘é€retryTimesWhenSendFailed + 1æ¬¡ã€‚ä¸ä¼šé€‰æ‹©ä¸Šæ¬¡å¤±è´¥çš„brokerï¼Œå°è¯•å‘å…¶ä»–brokerå‘é€ï¼Œæœ€å¤§ç¨‹åº¦ä¿è¯æ¶ˆæ¯ä¸ä¸¢ã€‚è¶…è¿‡é‡æŠ•æ¬¡æ•°ï¼ŒæŠ›å‡ºå¼‚å¸¸ï¼Œç”±å®¢æˆ·ç«¯ä¿è¯æ¶ˆæ¯ä¸ä¸¢ã€‚å½“å‡ºç°RemotingExceptionã€MQClientExceptionå’Œéƒ¨åˆ†MQBrokerExceptionæ—¶ä¼šé‡æŠ•ã€‚ retryTimesWhenSendAsyncFailed:å¼‚æ­¥å‘é€å¤±è´¥é‡è¯•æ¬¡æ•°ï¼Œå¼‚æ­¥é‡è¯•ä¸ä¼šé€‰æ‹©å…¶ä»–brokerï¼Œä»…åœ¨åŒä¸€ä¸ªbrokerä¸Šåšé‡è¯•ï¼Œä¸ä¿è¯æ¶ˆæ¯ä¸ä¸¢ã€‚ retryAnotherBrokerWhenNotStoreOK:æ¶ˆæ¯åˆ·ç›˜ï¼ˆä¸»æˆ–å¤‡ï¼‰è¶…æ—¶æˆ–slaveä¸å¯ç”¨ï¼ˆè¿”å›çŠ¶æ€éSEND_OKï¼‰ï¼Œæ˜¯å¦å°è¯•å‘é€åˆ°å…¶ä»–brokerï¼Œé»˜è®¤falseã€‚ååˆ†é‡è¦æ¶ˆæ¯å¯ä»¥å¼€å¯ã€‚ 11 æµé‡æ§åˆ¶ç”Ÿäº§è€…æµæ§ï¼Œå› ä¸ºbrokerå¤„ç†èƒ½åŠ›è¾¾åˆ°ç“¶é¢ˆï¼›æ¶ˆè´¹è€…æµæ§ï¼Œå› ä¸ºæ¶ˆè´¹èƒ½åŠ›è¾¾åˆ°ç“¶é¢ˆã€‚ ç”Ÿäº§è€…æµæ§ï¼š commitLogæ–‡ä»¶è¢«é”æ—¶é—´è¶…è¿‡osPageCacheBusyTimeOutMillsæ—¶ï¼Œå‚æ•°é»˜è®¤ä¸º1000msï¼Œè¿”å›æµæ§ã€‚ å¦‚æœå¼€å¯transientStorePoolEnable == trueï¼Œä¸”brokerä¸ºå¼‚æ­¥åˆ·ç›˜çš„ä¸»æœºï¼Œä¸”transientStorePoolä¸­èµ„æºä¸è¶³ï¼Œæ‹’ç»å½“å‰sendè¯·æ±‚ï¼Œè¿”å›æµæ§ã€‚ brokeræ¯éš”10msæ£€æŸ¥sendè¯·æ±‚é˜Ÿåˆ—å¤´éƒ¨è¯·æ±‚çš„ç­‰å¾…æ—¶é—´ï¼Œå¦‚æœè¶…è¿‡waitTimeMillsInSendQueueï¼Œé»˜è®¤200msï¼Œæ‹’ç»å½“å‰sendè¯·æ±‚ï¼Œè¿”å›æµæ§ã€‚ brokeré€šè¿‡æ‹’ç»send è¯·æ±‚æ–¹å¼å®ç°æµé‡æ§åˆ¶ã€‚ æ³¨æ„ï¼Œç”Ÿäº§è€…æµæ§ï¼Œä¸ä¼šå°è¯•æ¶ˆæ¯é‡æŠ•ã€‚ æ¶ˆè´¹è€…æµæ§ï¼š æ¶ˆè´¹è€…æœ¬åœ°ç¼“å­˜æ¶ˆæ¯æ•°è¶…è¿‡pullThresholdForQueueæ—¶ï¼Œé»˜è®¤1000ã€‚ æ¶ˆè´¹è€…æœ¬åœ°ç¼“å­˜æ¶ˆæ¯å¤§å°è¶…è¿‡pullThresholdSizeForQueueæ—¶ï¼Œé»˜è®¤100MBã€‚ æ¶ˆè´¹è€…æœ¬åœ°ç¼“å­˜æ¶ˆæ¯è·¨åº¦è¶…è¿‡consumeConcurrentlyMaxSpanæ—¶ï¼Œé»˜è®¤2000ã€‚ æ¶ˆè´¹è€…æµæ§çš„ç»“æœæ˜¯é™ä½æ‹‰å–é¢‘ç‡ã€‚ 12 æ­»ä¿¡é˜Ÿåˆ—æ­»ä¿¡é˜Ÿåˆ—ç”¨äºå¤„ç†æ— æ³•è¢«æ­£å¸¸æ¶ˆè´¹çš„æ¶ˆæ¯ã€‚å½“ä¸€æ¡æ¶ˆæ¯åˆæ¬¡æ¶ˆè´¹å¤±è´¥ï¼Œæ¶ˆæ¯é˜Ÿåˆ—ä¼šè‡ªåŠ¨è¿›è¡Œæ¶ˆæ¯é‡è¯•ï¼›è¾¾åˆ°æœ€å¤§é‡è¯•æ¬¡æ•°åï¼Œè‹¥æ¶ˆè´¹ä¾ç„¶å¤±è´¥ï¼Œåˆ™è¡¨æ˜æ¶ˆè´¹è€…åœ¨æ­£å¸¸æƒ…å†µä¸‹æ— æ³•æ­£ç¡®åœ°æ¶ˆè´¹è¯¥æ¶ˆæ¯ï¼Œæ­¤æ—¶ï¼Œæ¶ˆæ¯é˜Ÿåˆ— ä¸ä¼šç«‹åˆ»å°†æ¶ˆæ¯ä¸¢å¼ƒï¼Œè€Œæ˜¯å°†å…¶å‘é€åˆ°è¯¥æ¶ˆè´¹è€…å¯¹åº”çš„ç‰¹æ®Šé˜Ÿåˆ—ä¸­ã€‚ RocketMQå°†è¿™ç§æ­£å¸¸æƒ…å†µä¸‹æ— æ³•è¢«æ¶ˆè´¹çš„æ¶ˆæ¯ç§°ä¸ºæ­»ä¿¡æ¶ˆæ¯ï¼ˆDead-Letter Messageï¼‰ï¼Œå°†å­˜å‚¨æ­»ä¿¡æ¶ˆæ¯çš„ç‰¹æ®Šé˜Ÿåˆ—ç§°ä¸ºæ­»ä¿¡é˜Ÿåˆ—ï¼ˆDead-Letter Queueï¼‰ã€‚åœ¨RocketMQä¸­ï¼Œå¯ä»¥é€šè¿‡ä½¿ç”¨consoleæ§åˆ¶å°å¯¹æ­»ä¿¡é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯è¿›è¡Œé‡å‘æ¥ä½¿å¾—æ¶ˆè´¹è€…å®ä¾‹å†æ¬¡è¿›è¡Œæ¶ˆè´¹ã€‚","tags":[{"name":"RocketMq","slug":"RocketMq","permalink":"https://alexhuihui.github.io/tags/RocketMq/"}]},{"title":"ã€Redisã€‘åŸºäºredissonæ­å»ºå»¶è¿Ÿé˜Ÿåˆ—","date":"2022-01-06T08:18:56.000Z","path":"article/20220106.html","text":"ä»€ä¹ˆæ˜¯å»¶æ—¶é˜Ÿåˆ—ï¼Ÿ å®ƒé¦–å…ˆå…·æœ‰é˜Ÿåˆ—çš„ç‰¹æ€§ï¼ˆå…ˆè¿›å…ˆå‡ºï¼‰ï¼ŒåŒæ—¶è¿˜èƒ½æŒ‡å®šé˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯åœ¨æœªæ¥æŸä¸ªæ—¶åˆ»è¢«æ¶ˆè´¹ã€‚ åº”ç”¨ï¼šæŠ¢å•æˆåŠŸåï¼Œè®¢å•1åˆ†é’Ÿå†…æœªæ”¯ä»˜ï¼Œè‡ªåŠ¨å…³é—­ã€‚ å®ç°å»¶æ—¶é˜Ÿåˆ—å¾ˆæ—©ä¹‹å‰æˆ‘æœ‰ä½¿ç”¨è¿‡redisçš„zsetæ•°æ®ç»“æ„æ¥å®ç°å»¶æ—¶é˜Ÿåˆ—ï¼ˆè‡ªåŠ¨å…³é—­è€ƒè¯•ï¼‰ï¼Œä½†æ˜¯è¿™ç§æ–¹æ³•éœ€è¦å¼€å¯å®šæ—¶ä»»åŠ¡å»è½®è¯¢delayqueueï¼Œå®æ—¶æ€§ä¸å¥½ï¼Œä¸”æ— æ³•æ”¯æŒåº”ç”¨çš„æ°´å¹³æ‰©å±•ã€‚åæ¥æœ‰æ¥è§¦åˆ°redissonâ€”â€”ä¸€ä¸ªJavaå®ç°çš„rediså®¢æˆ·ç«¯ï¼Œå‘ç°ç”¨å®ƒæ¥å®ç°å»¶æ—¶é˜Ÿåˆ—å¯ä»¥åšçš„æ›´å¥½ã€‚ 1ã€å®šä¹‰æ¥å£12public interface Queue &#123;&#125; 2ã€å®ç°æŠ½è±¡ç±»é¦–å…ˆè¦å®ç°ä¸€ä¸ªredissonçš„å®¢æˆ·ç«¯ 1234567891011@Beanpublic RedissonClient getRedissonClient() &#123; Config config = new Config(); SingleServerConfig server = config.useSingleServer(); String address = StrUtil.format(&quot;redis://&#123;&#125;:&#123;&#125;&quot;, host, port); server.setAddress(address); if (StrUtil.isNotEmpty(password)) &#123; server.setPassword(password); &#125; return Redisson.create(config);&#125; æŠ½è±¡ç±»AbstractQueue 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374public abstract class AbstractQueue implements Queue &#123; protected String name; protected static Map&lt;String, IQueueListener&gt; listenerMap; protected static RedissonClient redissonClient = SpringUtil.getBean(RedissonClient.class); protected static String LOCK_PREFIX = &quot;alexmmd:queue:listeners&quot;; static &#123; // put topic and corresponding queueListener into the listenerMap listenerMap = new HashMap&lt;&gt;(); QueueConsumer annotation; Map&lt;String, IQueueListener&gt; beansOfType = SpringUtil.getBeansOfType(IQueueListener.class); if (MapUtil.isNotEmpty(beansOfType)) &#123; for (IQueueListener listener : beansOfType.values()) &#123; // bind topic and corresponding listener annotation = listener.getClass().getAnnotation(QueueConsumer.class); if (ObjectUtil.isNull(annotation)) &#123; continue; &#125; String topic = annotation.topic(); if (StrUtil.isNotEmpty(topic)) &#123; listenerMap.put(topic, listener); &#125; String[] topics = annotation.topics(); if (ArrayUtil.isEmpty(topics)) &#123; continue; &#125; for (String s : topics) &#123; listenerMap.put(s, listener); &#125; &#125; &#125; &#125; public AbstractQueue(String name) &#123; this.name = name; new Thread(() -&gt; &#123; log.info(&quot;å¼€å¯ä¸€ä¸ªçº¿ç¨‹ &#123;&#125; ç›‘å¬é˜Ÿåˆ— : &#123;&#125;&quot;, Thread.currentThread().getName(), name); while (true) &#123; try &#123; Pair&lt;String, String&gt; take = this.take(); String topic = take.getKey(); String body = take.getValue(); new Thread(consumer(name, topic, body)).start(); &#125; catch (Exception e) &#123; log.error(&quot;ç›‘å¬é˜Ÿåˆ—çº¿ç¨‹é”™è¯¯ï¼Œ&#123;&#125;&quot;, e.getMessage()); &#125; &#125; &#125;).start(); &#125; private Runnable consumer(String name, String topic, String body) &#123; return () -&gt; &#123; log.info(&quot;çº¿ç¨‹ï¼š &#123;&#125; ç›‘å¬é˜Ÿåˆ—ï¼š&#123;&#125;ï¼Œ topic: &#123;&#125;, body: &#123;&#125;, å¼€å§‹å¤„ç†&quot;, Thread.currentThread().getName() , name, topic, body); RLock lock = redissonClient.getLock(LOCK_PREFIX + topic); try &#123; lock.lock(); IQueueListener queueListener = listenerMap.get(topic); if (ObjectUtil.isNull(queueListener)) &#123; log.error(&quot;topic &#123;&#125; æ²¡æœ‰æ‰¾åˆ°å¯¹åº”çš„ç›‘å¬å™¨&quot;, topic); return; &#125; queueListener.consumer(body); &#125; catch (Exception e) &#123; log.error(&quot;æ¶ˆè´¹å¤±è´¥&quot;); &#125; finally &#123; lock.unlock(); &#125; &#125;; &#125; protected abstract Pair&lt;String, String&gt; take() throws InterruptedException;&#125; åœ¨æŠ½è±¡ç±»çš„é™æ€ä»£ç å—ä¸­ï¼Œè·å–æ‰€æœ‰å®ç°äº†IQueueListeneræ¥å£çš„ç±»ã€‚è·å–è¿™äº›ç±»ä¸­QueueConsumeræ³¨è§£é‡Œæ ‡æ˜çš„topicï¼ŒæŠŠtopicå’ŒQueueListenerç»‘å®šâ€”â€”å­˜å…¥lsitenerMapå®¹å™¨ä¸­ã€‚ åœ¨å”¯ä¸€çš„å¸¦å‚æ„é€ å™¨ä¸­ï¼Œå…ˆç»™å½“å‰çš„å®ç°ç±»çš„nameå±æ€§èµ‹å€¼ï¼Œç„¶åå†å¼€å¯ä¸€ä¸ªçº¿ç¨‹å»ç›‘å¬å»¶æ—¶é˜Ÿåˆ—ï¼Œè°ƒç”¨å­ç±»å®ç°çš„take()è·å–é˜Ÿåˆ—ä¸­çš„å€¼ï¼Œå¦‚æœå–å¾—åˆ°å€¼å°±å¼€å¯ä¸€ä¸ªçº¿ç¨‹å»è°ƒç”¨consumer()æ¶ˆè´¹ã€‚ åœ¨consumer()ä¸­ï¼Œé¦–å…ˆé€šè¿‡æ¶ˆæ¯ä½“Pairç±»çš„keyå€¼ï¼ˆtopicï¼‰ä»listenerMapä¸­è·å–å¯¹åº”çš„IQueueListenerç±»ï¼Œå†ç”±è¯¥ç±»å»å¤„ç†æ¶ˆæ¯ä½“ã€‚ take()ç”±å…·ä½“çš„å­ç±»æ¥å®ç° 12345678910111213141516171819202122232425262728@Slf4jpublic class DelayQueue extends AbstractQueue &#123; private RDelayedQueue&lt;Pair&lt;String, String&gt;&gt; delayedQueue; private RBlockingDeque&lt;Pair&lt;String, String&gt;&gt; blockingDeque; public DelayQueue(String name, RDelayedQueue&lt;Pair&lt;String, String&gt;&gt; delayedQueue, RBlockingDeque&lt;Pair&lt;String, String&gt;&gt; blockingDeque) &#123; super(name); this.blockingDeque = blockingDeque; this.delayedQueue = delayedQueue; &#125; public static DelayQueue create(String name) &#123; RBlockingDeque&lt;Pair&lt;String, String&gt;&gt; blockingDeque = redissonClient.getBlockingDeque(name); RDelayedQueue&lt;Pair&lt;String, String&gt;&gt; delayedQueue = redissonClient.getDelayedQueue(blockingDeque); return new DelayQueue(name, delayedQueue, blockingDeque); &#125; public &lt;T&gt; void offer(String topic, T body, long delay) &#123; delayedQueue.offer(Pair.of(topic, JSONUtil.toJsonStr(body)), delay, TimeUnit.SECONDS); &#125; @Override protected Pair&lt;String, String&gt; take() throws InterruptedException &#123; return blockingDeque.take(); &#125;&#125; å­ç±»ä¸­æä¾›äº†ä¸€ä¸ªcreate()çš„é™æ€æ–¹æ³•ï¼Œæš´éœ²ç»™å¤–éƒ¨æ¥åˆ›å»ºå»¶æ—¶é˜Ÿåˆ—ã€‚å…¶ä¸­é€šè¿‡redissonClientåˆ›å»ºäº†RBlockingDequeå’ŒRDelayedQueueï¼Œç„¶åå†è°ƒç”¨æ„é€ æ–¹æ³•ã€‚åœ¨å­ç±»çš„æ„é€ æ–¹æ³•ä¸­ï¼Œè°ƒç”¨æŠ½è±¡ç±»çš„æ„é€ æ–¹æ³•ï¼Œç„¶åæŠŠç»™RBlockingDequeå’ŒRDelayedQueueä¸¤ä¸ªæˆå‘˜å˜é‡èµ‹å€¼ã€‚ offer()å°±æ˜¯æ–°å¢å»¶æ—¶ä»»åŠ¡ï¼Œå¾€RDelayedQueueä¸­æ·»åŠ å€¼ã€‚ take()å°±æ˜¯è·å–å»¶æ—¶ä»»åŠ¡ï¼Œä»RBlockingDequeè·å–å€¼ï¼Œåœ¨çˆ¶ç±»ä¸­çš„æ„é€ å‡½æ•°ä¸­å¼€å¯çš„ç›‘å¬çº¿ç¨‹ä¸­è¢«è°ƒç”¨ã€‚ ä»¥ä¸Šå°±é€šè¿‡redissonå®ç°äº†å»¶æ—¶é˜Ÿåˆ—ï¼Œä¸‹é¢æ˜¯ä½¿ç”¨ç”¨ä¾‹ã€‚ 123456789101112public class DelayClient &#123; private static DelayQueue delayQueue = DelayQueue.create(&quot;DELAY_QUEUE_01&quot;); public static &lt;T&gt; void offer(String topic, T body, long delay) &#123; delayQueue.offer(topic, body, delay); &#125; public static &lt;T&gt; void offer(String topic, T body, Date date) &#123; delayQueue.offer(topic, body, DateUtil.between(new Date(), date, DateUnit.SECOND)); &#125;&#125; tip: é¡¹ç›®æºç ","tags":[{"name":"Redis","slug":"Redis","permalink":"https://alexhuihui.github.io/tags/Redis/"},{"name":"å»¶æ—¶é˜Ÿåˆ—","slug":"å»¶æ—¶é˜Ÿåˆ—","permalink":"https://alexhuihui.github.io/tags/%E5%BB%B6%E6%97%B6%E9%98%9F%E5%88%97/"}]},{"title":"ã€å®‰å…¨ã€‘Javaå¦‚ä½•ä½¿ç”¨JWT","date":"2021-12-25T04:36:02.000Z","path":"article/20211225.html","text":"ä½¿ç”¨Java JWTå¼•å…¥mavenä¾èµ– 12345&lt;dependency&gt; &lt;groupId&gt;com.auth0&lt;/groupId&gt; &lt;artifactId&gt;java-jwt&lt;/artifactId&gt; &lt;version&gt;3.18.2&lt;/version&gt;&lt;/dependency&gt; ç”Ÿæˆå¯†é’¥å¯¹RSAç”Ÿæˆ1024ä½ç§é’¥ï¼š 1$ openssl genrsa -out private.key 1024 RSAç”Ÿæˆå…¬é’¥: 1$ openssl rsa -in private.key -pubout -out pub.key é€šè¿‡javaä½¿ç”¨ç§é’¥å¿…é¡»è¦å…ˆç»è¿‡PCK8è½¬æ¢ 1openssl pkcs8 -topk8 -nocrypt -in private.key -outform PEM -out java_private.key ä»æ–‡ä»¶ä¸­è¯»å–å…¬é’¥å’Œç§é’¥12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364@Slf4jpublic class PemUtil &#123; private static byte[] parsePEMFile(File pemFile) throws IOException &#123; if (!pemFile.isFile() || !pemFile.exists()) &#123; throw new FileNotFoundException(String.format(&quot;The file &#x27;%s&#x27; doesn&#x27;t exist.&quot;, pemFile.getAbsolutePath())); &#125; PemReader reader = new PemReader(new FileReader(pemFile)); PemObject pemObject = reader.readPemObject(); byte[] content = pemObject.getContent(); reader.close(); return content; &#125; private static PublicKey getPublicKey(byte[] keyBytes, String algorithm) &#123; PublicKey publicKey = null; try &#123; KeyFactory kf = KeyFactory.getInstance(algorithm); EncodedKeySpec keySpec = new X509EncodedKeySpec(keyBytes); publicKey = kf.generatePublic(keySpec); &#125; catch (NoSuchAlgorithmException e) &#123; System.out.println(&quot;Could not reconstruct the public key, the given algorithm could not be found.&quot;); &#125; catch (InvalidKeySpecException e) &#123; System.out.println(&quot;Could not reconstruct the public key&quot;); &#125; return publicKey; &#125; private static PrivateKey getPrivateKey(byte[] keyBytes, String algorithm) &#123; PrivateKey privateKey = null; try &#123; KeyFactory kf = KeyFactory.getInstance(algorithm); EncodedKeySpec keySpec = new PKCS8EncodedKeySpec(keyBytes); privateKey = kf.generatePrivate(keySpec); &#125; catch (NoSuchAlgorithmException e) &#123; System.out.println(&quot;Could not reconstruct the private key, the given algorithm could not be found.&quot;); &#125; catch (InvalidKeySpecException e) &#123; System.out.println(&quot;Could not reconstruct the private key&quot;); &#125; return privateKey; &#125; public static PublicKey readPublicKeyFromFile(String filepath, String algorithm) &#123; byte[] bytes = new byte[0]; try &#123; bytes = PemUtil.parsePEMFile(new File(filepath)); &#125; catch (IOException exception) &#123; log.error(exception.getMessage()); &#125; return PemUtil.getPublicKey(bytes, algorithm); &#125; public static PrivateKey readPrivateKeyFromFile(String filepath, String algorithm) &#123; byte[] bytes = new byte[0]; try &#123; bytes = PemUtil.parsePEMFile(new File(filepath)); &#125; catch (IOException exception) &#123; log.error(exception.getMessage()); &#125; return PemUtil.getPrivateKey(bytes, algorithm); &#125;&#125; ä½¿ç”¨ç§é’¥ç”ŸæˆToken123456789101112131415161718192021222324public static String generateToken(JSONObject jsonObject) &#123; try &#123; //åŠ å¯†æ—¶ï¼Œä½¿ç”¨ç§é’¥ç”ŸæˆRSAç®—æ³•å¯¹è±¡ Algorithm algorithm = Algorithm.RSA256(null, PRIVATE_KEY); DateTime date = DateUtil.date(); return JWT.create() //ç­¾å‘äºº .withIssuer(&quot;auth-server&quot;) //æ¥æ”¶è€… .withAudience(&quot;client&quot;) //ç­¾å‘æ—¶é—´ .withIssuedAt(date) //è¿‡æœŸæ—¶é—´ .withExpiresAt(DateUtil.offsetMinute(date, 5)) //ç›¸å…³ä¿¡æ¯ .withClaim(&quot;data&quot;, jsonObject.toString()) //ç­¾å…¥ .sign(algorithm); &#125; catch (JWTCreationException exception) &#123; //Invalid Signing configuration / Couldn&#x27;t convert Claims. log.error(exception.getMessage()); &#125; return null; &#125; ä½¿ç”¨å…¬é’¥æ ¡éªŒToken123456789101112131415161718192021public static boolean verifierToken(String token) &#123; // æ ¹æ®å¯†é’¥å¯¹ç”ŸæˆRS256ç®—æ³•å¯¹è±¡ Algorithm algorithm = Algorithm.RSA256(PUBLIC_KEY, null); JWTVerifier verifier = JWT.require(algorithm) .build(); try &#123; // éªŒè¯Tokenï¼Œverifierè‡ªåŠ¨éªŒè¯ DecodedJWT jwt = verifier.verify(token); // æ‰“å°ç”¨æˆ·å£°æ˜çš„ä¿¡æ¯ Claim data = jwt.getClaim(&quot;data&quot;); JSONObject jsonObject = JSONUtil.parseObj(data.asString()); for (String key : jsonObject.keySet()) &#123; log.info(&quot;key === &#123;&#125;, value === &#123;&#125;&quot;, key, jsonObject.get(key)); &#125; return true; &#125; catch (JWTVerificationException e) &#123; log.error(&quot;Tokenæ— æ³•é€šè¿‡éªŒè¯! &quot; + e.getMessage()); return false; &#125; &#125; Tip ç§é’¥ä¿å­˜åœ¨æœåŠ¡å™¨ç«¯ï¼Œè¢«Auth server æŒæœ‰ï¼Œå…¬é’¥å¯ä»¥é¢å‘ç»™éœ€è¦éªŒè¯Tokençš„æœåŠ¡ ä½¿ç”¨JSONObjectå¯¹è±¡å­˜å‚¨ç”¨æˆ·å£°æ˜çš„ä¿¡æ¯ï¼Œå¹¶æ”¾å…¥payloadä¸­ æœ¬ç¤ºä¾‹æºç ","tags":[{"name":"JWT","slug":"JWT","permalink":"https://alexhuihui.github.io/tags/JWT/"},{"name":"ç­¾å","slug":"ç­¾å","permalink":"https://alexhuihui.github.io/tags/%E7%AD%BE%E5%90%8D/"}]},{"title":"ã€å®‰å…¨ã€‘JWTä»‹ç»å’Œä½¿ç”¨","date":"2021-12-24T03:11:49.000Z","path":"article/20211224.html","text":"Why use it? JWTå¯ä»¥å­˜å‚¨ç”¨æˆ·åŸºæœ¬ä¿¡æ¯ï¼Œå¸¸ç”¨äºå¾®æœåŠ¡ä¸­å¯¹è¯·æ±‚çš„é‰´æƒã€‚ JWTæ˜¯æ— çŠ¶æ€çš„ï¼Œæ–¹ä¾¿åç«¯æœåŠ¡çš„æ°´å¹³æ‰©å±• ä¸€ã€JWTçš„æ„æˆä¸€å…±ä¸‰éƒ¨åˆ†ï¼Œç¬¬ä¸€éƒ¨åˆ†æˆ‘ä»¬ç§°å®ƒä¸ºå¤´éƒ¨ï¼ˆheader),ç¬¬äºŒéƒ¨åˆ†æˆ‘ä»¬ç§°å…¶ä¸ºè½½è·ï¼ˆpayload)ï¼Œç¬¬ä¸‰éƒ¨åˆ†æ˜¯ç­¾åï¼ˆsignature). 1.headerjwtçš„å¤´éƒ¨æ‰¿è½½ä¸¤éƒ¨åˆ†ä¿¡æ¯ï¼š å£°æ˜ç±»å‹ï¼Œè¿™é‡Œæ˜¯jwt å£°æ˜åŠ å¯†çš„ç®—æ³• é€šå¸¸ç›´æ¥ä½¿ç”¨ HMAC SHA256 å®Œæ•´çš„å¤´éƒ¨å°±åƒä¸‹é¢è¿™æ ·çš„JSONï¼š 1234&#123; &#x27;typ&#x27;: &#x27;JWT&#x27;, &#x27;alg&#x27;: &#x27;HS256&#x27;&#125; ç„¶åå°†å¤´éƒ¨è¿›è¡Œbase64ç¼–ç ï¼Œæ„æˆäº†ç¬¬ä¸€éƒ¨åˆ†. 1eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9 2.payloadè½½è·å°±æ˜¯å­˜æ”¾æœ‰æ•ˆä¿¡æ¯çš„åœ°æ–¹ã€‚è¿™ä¸ªåå­—åƒæ˜¯ç‰¹æŒ‡é£æœºä¸Šæ‰¿è½½çš„è´§å“ï¼Œè¿™äº›æœ‰æ•ˆä¿¡æ¯åŒ…å«ä¸‰ä¸ªéƒ¨åˆ† æ ‡å‡†ä¸­æ³¨å†Œçš„å£°æ˜ å…¬å…±çš„å£°æ˜ ç§æœ‰çš„å£°æ˜ æ ‡å‡†ä¸­æ³¨å†Œçš„å£°æ˜ (å»ºè®®ä½†ä¸å¼ºåˆ¶ä½¿ç”¨) ï¼š iss: jwtç­¾å‘è€… sub: jwtæ‰€é¢å‘çš„ç”¨æˆ· aud: æ¥æ”¶jwtçš„ä¸€æ–¹ exp: jwtçš„è¿‡æœŸæ—¶é—´ï¼Œè¿™ä¸ªè¿‡æœŸæ—¶é—´å¿…é¡»è¦å¤§äºç­¾å‘æ—¶é—´ nbf: å®šä¹‰åœ¨ä»€ä¹ˆæ—¶é—´ä¹‹å‰ï¼Œè¯¥jwtéƒ½æ˜¯ä¸å¯ç”¨çš„ iat: jwtçš„ç­¾å‘æ—¶é—´ jti: jwtçš„å”¯ä¸€èº«ä»½æ ‡è¯†ï¼Œä¸»è¦ç”¨æ¥ä½œä¸ºä¸€æ¬¡æ€§token,ä»è€Œå›é¿é‡æ”¾æ”»å‡» å…¬å…±çš„å£°æ˜ ï¼š å…¬å…±çš„å£°æ˜å¯ä»¥æ·»åŠ ä»»ä½•çš„ä¿¡æ¯ï¼Œä¸€èˆ¬æ·»åŠ ç”¨æˆ·çš„ç›¸å…³ä¿¡æ¯æˆ–å…¶ä»–ä¸šåŠ¡éœ€è¦çš„å¿…è¦ä¿¡æ¯.ä½†ä¸å»ºè®®æ·»åŠ æ•æ„Ÿä¿¡æ¯ï¼Œå› ä¸ºè¯¥éƒ¨åˆ†åœ¨å®¢æˆ·ç«¯å¯è§£å¯†ã€‚ ç§æœ‰çš„å£°æ˜ ï¼š ç§æœ‰å£°æ˜æ˜¯æä¾›è€…å’Œæ¶ˆè´¹è€…æ‰€å…±åŒå®šä¹‰çš„å£°æ˜ï¼Œä¸€èˆ¬ä¸å»ºè®®å­˜æ”¾æ•æ„Ÿä¿¡æ¯ï¼Œå› ä¸ºbase64åªæ˜¯è¿›è¡Œç¼–ç ï¼Œæ„å‘³ç€è¯¥éƒ¨åˆ†ä¿¡æ¯å¯ä»¥å½’ç±»ä¸ºæ˜æ–‡ä¿¡æ¯ã€‚ å®šä¹‰ä¸€ä¸ªpayload: 12345&#123; &quot;sub&quot;: &quot;1234567890&quot;, &quot;name&quot;: &quot;John Doe&quot;, &quot;admin&quot;: true&#125; ç„¶åå°†å…¶è¿›è¡Œbase64åŠ å¯†ï¼Œå¾—åˆ°JWTçš„ç¬¬äºŒéƒ¨åˆ†ã€‚ 1eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiYWRtaW4iOnRydWV9 3.signatureç­¾åå¯ä»¥æ ¡éªŒpayloadé‡Œé¢çš„ä¿¡æ¯æ˜¯å¦è¢«ç¯¡æ”¹ï¼Œå®ƒç”±ç¼–ç è¿‡åçš„headerå’Œpayloadé‡‡ç”¨headeré‡Œå£°æ˜çš„ç®—æ³•ä½¿ç”¨secret keyè¿›è¡ŒåŠ å¯†ã€‚ 1signature = Crypto(secret, base64(header), base64(payload)) ä¸‹é¢æ˜¯ä¸ªç­¾åç¤ºä¾‹ 1jbcOUQ2bbiYlfVtprEkaT_S6Y6yQnBDOAKDHIHjvl7g å¦‚æœä½ æ„Ÿå…´è¶£ï¼Œå¯ä»¥æ‹·è´ä¸‹é¢çš„JWTå»https://jwt.ioè¿›è¡Œè§£å¯†. 1eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxZGZlZThkOC05OGE1LTQzMTQtYjRhZS1mYjU1YzRiMTg4NDUiLCJlbWFpbCI6ImFyaWVsQGNvZGluZ2x5LmlvIiwibmFtZSI6IkFyaWVsIFdlaW5iZXJnZXIiLCJyb2xlIjoiVVNFUiIsImlhdCI6MTU5ODYwODg0OCwiZXhwIjoxNTk4NjA5MTQ4fQ.oa3ziIZAoVFdn-97rweJAjjFn6a4ZSw7ogIHA74mGq0 æ—¢ç„¶JWTä¸èƒ½å¯¹ä¿¡æ¯åŠ å¯†ï¼Œé‚£å®ƒæ˜¯å¦‚ä½•é˜²æ­¢ä¿¡æ¯è¢«ç¯¡æ”¹çš„å‘¢ï¼Ÿæ¯”å¦‚æˆ‘æŠŠè§’è‰²æ”¹ä¸ºAdminã€‚æœåŠ¡ç«¯å¯¹JWTè¿›è¡Œæ ¡éªŒçš„æ—¶å€™ä¼š å¯¹headerå’Œpayloadå†æ¬¡ä½¿ç”¨secret keyåŠ å¯†ï¼Œå’Œä¼ è¿›æ¥çš„JWTç¬¬ä¸‰éƒ¨åˆ†è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœä¸åŒ¹é…åˆ™JWTä¸åˆæ³•ã€‚ äºŒã€å¸¸è§çš„è¯¯è§£ã€é—®é¢˜å’ŒæŠ€å·§1.çŸ­æš‚çš„æœ‰æ•ˆæœŸå’Œä¸»åŠ¨å¤±æ•ˆæœ‰æ•ˆæœŸè¾ƒçŸ­çš„tokenæ˜¯è¢«é«˜åº¦æ¨èçš„ï¼Œä¸€äº›æœåŠ¡çš„tokenè¿‡æœŸæ—¶é—´ä¸º5åˆ†é’Ÿåœ¨å‘å¸ƒå®ƒä»¬ä¹‹åã€‚ åœ¨tokenè¿‡æœŸä¹‹åï¼Œauth serverå°†ä¼šé¢å‘ä¸€ä¸ªåŒ…å«æœ€æ–°çš„èº«ä»½ä¿¡æ¯çš„access tokenï¼Œè¿™ä¸ªè¿‡ç¨‹è¢«å«åš token refreshã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœç”¨æˆ·è§’è‰²ä» Admin å˜æ›´ä¸º Userï¼Œæ‹¥æœ‰è¾ƒçŸ­çš„ç”Ÿå‘½å‘¨æœŸçš„tokenå¯ä»¥ä¿è¯ç”¨æˆ·çš„tokenåŒ…å«æœ€è¿‘çš„ç”¨æˆ·è§’è‰². ç»¼ä¸Šæ‰€è¿°ï¼Œè¾ƒçŸ­çš„æœ‰æ•ˆæœŸçš„tokenæœ‰ä»¥ä¸‹ä¸¤ä¸ªå¥½å¤„: å¦‚æœä½ çš„tokenè¢«ç›—å–ï¼Œæ”»å‡»è€…ä½¿ç”¨ä½ çš„tokençš„æœ‰æ•ˆæ—¶é—´çª—å£å°†ä¼šå¾ˆçŸ­ JWTæ˜¯æ— çŠ¶æ€çš„ï¼ŒæœåŠ¡ç«¯æ— æ³•ä¸»åŠ¨ä»¤å…¶å¤±æ•ˆï¼Œå› æ­¤ï¼Œè¾ƒçŸ­çš„ç”Ÿå‘½å‘¨æœŸå¯ä»¥è®©æˆ‘ä»¬åœ¨ç”¨æˆ·æƒé™å’Œè§’è‰²æ–¹é¢ä¿è¯å¼ºå¤§çš„ä¸€è‡´æ€§ 2.Refresh Tokenæ¥ä¸Šæ–‡ï¼ŒRefresh Tokenåœ¨å¾ˆå¤šä½¿ç”¨JWTçš„ç³»ç»Ÿçš„æ˜¯å¿…é¡»è¦ç”¨çš„ã€‚ å®ƒçš„ä½¿ç”¨å¾ˆç®€å•ï¼Œåœ¨æœ€åˆauthentication successçš„æ—¶å€™ï¼Œç»™ç”¨æˆ·é¢å‘ä¸¤ä¸ªtoken Access Token : æ¯ä¸ªè¯·æ±‚å¿…é¡»æºå¸¦çš„JSON Web Token ï¼ŒåŒ…å«ç”¨æˆ·å£°æ˜çš„ä¿¡æ¯ Refresh Token : è¿™ä¸ªç‰¹æ®Šç±»å‹çš„tokenæ˜¯è¢«æŒä¹…åŒ–ä¿å­˜åœ¨æ•°æ®åº“ä¸­çš„ï¼Œè¢«Auth Serveræ‰€æŒæœ‰ã€‚å®ƒç»å¸¸ä¸æ˜¯JWTï¼Œè€Œæ˜¯ä¸€ä¸ªç‹¬ä¸€æ— äºŒçš„hashå€¼ã€‚ æˆ‘ä»¬å·²ç»çŸ¥é“ï¼ŒAccess Tokenä¼šæºå¸¦åœ¨æ¯ä¸ªè¯·æ±‚ä¸­å¹¶ä¼šåœ¨æŸä¸ªæ—¶é—´èŠ‚ç‚¹å¤±æ•ˆã€‚ç„¶åå‰ç«¯å°†ä¼šå‘é€ä¸€ä¸ªRefreshè¯·æ±‚å¹¶æºå¸¦ Refresh Tokenã€‚Auth Serverå°†ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„Access Tokenè¿”å›ç»™ç”¨æˆ·ï¼Œç”¨æˆ·ä½¿ç”¨è¿™ä¸ªtokenç›´åˆ°å®ƒè¿‡æœŸï¼Œç„¶åå†åˆ·æ–°ä¸€éï¼ŒOver and overã€‚ Refresh Tokençš„æœ‰æ•ˆæœŸä¸€èˆ¬ä¼šé•¿è¾¾æ•°æœˆï¼Œå½“å®ƒå¤±æ•ˆåï¼Œç”¨æˆ·å¿…é¡»é‡æ–°ç™»å½•ã€‚ 3.Secret VS Private-Public Keyæµè¡Œçš„ HS256 ç­¾åç®—æ³•çš„ç¼ºç‚¹æ˜¯åœ¨ç”Ÿæˆå’ŒéªŒè¯çš„æ—¶å€™éƒ½éœ€è¦è®¿é—®å¯†é’¥ã€‚å¯¹äºå•ä¸€ç¨‹åºè€Œè¨€ï¼Œè¿™ä¸æ˜¯ä¸€ä¸ªé—®é¢˜ï¼Œä½†å¦‚æœä½ æœ‰ä¸€ä¸ªç”±å¤šä¸ªæœåŠ¡æ„å»ºçš„åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œå½¼æ­¤ç‹¬ç«‹è¿è¡Œï¼Œä½ å¿…é¡»åœ¨ä¸¤ä¸ªç³Ÿç³•çš„é€‰æ‹©ä¹‹é—´è¿›è¡Œé€‰æ‹©ï¼š ä½ å¯ä»¥é€‰æ‹©ä½¿ç”¨ä¸“ç”¨æœåŠ¡è¿›è¡Œ token çš„ç”Ÿæˆå’ŒéªŒè¯ã€‚ä»å®¢æˆ·ç«¯æ¥æ”¶ token çš„ä»»ä½•æœåŠ¡ï¼Œéƒ½éœ€è¦è°ƒç”¨èº«ä»½éªŒè¯æœåŠ¡æ¥éªŒè¯ tokenã€‚å¯¹äºç¹å¿™çš„ç³»ç»Ÿæ¥è¯´ï¼Œè¿™ä¼šåœ¨èº«ä»½éªŒè¯æœåŠ¡ä¸Šäº§ç”Ÿæ€§èƒ½é—®é¢˜ã€‚ ä½ å¯ä»¥ä¸ºæ‰€æœ‰éœ€è¦ä»å®¢æˆ·ç«¯æ¥æ”¶ token çš„æœåŠ¡é…ç½®å¯†é’¥ï¼Œä»¥ä¾¿å®ƒä»¬å¯ä»¥éªŒè¯ tokenï¼Œæ— éœ€è°ƒç”¨èº«ä»½éªŒè¯æœåŠ¡ã€‚ä½†æ˜¯ï¼Œåœ¨å¤šä¸ªåœ°æ–¹ä½¿ç”¨å¯†é’¥ä¼šå¢åŠ å…¶å—åˆ°æ”»å‡»çš„é£é™©ï¼Œå¹¶ä¸”ä¸€æ—¦å—åˆ°æ”»å‡»ï¼Œæ”»å‡»è€…å°±å¯ä»¥ç”Ÿæˆæœ‰æ•ˆ token å¹¶æ¨¡æ‹Ÿç³»ç»Ÿä¸­çš„ä»»ä½•ç”¨æˆ·ã€‚ å› æ­¤å¯¹äºè¿™äº›ç¨‹åºï¼Œæœ€å¥½å°†ç­¾åå¯†é’¥å®‰å…¨å­˜å‚¨åœ¨èº«ä»½éªŒè¯æœåŠ¡ä¸­ï¼Œå¹¶ä¸”ä»…ç”¨äºç”Ÿæˆå¯†é’¥ï¼Œè€Œå…¶ä»–æ‰€æœ‰æœåŠ¡æ— éœ€è®¿é—®å¯†é’¥å°±å¯ä»¥éªŒè¯è¿™äº› tokenã€‚å®é™…ä¸Šï¼Œè¿™å¯ä»¥é€šè¿‡å…¬é’¥åŠ å¯†æ¥å®ç°ã€‚ å…¬é’¥åŠ å¯†åŸºäºä¸¤ä¸ªç»„ä»¶çš„åŠ å¯†å¯†é’¥ï¼šä¸€ä¸ªå…¬é’¥å’Œä¸€ä¸ªç§é’¥ã€‚åœ¨å‘½åå®ç°æ—¶ï¼Œå…¬é’¥ç»„ä»¶å¯ä»¥è‡ªç”±å…±äº«ã€‚å¯ä»¥ä½¿ç”¨å…¬é’¥åŠ å¯†æ¥å®Œæˆä¸¤ä¸ªå·¥ä½œæµç¨‹ï¼š æ¶ˆæ¯åŠ å¯†ï¼šå¦‚æœä½ æƒ³è¦å‘æŸäººå‘é€åŠ å¯†æ¶ˆæ¯ï¼Œæˆ‘å¯ä»¥ä½¿ç”¨ä»–çš„å…¬é’¥æ¥åŠ å¯†ã€‚åŠ å¯†çš„æ¶ˆæ¯åªèƒ½ç”¨ä»–çš„ç§é’¥æ¥è§£å¯†ã€‚ æ¶ˆæ¯ç­¾åï¼šå¦‚æœæˆ‘æƒ³è¦ç­¾ç½²ä¸€æ¡æ¶ˆæ¯å®ƒæ¥è‡ªæˆ‘ï¼Œæˆ‘å¯ä»¥ä½¿ç”¨è‡ªå·±çš„ç§é’¥æ¥ç”Ÿæˆç­¾åã€‚ä»»ä½•å¯¹éªŒè¯æ¶ˆæ¯æ„Ÿå…´è¶£çš„äººï¼Œéƒ½å¯ä»¥ä½¿ç”¨æˆ‘çš„å…¬é’¥æ¥ç¡®è®¤ç­¾åæ˜¯å¦æœ‰æ•ˆã€‚ JWT çš„ç­¾åç®—æ³•å®ç°äº†ä¸Šé¢çš„ç¬¬äºŒç§æƒ…å†µã€‚ä½¿ç”¨æœåŠ¡å™¨çš„ç§é’¥å¯¹ token è¿›è¡Œç­¾åï¼Œç„¶åä»»ä½•ä½¿ç”¨æœåŠ¡å™¨å…¬é’¥çš„äººéƒ½å¯ä»¥éªŒè¯å®ƒä»¬ï¼Œä»»ä½•æƒ³è¦æ‹¥æœ‰å®ƒçš„äººéƒ½å¯ä»¥å…è´¹ä½¿ç”¨ã€‚ä¸¾ä¸ªä¾‹å­æ¥è¯´ä¸‹é¢ï¼Œæˆ‘ä½¿ç”¨ RS256 ç­¾åç®—æ³•ï¼Œå®ƒæ˜¯ RSA-SHA256 çš„ç®€å†™ã€‚ ä¸‹ä¸€æ­¥æ˜¯ä¸ºç¨‹åºç”Ÿæˆå…¬é’¥/ç§é’¥é›† (é€šå¸¸ç§°ä¸º â€œç§˜é’¥å¯¹â€)ã€‚ç”Ÿæˆ RSA å¯†é’¥æœ‰å‡ ç§ä¸åŒçš„æ–¹æ³•ï¼Œä½†æˆ‘å–œæ¬¢ä½¿ç”¨ openssh ä¸­çš„ ssh-keygen å·¥å…·ï¼š 123456789101112131415161718192021$ ssh-keygen -t rsa -b 4096Generating public/private rsa key pair.Enter file in which to save the key (/home/miguel/.ssh/id_rsa): jwt-keyEnter passphrase (empty for no passphrase):Enter same passphrase again:Your identification has been saved in jwt-key.Your public key has been saved in jwt-key.pub.The key fingerprint is:SHA256:ZER3ddV4/smE0rnoNesS+IwCNSbwu5SThfiWWtLYRVM miguel@MS90J8G8WLThe key&#x27;s randomart image is:+---[RSA 4096]----+| .+E. ....=|| . + . . ..o|| + o + . oo || . + O . + ..|| = @ S . o + o|| o # . o + o.|| * + = o o || . . . . = . || . o. |+----[SHA256]-----+ ssh-keygen å‘½ä»¤çš„ -t é€‰é¡¹å®šä¹‰äº†ï¼Œæˆ‘æ­£åœ¨è¯·æ±‚çš„ç§˜é’¥å¯¹ï¼Œ-b é€‰é¡¹æŒ‡å®šå¯†é’¥å¤§å°ä¸º 4096 ä½ï¼Œè¿™è¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªéå¸¸å®‰å…¨çš„å¯†é’¥é•¿åº¦ã€‚å½“ä½ è¿è¡Œè¯¥å‘½ä»¤æ—¶ï¼Œç³»ç»Ÿæç¤ºä½ éœ€è¦ä¸ºç§˜é’¥å¯¹æä¾›æ–‡ä»¶åï¼Œè¿™é‡Œæˆ‘åœ¨å½“å‰è·¯å¾„ä¸‹ä½¿ç”¨ jwt-key ã€‚ç„¶åï¼Œç³»ç»Ÿå°†æç¤ºä½ è¾“å…¥å¯†ç æ¥ä¿æŠ¤å¯†é’¥ï¼Œå¯†é’¥éœ€è¦ä¿ç•™ä¸ºç©ºã€‚ å½“è¿è¡Œå®Œå‘½ä»¤ï¼Œä½ ä¼šåœ¨å½“å‰ç›®å½•ä¸‹è·å¾—ä¸¤ä¸ªæ–‡ä»¶ï¼Œjwt-key å’Œ jwt-key.pubã€‚å‰è€…æ˜¯ç§é’¥ï¼Œå°†ç”¨äºç”Ÿæˆ token ç­¾åï¼Œå› æ­¤ä½ éœ€è¦ä¿å­˜å¥½å®ƒã€‚ç‰¹åˆ«æ˜¯ï¼Œä½ ä¸åº”è¯¥å°†ç§é’¥æäº¤åˆ°ä»£ç ä»“åº“ï¼Œè€Œåº”ç›´æ¥åœ¨æœåŠ¡å™¨ä¸Šå®‰è£… (å¦‚æœä½ éœ€è¦é‡å»ºæœåŠ¡å™¨ï¼Œåˆ™åº”åšå¥½å¤‡ä»½)ã€‚.pub æ–‡ä»¶ç”¨äºéªŒè¯ tokenã€‚ç”±äºæ­¤æ–‡ä»¶æ²¡æœ‰æ•æ„Ÿä¿¡æ¯ï¼Œå› æ­¤ä½ å¯ä»¥åœ¨éœ€è¦éªŒè¯ token çš„ä»»ä½•é¡¹ç›®ä¸Šéšæ„æ·»åŠ è¯¥æ–‡ä»¶çš„å‰¯æœ¬ã€‚ ä½¿ç”¨æ­¤ç§˜é’¥å¯¹ç”Ÿæˆ token çš„è¿‡ç¨‹ä¸æˆ‘ä¹‹å‰çš„å†…å®¹éå¸¸ç›¸ä¼¼ã€‚æˆ‘ä»¬å…ˆä½¿ç”¨ç§é’¥åˆ›å»ºä¸€ä¸ªæ–°çš„ token: 1234import jwtprivate_key = open(&#x27;jwt-key&#x27;).read()token = jwt.encode(&#123;&#x27;user_id&#x27;: 123&#125;, private_key, algorithm=&#x27;RS256&#x27;).decode(&#x27;utf-8&#x27;)print(token) ç„¶åå†ä½¿ç”¨å…¬é’¥æ¥éªŒè¯ï¼š 12345import jwtpublic_key = open(&#x27;jwt-key.pub&#x27;).read()token = &#x27;eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9.eyJ1c2VyX2lkIjoxMjN9.HT1kBSdGFAznrhbs2hB6xjVDilMUmKA-_36n1pLLtFTKHoO1qmRkUcy9bJJwGuyfJ_dbzBMyBwpXMj-EXnKQQmKlXsiItxzLVIfC5qE97V6l6S0LzT9bzixvgolwi-qB9STp0bR_7suiXaON-EzBWFh0PzZi7l5Tg8iS_0_iSCQQlX5MSJW_-bHESTf3dfj5GGbsRBRsi1TRBzvxMUB6GhNsy6rdUhwoTkihk7pljISTYs6BtNoGRW9gVUzfA2es3zwBaynyyMeSocYet6WJri97p0eRnVGtHSWwAmnzZ-CX5-scO9uYmb1fT1EkhhjGhnMejee-kQkMktCTNlPsaUAJyayzdgEvQeo5M9ZrfjEnDjF7ntI03dck1t9Bgy-tV1LKH0FWNLq3dCJJrYdQx--A-I7zW1th0C4wNcDe_d_GaYopbtU-HPRG3Z1SPKFuX1m0uYhk9aySvkec66NBfvV2xEgo8lRZyNxntXkMdeJCEiLF1UhQvvSvmWaWC-0uRulYACn4H-tZiaK7zvpcPkrsfJ7iR_O1bxMPziKpsM4b7c7tmsEcOUZY-IHEI9ibd54_A1O72i08sCWKT5CXyG70MAPqyR0MFlcV7IuDtBW3LCqyvfsDVk4eIj8VcSU1OKQJ1Gl-CTOHEyN-ncV3NslVLaT9Q1C4E7uK2QpS8z0&#x27;payload = jwt.decode(token, public_key, algorithms=[&#x27;RS256&#x27;])print(payload) å¦‚æœä½ æ„Ÿå…´è¶£å¯ä»¥ä½¿ç”¨æˆ‘çš„å…¬é’¥æ¥éªŒè¯ï¼š 1public_key = &#x27;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDKQ43JBiv6FwtMpq6hStz59tSUo8mEU2SwQSg6mGmm4RBZ7uudRSnSwcvGSv45J1rKx1GUSuGYs/To4Ehsney1utN3jUY0XPhSUgxgCIFz66R9eAu92pykWBcSF96mj753LsyBStqq1nCu1D0dEJOBQnz9J2Zzs0N71ZabEvb6hXE8e119j2LFEUQWfM+3+AzrgsVXsTFE8y3LKeWohzQRAY3cAsdPPKI2ayHtlW6DoQ9LLqnsj4YkCe0hDIP/unTyx5OijbD6r8AeAyY4EGIL3c3jYhla6pclSqyLyq7kI0lUAQq4IXS4DYdqNHX01fI57tZeim0+nM3/9H1vJC2EPCDZDRdC2reJ4go/AssyQGamlmlu21Xt3n7rthYWg1u6Y/wpabDBEQcoXJPrBwyuGK8VRQrUU16GMahSiTpHxwvKHBMVyghLPaC8SBf9/edJDxBIq9s2wpnNBdD8TohqAXQILnJt5QBbiG2L/3uMqrEg+udWURBOcVok9TnS6RTtvezM1dSlcYoNMhGYNLMKgBByMOM/bMqJg8udqWqPW2/i/eCNPTLRPqZR7Kdo/GGcMY9pSsDvbzM/IHdeV1JhTyRcSi0xJDCs2M3hmWLg1rJNf7wQZKISIXefIItrABRoF1MuKOsk2CgPnZJgjVhzjzSP7EmyzRAv0E8gCeCtDQ== root@VM-20-3-centos&#x27; æ€»ç»“æ¨èå¤§å®¶é‡‡ç”¨ RS256 éå¯¹ç§°åŠ å¯†ç®—æ³•æ¥ç”Ÿæˆå’ŒéªŒè¯JWT Tokenï¼Œtokençš„æœ‰æ•ˆæœŸè¦çŸ­ä¸€ç‚¹ï¼Œå¹¶ä¸”è¦æœ‰Refresh Tokenæœºåˆ¶ã€‚","tags":[{"name":"JWT","slug":"JWT","permalink":"https://alexhuihui.github.io/tags/JWT/"},{"name":"ç­¾å","slug":"ç­¾å","permalink":"https://alexhuihui.github.io/tags/%E7%AD%BE%E5%90%8D/"}]},{"title":"ã€å®‰å…¨ã€‘åŸºæœ¬åŠ å¯†è§£å¯†ç®—æ³•ä»‹ç»","date":"2021-12-23T03:28:18.000Z","path":"article/20211223.html","text":"å¯¹ç§°åŠ å¯†1.ä»‹ç» åŠ å¯†å’Œè§£å¯†éƒ½æ˜¯ä½¿ç”¨ç›¸åŒçš„ç§˜é’¥ ä¼˜ç‚¹æ˜¯åŠ å¯†æ•ˆç‡é«˜ï¼Œç¼ºç‚¹æ˜¯ä¿å¯†æ€§ä½ 2.å¸¸è§çš„å¯¹ç§°åŠ å¯†ç®—æ³• DESç®—æ³•(Data Encryption Standard) AESç®—æ³•(Advanced Encryption Standard) 3.ä½¿ç”¨åœºæ™¯ å¾®æœåŠ¡ä¸­ç”¨ä½œMySQLï¼ŒRedisç­‰æœåŠ¡å™¨åœ°å€ã€ç«¯å£ã€è´¦æˆ·åã€å¯†ç ç­‰é…ç½®çš„åŠ å¯† éå¯¹ç§°åŠ å¯†1.ä»‹ç» æœ‰ä¸¤æŠŠé’¥åŒ™(å¯†é’¥å¯¹)ï¼Œå…¬é’¥å’Œç§é’¥ï¼Œå…¬é’¥çš„è¯ç»™åˆ«äººï¼Œç§é’¥è‡ªå·±ä¿å­˜ ç‰¹ç‚¹æ˜¯åŠ å¯†é€Ÿåº¦æ…¢äº›ï¼Œä½†æ˜¯å®‰å…¨ç³»æ•°å¾ˆé«˜ åŠ å¯†å’Œè§£å¯†çš„è§„åˆ™æ˜¯ï¼šå…¬é’¥åŠ å¯†åªèƒ½ç§é’¥è§£å¯†ï¼Œç§é’¥åŠ å¯†åªèƒ½å…¬é’¥è§£å¯† 2. ç®—æ³• RSA 3.ä½¿ç”¨åœºæ™¯ èº«ä»½è®¤è¯ï¼šä¸€æ¡åŠ å¯†ä¿¡æ¯è‹¥èƒ½ç”¨A çš„å…¬é’¥èƒ½è§£å¼€ï¼Œåˆ™è¯¥ä¿¡æ¯ä¸€å®šæ˜¯ç”¨A çš„ç§é’¥åŠ å¯†çš„ï¼Œè¯¥èƒ½ç¡®å®šè¯¥ç”¨æˆ·æ˜¯A é™Œç”Ÿäººé€šä¿¡ï¼šA å’ŒB ä¸¤ä¸ªäººäº’ä¸è®¤è¯†ï¼ŒAæŠŠè‡ªå·±çš„å…¬é’¥å‘ç»™Bï¼ŒBä¹ŸæŠŠè‡ªå·±çš„å…¬é’¥å‘ç»™Aï¼Œåˆ™åŒæ–¹å¯ä»¥é€šè¿‡å¯¹æ–¹çš„å…¬é’¥åŠ å¯†ä¿¡æ¯é€šä¿¡ã€‚C è™½ç„¶ä¹Ÿèƒ½å¾—åˆ°Aã€B çš„å…¬é’¥ï¼Œä½†æ˜¯ä»–è§£ä¸å¼€å¯†æ–‡ã€‚ æ”¯ä»˜å®æ”¯ä»˜åŠ å¯† å•å‘åŠ å¯†ï¼ˆMD5ï¼‰ å•å‘åŠ å¯†ç®—æ³•åœ¨åŠ å¯†è¿‡ç¨‹ä¸­ä¸éœ€è¦ä½¿ç”¨å¯†é’¥ï¼Œè¾“å…¥æ˜æ–‡åç”±ç®—æ³•ç›´æ¥åŠ å¯†æˆå¯†æ–‡ï¼Œå¯†æ–‡æ— æ³•è§£å¯†ï¼Œåªæœ‰é‡æ–°è¾“å…¥å¯†æ–‡ï¼Œå¹¶ç»è¿‡åŒæ ·çš„åŠ å¯†ç®—æ³•å¤„ç†ï¼Œå¾—åˆ°å½¢åŒçš„å¯†æ–‡å¹¶è¢«ç³»ç»Ÿé‡æ–°è¯†åˆ«åï¼Œæ‰èƒ½çœŸæ­£çš„è§£å¯†ï¼Œè¿™ç§ç®—æ³•éå¸¸å¤æ‚ï¼Œé€šå¸¸åªåœ¨æ•°æ®é‡æœ‰é™çš„æƒ…å½¢ä¸‹ä½¿ç”¨ï¼Œå¦‚å¹¿æ³›åº”ç”¨åœ¨è®¡ç®—æœºç³»ç»Ÿä¸­çš„å£ä»¤åŠ å¯†ç­‰ã€‚ ä»£ç æ¼”ç¤º","tags":[{"name":"AES","slug":"AES","permalink":"https://alexhuihui.github.io/tags/AES/"},{"name":"RSA","slug":"RSA","permalink":"https://alexhuihui.github.io/tags/RSA/"},{"name":"MD5","slug":"MD5","permalink":"https://alexhuihui.github.io/tags/MD5/"}]},{"title":"ã€Hexoåšå®¢æŠ˜è…¾ã€‘HexoåŸºäºgithubæ­å»ºé™æ€åšå®¢","date":"2021-12-22T08:56:24.000Z","path":"article/20211222.html","text":"å¼€å§‹ä¹‹å‰åœ¨å®‰è£…hexoä¹‹å‰ï¼Œå¿…é¡»ç¡®è®¤ä½ å·²ç»å®‰è£…äº†Node.jså’ŒGitã€‚ 1.åˆ›å»ºGitHubä»“åº“æ³¨å†ŒGitHubè´¦å·ï¼Œåˆ›å»ºä¸€ä¸ªä»¥â€ç”¨æˆ·å.github.ioâ€å‘½åçš„ä»“åº“ï¼Œå¦‚æˆ‘çš„ç”¨æˆ·åä¸ºalexhuihui,é‚£æˆ‘çš„ä»“åº“åä¸ºï¼šalexhuihui.github.ioï¼Œä»“åº“é»˜æœ‰masteråˆ†æ”¯ï¼Œç”¨äºæ‰˜ç®¡ç”Ÿæˆçš„é™æ€æ–‡ä»¶ï¼Œå†æ–°å»ºä¸€ä¸ªblog-files(åå­—è‡ªå®š)åˆ†æ”¯ï¼Œç”¨äºæ‰˜ç®¡åå°æ–‡ä»¶ï¼Œæ–¹ä¾¿ä»¥åæ¢ç”µè„‘æ—¶åå°æ–‡ä»¶ä¸ä¼šä¸¢å¤±ã€‚ 2.é…ç½®Gitè®¾ç½®Gitçš„ç”¨æˆ·åå’Œé‚®ä»¶åœ°å€ï¼ˆé‚®ç®±å°±æ˜¯ä½ æ³¨å†ŒGithubæ—¶å€™çš„é‚®ç®±ï¼‰ï¼Œæ‰“å¼€Git Bash,é”®å…¥ï¼š 12$ git config --global user.name &quot;username&quot;$ git config --global user.email &quot;email@example.com&quot; 3.æœ¬åœ°Gitä¸GitHubå»ºç«‹è”ç³»è¿™é‡Œä»‹ç»SSHçš„é…ç½®ï¼Œå…ˆæ£€æŸ¥ç”µè„‘æ˜¯å¦å·²ç»æœ‰SSH 1$ ls -al ~/.ssh å¦‚æœä¸å­˜åœ¨å°±æ²¡æœ‰å…³ç³»ï¼Œå¦‚æœå­˜åœ¨çš„è¯ï¼Œç›´æ¥åˆ é™¤.sshæ–‡ä»¶å¤¹é‡Œé¢æ‰€æœ‰æ–‡ä»¶ã€‚è¾“å…¥ä»¥ä¸‹æŒ‡ä»¤åï¼Œä¸€è·¯å›è½¦å°±å¥½ï¼š 1$ ssh-keygen -t rsa -C &quot;emailt@example.com&quot; ç„¶åé”®å…¥ä»¥ä¸‹æŒ‡ä»¤ï¼š 12$ ssh-agent -s$ ssh-add ~/.ssh/id_rsa å¦‚æœå‡ºç°è¿™ä¸ªé”™è¯¯:Could not open a connection to your authentication agentï¼Œåˆ™å…ˆæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤å³å¯ï¼š 1$ ssh-agent bash å†é‡æ–°è¾“å…¥æŒ‡ä»¤ï¼š 1$ ssh-add ~/.ssh/id_rsa åˆ°äº†è¿™ä¸€æ­¥ï¼Œå°±å¯ä»¥æ·»åŠ SSH keyåˆ°ä½ çš„Githubè´¦æˆ·äº†ã€‚é”®å…¥ä»¥ä¸‹æŒ‡ä»¤ï¼Œæ‹·è´Keyï¼ˆå…ˆæ‹·è´äº†ï¼Œç­‰ä¸€ä¸‹å¯ä»¥ç›´æ¥ç²˜è´´ï¼‰ï¼š 1$ clip &lt; ~/.ssh/id_rsa.pub åœ¨githubä¸Šç‚¹å‡»ä½ çš„å¤´åƒâ€“&gt;Your profileâ€“&gt;Edit profileâ€“&gt;SSH and GPG keysâ€“&gt;New SSH keyTitleè‡ªå·±éšä¾¿å–ï¼Œç„¶åè¿™ä¸ªKeyå°±æ˜¯åˆšåˆšæ‹·è´çš„ï¼Œä½ ç›´æ¥ç²˜è´´å°±å¥½ï¼ˆä¹Ÿå¯ä»¥æ–‡æœ¬æ‰“å¼€id_rsa.pubå¤åˆ¶å…¶å†…å®¹ï¼‰ï¼Œæœ€åAdd SSH keyã€‚æœ€åè¿˜æ˜¯æµ‹è¯•ä¸€ä¸‹å§ï¼Œé”®å…¥ä»¥ä¸‹å‘½ä»¤ï¼š 1$ ssh -T git@github.com ä½ å¯èƒ½ä¼šçœ‹åˆ°æœ‰è­¦å‘Šï¼Œæ²¡äº‹ï¼Œè¾“å…¥â€œyesâ€å°±å¥½ã€‚ 4.åˆå§‹åŒ–hexoæ–‡ä»¶å¤¹åˆ°GitHubçš„alexhuihui.github.ioä»“åº“ä¸‹ï¼Œç‚¹å‡»Clone or download,å¤åˆ¶é‡Œé¢çš„HTTPSåœ°å€ã€‚åœ¨Eç›˜æˆ–æ˜¯ä½ å–œçˆ±çš„æ–‡ä»¶å¤¹ä¸‹ï¼Œå³é”®Git Bash Here: é”®å…¥git clone -b develop &lt;åˆšå¤åˆ¶çš„åœ°å€&gt; 12$ git clone -b blog-files https://github.com/alexhuihui/alexhuihui.github.io.git$ mkdir Hexo-admin Hexoå®‰è£…é…ç½®1.Hexoåˆå§‹åŒ–è¿›å…¥Hexo-adminæ–‡ä»¶å¤¹ 1$ cd Hexo-admin æ¥ä¸‹æ¥åªéœ€è¦ä½¿ç”¨ npm å³å¯å®Œæˆ Hexo çš„å®‰è£…: 1$ npm install -g hexo-cli å®‰è£… Hexo å®Œæˆåï¼Œè¯·æ‰§è¡Œä¸‹åˆ—å‘½ä»¤ï¼ŒHexo å°†ä¼šåœ¨æŒ‡å®šæ–‡ä»¶å¤¹ä¸­æ–°å»ºæ‰€éœ€è¦çš„æ–‡ä»¶: 12$ hexo init$ npm install æ¥ä¸‹æ¥ä¹Ÿå¯ä»¥æœ¬åœ°é¢„è§ˆåšå®¢ï¼Œæ‰§è¡Œä¸‹åˆ—å‘½ä»¤,ç„¶ååˆ°æµè§ˆå™¨è¾“å…¥localhost:4000çœ‹çœ‹ã€‚ 12$ hexo generate$ hexo server è¾“å…¥Ctrl+Cåœæ­¢æœåŠ¡ã€‚ 2.Hexoé…ç½®ç”¨ç¼–è¾‘å™¨æ‰“å¼€ Hexo-admin/ ä¸‹çš„é…ç½®æ–‡ä»¶_config.ymlæ‰¾åˆ°ï¼š 12345# Deployment## Docs: https://hexo.io/docs/deployment.htmldeploy: type: repository: åˆ°GitHubçš„alexhuihui.github.ioä»“åº“ä¸‹ï¼Œç‚¹å‡»Clone or download,å¤åˆ¶é‡Œé¢çš„HTTPSåœ°å€åˆ°repository:ï¼Œæ·»åŠ branch: masterã€‚ 123456# Deployment## Docs: https://hexo.io/docs/deployment.htmldeploy: type: git repository: https://github.com/alexhuihui/alexhuihui.github.io.git branch: master 3.å®Œæˆéƒ¨ç½²æœ€åä¸€æ­¥ï¼Œå¿«è¦æˆåŠŸäº†ï¼Œé”®å…¥æŒ‡ä»¤ï¼š 123$ npm install hexo-deployer-git --save$ hexo generate$ hexo deploy è¾“å…¥å¼¹å‡ºæ¡†çš„ç”¨æˆ·åä¸å¯†ç (é¦–æ¬¡ä½¿ç”¨gitä¼šå¼¹å‡º)ã€‚OKï¼Œæˆ‘ä»¬çš„åšå®¢å°±å·²ç»å®Œå…¨æ­å»ºèµ·æ¥äº†ï¼Œåœ¨æµè§ˆå™¨è¾“å…¥ï¼ˆå½“ç„¶ï¼Œæ˜¯ä½ çš„Repositoryåï¼‰ï¼Œä¾‹å¦‚æˆ‘çš„ï¼šalexhuihui.github.io/æ¯æ¬¡ä¿®æ”¹æœ¬åœ°æ–‡ä»¶åï¼Œéœ€è¦é”®å…¥hexo generateæ‰èƒ½ä¿å­˜ï¼Œå†é”®å…¥hexo deployä¸Šä¼ æ–‡ä»¶ã€‚æˆåŠŸä¹‹åå‘½ä»¤è¡Œæœ€åä¸¤å¥å¤§æ¦‚æ˜¯è¿™æ ·ï¼š 123To https://github.com/alexhuihui/alexhuihui.github.io.git 7f3b50a..128a10d HEAD -&gt; masterINFO Deploy done: git å½“ç„¶ï¼Œä¸è¦å¿˜äº†å›é€€åˆ°çˆ¶æ–‡ä»¶å¤¹æäº¤ç½‘ç«™ç›¸å…³çš„æ–‡ä»¶ä»¥å¤‡ä»Šåè¿ç§»ï¼Œä¾æ¬¡æ‰§è¡Œgit add .ã€git commit -m â€œâ€¦â€ã€git push origin developã€‚ æ—¥å¸¸æ“ä½œ1.å†™æ–‡ç« æ‰§è¡Œnewå‘½ä»¤ï¼Œç”ŸæˆæŒ‡å®šåç§°çš„æ–‡ç« è‡³ Admin-blog\\source_posts\\æ–‡ç« æ ‡é¢˜.md ã€‚ 1$ hexo new [layout] &quot;æ–‡ç« æ ‡é¢˜&quot; #æ–°å»ºæ–‡ç«  ç„¶åç”¨ç¼–è¾‘å™¨æ‰“å¼€â€œæ–‡ç« æ ‡é¢˜.mdâ€æŒ‰ç…§Markdownè¯­æ³•ä¹¦å†™æ–‡ç« ã€‚ å…¶ä¸­layoutæ˜¯å¯é€‰å‚æ•°ï¼Œé»˜è®¤å€¼ä¸ºpostã€‚åˆ° scaffolds ç›®å½•ä¸‹æŸ¥çœ‹ç°æœ‰çš„layoutã€‚å½“ç„¶ä½ å¯ä»¥æ·»åŠ è‡ªå·±çš„layoutï¼Œ åŒæ—¶ä½ ä¹Ÿå¯ä»¥ç¼–è¾‘ç°æœ‰çš„layoutï¼Œæ¯”å¦‚postçš„layouté»˜è®¤æ˜¯ hexo\\scaffolds\\post.md 1234title: &#123; &#123; title &#125; &#125;date: &#123; &#123; date &#125; &#125;tags:--- æˆ‘æƒ³æ·»åŠ categoriesï¼Œä»¥å…æ¯æ¬¡æ‰‹å·¥è¾“å…¥ï¼Œåªéœ€è¦ä¿®æ”¹è¿™ä¸ªæ–‡ä»¶æ·»åŠ ä¸€è¡Œï¼Œå¦‚ä¸‹ï¼š 12345title: &#123; &#123; title &#125; &#125;date: &#123; &#123; date &#125; &#125;categories:tags:--- æ–‡ä»¶æ ‡é¢˜ä¹Ÿæ˜¯mdæ–‡ä»¶çš„åå­—ï¼ŒåŒæ—¶ä¹Ÿå‡ºç°åœ¨ä½ æ–‡ç« çš„URLä¸­ï¼ŒpostNameå¦‚æœåŒ…å«ç©ºæ ¼ï¼Œå¿…é¡»ç”¨â€å°†å…¶åŒ…å›´ã€‚è¯·æ³¨æ„ï¼Œå¤§æ‹¬å·ä¸å¤§æ‹¬å·ä¹‹é—´æˆ‘å¤šåŠ äº†ä¸ªç©ºæ ¼ï¼Œå¦åˆ™ä¼šè¢«è½¬ä¹‰ï¼Œä¸èƒ½æ­£å¸¸æ˜¾ç¤ºï¼›æ‰€æœ‰æ–‡ä»¶&quot;ï¼š&quot;åé¢éƒ½å¿…é¡»æœ‰ä¸ªç©ºæ ¼ï¼Œä¸ç„¶ä¼šæŠ¥é”™ã€‚ 2.æäº¤æ¯æ¬¡åœ¨æœ¬åœ°å¯¹åšå®¢è¿›è¡Œä¿®æ”¹åï¼Œå…ˆæ‰§è¡Œä¸‹åˆ—å‘½ä»¤æäº¤ç½‘ç«™ç›¸å…³çš„æ–‡ä»¶ã€‚ 123$ git add .$ git commit -m &quot;...&quot;$ git push origin develop ç„¶åæ‰æ‰§è¡Œhexo generate -då‘å¸ƒç½‘ç«™åˆ°masteråˆ†æ”¯ä¸Šã€‚ 1$ hexo generate -d 3.æœ¬åœ°ä»“åº“ä¸¢å¤±å½“ä½ æƒ³åœ¨å…¶ä»–ç”µè„‘å·¥ä½œï¼Œæˆ–ç”µè„‘é‡è£…ç³»ç»Ÿåï¼Œå®‰è£…Gitä¸Node.jsåï¼Œå¯ä»¥ä½¿ç”¨ä¸‹åˆ—æ­¥éª¤ï¼š 3.1æ‹·è´ä»“åº“1$ git clone -b develop https://github.com/alexhuihui/alexhuihui.github.io.git 3.2é…ç½®Hexoåœ¨æœ¬åœ°æ–°æ‹·è´çš„alexhuihui.github.ioæ–‡ä»¶å¤¹ä¸‹é€šè¿‡Git bashä¾æ¬¡æ‰§è¡Œä¸‹åˆ—æŒ‡ä»¤: 1234$ npm install -g hexo-cli$ npm install hexo$ npm install$ npm install hexo-deployer-git --save å°Tips:hexo å‘½ä»¤1234567891011121314hexo new &quot;postName&quot; #æ–°å»ºæ–‡ç« hexo new page &quot;pageName&quot; #æ–°å»ºé¡µé¢hexo generate #ç”Ÿæˆé™æ€é¡µé¢è‡³publicç›®å½•hexo server #å¼€å¯é¢„è§ˆè®¿é—®ç«¯å£ï¼ˆé»˜è®¤ç«¯å£4000ï¼Œ&#x27;ctrl + c&#x27;å…³é—­serverï¼‰hexo deploy #å°†.deployç›®å½•éƒ¨ç½²åˆ°GitHubhexo help # æŸ¥çœ‹å¸®åŠ©hexo version #æŸ¥çœ‹Hexoçš„ç‰ˆæœ¬hexo deploy -g #ç”ŸæˆåŠ éƒ¨ç½²hexo server -g #ç”ŸæˆåŠ é¢„è§ˆ#å‘½ä»¤çš„ç®€å†™hexo n == hexo newhexo g == hexo generatehexo s == hexo serverhexo d == hexo deploy","tags":[{"name":"hexo","slug":"hexo","permalink":"https://alexhuihui.github.io/tags/hexo/"},{"name":"blog","slug":"blog","permalink":"https://alexhuihui.github.io/tags/blog/"}]}]